<!DOCTYPE html>
<html lang="ja">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width,initial-scale=1">
<title>CORETO â€” Business Management System</title>
<link href="https://fonts.googleapis.com/css2?family=Kaisei+Tokumin:wght@400;700&family=DM+Mono:wght@400;500&family=Noto+Sans+JP:wght@300;400;500;700&display=swap" rel="stylesheet">
<style>
/* â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
   RESET & VARS
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• */
*,*::before,*::after{box-sizing:border-box;margin:0;padding:0}
:root{
  --bg:       #0b0d12;
  --bg2:      #0f1219;
  --bg3:      #141820;
  --card:     #141820;
  --card2:    #191e28;
  --border:   #1e2435;
  --border2:  #252c3d;
  --text:     #e4e7f0;
  --sub:      #7a82a0;
  --muted:    #3e4565;
  --gold:     #c9a840;
  --gold2:    #e0bc5a;
  --gold-dim: rgba(201,168,64,.35);
  --gold-bg:  rgba(201,168,64,.07);
  --blue:     #4f9cf9;
  --green:    #34d399;
  --red:      #f87171;
  --orange:   #fb923c;
  --purple:   #a78bfa;
  --teal:     #2dd4bf;
  --sidebar-w:220px;
}
html,body{height:100%;background:var(--bg);color:var(--text);font-family:'Noto Sans JP',sans-serif;font-size:13px;line-height:1.5}

/* â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
   LOGIN SCREEN
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• */
#login-screen{
  position:fixed;inset:0;z-index:9999;
  background:var(--bg);
  display:flex;align-items:center;justify-content:center;
  background-image:radial-gradient(ellipse at 50% 0%, rgba(201,168,64,.06) 0%, transparent 70%);
}
.lf-card{
  width:380px;
  background:var(--bg2);
  border:1px solid var(--border2);
  border-radius:18px;
  padding:36px 32px 28px;
  box-shadow:0 32px 80px rgba(0,0,0,.6);
  position:relative;
  overflow:hidden;
}
.lf-card::before{
  content:'';position:absolute;top:0;left:0;right:0;height:2px;
  background:linear-gradient(90deg,transparent,var(--gold),transparent);
}
.lf-logo{
  font-family:'Kaisei Tokumin',serif;
  font-size:26px;letter-spacing:5px;color:var(--gold);
  text-align:center;margin-bottom:4px;
}
.lf-sub{font-size:10px;color:var(--muted);letter-spacing:2px;text-align:center;margin-bottom:28px;text-transform:uppercase}
.lf-label{display:block;font-size:10px;color:var(--sub);letter-spacing:1px;text-transform:uppercase;margin-bottom:5px}
.lf-input{
  width:100%;padding:10px 13px;background:var(--bg3);
  border:1px solid var(--border2);border-radius:9px;
  color:var(--text);font-size:13px;font-family:'Noto Sans JP',sans-serif;
  outline:none;transition:border-color .15s;margin-bottom:14px;
}
.lf-input:focus{border-color:var(--gold)}
.lf-btn{
  width:100%;padding:12px;background:var(--gold);color:#000;
  border:none;border-radius:9px;font-size:13px;font-weight:700;
  cursor:pointer;font-family:'Noto Sans JP',sans-serif;
  transition:all .15s;letter-spacing:.5px;margin-top:4px;
}
.lf-btn:hover{background:var(--gold2);transform:translateY(-1px);box-shadow:0 4px 20px rgba(201,168,64,.3)}
.lf-err{color:var(--red);font-size:11px;text-align:center;min-height:18px;margin-bottom:6px}
.lf-loading{
  position:absolute;inset:0;background:var(--bg2);border-radius:18px;
  display:flex;flex-direction:column;align-items:center;justify-content:center;gap:12px;
  display:none;
}
.lf-spinner{
  width:32px;height:32px;border:2px solid var(--border2);
  border-top-color:var(--gold);border-radius:50%;
  animation:spin .7s linear infinite;
}
@keyframes spin{to{transform:rotate(360deg)}}
.lf-demo{margin-top:20px;border-top:1px solid var(--border);padding-top:16px}
.lf-demo-toggle{
  font-size:10px;color:var(--muted);cursor:pointer;
  letter-spacing:1px;text-transform:uppercase;display:block;text-align:center;margin-bottom:10px;
  transition:.15s;
}
.lf-demo-toggle:hover{color:var(--sub)}
.lf-demo-panel{display:none}
.da-row{
  display:flex;align-items:center;gap:10px;padding:8px 10px;
  border-radius:8px;cursor:pointer;transition:background .1s;margin-bottom:4px;
}
.da-row:hover{background:var(--bg3)}
.da-avatar{
  width:30px;height:30px;border-radius:8px;display:flex;align-items:center;
  justify-content:center;font-size:13px;font-weight:700;flex-shrink:0;
}
.da-name{font-size:12px;font-weight:700;flex:1}
.da-id{font-family:'DM Mono',monospace;font-size:10px;color:var(--muted)}
.da-badge{font-size:9px;padding:2px 7px;border-radius:4px;font-weight:700;white-space:nowrap}

/* â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
   SHELL
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• */
#shell{display:none;height:100vh;flex-direction:column}
#shell.on{display:flex}

/* Topbar */
.topbar{
  height:48px;background:var(--bg2);border-bottom:1px solid var(--border);
  display:flex;align-items:center;padding:0 16px 0 0;
  flex-shrink:0;position:relative;z-index:50;
}
.tb-logo{
  width:var(--sidebar-w);flex-shrink:0;
  font-family:'Kaisei Tokumin',serif;font-size:16px;letter-spacing:3px;color:var(--gold);
  padding:0 20px;display:flex;align-items:center;gap:8px;border-right:1px solid var(--border);
  height:100%;
}
.tb-logo-dot{width:6px;height:6px;background:var(--gold);border-radius:50%}
.tb-context{font-size:11px;color:var(--muted);padding:0 16px;flex:1;letter-spacing:.5px}
.tb-right{display:flex;align-items:center;gap:10px}
.tb-avatar{
  width:32px;height:32px;border-radius:9px;
  display:flex;align-items:center;justify-content:center;
  font-size:13px;font-weight:700;cursor:pointer;
  border:1px solid var(--border2);transition:.15s;
}
.tb-avatar:hover{border-color:var(--gold-dim)}
.tb-name{font-size:12px;font-weight:600}
.tb-role{font-size:10px;color:var(--muted)}
.tb-logout{
  padding:5px 12px;border-radius:6px;border:1px solid var(--border2);
  background:transparent;color:var(--muted);font-size:10px;cursor:pointer;
  font-family:'Noto Sans JP',sans-serif;transition:.15s;
}
.tb-logout:hover{border-color:var(--red);color:var(--red)}

/* Body */
.shell-body{display:flex;flex:1;overflow:hidden}

/* Sidebar */
.sidebar{
  width:var(--sidebar-w);flex-shrink:0;
  background:var(--bg2);border-right:1px solid var(--border);
  overflow-y:auto;display:flex;flex-direction:column;padding:12px 0 0;
}
.sb-section{font-size:9px;color:var(--muted);letter-spacing:2px;text-transform:uppercase;
  padding:14px 16px 5px;font-family:'DM Mono',monospace}
.sb-section:first-child{padding-top:6px}
.nav-item{
  display:flex;align-items:center;gap:9px;padding:9px 14px 9px 16px;
  cursor:pointer;transition:all .12s;color:var(--sub);font-size:12px;border-radius:0;
  position:relative;
}
.nav-item:hover{background:var(--bg3);color:var(--text)}
.nav-item.on{background:var(--gold-bg);color:var(--gold)}
.nav-item.on::before{content:'';position:absolute;left:0;top:4px;bottom:4px;width:2px;background:var(--gold);border-radius:0 2px 2px 0}
.ni-icon{font-size:15px;width:22px;text-align:center;flex-shrink:0}
.ni-badge{margin-left:auto;background:var(--red);color:#fff;font-size:9px;padding:1px 6px;border-radius:10px;font-weight:700}
.ni-ext{margin-left:auto;font-size:10px;color:var(--muted);opacity:.6}
.sb-foot{margin-top:auto;padding:12px 16px;border-top:1px solid var(--border);font-family:'DM Mono',monospace;font-size:9px;color:var(--muted)}

/* Content */
.content{flex:1;overflow-y:auto;background:var(--bg)}
.page{display:none;padding:24px 28px;max-width:1300px}
.page.on{display:block;animation:fadeIn .18s ease}
@keyframes fadeIn{from{opacity:0;transform:translateY(4px)}to{opacity:1;transform:none}}

/* â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
   COMMON COMPONENTS
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• */
.page-hdr{margin-bottom:20px}
.page-title{font-size:20px;font-weight:700;letter-spacing:-.3px}
.page-sub{font-size:11px;color:var(--sub);margin-top:3px}

/* Cards */
.card{background:var(--card);border:1px solid var(--border);border-radius:12px;margin-bottom:16px}
.card-hdr{
  display:flex;align-items:center;justify-content:space-between;
  padding:14px 18px 0;
}
.ch-title{font-size:12px;font-weight:700;letter-spacing:.3px}
.card-body{padding:14px 18px}

/* Stats */
.stats-grid{display:grid;gap:12px;margin-bottom:20px}
.sg-4{grid-template-columns:repeat(4,1fr)}
.sg-5{grid-template-columns:repeat(5,1fr)}
.sg-3{grid-template-columns:repeat(3,1fr)}
@media(max-width:1100px){.sg-5{grid-template-columns:repeat(3,1fr)}.sg-4{grid-template-columns:repeat(2,1fr)}}
.stat{background:var(--card);border:1px solid var(--border);border-radius:12px;padding:16px;cursor:default}
.stat-ico{font-size:18px;margin-bottom:8px}
.stat-val{font-size:24px;font-weight:800;line-height:1;margin-bottom:4px}
.stat-label{font-size:11px;color:var(--sub)}
.stat-sub{font-size:10px;color:var(--muted);margin-top:3px}

/* Grid layouts */
.grid-2r{display:grid;grid-template-columns:1fr 340px;gap:16px}
.grid-2{display:grid;grid-template-columns:1fr 1fr;gap:14px}
.grid-3{display:grid;grid-template-columns:repeat(3,1fr);gap:10px}
@media(max-width:1050px){.grid-2r{grid-template-columns:1fr}.grid-2{grid-template-columns:1fr}}

/* Tables */
.tbl{width:100%;border-collapse:collapse;font-size:12px}
.tbl th{padding:9px 12px;text-align:left;font-size:9px;color:var(--muted);letter-spacing:2px;text-transform:uppercase;font-family:'DM Mono',monospace;border-bottom:1px solid var(--border);white-space:nowrap}
.tbl td{padding:10px 12px;border-bottom:1px solid var(--border)}
.tbl tr:last-child td{border-bottom:none}
.tbl tbody tr:hover td{background:var(--bg3)}
.mono{font-family:'DM Mono',monospace}

/* Buttons */
.btn{display:inline-flex;align-items:center;gap:5px;padding:8px 16px;border-radius:8px;border:none;cursor:pointer;font-size:12px;font-weight:700;font-family:'Noto Sans JP',sans-serif;transition:all .15s;text-decoration:none;white-space:nowrap}
.btn-primary{background:var(--gold);color:#000}
.btn-primary:hover{background:var(--gold2)}
.btn-ghost{background:transparent;border:1px solid var(--border2);color:var(--sub)}
.btn-ghost:hover{border-color:var(--gold-dim);color:var(--gold);background:var(--gold-bg)}
.btn-sm{padding:5px 11px;font-size:11px}
.btn-red{background:rgba(248,113,113,.12);border:1px solid rgba(248,113,113,.3);color:var(--red)}
.btn-red:hover{background:rgba(248,113,113,.2)}
.btn-green{background:rgba(52,211,153,.1);border:1px solid rgba(52,211,153,.25);color:var(--green)}
.btn-green:hover{background:rgba(52,211,153,.18)}
.btn-ext::after{content:'â†—';font-size:10px;margin-left:2px;opacity:.6}

/* Pills */
.pill{display:inline-flex;align-items:center;padding:2px 9px;border-radius:20px;font-size:10px;font-weight:700;white-space:nowrap}
.pill-green{background:rgba(52,211,153,.12);color:var(--green)}
.pill-blue{background:rgba(79,156,249,.12);color:var(--blue)}
.pill-orange{background:rgba(251,146,60,.12);color:var(--orange)}
.pill-red{background:rgba(248,113,113,.12);color:var(--red)}
.pill-purple{background:rgba(167,139,250,.12);color:var(--purple)}
.pill-gold{background:rgba(201,168,76,.12);color:var(--gold)}
.pill-muted{background:rgba(74,82,112,.15);color:var(--muted)}

/* Alert bars */
.alert-bar{
  display:flex;align-items:center;gap:10px;padding:10px 14px;
  border-radius:9px;font-size:12px;margin-bottom:10px;
}
.ab-red{background:rgba(248,113,113,.08);border:1px solid rgba(248,113,113,.25);color:var(--red)}
.ab-orange{background:rgba(251,146,60,.08);border:1px solid rgba(251,146,60,.25);color:var(--orange)}
.ab-blue{background:rgba(79,156,249,.08);border:1px solid rgba(79,156,249,.25);color:var(--blue)}
.ab-gold{background:var(--gold-bg);border:1px solid var(--gold-dim);color:var(--gold)}

/* Progress */
.prog-wrap{height:4px;background:var(--border2);border-radius:2px;margin-top:6px;width:100%}
.prog-fill{height:100%;border-radius:2px;transition:width .4s}

/* Feed */
.feed-item{display:flex;align-items:flex-start;gap:11px;padding:10px 0;border-bottom:1px solid var(--border)}
.feed-item:last-child{border-bottom:none}
.fi-dot{width:32px;height:32px;border-radius:9px;display:flex;align-items:center;justify-content:center;font-size:15px;flex-shrink:0}
.fi-msg{font-size:12px}
.fi-time{font-size:10px;color:var(--muted);margin-top:2px}

/* Rank display */
.rank-display{display:flex;align-items:center;gap:14px}
.rank-ring-wrap{position:relative;width:60px;height:60px;flex-shrink:0}
.rank-ring-wrap svg{width:60px;height:60px;transform:rotate(-90deg)}
.rank-ring-inner{position:absolute;inset:0;display:flex;align-items:center;justify-content:center;font-size:20px}

/* Form elements */
.fg{margin-bottom:14px}
.fg label{display:block;font-size:10px;color:var(--sub);letter-spacing:.5px;text-transform:uppercase;margin-bottom:5px}
.fg input,.fg select,.fg textarea{
  width:100%;padding:9px 12px;background:var(--bg3);
  border:1px solid var(--border2);border-radius:8px;
  color:var(--text);font-size:12px;font-family:'Noto Sans JP',sans-serif;
  outline:none;transition:border-color .15s;
}
.fg input:focus,.fg select:focus,.fg textarea:focus{border-color:var(--gold)}
.fg textarea{resize:vertical;min-height:80px;line-height:1.7}
.fg input::placeholder,.fg textarea::placeholder{color:var(--muted)}
.fg select{cursor:pointer}
.row2{display:grid;grid-template-columns:1fr 1fr;gap:12px}

/* Scrollbar */
::-webkit-scrollbar{width:4px;height:4px}
::-webkit-scrollbar-track{background:transparent}
::-webkit-scrollbar-thumb{background:var(--border2);border-radius:2px}
::-webkit-scrollbar-thumb:hover{background:var(--muted)}

/* Exec banner */
.exec-banner{
  display:grid;grid-template-columns:repeat(3,1fr);gap:10px;margin-bottom:18px;
}
.exec-btn{
  display:flex;align-items:center;gap:10px;padding:13px 16px;
  background:linear-gradient(135deg,rgba(201,168,64,.1),rgba(201,168,64,.04));
  border:1px solid rgba(201,168,64,.25);border-radius:10px;
  cursor:pointer;transition:all .15s;
}
.exec-btn:hover{border-color:var(--gold-dim);background:linear-gradient(135deg,rgba(201,168,64,.16),rgba(201,168,64,.07));transform:translateY(-1px)}
.exec-btn-icon{font-size:18px}
.exec-btn-label{font-size:11px;font-weight:700;color:var(--gold)}

/* Quick tools grid (agent) */
.qt-grid{display:grid;grid-template-columns:repeat(3,1fr);gap:9px}
.qt-card{
  background:var(--bg3);border:1px solid var(--border);border-radius:10px;
  padding:13px;text-align:center;cursor:pointer;transition:all .15s;
}
.qt-card:hover{border-color:var(--border2);transform:translateY(-1px)}
.qt-icon{font-size:21px;margin-bottom:6px}
.qt-label{font-size:11px;font-weight:700}

/* â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
   PARTNER SPECIFIC
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• */
.pt-stat{
  background:var(--card);border:1px solid var(--border);border-radius:12px;
  padding:16px;cursor:pointer;transition:all .15s;text-align:center;
}
.pt-stat:hover{border-color:var(--border2);transform:translateY(-2px)}

/* Messages */
.msg-layout{display:grid;grid-template-columns:260px 1fr;gap:0;border:1px solid var(--border);border-radius:12px;overflow:hidden;height:500px}
.msg-list{background:var(--bg2);border-right:1px solid var(--border);overflow-y:auto}
.msg-contact{
  display:flex;align-items:center;gap:10px;padding:12px 14px;
  border-bottom:1px solid var(--border);cursor:pointer;transition:background .1s;
}
.msg-contact:hover{background:var(--bg3)}
.msg-contact.on{background:var(--gold-bg)}
.mc-avatar{width:36px;height:36px;border-radius:10px;display:flex;align-items:center;justify-content:center;font-size:16px;flex-shrink:0}
.mc-name{font-size:12px;font-weight:700}
.mc-last{font-size:10px;color:var(--muted);white-space:nowrap;overflow:hidden;text-overflow:ellipsis;max-width:150px}
.mc-time{font-size:10px;color:var(--muted);white-space:nowrap}
.mc-unread{background:var(--gold);color:#000;font-size:9px;padding:1px 5px;border-radius:8px;font-weight:700}
.msg-main{display:flex;flex-direction:column;background:var(--card)}
.msg-hdr{display:flex;align-items:center;gap:10px;padding:14px 16px;border-bottom:1px solid var(--border);flex-shrink:0}
.msg-body{flex:1;overflow-y:auto;padding:16px;display:flex;flex-direction:column;gap:10px}
.msg-bubble{max-width:72%;padding:9px 13px;border-radius:12px;font-size:12px;line-height:1.6;word-break:break-word}
.msg-me{background:var(--gold);color:#000;margin-left:auto;border-radius:12px 12px 3px 12px}
.msg-them{background:var(--bg3);border:1px solid var(--border);border-radius:12px 12px 12px 3px}
.msg-time{font-size:10px;color:var(--muted);margin-top:2px;text-align:right}
.msg-them + .msg-time{text-align:left}
.msg-footer{display:flex;gap:8px;padding:12px 14px;border-top:1px solid var(--border);flex-shrink:0}
.msg-input{
  flex:1;padding:8px 12px;background:var(--bg3);border:1px solid var(--border2);
  border-radius:8px;color:var(--text);font-size:12px;font-family:'Noto Sans JP',sans-serif;
  outline:none;resize:none;
}
.msg-input:focus{border-color:var(--gold)}

/* Stepper */
.stepper{display:flex;align-items:center;gap:0}
.step{display:flex;align-items:center}
.step-dot{
  width:18px;height:18px;border-radius:50%;display:flex;align-items:center;
  justify-content:center;font-size:9px;font-weight:700;flex-shrink:0;
}
.step-dot.done{background:var(--green);color:#000}
.step-dot.active{background:var(--blue);color:#fff}
.step-dot.wait{background:var(--border2);color:var(--muted)}
.step-line{width:16px;height:2px;background:var(--border2)}
.step-line.done{background:var(--green)}

/* Code display */
.code-box{
  background:var(--bg3);border:1px solid var(--gold-dim);border-radius:12px;
  padding:18px;margin-bottom:12px;
}
.code-big{font-family:'DM Mono',monospace;font-size:26px;font-weight:700;color:var(--gold);letter-spacing:3px;margin:8px 0}
.code-share-btns{display:flex;gap:8px;flex-wrap:wrap}

/* HQ Role badge */
.hq-role-badge{
  display:inline-block;font-size:10px;padding:2px 9px;border-radius:5px;margin-left:10px;vertical-align:middle;font-weight:700;
}
.hrb-exec{background:rgba(201,168,64,.15);color:var(--gold)}
.hrb-manager{background:rgba(79,156,249,.12);color:var(--blue)}
.hrb-staff{background:rgba(52,211,153,.1);color:var(--green)}

/* Matching page */
.match-card{
  background:var(--card);border:1px solid var(--border);border-radius:11px;
  padding:14px;cursor:pointer;transition:all .15s;margin-bottom:10px;
}
.match-card:hover{border-color:var(--border2);transform:translateY(-1px)}
.match-card.selected{border-color:var(--gold)}
.mc-status-bar{height:3px;border-radius:2px;margin:-14px -14px 12px;background:var(--border)}
.mc-status-open{background:var(--blue)}
.mc-status-done{background:var(--green)}
.mc-status-pending{background:var(--orange)}

/* â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
   SCROLLBAR & UTILITIES
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• */
.text-gold{color:var(--gold)}
.text-blue{color:var(--blue)}
.text-green{color:var(--green)}
.text-red{color:var(--red)}
.text-orange{color:var(--orange)}
.text-muted{color:var(--muted)}
.text-sub{color:var(--sub)}
.fw-700{font-weight:700}

/* â”€â”€ ç´¹ä»‹ãƒªãƒ³ã‚¯ãƒ¢ãƒ¼ãƒ€ãƒ« â”€â”€ */
#ref-modal-overlay{display:none;position:fixed;inset:0;background:rgba(0,0,0,.65);z-index:9000;align-items:center;justify-content:center}
#ref-modal-overlay.open{display:flex}
#ref-modal{background:var(--card);border:1px solid var(--border2);border-radius:16px;padding:0;width:min(460px,92vw);overflow:hidden}
.ref-mhdr{padding:16px 20px;border-bottom:1px solid var(--border);display:flex;align-items:center;justify-content:space-between}
.ref-mhdr-t{font-family:'Syne',sans-serif;font-size:14px;font-weight:800;color:var(--gold)}
.ref-mbody{padding:20px}
.ref-url{background:var(--card2);border:1px solid var(--border2);border-radius:8px;padding:10px 12px;font-family:'DM Mono',monospace;font-size:11px;color:var(--sub);word-break:break-all;margin:10px 0;min-height:36px}
.ref-copy-btn{width:100%;padding:10px;border-radius:8px;border:none;cursor:pointer;font-family:inherit;font-size:13px;font-weight:700;background:var(--gold);color:#0a0c10;margin-top:4px}
.ref-copy-btn:hover{opacity:.9}
</style>
</head>
<body>

<!-- â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
  LOGIN
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• -->
<div id="login-screen">
  <div class="lf-card">
    <div class="lf-loading" id="lf-loading">
      <div class="lf-spinner"></div>
      <div style="font-size:12px;color:var(--sub)">èªè¨¼ä¸­...</div>
    </div>

    <div class="lf-logo">CORETO</div>
    <div class="lf-sub">Business Management System</div>

    <div class="lf-err" id="lf-err"></div>

    <label class="lf-label" for="lf-id">CORETO ID</label>
    <input class="lf-input" type="text" id="lf-id" placeholder="ä¾‹ï¼š10012" maxlength="10"
           autocomplete="username"
           onkeydown="if(event.key==='Enter')document.getElementById('lf-pw').focus()">

    <label class="lf-label" for="lf-pw">ãƒ‘ã‚¹ãƒ¯ãƒ¼ãƒ‰</label>
    <input class="lf-input" type="password" id="lf-pw" placeholder="â€¢â€¢â€¢â€¢â€¢â€¢â€¢â€¢"
           autocomplete="current-password"
           onkeydown="if(event.key==='Enter')doLogin()">

    <button class="lf-btn" onclick="doLogin()">ãƒ­ã‚°ã‚¤ãƒ³</button>

    <div class="lf-demo">
      <span class="lf-demo-toggle" onclick="toggleDemo(this)">â–¼ ãƒ‡ãƒ¢ã‚¢ã‚«ã‚¦ãƒ³ãƒˆä¸€è¦§</span>
      <div class="lf-demo-panel" id="lf-demo-panel">
        <div style="font-size:9px;color:var(--muted);text-align:center;margin-bottom:10px;letter-spacing:1px">ã‚¯ãƒªãƒƒã‚¯ã§è‡ªå‹•å…¥åŠ› / PW: coreto2026</div>
        <div class="da-row" onclick="fillDemo('00001')">
          <div class="da-avatar" style="background:rgba(201,168,64,.15);color:var(--gold)">çµ±</div>
          <div><div class="da-name">HQ çµ±æ‹¬</div><div class="da-id">00001</div></div>
          <span class="da-badge" style="background:rgba(201,168,64,.15);color:var(--gold)">exec</span>
        </div>
        <div class="da-row" onclick="fillDemo('00347')">
          <div class="da-avatar" style="background:rgba(79,156,249,.12);color:var(--blue)">ãƒ</div>
          <div><div class="da-name">HQ ãƒãƒãƒ¼ã‚¸ãƒ£ãƒ¼</div><div class="da-id">00347</div></div>
          <span class="da-badge" style="background:rgba(79,156,249,.12);color:var(--blue)">manager</span>
        </div>
        <div class="da-row" onclick="fillDemo('00891')">
          <div class="da-avatar" style="background:rgba(52,211,153,.1);color:var(--green)">ã‚¹</div>
          <div><div class="da-name">HQ ã‚¹ã‚¿ãƒƒãƒ•</div><div class="da-id">00891</div></div>
          <span class="da-badge" style="background:rgba(52,211,153,.1);color:var(--green)">staff</span>
        </div>
        <div style="height:1px;background:var(--border);margin:8px 0"></div>
        <div class="da-row" onclick="fillDemo('10008')">
          <div class="da-avatar" style="background:rgba(167,139,250,.15);color:var(--purple)">ä½</div>
          <div><div class="da-name">ä½è—¤ èŠ±å­</div><div class="da-id">10008</div></div>
          <span class="da-badge" style="background:rgba(167,139,250,.12);color:var(--purple)">RE Platinum</span>
        </div>
        <div class="da-row" onclick="fillDemo('10012')">
          <div class="da-avatar" style="background:rgba(201,168,64,.15);color:var(--gold)">å±±</div>
          <div><div class="da-name">å±±ç”° èª </div><div class="da-id">10012</div></div>
          <span class="da-badge" style="background:rgba(201,168,64,.12);color:var(--gold)">RE Gold</span>
        </div>
        <div class="da-row" onclick="fillDemo('20005')">
          <div class="da-avatar" style="background:rgba(52,211,153,.1);color:var(--green)">ç”°</div>
          <div><div class="da-name">ç”°ä¸­ ç¾ç©‚</div><div class="da-id">20005</div></div>
          <span class="da-badge" style="background:rgba(52,211,153,.1);color:var(--green)">HR Gold</span>
        </div>
        <div class="da-row" onclick="fillDemo('30007')">
          <div class="da-avatar" style="background:rgba(167,139,250,.12);color:var(--purple)">ä½</div>
          <div><div class="da-name">ä½è—¤ ç¾å’²</div><div class="da-id">30007</div></div>
          <span class="da-badge" style="background:rgba(167,139,250,.12);color:var(--purple)">Partner</span>
        </div>
      </div>
    </div>
  </div>
</div>

<!-- â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
  SHELL
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• -->
<div id="shell">
  <!-- Topbar -->
  <div class="topbar">
    <div class="tb-logo">
      <div class="tb-logo-dot"></div>
      CORETO
    </div>
    <div class="tb-context" id="tb-context">â€”</div>
    <div class="tb-right">
      <div>
        <div class="tb-name" id="tb-name">â€”</div>
        <div class="tb-role" id="tb-role">â€”</div>
      </div>
      <div class="tb-avatar" id="tb-avatar">?</div>
      <button onclick="openRefModal()" style="background:rgba(201,168,76,.15);border:1px solid rgba(201,168,76,.35);color:var(--gold);border-radius:7px;padding:4px 10px;cursor:pointer;font-size:11px;font-weight:700;font-family:inherit;white-space:nowrap;margin-right:6px">ğŸ”— ç´¹ä»‹ãƒªãƒ³ã‚¯</button>
      <button onclick="openRefModal()" style="background:rgba(201,168,76,.15);border:1px solid rgba(201,168,76,.35);color:var(--gold);border-radius:7px;padding:4px 10px;cursor:pointer;font-size:11px;font-weight:700;font-family:inherit;white-space:nowrap">ğŸ”— ç´¹ä»‹ãƒªãƒ³ã‚¯</button>
      <button class="tb-logout" onclick="doLogout()">ãƒ­ã‚°ã‚¢ã‚¦ãƒˆ</button>
    </div>
  </div>

  <!-- Body -->
  <div class="shell-body">
    <div class="sidebar" id="sidebar"></div>
    <div class="content" id="content"></div>
  </div>
</div>

<script>
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
//  USERS & AUTH
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
const USERS = {
  '00001':{ name:'HQ çµ±æ‹¬',        type:'hq', hqRole:'exec',    pw:'coreto2026', color:'var(--gold)',   avatar:'çµ±' },
  '00347':{ name:'HQ ãƒãƒãƒ¼ã‚¸ãƒ£ãƒ¼',type:'hq', hqRole:'manager', pw:'coreto2026', color:'var(--blue)',   avatar:'ãƒ' },
  '00891':{ name:'HQ ã‚¹ã‚¿ãƒƒãƒ•',    type:'hq', hqRole:'staff',   pw:'coreto2026', color:'var(--green)',  avatar:'ã‚¹' },
  '10008':{ name:'ä½è—¤ èŠ±å­', type:'re', rank:'Platinum', rankKey:'platinum', pw:'coreto2026', color:'var(--purple)', avatar:'ä½' },
  '10012':{ name:'å±±ç”° èª ',   type:'re', rank:'Gold',     rankKey:'gold',     pw:'coreto2026', color:'var(--gold)',   avatar:'å±±' },
  '10023':{ name:'éˆ´æœ¨ å¥å¤ª', type:'re', rank:'Silver',   rankKey:'silver',   pw:'coreto2026', color:'var(--green)',  avatar:'éˆ´' },
  '10041':{ name:'æ¸¡è¾º éš†',   type:'re', rank:'Bronze',   rankKey:'bronze',   pw:'coreto2026', color:'var(--orange)', avatar:'æ¸¡' },
  '20005':{ name:'ç”°ä¸­ ç¾ç©‚', type:'hr', rank:'Gold',     rankKey:'gold',     pw:'coreto2026', color:'var(--green)',  avatar:'ç”°' },
  '30007':{ name:'ä½è—¤ ç¾å’²', type:'pt', rank:'Partner',  rankKey:'pt',       pw:'coreto2026', color:'var(--purple)', avatar:'ä½' },
};

// HQ role hierarchy
const HQ_LEVEL = { exec:3, manager:2, staff:1 };

let session = null;
let currentPage = 'dashboard';

// â”€ Restore session â”€
(function(){
  const s = JSON.parse(sessionStorage.getItem('coreto_session') || 'null');
  if(s && USERS[s.userId] && USERS[s.userId].type === s.type) {
    session = {...USERS[s.userId], userId: s.userId};
    document.getElementById('login-screen').style.display = 'none';
    initShell();
  }
})();

function doLogin() {
  const id = document.getElementById('lf-id').value.trim().padStart(5,'0');
  const pw = document.getElementById('lf-pw').value;
  const errEl = document.getElementById('lf-err');
  errEl.textContent = '';
  const u = USERS[id] || USERS[document.getElementById('lf-id').value.trim()];
  if(!u || u.pw !== pw) {
    errEl.textContent = 'IDã¾ãŸã¯ãƒ‘ã‚¹ãƒ¯ãƒ¼ãƒ‰ãŒæ­£ã—ãã‚ã‚Šã¾ã›ã‚“';
    return;
  }
  document.getElementById('lf-loading').style.display = 'flex';
  const actualId = Object.keys(USERS).find(k => USERS[k] === u) || id;
  setTimeout(() => {
    session = {...u, userId: actualId};
    sessionStorage.setItem('coreto_session', JSON.stringify({ userId: actualId, type: u.type }));
    document.getElementById('login-screen').style.display = 'none';
    document.getElementById('lf-loading').style.display = 'none';
    initShell();
  }, 800);
}

function doLogout() {
  if(!confirm('ãƒ­ã‚°ã‚¢ã‚¦ãƒˆã—ã¾ã™ã‹ï¼Ÿ')) return;
  sessionStorage.removeItem('coreto_session');
  session = null;
  document.getElementById('shell').className = '';
  document.getElementById('login-screen').style.display = 'flex';
  document.getElementById('lf-id').value = '';
  document.getElementById('lf-pw').value = '';
  document.getElementById('lf-err').textContent = '';
  document.getElementById('content').innerHTML = '';
  document.getElementById('sidebar').innerHTML = '';
}

function fillDemo(id) {
  document.getElementById('lf-id').value = id;
  document.getElementById('lf-pw').value = 'coreto2026';
  document.getElementById('lf-err').textContent = '';
}
function toggleDemo(el) {
  const panel = document.getElementById('lf-demo-panel');
  panel.style.display = panel.style.display === 'block' ? 'none' : 'block';
  el.textContent = panel.style.display === 'block' ? 'â–² ãƒ‡ãƒ¢ã‚¢ã‚«ã‚¦ãƒ³ãƒˆä¸€è¦§' : 'â–¼ ãƒ‡ãƒ¢ã‚¢ã‚«ã‚¦ãƒ³ãƒˆä¸€è¦§';
}

// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
//  SHELL INIT
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
function initShell() {
  const u = session;
  const shell = document.getElementById('shell');
  shell.classList.add('on');

  // Topbar
  document.getElementById('tb-avatar').textContent = u.avatar;
  document.getElementById('tb-avatar').style.cssText = `background:${u.color}18;color:${u.color};border:1px solid ${u.color}30`;
  document.getElementById('tb-name').textContent = u.name;
  document.getElementById('tb-role').textContent =
    u.type==='hq' ? `HQ ${u.hqRole==='exec'?'çµ±æ‹¬':u.hqRole==='manager'?'ç®¡ç†è·':'ã‚¹ã‚¿ãƒƒãƒ•'}` :
    u.type==='re' ? `ä¸å‹•ç”£AG â€” ${u.rank}` :
    u.type==='hr' ? `äººæç´¹ä»‹AG â€” ${u.rank}` : 'ãƒ‘ãƒ¼ãƒˆãƒŠãƒ¼';
  const ctxMap = {hq:'ç®¡ç†ãƒ€ãƒƒã‚·ãƒ¥ãƒœãƒ¼ãƒ‰', re:'ã‚¨ãƒ¼ã‚¸ã‚§ãƒ³ãƒˆãƒãƒ¼ã‚¿ãƒ«', hr:'HRã‚¨ãƒ¼ã‚¸ã‚§ãƒ³ãƒˆãƒãƒ¼ã‚¿ãƒ«', pt:'ãƒ‘ãƒ¼ãƒˆãƒŠãƒ¼ãƒ€ãƒƒã‚·ãƒ¥ãƒœãƒ¼ãƒ‰'};
  document.getElementById('tb-context').textContent = ctxMap[u.type] || '';

  buildSidebar();
  buildContent();
}

// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
//  NAVIGATION
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
function buildSidebar() {
  const sb = document.getElementById('sidebar');
  sb.innerHTML = '';
  const nav = getSidebarNav();

  nav.forEach(section => {
    const label = document.createElement('div');
    label.className = 'sb-section';
    label.textContent = section.section;
    sb.appendChild(label);

    section.items.forEach(item => {
      const el = document.createElement('div');
      el.className = 'nav-item' + (item.id === currentPage ? ' on' : '');
      el.id = 'nav-' + item.id;
      let inner = `<div class="ni-icon">${item.icon}</div><span>${item.label}</span>`;
      if(item.badge) inner += `<span class="ni-badge">${item.badge}</span>`;
      if(item.ext)   inner += `<span class="ni-ext">â†—</span>`;
      el.innerHTML = inner;

      if(item.ext) {
        // Genuine external tools: open in new tab
        el.onclick = () => window.open(item.url, '_blank');
      } else {
        el.onclick = () => goPage(item.id);
      }
      sb.appendChild(el);
    });
  });

  const foot = document.createElement('div');
  foot.className = 'sb-foot';
  foot.innerHTML = `ID: ${session.userId}<br><span style="opacity:.5">v3.0 / 2026.02</span>`;
  sb.appendChild(foot);
}

function getSidebarNav() {
  const t = session.type;
  const role = session.hqRole || '';

  if(t === 'hq') {
    const nav = [];
    nav.push({ section:'ãƒ¡ã‚¤ãƒ³', items:[
      { id:'dashboard', icon:'ğŸ“Š', label:'ãƒ€ãƒƒã‚·ãƒ¥ãƒœãƒ¼ãƒ‰' },
    ]});

    if(HQ_LEVEL[role] >= 3) { // exec only
      nav.push({ section:'çµŒå–¶é™£', items:[
        { id:'exec-dashboard', icon:'ğŸ“ˆ', label:'åç›Šãƒ€ãƒƒã‚·ãƒ¥ãƒœãƒ¼ãƒ‰', url:'coreto-exec-dashboard.html', ext:true },
        { id:'agent-mgmt',     icon:'ğŸ‘¥', label:'å…¨ã‚¨ãƒ¼ã‚¸ã‚§ãƒ³ãƒˆç®¡ç†', url:'coreto-agent-mgmt.html', ext:true },
        { id:'network-tree',   icon:'ğŸŒ', label:'ç´¹ä»‹ãƒãƒƒãƒˆãƒ¯ãƒ¼ã‚¯å›³', url:'coreto-network-tree.html', ext:true },
      ]});
    }

    nav.push({ section:'æ¥­å‹™', items:[
      { id:'matching',  icon:'ğŸ¯', label:'ãƒãƒƒãƒãƒ³ã‚°' },
      { id:'screening', icon:'ğŸ“‹', label:'æ›¸é¡å¯©æŸ»ãƒ»ã‚¹ã‚¯ãƒªãƒ¼ãƒ‹ãƒ³ã‚°', url:'coreto-screening.html', ext:true },
      { id:'naiken-hq', icon:'ğŸ ', label:'å†…è¦‹ç”³è¾¼ç®¡ç†', url:'coreto-naiken.html', ext:true },
      { id:'sale-report',icon:'ğŸ¢', label:'å£²è²·å ±å‘Šæ›¸ï¼ˆæ‰¿èªï¼‰', url:'coreto-sale-report.html', ext:true },
      { id:'early-quit',icon:'âš ï¸', label:'æ—©æœŸé€€è·ã‚¢ãƒ©ãƒ¼ãƒˆ', badge:'2', url:'coreto-early-quit.html', ext:true },
      { id:'kyc',       icon:'ğŸªª', label:'KYCå¯©æŸ»', badge:'4', url:'coreto-kyc.html', ext:true },
    ]});

    if(HQ_LEVEL[role] >= 2) { // manager+
      nav.push({ section:'å ±é…¬ãƒ»æ”¯æ‰•ã„', items:[
        { id:'payroll',  icon:'ğŸ’°', label:'æœˆæ¬¡å ±é…¬ç¢ºå®š', url:'coreto-payroll.html', ext:true },
        { id:'payment',  icon:'ğŸ’´', label:'æ”¯æ‰•æ˜ç´°', url:'coreto-payment.html', ext:true },
        { id:'instant-pay', icon:'âš¡', label:'å³æ™‚æ‰•ã„ç”³è«‹', badge:'3', url:'coreto-instant-pay.html', ext:true },
      ]});
      nav.push({ section:'ã‚¨ãƒ¼ã‚¸ã‚§ãƒ³ãƒˆç®¡ç†', items:[
        { id:'codes',      icon:'ğŸ”–', label:'ç´¹ä»‹ã‚³ãƒ¼ãƒ‰ç®¡ç†', url:'coreto-codes.html', ext:true },
        { id:'pt-mgmt',    icon:'ğŸ¤', label:'ãƒ‘ãƒ¼ãƒˆãƒŠãƒ¼ç®¡ç†', url:'coreto-partner.html', ext:true },
        { id:'rbac',       icon:'ğŸ›¡', label:'æ¨©é™ç®¡ç†', url:'coreto-admin-rbac.html', ext:true },
      ]});
    }

    nav.push({ section:'ãƒ„ãƒ¼ãƒ«', items:[
      { id:'label',  icon:'ğŸ“®', label:'ãƒ©ãƒ™ãƒ«å°åˆ·', url:'coreto-thermal-label.html', ext:true },
      { id:'barcode',icon:'ğŸ“¡', label:'ã‚¹ã‚­ãƒ£ãƒ³', url:'coreto-barcode-scan.html', ext:true },
    ]});
    return nav;
  }

  if(t === 're') {
    return [
      { section:'ãƒ¡ã‚¤ãƒ³', items:[
        { id:'dashboard', icon:'ğŸ“Š', label:'ãƒ€ãƒƒã‚·ãƒ¥ãƒœãƒ¼ãƒ‰' },
        { id:'mypage',    icon:'ğŸ‘¤', label:'ãƒã‚¤ãƒšãƒ¼ã‚¸ãƒ»ãƒ—ãƒ­ãƒ•ã‚£ãƒ¼ãƒ«' },
        { id:'rank',      icon:'â­', label:'ãƒ©ãƒ³ã‚¯ãƒ»ãƒã‚¤ãƒ³ãƒˆ' },
      ]},
      { section:'æ¡ˆä»¶æ¥­å‹™', items:[
        { id:'pipeline',   icon:'ğŸ“‹', label:'æ¡ˆä»¶ç®¡ç†', url:'coreto-pipeline.html', ext:true },
        { id:'it-setsu',   icon:'ğŸ“', label:'ITé‡èª¬', url:'coreto-it-setsu.html', ext:true },
        { id:'sale-report',icon:'ğŸ¢', label:'å£²è²·å ±å‘Šæ›¸', url:'coreto-sale-report.html', ext:true },
      ]},
      { section:'ãƒ„ãƒ¼ãƒ«', items:[
        { id:'simulator',  icon:'ğŸ§®', label:'å ±é…¬ã‚·ãƒŸãƒ¥ãƒ¬ãƒ¼ã‚¿ãƒ¼' },
        { id:'receipt',    icon:'ğŸ§¾', label:'é ˜åæ›¸ãƒ»è«‹æ±‚æ›¸', url:'coreto-receipt.html', ext:true },
      ]},
      { section:'ã‚¢ã‚«ã‚¦ãƒ³ãƒˆ', items:[
        { id:'line-link',  icon:'ğŸ’¬', label:'LINEé€£æº', url:'coreto-line-link.html', ext:true },
        { id:'kyc',        icon:'ğŸªª', label:'eKYCãƒ»æœ¬äººç¢ºèª', url:'coreto-kyc.html', ext:true },
        { id:'settings',   icon:'âš™ï¸',  label:'ã‚¢ã‚«ã‚¦ãƒ³ãƒˆè¨­å®š', url:'coreto-account-settings.html', ext:true },
      ]},
    ];
  }

  if(t === 'hr') {
    return [
      { section:'ãƒ¡ã‚¤ãƒ³', items:[
        { id:'dashboard', icon:'ğŸ“Š', label:'ãƒ€ãƒƒã‚·ãƒ¥ãƒœãƒ¼ãƒ‰' },
        { id:'mypage',    icon:'ğŸ‘¤', label:'ãƒã‚¤ãƒšãƒ¼ã‚¸ãƒ»ãƒ—ãƒ­ãƒ•ã‚£ãƒ¼ãƒ«' },
        { id:'rank',      icon:'â­', label:'ãƒ©ãƒ³ã‚¯ãƒ»ãƒã‚¤ãƒ³ãƒˆ' },
      ]},
      { section:'HRæ¥­å‹™', items:[
        { id:'hr-cases',   icon:'ğŸ‘¥', label:'æ‹…å½“æ¡ˆä»¶' },
        { id:'early-quit-ag',icon:'âš ï¸',label:'æ—©æœŸé€€è·ãƒ•ã‚©ãƒ­ãƒ¼', badge:'1', url:'coreto-early-quit.html', ext:true },
      ]},
      { section:'ãƒ„ãƒ¼ãƒ«', items:[
        { id:'simulator',  icon:'ğŸ§®', label:'å ±é…¬ã‚·ãƒŸãƒ¥ãƒ¬ãƒ¼ã‚¿ãƒ¼' },
        { id:'receipt',    icon:'ğŸ§¾', label:'é ˜åæ›¸ãƒ»è«‹æ±‚æ›¸', url:'coreto-receipt.html', ext:true },
      ]},
      { section:'ã‚¢ã‚«ã‚¦ãƒ³ãƒˆ', items:[
        { id:'line-link',  icon:'ğŸ’¬', label:'LINEé€£æº', url:'coreto-line-link.html', ext:true },
        { id:'kyc',        icon:'ğŸªª', label:'eKYCãƒ»æœ¬äººç¢ºèª', url:'coreto-kyc.html', ext:true },
        { id:'settings',   icon:'âš™ï¸',  label:'ã‚¢ã‚«ã‚¦ãƒ³ãƒˆè¨­å®š', url:'coreto-account-settings.html', ext:true },
      ]},
    ];
  }

  if(t === 'pt') {
    return [
      { section:'ãƒ¡ã‚¤ãƒ³', items:[
        { id:'dashboard', icon:'ğŸ“Š', label:'ãƒ€ãƒƒã‚·ãƒ¥ãƒœãƒ¼ãƒ‰' },
        { id:'pt-cases',  icon:'ğŸ“‹', label:'ç´¹ä»‹æ¡ˆä»¶' },
        { id:'pt-code',   icon:'ğŸ”—', label:'ç´¹ä»‹ã‚³ãƒ¼ãƒ‰ãƒ»ãƒªãƒ³ã‚¯' },
        { id:'pt-rewards',icon:'ğŸ’°', label:'å ±é…¬ãƒ»æŒ¯è¾¼æ˜ç´°' },
        { id:'pt-msgs',   icon:'ğŸ’¬', label:'ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸' },
        { id:'pt-register',icon:'â•', label:'æ–°è¦ç´¹ä»‹ã‚’ç™»éŒ²' },
      ]},
      { section:'ã‚¢ã‚«ã‚¦ãƒ³ãƒˆ', items:[
        { id:'line-link',  icon:'ğŸ’¬', label:'LINEé€£æº', url:'coreto-line-link.html', ext:true },
        { id:'kyc',        icon:'ğŸªª', label:'eKYCãƒ»æœ¬äººç¢ºèª', url:'coreto-kyc.html', ext:true },
      ]},
    ];
  }

  return [];
}

function goPage(pageId) {
  currentPage = pageId;
  document.querySelectorAll('.nav-item').forEach(n => {
    n.classList.toggle('on', n.id === 'nav-' + pageId);
  });
  document.querySelectorAll('.page').forEach(p => p.classList.remove('on'));
  const pg = document.getElementById('page-' + pageId);
  if(pg) {
    pg.classList.add('on');
  } else {
    buildPageContent(pageId);
  }
}

// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
//  CONTENT BUILDER
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
function buildContent() {
  const cnt = document.getElementById('content');
  cnt.innerHTML = '';
  const t = session.type;

  if(t === 'hq') {
    cnt.innerHTML = hqDashPage() + hqMatchingPage();
  } else if(t === 're') {
    cnt.innerHTML = reDashPage() + reMyPage() + rankPage() + simPage();
  } else if(t === 'hr') {
    cnt.innerHTML = hrDashPage() + hrCasesPage() + rankPage() + simPage();
  } else if(t === 'pt') {
    cnt.innerHTML = ptDashPage() + ptCasesPage() + ptCodePage() + ptRewardsPage() + ptMsgsPage() + ptRegisterPage();
  }

  goPage('dashboard');
}

function buildPageContent(pageId) {
  // Pages not pre-built â€” show placeholder
  const cnt = document.getElementById('content');
  const div = document.createElement('div');
  div.className = 'page on';
  div.id = 'page-' + pageId;
  div.innerHTML = `<div class="page-hdr"><div class="page-title">${pageId}</div></div><p style="color:var(--muted)">ã“ã®ãƒšãƒ¼ã‚¸ã¯æº–å‚™ä¸­ã§ã™ã€‚</p>`;
  cnt.appendChild(div);
}

// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
//  HQ PAGES
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
function hqDashPage() {
  const u = session;
  const role = u.hqRole || 'staff';
  const roleLabel = {exec:'çµ±æ‹¬', manager:'ç®¡ç†è·', staff:'ã‚¹ã‚¿ãƒƒãƒ•'}[role];
  const roleCls   = {exec:'hrb-exec', manager:'hrb-manager', staff:'hrb-staff'}[role];

  const execBanner = role === 'exec' ? `
  <div class="exec-banner">
    <div class="exec-btn" onclick="window.open('coreto-exec-dashboard.html','_blank')">
      <div class="exec-btn-icon">ğŸ“ˆ</div>
      <div class="exec-btn-label">åç›Šãƒ€ãƒƒã‚·ãƒ¥ãƒœãƒ¼ãƒ‰ï¼ˆP&amp;Lï¼‰</div>
      <span style="margin-left:auto;font-size:10px;color:var(--muted)">â†—</span>
    </div>
    <div class="exec-btn" onclick="window.open('coreto-agent-mgmt.html','_blank')">
      <div class="exec-btn-icon">ğŸ‘¥</div>
      <div class="exec-btn-label">å…¨ã‚¨ãƒ¼ã‚¸ã‚§ãƒ³ãƒˆç®¡ç†</div>
      <span style="margin-left:auto;font-size:10px;color:var(--muted)">â†—</span>
    </div>
    <div class="exec-btn" onclick="window.open('coreto-network-tree.html','_blank')">
      <div class="exec-btn-icon">ğŸŒ</div>
      <div class="exec-btn-label">ç´¹ä»‹ãƒãƒƒãƒˆãƒ¯ãƒ¼ã‚¯å›³</div>
      <span style="margin-left:auto;font-size:10px;color:var(--muted)">â†—</span>
    </div>
  </div>` : '';

  return `<div class="page" id="page-dashboard">
  <div class="page-hdr">
    <div class="page-title">HQ ãƒ€ãƒƒã‚·ãƒ¥ãƒœãƒ¼ãƒ‰ <span class="hq-role-badge ${roleCls}">${roleLabel}</span></div>
    <div class="page-sub">CORETO æ¥­å‹™çŠ¶æ³ â€” 2026å¹´2æœˆ21æ—¥ï¼ˆåœŸï¼‰ç¾åœ¨</div>
  </div>
  ${execBanner}

  <div class="ab-red alert-bar">ğŸš¨ <strong>æ—©æœŸé€€è·ã‚¢ãƒ©ãƒ¼ãƒˆ</strong>ï¼šå¯¾å¿œå¾…ã¡ 2ä»¶ / è¿”é‡‘è¦è«‹ Â¥693,000
    <button class="btn btn-sm" style="margin-left:auto;background:rgba(248,113,113,.15);border:1px solid rgba(248,113,113,.3);color:var(--red);cursor:pointer" onclick="window.open('coreto-early-quit.html','_blank')">å¯¾å¿œ â†—</button>
  </div>
  <div class="ab-orange alert-bar">ğŸªª <strong>KYCå¯©æŸ»å¾…ã¡</strong>ï¼š4ä»¶ / åç¾©ä¸ä¸€è‡´ãƒ•ãƒ©ã‚° 1ä»¶
    <button class="btn btn-sm" style="margin-left:auto;background:rgba(251,146,60,.12);border:1px solid rgba(251,146,60,.3);color:var(--orange);cursor:pointer" onclick="window.open('coreto-kyc.html','_blank')">å¯©æŸ» â†—</button>
  </div>

  <div class="stats-grid sg-5">
    <div class="stat"><div class="stat-ico">ğŸ“‹</div><div class="stat-val text-blue">24</div><div class="stat-label">é€²è¡Œä¸­æ¡ˆä»¶</div><div class="stat-sub text-green">â–² +4ä»¶</div></div>
    <div class="stat"><div class="stat-ico">âœ…</div><div class="stat-val text-green">18</div><div class="stat-label">ä»Šæœˆã®æˆç´„</div><div class="stat-sub text-sub">ç›®æ¨™ï¼š20ä»¶</div></div>
    <div class="stat"><div class="stat-ico">ğŸ‘¥</div><div class="stat-val text-purple">31</div><div class="stat-label">ç¨¼åƒAG</div><div class="stat-sub text-sub">RE:18 / HR:13</div></div>
    <div class="stat"><div class="stat-ico">ğŸ’°</div><div class="stat-val text-gold" style="font-size:18px">Â¥6,840,000</div><div class="stat-label">ä»ŠæœˆæŒ¯è¾¼äºˆå®š</div><div class="stat-sub text-sub">3æœˆ25æ—¥</div></div>
    <div class="stat"><div class="stat-ico">âš ï¸</div><div class="stat-val text-red">2</div><div class="stat-label">æ—©æœŸé€€è· å¾…æ©Ÿ</div><div class="stat-sub text-red">è¿”é‡‘ Â¥693,000</div></div>
  </div>

  <div class="grid-2r">
    <div>
      <div class="card">
        <div class="card-hdr"><div class="ch-title">æœ€è¿‘ã®ã‚¢ã‚¯ãƒ†ã‚£ãƒ“ãƒ†ã‚£</div><span class="pill pill-muted">æœ¬æ—¥</span></div>
        <div class="card-body" style="padding:0 18px">
          ${[
            ['ğŸ ','å±±ç”° èª  ãŒ R0234 ã‚’æˆç´„å ±å‘Š','10åˆ†å‰','blue'],
            ['ğŸ“‹','ç”°ä¸­ ç¾ç©‚ã® HRæ¡ˆä»¶ã€Œéˆ´æœ¨ å¥ä¸€ã€åœ¨ç±ç¢ºèªæœŸé™','30åˆ†å‰','orange'],
            ['âš ï¸','æ¸¡è¾º éš†ã®æ—©æœŸé€€è·ã‚¢ãƒ©ãƒ¼ãƒˆ â€” è¿”é‡‘è¦å¯¾å¿œ','2æ™‚é–“å‰','red'],
            ['âœ…','ä½è—¤ èŠ±å­ãŒ R0228 æ›¸é¡ã‚¹ã‚­ãƒ£ãƒ³å®Œäº†','æ˜¨æ—¥','green'],
            ['ğŸ’´','2æœˆåˆ†æŒ¯è¾¼ãƒãƒƒãƒå‡¦ç†å®Œäº† â€” 28å Â¥6,100,000','æ˜¨æ—¥','gold'],
          ].map(([ic,msg,time,col]) => `
          <div class="feed-item">
            <div class="fi-dot" style="background:${
              col==='blue'?'rgba(79,156,249,.12)':col==='orange'?'rgba(251,146,60,.12)':
              col==='red'?'rgba(248,113,113,.12)':col==='green'?'rgba(52,211,153,.1)':'rgba(201,168,64,.1)'}">${ic}</div>
            <div class="fi-content"><div class="fi-msg">${msg}</div><div class="fi-time">${time}</div></div>
          </div>`).join('')}
        </div>
      </div>

      <div class="card">
        <div class="card-hdr"><div class="ch-title">ã‚¨ãƒ¼ã‚¸ã‚§ãƒ³ãƒˆ ä»Šæœˆãƒ©ãƒ³ã‚­ãƒ³ã‚°</div></div>
        <div style="overflow-x:auto">
          <table class="tbl">
            <thead><tr><th>#</th><th>ã‚¨ãƒ¼ã‚¸ã‚§ãƒ³ãƒˆ</th><th>ç¨®åˆ¥</th><th>æˆç´„</th><th>ä»Šæœˆå ±é…¬</th><th>ãƒ©ãƒ³ã‚¯</th></tr></thead>
            <tbody>
              ${[
                [1,'ä½è—¤ èŠ±å­','RE',5,'Â¥1,312,500','Platinum','var(--purple)'],
                [2,'å±±ç”° èª ','RE',4,'Â¥980,000','Gold','var(--gold)'],
                [3,'ç”°ä¸­ ç¾ç©‚','HR',3,'Â¥693,000','Gold','var(--gold)'],
                [4,'éˆ´æœ¨ å¥å¤ª','RE',3,'Â¥742,500','Silver','var(--green)'],
                [5,'æ¸¡è¾º éš†','RE',2,'Â¥412,500','Bronze','var(--orange)'],
              ].map(([rank,name,type,count,rew,r,col]) => `
              <tr>
                <td class="mono text-muted">${rank}</td>
                <td class="fw-700">${name}</td>
                <td><span class="pill ${type==='RE'?'pill-blue':'pill-green'}">${type}</span></td>
                <td class="mono">${count}ä»¶</td>
                <td class="mono text-gold fw-700">${rew}</td>
                <td><span class="pill" style="background:${col}1a;color:${col}">${r}</span></td>
              </tr>`).join('')}
            </tbody>
          </table>
        </div>
      </div>
    </div>

    <div>
      <div class="card">
        <div class="card-hdr"><div class="ch-title">ã‚¯ã‚¤ãƒƒã‚¯ã‚¢ã‚¯ã‚·ãƒ§ãƒ³</div></div>
        <div class="card-body" style="display:flex;flex-direction:column;gap:7px">
          ${[
            ['ğŸ¯','ãƒãƒƒãƒãƒ³ã‚°ç®¡ç†','matching',false],
            ['ğŸ“‹','æ›¸é¡å¯©æŸ»','coreto-screening.html',true],
            ['ğŸ’´','æ”¯æ‰•æ˜ç´°','coreto-payment.html',true],
            ['âš ï¸','æ—©æœŸé€€è·å¯¾å¿œ','coreto-early-quit.html',true],
            ['ğŸ”–','ç´¹ä»‹ã‚³ãƒ¼ãƒ‰','coreto-codes.html',true],
            ['ğŸªª','KYCå¯©æŸ»','coreto-kyc.html',true],
          ].map(([ic,label,target,ext]) => `
          <button class="btn btn-ghost" style="justify-content:flex-start;width:100%;font-size:11px"
                  onclick="${ext ? `window.open('${target}','_blank')` : `goPage('${target}')`}">
            ${ic} ${label} <span style="margin-left:auto;color:var(--muted)">${ext?'â†—':'â†’'}</span>
          </button>`).join('')}
        </div>
      </div>

      <div class="card">
        <div class="card-hdr"><div class="ch-title">ä»Šæœˆã®åç›Šã‚µãƒãƒªãƒ¼</div></div>
        <div class="card-body">
          ${[
            ['RE æˆç´„æ‰‹æ•°æ–™','Â¥4,812,500',false],
            ['HR æˆç´„æ‰‹æ•°æ–™','Â¥2,310,000',false],
            ['ã‚¨ãƒ¼ã‚¸ã‚§ãƒ³ãƒˆå ±é…¬','- Â¥6,024,375',true],
            ['ãƒ‘ãƒ¼ãƒˆãƒŠãƒ¼å ±é…¬','- Â¥577,500',true],
          ].map(([k,v,neg]) => `
          <div style="display:flex;justify-content:space-between;font-size:12px;padding:7px 0;border-bottom:1px solid var(--border)">
            <span class="text-sub">${k}</span>
            <span class="mono fw-700" style="color:${neg?'var(--red)':'var(--text)'}">${v}</span>
          </div>`).join('')}
          <div style="display:flex;justify-content:space-between;font-size:14px;padding:10px 0 0">
            <span class="text-sub">åç›Šåˆè¨ˆ</span>
            <span class="mono fw-700 text-green">Â¥520,625</span>
          </div>
        </div>
      </div>
    </div>
  </div>
</div>`;
}

function hqMatchingPage() {
  return `<div class="page" id="page-matching">
  <div class="page-hdr"><div class="page-title">ãƒãƒƒãƒãƒ³ã‚°ç®¡ç†</div><div class="page-sub">æ¡ˆä»¶ãƒœãƒ¼ãƒ‰ãƒ»ã‚¢ã‚µã‚¤ãƒ³ç®¡ç†</div></div>
  <div class="ab-blue alert-bar">ğŸ’¡ ãƒãƒƒãƒãƒ³ã‚°ã‚·ã‚¹ãƒ†ãƒ ã®å…¨æ©Ÿèƒ½ã¯å°‚ç”¨ãƒšãƒ¼ã‚¸ã§æ“ä½œã§ãã¾ã™ã€‚
    <button class="btn btn-sm btn-ghost btn-ext" style="margin-left:auto" onclick="window.open('coreto-matching.html','_blank')">ãƒãƒƒãƒãƒ³ã‚°ã‚·ã‚¹ãƒ†ãƒ ã‚’é–‹ã</button>
  </div>

  <div class="stats-grid sg-4" style="margin-bottom:20px">
    <div class="stat"><div class="stat-ico">ğŸ“‹</div><div class="stat-val text-blue">8</div><div class="stat-label">å‹Ÿé›†ä¸­æ¡ˆä»¶</div></div>
    <div class="stat"><div class="stat-ico">â³</div><div class="stat-val text-orange">2</div><div class="stat-label">æ‰¿èªå¾…ã¡</div></div>
    <div class="stat"><div class="stat-ico">âœ…</div><div class="stat-val text-green">15</div><div class="stat-label">ä»Šæœˆæˆç«‹</div></div>
    <div class="stat"><div class="stat-ico">ğŸ‰</div><div class="stat-val text-gold">3</div><div class="stat-label">ä»Šæœˆæˆç´„</div></div>
  </div>

  <div class="card">
    <div class="card-hdr"><div class="ch-title">ç›´è¿‘ã®æ¡ˆä»¶ãƒœãƒ¼ãƒ‰</div>
      <button class="btn btn-sm btn-ghost btn-ext" onclick="window.open('coreto-matching.html','_blank')">å…¨ä»¶ãƒ»è©³ç´°æ“ä½œ</button>
    </div>
    <div style="overflow-x:auto">
      <table class="tbl">
        <thead><tr><th>ID</th><th>ã‚¿ã‚¤ãƒˆãƒ«</th><th>ç¨®åˆ¥</th><th>ã‚½ãƒ¼ã‚¹</th><th>å¿œå‹Ÿ</th><th>ç· åˆ‡</th><th>ã‚¹ãƒ†ãƒ¼ã‚¿ã‚¹</th></tr></thead>
        <tbody>
          ${[
            ['0234','æ± è¢‹ã‚¨ãƒªã‚¢ 1Kã€œ1LDK è³ƒè²¸','è³ƒè²¸','PTç´¹ä»‹',3,'23h','å‹Ÿé›†ä¸­','pill-blue'],
            ['0235','æ–°å®¿åŒº 2LDK å£²è²·','å£²è²·','HQèµ·ç¥¨',1,'5h','å‹Ÿé›†ä¸­','pill-blue'],
            ['0230','æ¸‹è°·åŒº ITè»¢è·ï¼ˆ30ä»£ï¼‰','HR','PTç´¹ä»‹',2,'æ¸ˆ','æ‰¿èªå¾…','pill-orange'],
            ['0229','å“å·åŒº 1LDK è³ƒè²¸','è³ƒè²¸','è‡ªå·±é–‹æ‹“',1,'æ¸ˆ','æˆç«‹','pill-green'],
          ].map(([id,title,type,src,apply,dead,status,sc]) => `
          <tr>
            <td class="mono text-muted">${id}</td>
            <td class="fw-700">${title}</td>
            <td><span class="pill ${type==='HR'?'pill-purple':'pill-blue'}">${type}</span></td>
            <td style="font-size:11px">${src}</td>
            <td class="mono">${apply}å</td>
            <td class="mono" style="color:${dead.includes('h')?'var(--orange)':'var(--muted)'}">${dead}</td>
            <td><span class="pill ${sc}">${status}</span></td>
          </tr>`).join('')}
        </tbody>
      </table>
    </div>
  </div>
</div>`;
}

// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
//  RE AGENT PAGES
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
function reDashPage() {
  const u = session;
  const rankColors = {platinum:'var(--purple)',gold:'var(--gold)',silver:'var(--green)',bronze:'var(--orange)'};
  const rankCol = rankColors[u.rankKey] || 'var(--muted)';
  const pts = {platinum:30,gold:20,silver:10,bronze:5}[u.rankKey] || 5;
  const nextRank = {bronze:'Silver',silver:'Gold',gold:'Platinum',platinum:'â€”'}[u.rankKey];
  const nextPts  = {bronze:10,silver:20,gold:30,platinum:30}[u.rankKey];
  const pct = Math.min(100, Math.round(pts / nextPts * 100));

  return `<div class="page" id="page-dashboard">
  <div class="page-hdr">
    <div class="page-title">ã“ã‚“ã«ã¡ã¯ã€${u.name}ã•ã‚“</div>
    <div class="page-sub">ä¸å‹•ç”£ã‚¨ãƒ¼ã‚¸ã‚§ãƒ³ãƒˆãƒ€ãƒƒã‚·ãƒ¥ãƒœãƒ¼ãƒ‰ â€” 2026å¹´2æœˆ21æ—¥</div>
  </div>

  <div class="ab-orange alert-bar">â° R0228 ã® ITé‡èª¬ãŒæœªå®Œäº†ã§ã™ã€‚ä»Šæœˆæœ«ã¾ã§ã«å¯¾å¿œã—ã¦ãã ã•ã„ã€‚
    <button class="btn btn-sm" style="margin-left:auto;background:rgba(251,146,60,.12);border:1px solid rgba(251,146,60,.3);color:var(--orange)" onclick="window.open('coreto-it-setsu.html','_blank')">å¯¾å¿œ â†—</button>
  </div>

  <div class="stats-grid sg-4">
    <div class="stat"><div class="stat-ico">ğŸ“‹</div><div class="stat-val text-blue">6</div><div class="stat-label">é€²è¡Œä¸­æ¡ˆä»¶</div><div class="stat-sub text-green">ä»Šæœˆ +2ä»¶</div></div>
    <div class="stat"><div class="stat-ico">âœ…</div><div class="stat-val text-green">4</div><div class="stat-label">ä»Šæœˆã®æˆç´„</div><div class="stat-sub text-green">ç›®æ¨™é”æˆä¸­</div></div>
    <div class="stat"><div class="stat-ico">â­</div><div class="stat-val" style="color:${rankCol}">${pts} pt</div><div class="stat-label">ä»Šæœˆãƒã‚¤ãƒ³ãƒˆ</div><div class="stat-sub text-sub">æ¬¡ï¼š${nextRank}</div></div>
    <div class="stat"><div class="stat-ico">ğŸ’°</div><div class="stat-val text-gold" style="font-size:20px">Â¥980,000</div><div class="stat-label">ä»Šæœˆã®å ±é…¬</div><div class="stat-sub text-sub">3æœˆ25æ—¥æŒ¯è¾¼</div></div>
  </div>

  <div class="grid-2r">
    <div>
      <div class="card" style="margin-bottom:16px">
        <div class="card-hdr"><div class="ch-title">æ‹…å½“æ¡ˆä»¶ï¼ˆé€²è¡Œä¸­ï¼‰</div><button class="btn btn-sm btn-ghost btn-ext" onclick="window.open('coreto-agent-mypage.html','_blank')">å…¨ä»¶</button></div>
        <div style="overflow-x:auto">
          <table class="tbl">
            <thead><tr><th>ID</th><th>ã‚¯ãƒ©ã‚¤ã‚¢ãƒ³ãƒˆ</th><th>ç‰©ä»¶</th><th>ã‚¹ãƒ†ãƒ¼ã‚¿ã‚¹</th><th>ã‚¢ã‚¯ã‚·ãƒ§ãƒ³</th></tr></thead>
            <tbody>
              ${[
                ['R0234','ç”°ä¸­ é›„ä»‹','æ¸‹è°·åŒºæ±2ä¸ç›® 302å·å®¤','ITé‡èª¬å¾…ã¡','pill-orange','coreto-it-setsu.html'],
                ['R0228','ä½è—¤ æ˜æ—¥é¦™','æ¸¯åŒºå—é’å±± 1LDK','æ›¸é¡å‡¦ç†ä¸­','pill-blue','coreto-it-setsu.html'],
                ['R0241','æœ¨æ‘ ç¿”å¤ª','æ–°å®¿åŒºè¥¿æ–°å®¿ 2LDK','å†…è¦‹èª¿æ•´','pill-blue','coreto-naiken.html'],
                ['R0245','æ— ã•ãã‚‰','ç›®é»’åŒºä¸­ç›®é»’ 1K','ç”³è¾¼æ›¸é¡åé›†','pill-blue','coreto-batch-close.html'],
              ].map(([cid,cl,prop,st,sc,url]) => `
              <tr>
                <td class="mono text-muted" style="font-size:10px">${cid}</td>
                <td class="fw-700">${cl}</td>
                <td style="font-size:11px;color:var(--sub)">${prop}</td>
                <td><span class="pill ${sc}">${st}</span></td>
                <td><button class="btn btn-sm btn-ghost" onclick="window.open('${url}','_blank')">å¯¾å¿œ â†—</button></td>
              </tr>`).join('')}
            </tbody>
          </table>
        </div>
      </div>

      <div class="card">
        <div class="card-hdr"><div class="ch-title">æ¥­å‹™ãƒ„ãƒ¼ãƒ«</div></div>
        <div class="card-body">
          <div class="qt-grid">
            ${[
              ['ğŸ“','ITé‡èª¬ãƒ»æ›¸é¡','coreto-it-setsu.html','var(--green)'],
              ['ğŸ ','å†…è¦‹ç”³è¾¼','coreto-naiken.html','var(--blue)'],
              ['âœ…','æˆç´„ã‚¯ãƒ­ãƒ¼ã‚º','coreto-batch-close.html','var(--green)'],
              ['ğŸ¢','å£²è²·å ±å‘Šæ›¸','coreto-sale-report.html','var(--orange)'],
              ['ğŸ§¾','é ˜åæ›¸','coreto-receipt.html','var(--purple)'],
            ].map(([ic,label,url,col]) => `
            <div class="qt-card" onclick="window.open('${url}','_blank')" style="border-color:${col}20">
              <div class="qt-icon">${ic}</div>
              <div class="qt-label" style="color:${col}">${label}</div>
            </div>`).join('')}
          </div>
        </div>
      </div>
    </div>

    <div>
      <div class="card" style="margin-bottom:14px">
        <div class="card-hdr"><div class="ch-title">ãƒ©ãƒ³ã‚¯çŠ¶æ³</div><button class="btn btn-sm btn-ghost" onclick="goPage('rank')">è©³ç´°</button></div>
        <div class="card-body">
          <div class="rank-display" style="margin-bottom:12px">
            <div class="rank-ring-wrap">
              <svg viewBox="0 0 60 60" fill="none">
                <circle cx="30" cy="30" r="24" stroke="var(--border2)" stroke-width="5"/>
                <circle cx="30" cy="30" r="24" stroke="${rankCol}" stroke-width="5"
                  stroke-dasharray="${Math.round(2*3.14159*24*pct/100)} ${Math.round(2*3.14159*24*(100-pct)/100)}"
                  stroke-linecap="round"/>
              </svg>
              <div class="rank-ring-inner">${u.rank==='Platinum'?'ğŸ’':u.rank==='Gold'?'ğŸ¥‡':u.rank==='Silver'?'ğŸ¥ˆ':'ğŸ¥‰'}</div>
            </div>
            <div>
              <div style="font-size:17px;font-weight:800;color:${rankCol}">${u.rank}</div>
              <div style="font-size:11px;color:var(--sub);margin-top:2px">${pts} pt / ä»Šæœˆ</div>
              <div style="font-size:10px;color:var(--muted);margin-top:6px">æ¬¡ï¼š${nextRank}ï¼ˆ${nextPts}ptï¼‰</div>
              <div class="prog-wrap"><div class="prog-fill" style="width:${pct}%;background:${rankCol}"></div></div>
            </div>
          </div>
          <button class="btn btn-ghost btn-sm" style="width:100%;justify-content:center" onclick="goPage('simulator')">ğŸ§® å ±é…¬ã‚·ãƒŸãƒ¥ãƒ¬ãƒ¼ã‚¿ãƒ¼</button>
        </div>
      </div>

      <div class="card">
        <div class="card-hdr"><div class="ch-title">ä»Šæœˆã®ç›®æ¨™</div></div>
        <div class="card-body" style="font-size:12px;line-height:2;color:var(--sub)">
          æˆç´„ <strong class="text-gold">ã‚ã¨2ä»¶</strong> ã§æœˆé–“ç›®æ¨™é”æˆ<br>
          ãƒã‚¤ãƒ³ãƒˆ <strong class="text-gold">ã‚ã¨${nextPts-pts}pt</strong> ã§${nextRank}æ˜‡æ ¼
        </div>
      </div>
    </div>
  </div>
</div>`;
}

function reMyPage() {
  const u = session;
  return `<div class="page" id="page-mypage">
  <div class="page-hdr"><div class="page-title">ãƒã‚¤ãƒšãƒ¼ã‚¸</div><div class="page-sub">ãƒ—ãƒ­ãƒ•ã‚£ãƒ¼ãƒ«ãƒ»æˆç¸¾ãƒ»è¨­å®š</div></div>
  <div class="grid-2">
    <div class="card">
      <div class="card-hdr"><div class="ch-title">ãƒ—ãƒ­ãƒ•ã‚£ãƒ¼ãƒ«</div><button class="btn btn-sm btn-ghost btn-ext" onclick="window.open('coreto-agent-mypage.html','_blank')">è©³ç´°ç·¨é›†</button></div>
      <div class="card-body">
        <div style="display:flex;align-items:center;gap:14px;margin-bottom:16px">
          <div style="width:52px;height:52px;border-radius:14px;background:${u.color}18;color:${u.color};display:flex;align-items:center;justify-content:center;font-size:22px;font-weight:700;border:1px solid ${u.color}30">${u.avatar}</div>
          <div>
            <div style="font-size:16px;font-weight:700">${u.name}</div>
            <div style="font-size:11px;color:var(--sub)">ä¸å‹•ç”£ã‚¨ãƒ¼ã‚¸ã‚§ãƒ³ãƒˆ / ID: ${u.userId}</div>
            <div style="font-size:11px;color:var(--gold)">${u.rank} ãƒ©ãƒ³ã‚¯</div>
          </div>
        </div>
        ${[['æœˆé¡è²»ç”¨','Â¥0ï¼ˆGoldä»¥ä¸Šï¼‰'],['ç™»éŒ²æ—¥','2024å¹´4æœˆ1æ—¥'],['ç´¯è¨ˆæˆç´„','28ä»¶'],['ç´¯è¨ˆå ±é…¬','Â¥6,832,500']].map(([k,v])=>`
        <div style="display:flex;justify-content:space-between;padding:8px 0;border-bottom:1px solid var(--border);font-size:12px">
          <span class="text-sub">${k}</span><span class="mono fw-700">${v}</span>
        </div>`).join('')}
      </div>
    </div>
    <div class="card">
      <div class="card-hdr"><div class="ch-title">ä»Šæœˆã®æˆç¸¾</div></div>
      <div class="card-body">
        ${[['æˆç´„ä»¶æ•°','4ä»¶','text-green'],['é€²è¡Œä¸­','6ä»¶','text-blue'],['ä»Šæœˆã®å ±é…¬','Â¥980,000','text-gold'],['ä»Šæœˆã®ãƒã‚¤ãƒ³ãƒˆ','20 pt','text-gold'],['ãƒ©ãƒ³ã‚¯é€²æ—','67%','text-purple']].map(([k,v,cl])=>`
        <div style="display:flex;justify-content:space-between;padding:9px 0;border-bottom:1px solid var(--border);font-size:12px">
          <span class="text-sub">${k}</span><span class="mono fw-700 ${cl}">${v}</span>
        </div>`).join('')}
      </div>
    </div>
  </div>
</div>`;
}

function rankPage() {
  const u = session;
  const rankColors = {platinum:'var(--purple)',gold:'var(--gold)',silver:'var(--green)',bronze:'var(--orange)'};
  const rankCol = rankColors[u.rankKey] || 'var(--orange)';

  const RANKS = [
    { icon:'ğŸ’', label:'Platinum', col:'var(--purple)', fee:'Â¥0ï¼ˆæ°¸ä¹…ç„¡æ–™ï¼‰', rate_re:'75%', rate_hr:'55%', pts:'30pt ä»¥ä¸Š' },
    { icon:'ğŸ¥‡', label:'Gold',     col:'var(--gold)',   fee:'Â¥0',            rate_re:'70%', rate_hr:'50%', pts:'20ã€œ29pt' },
    { icon:'ğŸ¥ˆ', label:'Silver',   col:'var(--green)',  fee:'Â¥490',          rate_re:'67.5%', rate_hr:'47.5%', pts:'10ã€œ19pt' },
    { icon:'ğŸ¥‰', label:'Bronze',   col:'var(--orange)', fee:'Â¥980',          rate_re:'65%',  rate_hr:'45%',  pts:'0ã€œ9pt'  },
  ];

  const feeMap  = {platinum:'Â¥0ï¼ˆæ°¸ä¹…ç„¡æ–™ï¼‰', gold:'Â¥0', silver:'Â¥490', bronze:'Â¥980'};
  const rateMap = {platinum:'75%', gold:'70%', silver:'67.5%', bronze:'65%'};

  // â”€â”€ Progress bar HTML (built without nested template literals) â”€â”€
  const curPtsMap = {platinum:33, gold:22, silver:12, bronze:5};
  const curPts = curPtsMap[u.rankKey] || 5;
  const thresholds = [
    {pts:0,  label:'Bronze',   icon:'ğŸ¥‰', col:'var(--orange)'},
    {pts:10, label:'Silver',   icon:'ğŸ¥ˆ', col:'var(--green)'},
    {pts:20, label:'Gold',     icon:'ğŸ¥‡', col:'var(--gold)'},
    {pts:30, label:'Platinum', icon:'ğŸ’', col:'var(--purple)'},
  ];
  const MAX = 34;
  const pct = v => Math.min(97, Math.round(v / MAX * 100));
  const next = thresholds.find(t => t.pts > curPts);
  const needed = next ? next.pts - curPts : 0;

  const nextLabel = next
    ? '<div style="font-size:12px;color:var(--muted)">æ¬¡ã®ãƒ©ãƒ³ã‚¯ <strong style="color:' + next.col + '">' + next.icon + ' ' + next.label + '</strong> ã¾ã§ <strong style="color:var(--text)">' + needed + ' pt</strong></div>'
    : '<div style="font-size:12px;color:var(--purple)">ğŸ’ æœ€é«˜ãƒ©ãƒ³ã‚¯åˆ°é”æ¸ˆã¿</div>';

  const markers = thresholds.map(t => {
    const active = curPts >= t.pts;
    return '<div style="position:absolute;top:0;bottom:0;left:' + pct(t.pts) + '%;transform:translateX(-50%);z-index:2">'
      + '<div style="width:2px;height:100%;background:' + (active ? 'rgba(255,255,255,.5)' : 'var(--border2)') + ';border-radius:1px"></div>'
      + '</div>';
  }).join('');

  const labels = thresholds.map(t => {
    const active = curPts >= t.pts;
    return '<div style="position:absolute;left:' + pct(t.pts) + '%;transform:translateX(-50%);text-align:center">'
      + '<div style="font-size:16px">' + t.icon + '</div>'
      + '<div style="font-size:9px;font-weight:700;color:' + (active ? t.col : 'var(--muted)') + ';' + (active ? '' : 'opacity:.5') + '">' + t.pts + 'pt</div>'
      + '</div>';
  }).join('');

  const progressHTML =
    '<div style="display:flex;justify-content:space-between;align-items:baseline;margin-bottom:12px">'
    + '<div><span style="font-size:32px;font-weight:800;color:' + rankCol + '">' + curPts + '</span><span style="font-size:13px;color:var(--sub);margin-left:5px">pt</span></div>'
    + nextLabel
    + '</div>'
    + '<div style="position:relative;height:20px;margin-bottom:10px">'
    +   '<div style="position:absolute;inset:0;background:#0a0c14;border-radius:10px;overflow:hidden">'
    +     '<div style="height:100%;width:' + pct(curPts) + '%;background:linear-gradient(90deg,var(--orange),' + rankCol + ');border-radius:10px">'
    +       '<div style="position:absolute;right:0;top:0;bottom:0;width:3px;background:rgba(255,255,255,.35);border-radius:0 2px 2px 0"></div>'
    +     '</div>'
    +   '</div>'
    +   markers
    + '</div>'
    + '<div style="position:relative;height:42px">' + labels + '</div>';

  const rankTableRows = RANKS.map(r => {
    const isCur = r.label === u.rank;
    return '<tr style="' + (isCur ? 'background:var(--card2)' : '') + '">'
      + '<td><span style="font-weight:800;color:' + r.col + '">' + r.icon + ' ' + r.label + '</span>'
      + (isCur ? ' <span style="font-size:9px;color:var(--sub)">â† ç¾åœ¨</span>' : '') + '</td>'
      + '<td class="mono fw-700" style="color:' + r.col + '">' + r.pts + '</td>'
      + '<td class="mono" style="white-space:nowrap">' + r.fee + '</td>'
      + '<td class="mono" style="color:' + r.col + ';font-weight:700">' + r.rate_re + '</td>'
      + '<td class="mono" style="color:' + r.col + ';font-weight:700">' + r.rate_hr + '</td>'
      + '</tr>';
  }).join('');

  return `<div class="page" id="page-rank">
  <div class="page-hdr"><div class="page-title">ãƒ©ãƒ³ã‚¯ãƒ»ãƒã‚¤ãƒ³ãƒˆ</div><div class="page-sub">ãƒ©ãƒ³ã‚¯æ˜‡æ ¼æ¡ä»¶ï¼ˆæ¯æœˆ1æ—¥ è‡ªå‹•åˆ¤å®šï¼‰</div></div>

  <div class="grid-2" style="margin-bottom:16px">
    <div class="card">
      <div class="card-hdr"><div class="ch-title">ç¾åœ¨ã®ãƒ©ãƒ³ã‚¯</div></div>
      <div class="card-body" style="text-align:center;padding:20px 0">
        <div style="font-size:52px;margin-bottom:10px">${u.rank==='Platinum'?'ğŸ’':u.rank==='Gold'?'ğŸ¥‡':u.rank==='Silver'?'ğŸ¥ˆ':'ğŸ¥‰'}</div>
        <div style="font-size:24px;font-weight:800;color:${rankCol}">${u.rank}</div>
        <div style="font-size:12px;color:var(--sub);margin-top:8px">æœˆé¡è²»ç”¨ï¼š${feeMap[u.rankKey]||'Â¥980'}</div>
        <div style="font-size:12px;color:var(--sub);margin-top:2px">å ±é…¬ç‡ï¼ˆä¸å‹•ç”£ï¼‰ï¼š${rateMap[u.rankKey]||'65%'}</div>
      </div>
    </div>
    <div class="card">
      <div class="card-hdr"><div class="ch-title">ãƒã‚¤ãƒ³ãƒˆä»˜ä¸ãƒ«ãƒ¼ãƒ«</div></div>
      <div style="overflow-x:auto">
        <table class="tbl">
          <thead><tr><th>æ¡ä»¶</th><th style="text-align:right">ä»˜ä¸</th></tr></thead>
          <tbody>
            <tr><td>æ‰‹æ•°æ–™å£²ä¸Š 10ä¸‡å††ã”ã¨ï¼ˆè‡ªå·±æ¡ˆä»¶ï¼‰</td><td class="mono fw-700" style="text-align:right;color:var(--gold)">1.0 pt</td></tr>
            <tr><td>æ¡ˆä»¶å®Œäº†ãƒœãƒ¼ãƒŠã‚¹ï¼ˆè‡ªå·±æ¡ˆä»¶ï¼‰</td><td class="mono fw-700" style="text-align:right;color:var(--gold)">1.0 pt</td></tr>
            <tr><td>ãƒ‘ãƒ¼ãƒˆãƒŠãƒ¼ç´¹ä»‹æ¡ˆä»¶ï¼šæ‰‹æ•°æ–™ 10ä¸‡å††ã”ã¨<br><span style="font-size:10px;color:var(--muted)">AGãƒ»ãƒ‘ãƒ¼ãƒˆãƒŠãƒ¼ãã‚Œãã‚Œã«ä»˜ä¸</span></td><td class="mono fw-700" style="text-align:right;color:var(--blue)">0.5 pt</td></tr>
            <tr><td>ãƒ‘ãƒ¼ãƒˆãƒŠãƒ¼ç´¹ä»‹æ¡ˆä»¶ï¼šå®Œäº†ãƒœãƒ¼ãƒŠã‚¹<br><span style="font-size:10px;color:var(--muted)">AGãƒ»ãƒ‘ãƒ¼ãƒˆãƒŠãƒ¼ãã‚Œãã‚Œã«ä»˜ä¸</span></td><td class="mono fw-700" style="text-align:right;color:var(--blue)">0.5 pt</td></tr>
            <tr><td>ãƒ¡ãƒ³ã‚¿ãƒ¼ã‚³ãƒŸãƒƒã‚·ãƒ§ãƒ³ 5,000å††ã”ã¨</td><td class="mono fw-700" style="text-align:right;color:var(--purple)">0.2 pt</td></tr>
          </tbody>
        </table>
      </div>
      <div style="padding:10px 14px;font-size:11px;color:var(--muted);border-top:1px solid var(--border)">
        ãƒ©ãƒ³ã‚¯ã¯ <strong style="color:var(--gold)">æ¯æœˆ1æ—¥</strong> ã« Kintone ã§è‡ªå‹•é›†è¨ˆãƒ»åˆ¤å®šã€‚æ˜‡é™æ ¼ã¯ Slack é€šçŸ¥ã€‚
      </div>
    </div>
  </div>

  <!-- ãƒ©ãƒ³ã‚¯é€²æ—ãƒãƒ¼ -->
  <div class="card" style="margin-bottom:16px">
    <div class="card-hdr"><div class="ch-title">ãƒ©ãƒ³ã‚¯é€²æ—ãƒãƒ¼</div></div>
    <div class="card-body" style="padding-bottom:4px">
      ${progressHTML}
    </div>
  </div>

  <!-- ãƒ©ãƒ³ã‚¯æ˜‡æ ¼æ¡ä»¶ä¸€è¦§ -->
  <div class="card">
    <div class="card-hdr"><div class="ch-title">ãƒ©ãƒ³ã‚¯æ˜‡æ ¼æ¡ä»¶ä¸€è¦§</div></div>
    <div style="overflow-x:auto">
      <table class="tbl">
        <thead>
          <tr>
            <th>ãƒ©ãƒ³ã‚¯</th><th>ç´¯è¨ˆãƒã‚¤ãƒ³ãƒˆ</th><th>æœˆé¡è²»ç”¨</th><th>å ±é…¬ç‡ï¼ˆä¸å‹•ç”£ï¼‰</th><th>å ±é…¬ç‡ï¼ˆäººæï¼‰</th>
          </tr>
        </thead>
        <tbody>${rankTableRows}</tbody>
      </table>
    </div>
  </div>
</div>`;
}


function simPage() {
  const u = session;
  const rateMap = { platinum:0.75, gold:0.70, silver:0.675, bronze:0.65 };
  const defaultRate = rateMap[u.rankKey] || 0.65;
  return `<div class="page" id="page-simulator">
  <div class="page-hdr"><div class="page-title">å ±é…¬ãƒ»ãƒã‚¤ãƒ³ãƒˆã‚·ãƒŸãƒ¥ãƒ¬ãƒ¼ã‚¿ãƒ¼</div><div class="page-sub">æˆç´„é¡ã‹ã‚‰å ±é…¬ã¨ãƒã‚¤ãƒ³ãƒˆã‚’åŒæ™‚è¨ˆç®—</div></div>
  <div class="grid-2">

    <!-- å·¦ï¼šå…¥åŠ› -->
    <div>
      <div class="card" style="margin-bottom:14px">
        <div class="card-hdr"><div class="ch-title">æ¡ˆä»¶æƒ…å ±</div></div>
        <div class="card-body" style="display:flex;flex-direction:column;gap:12px">
          <div class="fg">
            <label>æ¥­ç¨®</label>
            <div class="tg-group" id="sg-biz" style="margin-top:4px">
              <button class="tg on" data-v="re-rent" onclick="simTog('sg-biz',this);calcSim()">ğŸ  è³ƒè²¸</button>
              <button class="tg" data-v="re-sale" onclick="simTog('sg-biz',this);calcSim()">ğŸ¢ å£²è²·</button>
              <button class="tg" data-v="hr" onclick="simTog('sg-biz',this);calcSim()">ğŸ‘¥ äººæ</button>
            </div>
          </div>
          <div class="fg">
            <label>æ¡ˆä»¶ã‚½ãƒ¼ã‚¹</label>
            <div class="tg-group" id="sg-src" style="margin-top:4px">
              <button class="tg on" data-v="self" onclick="simTog('sg-src',this);calcSim()">è‡ªå·±æ¡ˆä»¶</button>
              <button class="tg" data-v="pt" onclick="simTog('sg-src',this);calcSim()">ãƒ‘ãƒ¼ãƒˆãƒŠãƒ¼ç´¹ä»‹</button>
            </div>
          </div>
          <div class="fg">
            <label>æ‰‹æ•°æ–™ / å£²ä¸Šï¼ˆç¨è¾¼ï¼‰</label>
            <input type="number" id="sim-fee" placeholder="300000" oninput="calcSim()" step="10000" style="margin-top:4px">
          </div>
          <div class="fg" id="sg-mentor-wrap" style="display:none">
            <label>ãƒ¡ãƒ³ã‚¿ãƒ¼ã‚³ãƒŸãƒƒã‚·ãƒ§ãƒ³ï¼ˆç¨è¾¼ï¼‰</label>
            <input type="number" id="sim-mentor" placeholder="0" oninput="calcSim()" step="1000" style="margin-top:4px">
          </div>
          <div class="fg">
            <label>ãƒ©ãƒ³ã‚¯ï¼ˆå ±é…¬ç‡ï¼‰</label>
            <select id="sim-rate" onchange="calcSim()" style="margin-top:4px">
              <option value="0.75" ${defaultRate===0.75?'selected':''}>Platinum â€” 75%</option>
              <option value="0.70" ${defaultRate===0.70?'selected':''}>Gold â€” 70%</option>
              <option value="0.675" ${defaultRate===0.675?'selected':''}>Silver â€” 67.5%</option>
              <option value="0.65" ${defaultRate===0.65?'selected':''}>Bronze â€” 65%</option>
            </select>
          </div>
        </div>
      </div>
    </div>

    <!-- å³ï¼šçµæœ -->
    <div>
      <div class="card" style="margin-bottom:14px">
        <div class="card-hdr"><div class="ch-title">ğŸ’° å ±é…¬è¨ˆç®—</div></div>
        <div class="card-body">
          ${[['æ‰‹æ•°æ–™ï¼ˆç¨è¾¼ï¼‰','sim-fee-disp','var(--sub)'],
             ['å ±é…¬ï¼ˆç¨å¼•å‰ï¼‰','sim-gross','var(--text)'],
             ['æºæ³‰å¾´åï¼ˆ10.21%ï¼‰','sim-tax','var(--red)'],
             ['æ‰‹å–ã‚ŠæŒ¯è¾¼é¡','sim-net','var(--gold)']
            ].map(([k,id,col])=>`
          <div style="display:flex;justify-content:space-between;align-items:center;padding:9px 0;border-bottom:1px solid var(--border);font-size:12px">
            <span style="color:var(--sub)">${k}</span>
            <span class="mono fw-700" id="${id}" style="color:${col}">â€”</span>
          </div>`).join('')}
        </div>
      </div>

      <div class="card">
        <div class="card-hdr"><div class="ch-title">â­ ãƒã‚¤ãƒ³ãƒˆè©¦ç®—</div></div>
        <div class="card-body">
          ${[['æ‰‹æ•°æ–™ãƒã‚¤ãƒ³ãƒˆï¼ˆ10ä¸‡/1ptï¼‰','sim-pt-fee','var(--text)'],
             ['æ¡ˆä»¶å®Œäº†ãƒœãƒ¼ãƒŠã‚¹','sim-pt-bonus','var(--text)'],
             ['ãƒ¡ãƒ³ã‚¿ãƒ¼ãƒã‚¤ãƒ³ãƒˆï¼ˆ5åƒå††/0.2ptï¼‰','sim-pt-mentor','var(--purple)'],
             ['ä»Šå›åˆè¨ˆç²å¾—ãƒã‚¤ãƒ³ãƒˆ','sim-pt-total','var(--gold)'],
             ['ç´¯è¨ˆãƒã‚¤ãƒ³ãƒˆï¼ˆæ¦‚ç®—ï¼‰','sim-pt-cumul','var(--gold)'],
             ['ç¾åœ¨ã®ãƒ©ãƒ³ã‚¯åˆ¤å®š','sim-rank-result','var(--gold)'],
            ].map(([k,id,col])=>`
          <div style="display:flex;justify-content:space-between;align-items:center;padding:9px 0;border-bottom:1px solid var(--border);font-size:12px">
            <span style="color:var(--sub)">${k}</span>
            <span class="mono fw-700" id="${id}" style="color:${col}">â€”</span>
          </div>`).join('')}
          <div style="font-size:10px;color:var(--muted);margin-top:10px">
            â€» ç´¯è¨ˆãƒã‚¤ãƒ³ãƒˆã¯ç¾åœ¨ã®ãƒã‚¤ãƒ³ãƒˆï¼ˆãƒ€ãƒŸãƒ¼ï¼‰ã«ä»Šå›åˆ†ã‚’åŠ ç®—ã—ãŸæ¦‚ç®—å€¤<br>
            â€» ãƒ‘ãƒ¼ãƒˆãƒŠãƒ¼æ¡ˆä»¶ã¯æ‰‹æ•°æ–™ãƒ»å®Œäº†ãƒœãƒ¼ãƒŠã‚¹ã¨ã‚‚ã« 0.5ptï¼ˆAGãƒ»PT å„è‡ªï¼‰
          </div>
        </div>
      </div>
    </div>

  </div>
</div>`;
}

function simTog(groupId, el) {
  document.querySelectorAll('#'+groupId+' .tg').forEach(b => b.classList.remove('on'));
  el.classList.add('on');
  // ãƒ¡ãƒ³ã‚¿ãƒ¼ãƒ•ã‚£ãƒ¼ãƒ«ãƒ‰è¡¨ç¤ºåˆ¶å¾¡
  const biz = document.querySelector('#sg-biz .tg.on')?.dataset.v;
  const mentorWrap = document.getElementById('sg-mentor-wrap');
  if (mentorWrap) mentorWrap.style.display = (biz !== 'hr') ? 'block' : 'none';
}

function calcSim() {
  const fee    = parseFloat(document.getElementById('sim-fee')?.value) || 0;
  const rate   = parseFloat(document.getElementById('sim-rate')?.value) || 0.65;
  const mentor = parseFloat(document.getElementById('sim-mentor')?.value) || 0;
  const src    = document.querySelector('#sg-src .tg.on')?.dataset.v || 'self';
  const isPt   = src === 'pt';

  // å ±é…¬è¨ˆç®—
  const gross = Math.round(fee * rate);
  const tax   = Math.round(gross * 0.1021);
  const net   = gross - tax;

  // ãƒã‚¤ãƒ³ãƒˆè¨ˆç®—
  const feePts   = Math.floor(fee / 100000) * (isPt ? 0.5 : 1.0);
  const bonusPts = isPt ? 0.5 : 1.0;
  const mentorPts = Math.floor(mentor / 5000) * 0.2;
  const totalPts  = feePts + bonusPts + mentorPts;

  // ç¾åœ¨ãƒã‚¤ãƒ³ãƒˆï¼ˆãƒ‡ãƒ¢ç”¨é€†ç®—ï¼‰
  const curPtsMap = {'0.75':30, '0.70':22, '0.675':12, '0.65':5};
  const curPts = curPtsMap[String(rate)] || 5;
  const newPts = curPts + totalPts;
  const rankLabel = newPts >= 30 ? 'ğŸ’ Platinum' : newPts >= 20 ? 'ğŸ¥‡ Gold' : newPts >= 10 ? 'ğŸ¥ˆ Silver' : 'ğŸ¥‰ Bronze';

  const fmt  = v => v ? 'Â¥' + Math.round(v).toLocaleString() : 'â€”';
  const fmtP = v => v.toFixed(1) + ' pt';
  const set  = (id, v) => { const el = document.getElementById(id); if(el) el.textContent = v; };

  set('sim-fee-disp',    fmt(fee));
  set('sim-gross',       fmt(gross));
  set('sim-tax',         fmt(tax));
  set('sim-net',         fmt(net));
  set('sim-pt-fee',      fee ? fmtP(feePts) : 'â€”');
  set('sim-pt-bonus',    isPt ? '0.5 ptï¼ˆãƒ‘ãƒ¼ãƒˆãƒŠãƒ¼æ¡ˆä»¶ï¼‰' : '1.0 pt');
  set('sim-pt-mentor',   mentor > 0 ? fmtP(mentorPts) : 'â€”');
  set('sim-pt-total',    fee ? fmtP(totalPts) : 'â€”');
  set('sim-pt-cumul',    fee ? fmtP(newPts) : 'â€”');
  set('sim-rank-result', fee ? rankLabel : 'â€”');
}

function simTog(groupId, el) {
  document.querySelectorAll('#'+groupId+' .tg').forEach(b => b.classList.remove('on'));
  el.classList.add('on');
  const biz = document.querySelector('#sg-biz .tg.on')?.dataset.v;
  const mentorWrap = document.getElementById('sg-mentor-wrap');
  if (mentorWrap) mentorWrap.style.display = (biz !== 'hr') ? 'block' : 'none';
}

// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
//  HR AGENT PAGES
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
function hrDashPage() {
  const u = session;
  const rankColors = {gold:'var(--gold)',silver:'var(--green)',bronze:'var(--orange)'};
  const rankCol = rankColors[u.rankKey] || 'var(--muted)';
  return `<div class="page" id="page-dashboard">
  <div class="page-hdr">
    <div class="page-title">ã“ã‚“ã«ã¡ã¯ã€${u.name}ã•ã‚“</div>
    <div class="page-sub">äººæç´¹ä»‹ã‚¨ãƒ¼ã‚¸ã‚§ãƒ³ãƒˆãƒ€ãƒƒã‚·ãƒ¥ãƒœãƒ¼ãƒ‰ â€” 2026å¹´2æœˆ21æ—¥</div>
  </div>

  <div class="ab-orange alert-bar">âš ï¸ <strong>åœ¨ç±ç¢ºèªæœŸé™</strong>ï¼šéˆ´æœ¨ å¥ä¸€ï¼ˆR-HR0089ï¼‰ã®åœ¨ç±ç¢ºèªãŒæœ¬æ—¥æœŸé™ã§ã™ã€‚
    <button class="btn btn-sm" style="margin-left:auto;background:rgba(251,146,60,.12);border:1px solid rgba(251,146,60,.3);color:var(--orange)" onclick="window.open('coreto-early-quit.html','_blank')">ç¢ºèª â†—</button>
  </div>

  <div class="stats-grid sg-4">
    <div class="stat"><div class="stat-ico">ğŸ‘¥</div><div class="stat-val text-blue">4</div><div class="stat-label">æ‹…å½“æ¡ˆä»¶</div><div class="stat-sub text-sub">é€²è¡Œä¸­</div></div>
    <div class="stat"><div class="stat-ico">âœ…</div><div class="stat-val text-green">3</div><div class="stat-label">ä»Šæœˆã®æˆç´„</div><div class="stat-sub text-green">ç›®æ¨™é”æˆ</div></div>
    <div class="stat"><div class="stat-ico">â­</div><div class="stat-val" style="color:${rankCol}">20 pt</div><div class="stat-label">ä»Šæœˆãƒã‚¤ãƒ³ãƒˆ</div></div>
    <div class="stat"><div class="stat-ico">ğŸ’°</div><div class="stat-val text-gold" style="font-size:20px">Â¥693,000</div><div class="stat-label">ä»Šæœˆã®å ±é…¬</div><div class="stat-sub text-sub">3æœˆ25æ—¥</div></div>
  </div>

  <div class="grid-2r">
    <div>
      <div class="card">
        <div class="card-hdr"><div class="ch-title">æ‹…å½“æ¡ˆä»¶</div><button class="btn btn-sm btn-ghost" onclick="goPage('hr-cases')">å…¨ä»¶</button></div>
        <div style="overflow-x:auto">
          <table class="tbl">
            <thead><tr><th>ID</th><th>ã‚¯ãƒ©ã‚¤ã‚¢ãƒ³ãƒˆ</th><th>æ¥­ç•Œ</th><th>ã‚¹ãƒ†ãƒ¼ã‚¿ã‚¹</th><th>åœ¨ç±ç¢ºèª</th></tr></thead>
            <tbody>
              ${[
                ['R-HR0089','éˆ´æœ¨ å¥ä¸€','ITãƒ»å–¶æ¥­','åœ¨ç±ç¢ºèªä¸­','âš ï¸ æœŸé™æœ¬æ—¥','pill-orange'],
                ['R-HR0091','ç”°æ‘ çœŸç”±','è£½é€ ','é¸è€ƒä¸­','â€” ','pill-blue'],
                ['R-HR0094','æœ¨æ‘ å¥ˆã€…','HRãƒ»ç®¡ç†','å†…å®šæ‰¿è«¾æ¸ˆ','âœ…','pill-green'],
                ['R-HR0097','æ¸¡è¾º æ´¸','ITãƒ»ã‚¨ãƒ³ã‚¸ãƒ‹ã‚¢','æ›¸é¡å¯©æŸ»','â€”','pill-muted'],
              ].map(([id,name,ind,st,zaiki,sc]) => `
              <tr>
                <td class="mono text-muted" style="font-size:10px">${id}</td>
                <td class="fw-700">${name}</td>
                <td style="font-size:11px">${ind}</td>
                <td><span class="pill ${sc}">${st}</span></td>
                <td style="font-size:11px">${zaiki}</td>
              </tr>`).join('')}
            </tbody>
          </table>
        </div>
      </div>
    </div>

    <div>
      <div class="card" style="margin-bottom:14px">
        <div class="card-hdr"><div class="ch-title">ãƒ©ãƒ³ã‚¯çŠ¶æ³</div><button class="btn btn-sm btn-ghost" onclick="goPage('rank')">è©³ç´°</button></div>
        <div class="card-body">
          <div style="text-align:center">
            <div style="font-size:28px;margin-bottom:4px">ğŸ¥‡</div>
            <div style="font-size:16px;font-weight:800;color:${rankCol}">${u.rank}</div>
            <div style="font-size:10px;color:var(--muted);margin-top:4px">æœˆé¡ï¼šÂ¥0</div>
          </div>
        </div>
      </div>
      <div class="card">
        <div class="card-hdr"><div class="ch-title">ãƒ„ãƒ¼ãƒ«</div></div>
        <div class="card-body" style="display:flex;flex-direction:column;gap:7px">
          ${[['âš ï¸','æ—©æœŸé€€è·ãƒ•ã‚©ãƒ­ãƒ¼','coreto-early-quit.html'],['ğŸ§®','å ±é…¬ã‚·ãƒŸãƒ¥ãƒ¬ãƒ¼ã‚¿ãƒ¼',null],['ğŸ§¾','é ˜åæ›¸','coreto-receipt.html']].map(([ic,label,url])=>`
          <button class="btn btn-ghost" style="justify-content:flex-start;width:100%;font-size:11px"
                  onclick="${url?`window.open('${url}','_blank')`:"goPage('simulator')"}">
            ${ic} ${label} <span style="margin-left:auto;color:var(--muted)">${url?'â†—':'â†’'}</span>
          </button>`).join('')}
        </div>
      </div>
    </div>
  </div>
</div>`;
}

function hrCasesPage() {
  return `<div class="page" id="page-hr-cases">
  <div class="page-hdr"><div class="page-title">æ‹…å½“æ¡ˆä»¶ä¸€è¦§</div><div class="page-sub">å…¨HRæ¡ˆä»¶ã®é€²æ—ç®¡ç†</div></div>
  <div class="card">
    <div style="overflow-x:auto">
      <table class="tbl">
        <thead><tr><th>ID</th><th>ã‚¯ãƒ©ã‚¤ã‚¢ãƒ³ãƒˆ</th><th>æ¥­ç•Œ</th><th>å¸Œæœ›è·ç¨®</th><th>å¸Œæœ›å¹´å</th><th>ã‚¹ãƒ†ãƒ¼ã‚¿ã‚¹</th><th>åœ¨ç±ç¢ºèª</th></tr></thead>
        <tbody>
          ${[
            ['R-HR0089','éˆ´æœ¨ å¥ä¸€','ITãƒ»å–¶æ¥­','å–¶æ¥­ãƒãƒãƒ¼ã‚¸ãƒ£ãƒ¼','Â¥600ä¸‡ã€œ','åœ¨ç±ç¢ºèªä¸­','pill-orange','âš ï¸ æœ¬æ—¥'],
            ['R-HR0091','ç”°æ‘ çœŸç”±','è£½é€ ','å“è³ªç®¡ç†','Â¥450ä¸‡ã€œ','é¸è€ƒä¸­','pill-blue','â€”'],
            ['R-HR0094','æœ¨æ‘ å¥ˆã€…','HRãƒ»ç®¡ç†','äººäº‹','Â¥500ä¸‡ã€œ','å†…å®šæ‰¿è«¾','pill-green','âœ… å®Œäº†'],
            ['R-HR0097','æ¸¡è¾º æ´¸','IT','ã‚¨ãƒ³ã‚¸ãƒ‹ã‚¢','Â¥700ä¸‡ã€œ','æ›¸é¡å¯©æŸ»','pill-muted','â€”'],
          ].map(([id,name,ind,job,sal,st,sc,zaiki]) => `
          <tr>
            <td class="mono text-muted" style="font-size:10px">${id}</td>
            <td class="fw-700">${name}</td>
            <td style="font-size:11px">${ind}</td>
            <td style="font-size:11px">${job}</td>
            <td class="mono" style="font-size:11px">${sal}</td>
            <td><span class="pill ${sc}">${st}</span></td>
            <td style="font-size:11px">${zaiki}</td>
          </tr>`).join('')}
        </tbody>
      </table>
    </div>
  </div>
</div>`;
}

// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
//  PARTNER PAGES (all inline, no redirect)
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
const PT_YEN = v => 'Â¥' + Math.round(v).toLocaleString();
const PT_CASES = [
  {id:1,client:'ç”°ä¸­ é›„ä»‹',prop:'æ¸‹è°·åŒºæ±2ä¸ç›®ãƒãƒ³ã‚·ãƒ§ãƒ³ 302å·å®¤',ag:'å±±ç”° èª ',date:'2026-01-15',status:'done',reward:83750,step:4},
  {id:2,client:'éˆ´æœ¨ æ˜æ—¥é¦™',prop:'æ¸¯åŒºå—é’å±± 1LDK',ag:'ä½è—¤ èŠ±å­',date:'2026-01-28',status:'done',reward:55000,step:4},
  {id:3,client:'é«˜æ©‹ å¥å¤ª',prop:'æ–°å®¿åŒºè¥¿æ–°å®¿ 2LDK',ag:'å±±ç”° èª ',date:'2026-02-05',status:'done',reward:71250,step:4},
  {id:4,client:'æœ¨æ‘ å¥ˆã€…',prop:'ä¸–ç”°è°·åŒºå¤ªå­å ‚ 1K',ag:'éˆ´æœ¨ å¥å¤ª',date:'2026-02-08',status:'done',reward:32500,step:4},
  {id:5,client:'ä¼Šè—¤ è‰¯å¤ª',prop:'ç›®é»’åŒºä¸­ç›®é»’ ãƒãƒ³ã‚·ãƒ§ãƒ³',ag:'ä½è—¤ èŠ±å­',date:'2026-02-10',status:'done',reward:41250,step:4},
  {id:6,client:'ä¸­æ‘ ãˆã¿',prop:'å“å·åŒºå¤§å´ 1LDK',ag:'å±±ç”° èª ',date:'2026-02-12',status:'active',reward:null,step:2},
  {id:7,client:'æ¸¡è¾º ç¿”',prop:'æ¸‹è°·åŒºä»£å®˜å±± 2DK',ag:'éˆ´æœ¨ å¥å¤ª',date:'2026-02-16',status:'active',reward:null,step:1},
  {id:8,client:'æ¾æœ¬ é¥',prop:'æ–°å®¿åŒºå››è°· 1LDK',ag:'â€”',date:'2026-02-19',status:'active',reward:null,step:0},
];
const PT_STEPS = ['ç™»éŒ²æ¸ˆ','AGå¯¾å¿œä¸­','å†…è¦‹ãƒ»å¯©æŸ»','ç”³è¾¼æ¸ˆ','æˆç´„'];
const PT_REWARDS = [
  {month:'2026å¹´2æœˆåˆ†',count:1,gross:83750,tax:8551,net:75199,date:'2026-03-25',status:'äºˆå®š'},
  {month:'2026å¹´1æœˆåˆ†',count:2,gross:126250,tax:12890,net:113360,date:'2026-02-25',status:'æŒ¯è¾¼æ¸ˆ'},
  {month:'2025å¹´12æœˆåˆ†',count:1,gross:71250,tax:7275,net:63975,date:'2026-01-25',status:'æŒ¯è¾¼æ¸ˆ'},
  {month:'2025å¹´11æœˆåˆ†',count:1,gross:41250,tax:4211,net:37039,date:'2025-12-25',status:'æŒ¯è¾¼æ¸ˆ'},
];
const PT_CONTACTS = [
  {id:1,name:'å±±ç”° èª ',role:'æ‹…å½“AGï¼ˆREï¼‰',icon:'ğŸ ',unread:1,msgs:[
    {me:false,text:'ä½è—¤ã•ã‚“ã€ã“ã‚“ã«ã¡ã¯ã€‚å“å·åŒºå¤§å´ã®ä»¶ã§ã™ãŒã€æ˜æ—¥13æ™‚ã«å†…è¦‹ã‚’è¨­å®šã—ã¾ã—ãŸã€‚',time:'2æœˆ19æ—¥ 14:32'},
    {me:true,text:'ã‚ã‚ŠãŒã¨ã†ã”ã–ã„ã¾ã™ã€‚é¡§å®¢ã«ã‚‚é€£çµ¡ã—ã¦ãŠãã¾ã™ï¼',time:'2æœˆ19æ—¥ 14:45'},
    {me:false,text:'ã‚ˆã‚ã—ããŠé¡˜ã„ã—ã¾ã™ã€‚å†…è¦‹å¾Œã®æ„Ÿè§¦ã‚’æ•™ãˆã¦ã„ãŸã ã‘ã¾ã™ã‹ï¼Ÿ',time:'2æœˆ20æ—¥ 09:15'},
  ]},
  {id:2,name:'CORETO æœ¬éƒ¨',role:'HQ ã‚µãƒãƒ¼ãƒˆ',icon:'ğŸ¢',unread:1,msgs:[
    {me:false,text:'ä½è—¤ ç¾å’²æ§˜ã€2æœˆåˆ†ã®å ±é…¬è¨ˆç®—ãŒå®Œäº†ã—ã¾ã—ãŸã€‚Â¥83,750ã‚’3æœˆ25æ—¥ã«ãŠæŒ¯è¾¼ã¿ã—ã¾ã™ã€‚',time:'2æœˆ20æ—¥ 10:00'},
    {me:true,text:'ç¢ºèªã—ã¾ã—ãŸã€‚ã‚ã‚ŠãŒã¨ã†ã”ã–ã„ã¾ã™ã€‚',time:'2æœˆ20æ—¥ 10:15'},
  ]},
  {id:3,name:'éˆ´æœ¨ å¥å¤ª',role:'æ‹…å½“AGï¼ˆREï¼‰',icon:'ğŸ ',unread:0,msgs:[
    {me:false,text:'ä½è—¤ã•ã‚“ã€æ¸¡è¾ºæ§˜ã®ç‰©ä»¶æ¢ã—ã‚’é–‹å§‹ã—ã¾ã—ãŸã€‚ä»£å®˜å±±ã§3ä»¶å€™è£œãŒã‚ã‚Šã¾ã™ã€‚',time:'2æœˆ17æ—¥ 16:00'},
    {me:true,text:'ã‚ˆã‚ã—ããŠé¡˜ã„ã—ã¾ã™ã€‚',time:'2æœˆ17æ—¥ 16:20'},
  ]},
];
let ptCurrentContact = null;
let ptCaseFilter = 'all';

function ptDashPage() {
  const u = session;
  return `<div class="page" id="page-dashboard">
  <div class="page-hdr">
    <div class="page-title">ã“ã‚“ã«ã¡ã¯ã€${u.name}ã•ã‚“</div>
    <div class="page-sub">ãƒ‘ãƒ¼ãƒˆãƒŠãƒ¼ãƒ€ãƒƒã‚·ãƒ¥ãƒœãƒ¼ãƒ‰ â€” 2026å¹´2æœˆ21æ—¥</div>
  </div>

  <div class="stats-grid sg-4">
    <div class="pt-stat" onclick="goPage('pt-cases')"><div style="font-size:20px;margin-bottom:8px">ğŸ“‹</div><div class="stat-val text-blue">8</div><div class="stat-label">ç´¹ä»‹æ¡ˆä»¶ï¼ˆç´¯è¨ˆï¼‰</div><div class="stat-sub text-green">ä»Šæœˆ +2ä»¶</div></div>
    <div class="pt-stat" onclick="goPage('pt-cases')"><div style="font-size:20px;margin-bottom:8px">ğŸ”„</div><div class="stat-val text-orange">3</div><div class="stat-label">é€²è¡Œä¸­</div></div>
    <div class="pt-stat" onclick="goPage('pt-rewards')"><div style="font-size:20px;margin-bottom:8px">âœ…</div><div class="stat-val text-green">5</div><div class="stat-label">æˆç´„ä»¶æ•°</div></div>
    <div class="pt-stat" onclick="goPage('pt-rewards')"><div style="font-size:20px;margin-bottom:8px">ğŸ’°</div><div class="stat-val text-gold" style="font-size:20px">Â¥523,750</div><div class="stat-label">ç´¯è¨ˆå ±é…¬</div></div>
  </div>

  <div class="grid-2r">
    <div>
      <div class="card">
        <div class="card-hdr"><div class="ch-title">ç´¹ä»‹æ¡ˆä»¶ï¼ˆç›´è¿‘5ä»¶ï¼‰</div><button class="btn btn-sm btn-ghost" onclick="goPage('pt-cases')">å…¨ä»¶</button></div>
        <div style="overflow-x:auto">
          <table class="tbl">
            <thead><tr><th>ã‚¯ãƒ©ã‚¤ã‚¢ãƒ³ãƒˆ</th><th>ç‰©ä»¶</th><th>æ‹…å½“AG</th><th>ã‚¹ãƒ†ãƒ¼ã‚¿ã‚¹</th><th>å ±é…¬</th></tr></thead>
            <tbody>
              ${PT_CASES.slice(0,5).map(c => `
              <tr>
                <td class="fw-700">${c.client}</td>
                <td style="font-size:11px;color:var(--sub)">${c.prop}</td>
                <td style="font-size:11px">${c.ag}</td>
                <td><span class="pill ${c.status==='done'?'pill-green':'pill-blue'}">${c.status==='done'?'âœ“ æˆç´„':'é€²è¡Œä¸­'}</span></td>
                <td class="mono" style="color:${c.reward?'var(--gold)':'var(--muted)'}">${c.reward?PT_YEN(c.reward):'â€”'}</td>
              </tr>`).join('')}
            </tbody>
          </table>
        </div>
      </div>
    </div>
    <div>
      <div class="card" style="margin-bottom:14px">
        <div class="card-hdr"><div class="ch-title">ç´¹ä»‹ã‚³ãƒ¼ãƒ‰</div><button class="btn btn-sm btn-ghost" onclick="goPage('pt-code')">è©³ç´°</button></div>
        <div class="card-body">
          <div class="code-box" style="text-align:center">
            <div style="font-size:10px;color:var(--muted);margin-bottom:4px">ã‚ãªãŸã®ç´¹ä»‹ã‚³ãƒ¼ãƒ‰</div>
            <div class="code-big">PT-SATO2026</div>
            <div style="font-size:10px;color:var(--muted)">ä½¿ç”¨å›æ•° 8å› / æœˆ</div>
          </div>
          <div class="code-share-btns">
            <button class="btn btn-ghost btn-sm" onclick="ptCopyCode()">ğŸ“‹ ã‚³ãƒ”ãƒ¼</button>
            <button class="btn btn-ghost btn-sm" onclick="ptCopyLink()">ğŸ”— ãƒªãƒ³ã‚¯</button>
          </div>
        </div>
      </div>
      <div class="card">
        <div class="card-hdr"><div class="ch-title">æ¬¡å›æŒ¯è¾¼äºˆå®š</div><button class="btn btn-sm btn-ghost" onclick="goPage('pt-rewards')">æ˜ç´°</button></div>
        <div class="card-body">
          <div style="font-size:22px;font-weight:800;color:var(--gold);margin-bottom:4px">${PT_YEN(75199)}</div>
          <div style="font-size:11px;color:var(--sub)">2026å¹´3æœˆ25æ—¥ æŒ¯è¾¼äºˆå®š</div>
          <div style="font-size:10px;color:var(--muted);margin-top:4px">2æœˆåˆ† 1ä»¶ / æºæ³‰å¾Œæ‰‹å–ã‚Š</div>
        </div>
      </div>
    </div>
  </div>
</div>`;
}

function ptCasesPage() {
  return `<div class="page" id="page-pt-cases">
  <div class="page-hdr"><div class="page-title">ç´¹ä»‹æ¡ˆä»¶</div><div class="page-sub">ã‚ãªãŸãŒç´¹ä»‹ã—ãŸå…¨æ¡ˆä»¶ã®é€²æ—</div></div>
  <div style="display:flex;gap:8px;margin-bottom:14px">
    ${[['all','å…¨ã¦'],['active','é€²è¡Œä¸­'],['done','æˆç´„']].map(([f,l])=>`
    <button class="btn btn-sm btn-ghost" id="pt-filter-${f}" onclick="ptFilter('${f}')" style="${f==='all'?'border-color:var(--gold-dim);color:var(--gold);background:var(--gold-bg)':''}">${l}</button>`).join('')}
  </div>
  <div class="card">
    <div id="pt-cases-list">
      ${ptRenderCases('all')}
    </div>
  </div>
</div>`;
}

function ptRenderCases(filter) {
  const rows = PT_CASES.filter(c => filter === 'all' ? true : filter === 'active' ? c.status === 'active' : c.status === 'done');
  return `<div style="overflow-x:auto"><table class="tbl">
    <thead><tr><th>ã‚¯ãƒ©ã‚¤ã‚¢ãƒ³ãƒˆ</th><th>ç‰©ä»¶</th><th>æ‹…å½“AG</th><th>æ—¥ä»˜</th><th>é€²æ—</th><th>å ±é…¬</th></tr></thead>
    <tbody>
      ${rows.map(c => `
      <tr>
        <td class="fw-700">${c.client}</td>
        <td style="font-size:11px;color:var(--sub)">${c.prop}</td>
        <td style="font-size:11px">${c.ag}</td>
        <td style="font-size:11px;color:var(--muted)">${c.date}</td>
        <td>${ptStepperHtml(c.step)}</td>
        <td class="mono" style="color:${c.reward?'var(--gold)':'var(--muted)'};font-weight:${c.reward?700:400}">${c.reward?PT_YEN(c.reward):'â€”'}</td>
      </tr>`).join('')}
    </tbody>
  </table></div>`;
}

function ptFilter(f) {
  ['all','active','done'].forEach(x => {
    const btn = document.getElementById('pt-filter-'+x);
    if(!btn) return;
    if(x === f) { btn.style.borderColor='var(--gold-dim)'; btn.style.color='var(--gold)'; btn.style.background='var(--gold-bg)'; }
    else { btn.style.borderColor=''; btn.style.color=''; btn.style.background=''; }
  });
  const list = document.getElementById('pt-cases-list');
  if(list) list.innerHTML = ptRenderCases(f);
}

function ptStepperHtml(step) {
  return '<div class="stepper">' +
    PT_STEPS.map((s,i) => `<div class="step"><div class="step-dot ${i<step?'done':i===step?'active':'wait'}">${i<step?'âœ“':i+1}</div>${i<PT_STEPS.length-1?`<div class="step-line ${i<step?'done':''}"></div>`:''}</div>`).join('') +
    `</div><div style="font-size:9px;color:var(--sub);margin-top:3px">${PT_STEPS[Math.min(step,PT_STEPS.length-1)]}</div>`;
}

function ptCodePage() {
  return `<div class="page" id="page-pt-code">
  <div class="page-hdr"><div class="page-title">ç´¹ä»‹ã‚³ãƒ¼ãƒ‰ãƒ»ãƒªãƒ³ã‚¯</div><div class="page-sub">ã“ã®ã‚³ãƒ¼ãƒ‰ã‚’é¡§å®¢ã«å…±æœ‰ã™ã‚‹ã“ã¨ã§æ¡ˆä»¶ã‚’ç´¹ä»‹ã§ãã¾ã™</div></div>
  <div class="grid-2">
    <div class="card">
      <div class="card-hdr"><div class="ch-title">ã‚ãªãŸã®ç´¹ä»‹ã‚³ãƒ¼ãƒ‰</div></div>
      <div class="card-body">
        <div class="code-box" style="text-align:center;margin-bottom:16px">
          <div style="font-size:10px;color:var(--muted);margin-bottom:6px;letter-spacing:1px">REFERRAL CODE</div>
          <div class="code-big">PT-SATO2026</div>
          <div style="font-size:11px;color:var(--sub);margin-top:8px">ä½¿ç”¨å›æ•° 8å› / å…ˆæœˆæ¯” +3</div>
        </div>
        <div style="font-size:11px;color:var(--muted);background:var(--bg3);border-radius:8px;padding:10px;margin-bottom:14px;font-family:'DM Mono',monospace;word-break:break-all">
          https://coreto.jp/register?ref=PT-SATO2026
        </div>
        <div class="code-share-btns">
          <button class="btn btn-primary" onclick="ptCopyCode()">ğŸ“‹ ã‚³ãƒ¼ãƒ‰ã‚’ã‚³ãƒ”ãƒ¼</button>
          <button class="btn btn-ghost" onclick="ptCopyLink()">ğŸ”— ãƒªãƒ³ã‚¯ã‚’ã‚³ãƒ”ãƒ¼</button>
          <button class="btn btn-ghost" onclick="ptShareSlack()">ğŸ“¢ Slackã«æŠ•ç¨¿</button>
        </div>
      </div>
    </div>
    <div class="card">
      <div class="card-hdr"><div class="ch-title">ã‚³ãƒ¼ãƒ‰åˆ©ç”¨å±¥æ­´</div></div>
      <div style="overflow-x:auto">
        <table class="tbl">
          <thead><tr><th>æ—¥ä»˜</th><th>ã‚¯ãƒ©ã‚¤ã‚¢ãƒ³ãƒˆ</th><th>ã‚¹ãƒ†ãƒ¼ã‚¿ã‚¹</th></tr></thead>
          <tbody>
            ${PT_CASES.slice(0,6).map(c => `
            <tr>
              <td style="font-size:11px;color:var(--muted)">${c.date}</td>
              <td class="fw-700">${c.client}</td>
              <td><span class="pill ${c.status==='done'?'pill-green':'pill-blue'}">${c.status==='done'?'æˆç´„':'é€²è¡Œä¸­'}</span></td>
            </tr>`).join('')}
          </tbody>
        </table>
      </div>
    </div>
  </div>
</div>`;
}

function ptCopyCode() { navigator.clipboard.writeText('PT-SATO2026').then(()=>alert('âœ… ã‚³ãƒ¼ãƒ‰ã‚’ã‚³ãƒ”ãƒ¼ã—ã¾ã—ãŸ')); }
function ptCopyLink() { navigator.clipboard.writeText('https://coreto.jp/register?ref=PT-SATO2026').then(()=>alert('âœ… ç´¹ä»‹ãƒªãƒ³ã‚¯ã‚’ã‚³ãƒ”ãƒ¼ã—ã¾ã—ãŸ')); }
function ptShareSlack() { alert('ğŸ“¢ Slackãƒ†ã‚­ã‚¹ãƒˆã‚’ã‚³ãƒ”ãƒ¼ã—ã¾ã—ãŸ\n\nã€ç´¹ä»‹ã‚³ãƒ¼ãƒ‰ã€‘PT-SATO2026\nhttps://coreto.jp/register?ref=PT-SATO2026'); }

function ptRewardsPage() {
  return `<div class="page" id="page-pt-rewards">
  <div class="page-hdr"><div class="page-title">å ±é…¬ãƒ»æŒ¯è¾¼æ˜ç´°</div><div class="page-sub">ç´¹ä»‹å ±é…¬ã®å±¥æ­´ã¨æŒ¯è¾¼ã‚¹ã‚±ã‚¸ãƒ¥ãƒ¼ãƒ«</div></div>

  <div class="stats-grid sg-3" style="margin-bottom:20px">
    <div class="stat"><div class="stat-ico">ğŸ’°</div><div class="stat-val text-gold" style="font-size:20px">${PT_YEN(523750)}</div><div class="stat-label">ç´¯è¨ˆå ±é…¬ï¼ˆç¨å¼•å‰ï¼‰</div></div>
    <div class="stat"><div class="stat-ico">ğŸ“…</div><div class="stat-val text-green" style="font-size:20px">${PT_YEN(75199)}</div><div class="stat-label">æ¬¡å›æŒ¯è¾¼ï¼ˆ3æœˆ25æ—¥ï¼‰</div></div>
    <div class="stat"><div class="stat-ico">ğŸ“Š</div><div class="stat-val text-blue">5</div><div class="stat-label">ç´¯è¨ˆæˆç´„ä»¶æ•°</div></div>
  </div>

  <div class="card" style="margin-bottom:16px">
    <div class="card-hdr"><div class="ch-title">æŒ¯è¾¼å±¥æ­´</div></div>
    <div style="overflow-x:auto">
      <table class="tbl">
        <thead><tr><th>å¯¾è±¡æœˆ</th><th>ä»¶æ•°</th><th>å ±é…¬ï¼ˆç¨å‰ï¼‰</th><th>æºæ³‰å¾´å</th><th>æ‰‹å–ã‚Š</th><th>æŒ¯è¾¼æ—¥</th><th>çŠ¶æ³</th></tr></thead>
        <tbody>
          ${PT_REWARDS.map(r => `
          <tr>
            <td class="fw-700">${r.month}</td>
            <td class="mono">${r.count}ä»¶</td>
            <td class="mono">${r.gross?PT_YEN(r.gross):'â€”'}</td>
            <td class="mono text-red">${r.tax?'-'+PT_YEN(r.tax):'â€”'}</td>
            <td class="mono fw-700 text-gold">${r.net?PT_YEN(r.net):'â€”'}</td>
            <td style="font-size:11px;color:var(--sub)">${r.date}</td>
            <td><span class="pill ${r.status==='æŒ¯è¾¼æ¸ˆ'?'pill-green':r.status==='äºˆå®š'?'pill-orange':'pill-muted'}">${r.status}</span></td>
          </tr>`).join('')}
        </tbody>
      </table>
    </div>
  </div>

  <div class="card" style="max-width:400px">
    <div class="card-hdr"><div class="ch-title">å ±é…¬ã‚·ãƒŸãƒ¥ãƒ¬ãƒ¼ã‚¿ãƒ¼</div></div>
    <div class="card-body">
      <div class="fg">
        <label>æˆç´„æ‰‹æ•°æ–™ï¼ˆä»²ä»‹æ–™ï¼‰</label>
        <input type="number" id="pt-sim-fee" placeholder="300000" oninput="ptCalcSim()" step="10000">
      </div>
      <div style="background:var(--bg3);border-radius:9px;padding:14px">
        ${[['å ±é…¬ï¼ˆç¨å‰ï¼‰','pt-sg','var(--text)'],['æºæ³‰å¾´å','pt-st','var(--red)'],['æ‰‹å–ã‚Š','pt-sn','var(--gold)']].map(([k,id,col])=>`
        <div style="display:flex;justify-content:space-between;padding:6px 0;border-bottom:1px solid var(--border);font-size:12px">
          <span class="text-sub">${k}</span>
          <span class="mono fw-700" id="${id}" style="color:${col}">â€”</span>
        </div>`).join('')}
      </div>
    </div>
  </div>
</div>`;
}

function ptCalcSim() {
  const fee = parseFloat(document.getElementById('pt-sim-fee')?.value) || 0;
  const gross = Math.round(fee * 0.25);
  const tax   = gross <= 1000000 ? Math.floor(gross*0.1021) : Math.floor(1000000*0.1021+(gross-1000000)*0.2042);
  const net   = gross - tax;
  const g = document.getElementById('pt-sg');
  const t = document.getElementById('pt-st');
  const n = document.getElementById('pt-sn');
  if(g) g.textContent = fee ? PT_YEN(gross) : 'â€”';
  if(t) t.textContent = fee ? '-'+PT_YEN(tax) : 'â€”';
  if(n) n.textContent = fee ? PT_YEN(net) : 'â€”';
}

function ptMsgsPage() {
  return `<div class="page" id="page-pt-msgs">
  <div class="page-hdr"><div class="page-title">ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸</div><div class="page-sub">æ‹…å½“AGã¨HQæœ¬éƒ¨ã¨ã®ã‚„ã‚Šã¨ã‚Š</div></div>
  <div class="msg-layout">
    <div class="msg-list" id="pt-contact-list"></div>
    <div class="msg-main" id="pt-msg-main">
      <div style="display:flex;align-items:center;justify-content:center;height:100%;color:var(--muted);font-size:12px">â† å·¦ã®ãƒªã‚¹ãƒˆã‹ã‚‰ç›¸æ‰‹ã‚’é¸æŠ</div>
    </div>
  </div>
</div>`;
}

function ptRegisterPage() {
  return `<div class="page" id="page-pt-register">
  <div class="page-hdr"><div class="page-title">æ–°è¦ç´¹ä»‹ã‚’ç™»éŒ²</div><div class="page-sub">æ–°ã—ã„æ¡ˆä»¶ã‚’ç´¹ä»‹ã—ã¦ãã ã•ã„</div></div>
  <div style="max-width:600px">
    <div class="card">
      <div class="card-hdr"><div class="ch-title">ç´¹ä»‹æƒ…å ±å…¥åŠ›</div></div>
      <div class="card-body">
        <div class="row2">
          <div class="fg">
            <label>æ¥­ç¨®</label>
            <select id="pt-reg-type" onchange="ptUpdateRegType()">
              <option value="re">ä¸å‹•ç”£ï¼ˆè³ƒè²¸ãƒ»å£²è²·ï¼‰</option>
              <option value="hr">äººæç´¹ä»‹ï¼ˆè»¢è·ï¼‰</option>
            </select>
          </div>
          <div class="fg">
            <label>ã‚¯ãƒ©ã‚¤ã‚¢ãƒ³ãƒˆæ°å</label>
            <input type="text" id="pt-reg-name" placeholder="å±±ç”° å¤ªéƒ">
          </div>
        </div>
        <div class="row2">
          <div class="fg">
            <label>é›»è©±ç•ªå·</label>
            <input type="tel" id="pt-reg-tel" placeholder="080-XXXX-XXXX">
          </div>
          <div class="fg">
            <label>ãƒ¡ãƒ¼ãƒ«ã‚¢ãƒ‰ãƒ¬ã‚¹</label>
            <input type="email" id="pt-reg-email" placeholder="taro@example.com">
          </div>
        </div>
        <div id="pt-re-section">
          <div class="row2">
            <div class="fg"><label>å¸Œæœ›ã‚¨ãƒªã‚¢</label><input type="text" id="pt-reg-area" placeholder="æ¸‹è°·åŒºãƒ»æ¸¯åŒº"></div>
            <div class="fg"><label>å¸Œæœ›å®¶è³ƒãƒ»ä¾¡æ ¼å¸¯</label><input type="text" placeholder="Â¥10ã€œ12ä¸‡"></div>
          </div>
        </div>
        <div id="pt-hr-section" style="display:none">
          <div class="row2">
            <div class="fg"><label>å¸Œæœ›æ¥­ç•Œ</label><input type="text" placeholder="ITãƒ»å–¶æ¥­"></div>
            <div class="fg"><label>å¸Œæœ›å¹´å</label><input type="text" placeholder="Â¥500ä¸‡ã€œ"></div>
          </div>
        </div>
        <div class="fg">
          <label>å‚™è€ƒ</label>
          <textarea placeholder="ç‰¹è¨˜äº‹é …ãƒ»èƒŒæ™¯ãªã©"></textarea>
        </div>
        <button class="btn btn-primary" onclick="ptSubmitReferral()" style="width:100%;justify-content:center;margin-top:8px">
          âœ… ç´¹ä»‹ã‚’ç™»éŒ²ã™ã‚‹
        </button>
      </div>
    </div>
  </div>
</div>`;
}

function ptUpdateRegType() {
  const v = document.getElementById('pt-reg-type')?.value;
  const re = document.getElementById('pt-re-section');
  const hr = document.getElementById('pt-hr-section');
  if(re) re.style.display = v === 'hr' ? 'none' : 'block';
  if(hr) hr.style.display = v === 'hr' ? 'block' : 'none';
}

function ptSubmitReferral() {
  const name = document.getElementById('pt-reg-name')?.value?.trim();
  if(!name) { alert('ã‚¯ãƒ©ã‚¤ã‚¢ãƒ³ãƒˆæ°åã‚’å…¥åŠ›ã—ã¦ãã ã•ã„'); return; }
  alert(`âœ… ç´¹ä»‹ã‚’ç™»éŒ²ã—ã¾ã—ãŸ\n\nã‚¯ãƒ©ã‚¤ã‚¢ãƒ³ãƒˆï¼š${name}\n\nCORETOæœ¬éƒ¨ãŒSlackã§é€šçŸ¥ã‚’å—ã‘å–ã‚Šã€æ‹…å½“ã‚¨ãƒ¼ã‚¸ã‚§ãƒ³ãƒˆãŒã”é€£çµ¡ã—ã¾ã™ã€‚\né€²æ—ã¯ã€Œç´¹ä»‹æ¡ˆä»¶ã€ã‚¿ãƒ–ã§ç¢ºèªã§ãã¾ã™ã€‚`);
  goPage('pt-cases');
}

// â”€â”€ Partner messages â”€â”€
function ptRenderMessages() {
  const list = document.getElementById('pt-contact-list');
  if(!list) return;
  const total = PT_CONTACTS.reduce((s,c)=>s+c.unread,0);
  list.innerHTML = PT_CONTACTS.map(c => `
    <div class="msg-contact ${ptCurrentContact===c.id?'on':''}" onclick="ptOpenChat(${c.id})">
      <div class="mc-avatar" style="background:${c.id===2?'rgba(201,168,64,.15)':'rgba(79,156,249,.12)'}">${c.icon}</div>
      <div style="flex:1;overflow:hidden">
        <div style="display:flex;align-items:center;gap:6px">
          <div class="mc-name">${c.name}</div>
          ${c.unread?`<span class="mc-unread">${c.unread}</span>`:''}
        </div>
        <div class="mc-last">${c.msgs[c.msgs.length-1].text}</div>
      </div>
      <div class="mc-time" style="font-size:10px;color:var(--muted);white-space:nowrap;margin-left:6px">${c.msgs[c.msgs.length-1].time.replace('2æœˆ','2/')}</div>
    </div>`).join('');
}

function ptOpenChat(id) {
  ptCurrentContact = id;
  const c = PT_CONTACTS.find(x => x.id === id);
  c.unread = 0;
  ptRenderMessages();

  const main = document.getElementById('pt-msg-main');
  if(!main) return;
  main.innerHTML = `
    <div class="msg-hdr">
      <div class="mc-avatar" style="background:${id===2?'rgba(201,168,64,.15)':'rgba(79,156,249,.12)'}">${c.icon}</div>
      <div>
        <div style="font-size:13px;font-weight:700">${c.name}</div>
        <div style="font-size:10px;color:var(--sub)">${c.role}</div>
      </div>
    </div>
    <div class="msg-body" id="pt-chat-body">
      ${c.msgs.map(m => `
      <div>
        <div class="msg-bubble ${m.me?'msg-me':'msg-them'}">${m.text}</div>
        <div class="msg-time">${m.time}</div>
      </div>`).join('')}
    </div>
    <div class="msg-footer">
      <textarea class="msg-input" id="pt-msg-inp" placeholder="ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸ã‚’å…¥åŠ›â€¦" rows="1"
                onkeydown="if(event.key==='Enter'&&!event.shiftKey){event.preventDefault();ptSendMsg(${id})}"></textarea>
      <button class="btn btn-primary btn-sm" onclick="ptSendMsg(${id})">é€ä¿¡</button>
    </div>`;

  const body = document.getElementById('pt-chat-body');
  if(body) body.scrollTop = body.scrollHeight;
}

function ptSendMsg(id) {
  const inp = document.getElementById('pt-msg-inp');
  if(!inp) return;
  const text = inp.value.trim();
  if(!text) return;
  const c = PT_CONTACTS.find(x => x.id === id);
  const now = new Date().toLocaleTimeString('ja-JP',{hour:'2-digit',minute:'2-digit'});
  c.msgs.push({me:true, text, time:'ä»Šæ—¥ '+now});
  inp.value = '';
  const body = document.getElementById('pt-chat-body');
  if(body) {
    const div = document.createElement('div');
    div.innerHTML = `<div class="msg-bubble msg-me">${text}</div><div class="msg-time">ä»Šæ—¥ ${now}</div>`;
    body.appendChild(div);
    body.scrollTop = body.scrollHeight;
  }
}

// â”€â”€ Show messages when navigating to that page â”€â”€
const _origGoPage = goPage;
function goPage(pageId) {
  currentPage = pageId;
  document.querySelectorAll('.nav-item').forEach(n => n.classList.toggle('on', n.id === 'nav-' + pageId));
  document.querySelectorAll('.page').forEach(p => p.classList.remove('on'));
  const pg = document.getElementById('page-' + pageId);
  if(pg) {
    pg.classList.add('on');
    if(pageId === 'pt-msgs') ptRenderMessages();
  } else {
    buildPageContent(pageId);
  }
}

// â”€â”€ ç´¹ä»‹ãƒªãƒ³ã‚¯ãƒ¢ãƒ¼ãƒ€ãƒ« â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
var _refCurrentCode = '';
function openRefModal() {
  var overlay = document.getElementById('ref-modal-overlay');
  var selector = document.getElementById('ref-code-selector');
  var isExec = (typeof session !== 'undefined' && session && session.hqRole === 'exec')
            || (typeof CURRENT_USER !== 'undefined' && CURRENT_USER && CURRENT_USER.hqRole === 'exec');
  var agentId = (typeof session !== 'undefined' && session && session.userId) ? session.userId
              : (typeof ME !== 'undefined' && ME && ME.id) ? ME.id
              : (typeof AGENT !== 'undefined' && AGENT && AGENT.id) ? AGENT.id : '10012';
  if (isExec) {
    var SPECIAL = ['FOUNDER2026','WELCOME2026','GOLD_START','HR_PRO75'];
    var opts = SPECIAL.map(function(c){ return '<option value="'+c+'">â­ '+c+'</option>'; }).join('');
    selector.innerHTML =
      '<div style="margin-bottom:12px"><div style="font-size:10px;color:var(--sub);font-weight:600;margin-bottom:5px">ã‚³ãƒ¼ãƒ‰ç¨®åˆ¥</div>'
      +'<select id="ref-code-select" onchange="updateRefLink()" style="width:100%;padding:8px 10px;background:var(--card2);border:1px solid var(--border2);border-radius:8px;color:var(--text);font-size:12px;font-family:inherit">'
      +'<option value="'+agentId+'">è‡ªåˆ†ã®IDï¼ˆ'+agentId+'ï¼‰</option>'
      +'<optgroup label="â”€â”€ ç‰¹åˆ¥ã‚³ãƒ¼ãƒ‰ â”€â”€">'+opts+'</optgroup>'
      +'</select></div>';
    _refCurrentCode = agentId;
  } else {
    selector.innerHTML =
      '<div style="display:flex;align-items:center;gap:8px;margin-bottom:12px;padding:8px 12px;background:rgba(201,168,76,.06);border:1px solid rgba(201,168,76,.2);border-radius:8px">'
      +'<span style="font-size:11px;color:var(--muted)">ç´¹ä»‹ã‚³ãƒ¼ãƒ‰ï¼š</span>'
      +'<span style="font-family:\'DM Mono\',monospace;font-size:13px;font-weight:700;color:var(--gold)">'+agentId+'</span>'
      +'</div>';
    _refCurrentCode = agentId;
  }
  updateRefLink();
  overlay.classList.add('open');
}
function updateRefLink() {
  var sel = document.getElementById('ref-code-select');
  if (sel) _refCurrentCode = sel.value;
  var base = location.origin + location.pathname.replace(/[^/]*$/, '') + 'coreto-agent-signup.html';
  var url = base + '?ref=' + encodeURIComponent(_refCurrentCode);
  document.getElementById('ref-url-display').textContent = url;
}
function closeRefModal() {
  document.getElementById('ref-modal-overlay').classList.remove('open');
}
function copyRefLink() {
  var url = document.getElementById('ref-url-display').textContent;
  navigator.clipboard.writeText(url).then(function() {
    var btn = document.querySelector('.ref-copy-btn');
    btn.textContent = 'âœ… ã‚³ãƒ”ãƒ¼ã—ã¾ã—ãŸ';
    setTimeout(function(){ btn.textContent = 'ğŸ“‹ ã‚³ãƒ”ãƒ¼'; }, 2000);
  }).catch(function() {
    var ta = document.createElement('textarea');
    ta.value = url; document.body.appendChild(ta); ta.select();
    document.execCommand('copy'); document.body.removeChild(ta);
  });
}
</script>

<div id="ref-modal-overlay" onclick="if(event.target===this)closeRefModal()">
  <div id="ref-modal">
    <div class="ref-mhdr">
      <div class="ref-mhdr-t">ğŸ”— ç´¹ä»‹ãƒªãƒ³ã‚¯ç™ºè¡Œ</div>
      <button onclick="closeRefModal()" style="background:none;border:none;color:var(--muted);font-size:20px;cursor:pointer;line-height:1">Ã—</button>
    </div>
    <div class="ref-mbody">
      <div style="font-size:11px;color:var(--sub);margin-bottom:14px;line-height:1.8">ã“ã®ãƒªãƒ³ã‚¯ã‹ã‚‰å…¥ä¼šã™ã‚‹ã¨ç´¹ä»‹ã‚³ãƒ¼ãƒ‰ãŒè‡ªå‹•å…¥åŠ›ã•ã‚Œã¾ã™ã€‚</div>
      <div id="ref-code-selector"></div>
      <div style="font-size:10px;color:var(--muted);margin-bottom:4px;font-weight:600;letter-spacing:.5px">ç™ºè¡Œãƒªãƒ³ã‚¯</div>
      <div class="ref-url" id="ref-url-display">â€”</div>
      <button class="ref-copy-btn" onclick="copyRefLink()">ğŸ“‹ ã‚³ãƒ”ãƒ¼</button>
    </div>
  </div>
</div>
</body>
</html>
