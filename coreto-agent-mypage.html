<!DOCTYPE html>
<html lang="ja">
<head>
  <!-- â”€â”€ Content Security Policy (XSSè»½æ¸›) â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
       å¤‰æ›´æ™‚: ä½¿ç”¨ã™ã‚‹å¤–éƒ¨ã‚µãƒ¼ãƒ“ã‚¹ã®ã‚ªãƒªã‚¸ãƒ³ã‚’è¿½åŠ ã—ã¦ãã ã•ã„
       Kintoneè¿½åŠ æ™‚: connect-src ã« *.cybozu.com ã‚’è¿½åŠ 
  â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ -->
  <meta http-equiv="Content-Security-Policy" content="
    default-src 'self';
    script-src 'self' 'unsafe-inline'
      https://cdnjs.cloudflare.com
      https://js.stripe.com
      https://cdn-cgi/scripts;
    style-src 'self' 'unsafe-inline'
      https://fonts.googleapis.com;
    font-src 'self'
      https://fonts.gstatic.com;
    img-src 'self' data: blob:;
    connect-src 'self'
      https://hooks.slack.com
      https://hooks.zapier.com
      https://api.stripe.com
      https://js.stripe.com
      https://www.houjin-bangou.nta.go.jp
      https://www.retio.or.jp;
    frame-src 'none';
    object-src 'none';
    base-uri 'self';
  ">

<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>CORETO ãƒã‚¤ãƒšãƒ¼ã‚¸</title>
<style>
@import url('https://fonts.googleapis.com/css2?family=Noto+Sans+JP:wght@300;400;500;700&family=DM+Mono:wght@400;500&family=Syne:wght@700;800&display=swap');
*{box-sizing:border-box;margin:0;padding:0}
:root{
  --bg:#07090f;--card:#0f1119;--card2:#141720;--border:#1e2235;--border2:#252a3d;
  --gold:#c9a84c;--gold-l:#e8c96a;--gold-dim:#7a5f22;--gold-glow:rgba(201,168,76,.12);
  --blue:#4f9cf9;--green:#34d399;--red:#f87171;--orange:#fb923c;--purple:#a78bfa;
  --muted:#4a5270;--sub:#7a849e;--text:#e2e6f3;
}
body{font-family:'Noto Sans JP',sans-serif;background:var(--bg);color:var(--text);min-height:100vh;
  background-image:radial-gradient(ellipse 60% 40% at 80% 10%,rgba(201,168,76,.05) 0%,transparent 60%)}

/* â”€â”€ ãƒ˜ãƒƒãƒ€ãƒ¼ â”€â”€ */
.header{background:rgba(7,9,15,.9);backdrop-filter:blur(12px);border-bottom:1px solid var(--border);
  padding:0 24px;height:56px;display:flex;align-items:center;justify-content:space-between;
  position:sticky;top:0;z-index:100}
.logo{font-family:'Syne',sans-serif;font-size:18px;font-weight:800;color:var(--gold);letter-spacing:3px}
.header-right{display:flex;align-items:center;gap:12px}
.header-name{font-size:12px;font-weight:600}
.header-id{font-family:'DM Mono',monospace;font-size:10px;color:var(--muted)}
.btn-logout{font-size:10px;padding:4px 10px;border-radius:6px;border:1px solid var(--border2);
  background:transparent;color:var(--muted);cursor:pointer;font-family:'Noto Sans JP',sans-serif}
.btn-logout:hover{color:var(--text);border-color:var(--sub)}

/* â”€â”€ ãƒ¡ã‚¤ãƒ³ãƒ¬ã‚¤ã‚¢ã‚¦ãƒˆ â”€â”€ */
.main{max-width:1200px;margin:0 auto;padding:24px}

/* â”€â”€ ãƒ—ãƒ­ãƒ•ã‚£ãƒ¼ãƒ«ãƒãƒŠãƒ¼ â”€â”€ */
.profile-banner{background:linear-gradient(135deg,rgba(201,168,76,.1),rgba(201,168,76,.03));
  border:1px solid rgba(201,168,76,.2);border-radius:16px;padding:22px 28px;
  display:flex;align-items:center;gap:20px;margin-bottom:22px;position:relative;overflow:hidden}
.profile-banner::before{content:'';position:absolute;right:-60px;top:-60px;width:200px;height:200px;
  border-radius:50%;background:radial-gradient(circle,rgba(201,168,76,.06) 0%,transparent 70%)}
.avatar{width:54px;height:54px;border-radius:50%;background:linear-gradient(135deg,var(--gold-dim),rgba(201,168,76,.3));
  display:flex;align-items:center;justify-content:center;font-size:22px;flex-shrink:0;
  border:2px solid rgba(201,168,76,.3)}
.profile-info{flex:1}
.profile-greeting{font-size:11px;color:var(--sub);margin-bottom:3px}
.profile-name{font-family:'Syne',sans-serif;font-size:22px;font-weight:700;line-height:1.1}
.profile-meta{display:flex;align-items:center;gap:10px;margin-top:6px;flex-wrap:wrap}
.rank-badge{font-size:10px;font-weight:700;padding:3px 10px;border-radius:5px;letter-spacing:.5px}
.rb-gold{background:rgba(201,168,76,.2);color:var(--gold);border:1px solid rgba(201,168,76,.3)}
.rb-platinum{background:rgba(167,139,250,.2);color:var(--purple);border:1px solid rgba(167,139,250,.3)}
.rb-silver{background:rgba(160,160,160,.15);color:#c0c0c0;border:1px solid rgba(160,160,160,.3)}
.rb-bronze{background:rgba(180,120,60,.15);color:#cd7f32;border:1px solid rgba(180,120,60,.3)}
.rb-pt{background:rgba(52,211,153,.15);color:var(--green);border:1px solid rgba(52,211,153,.3)}
.profile-id{font-family:'DM Mono',monospace;font-size:11px;color:var(--muted)}
.rank-progress{margin-top:12px}
.rp-label{display:flex;justify-content:space-between;font-size:10px;color:var(--muted);margin-bottom:5px}
.rp-bar{height:4px;background:var(--border2);border-radius:2px;overflow:hidden}
.rp-fill{height:100%;background:linear-gradient(90deg,var(--gold-dim),var(--gold));
  border-radius:2px;transition:width .6s ease}
.profile-stats{display:flex;gap:16px;flex-direction:column;align-items:flex-end}
.ps-item{text-align:right}
.ps-val{font-family:'DM Mono',monospace;font-size:20px;font-weight:500;color:var(--gold)}
.ps-lbl{font-size:10px;color:var(--muted)}

/* â”€â”€ ã‚¯ã‚¤ãƒƒã‚¯ã‚¢ã‚¯ã‚·ãƒ§ãƒ³ â”€â”€ */
.section-title{font-size:10px;color:var(--muted);letter-spacing:2px;text-transform:uppercase;
  margin-bottom:12px;padding-bottom:8px;border-bottom:1px solid var(--border);
  display:flex;align-items:center;gap:8px}
.section-title::before{content:'';width:3px;height:11px;background:var(--gold);border-radius:2px}

.action-grid{display:grid;grid-template-columns:repeat(auto-fill,minmax(160px,1fr));gap:10px;margin-bottom:22px}
.action-card{background:var(--card);border:1px solid var(--border);border-radius:12px;
  padding:18px 14px;cursor:pointer;transition:all .2s;position:relative;overflow:hidden;
  text-decoration:none;color:inherit;display:flex;flex-direction:column;gap:8px}
.action-card:hover{transform:translateY(-2px);border-color:var(--border2)}
.action-card.primary{border-color:rgba(201,168,76,.3);background:rgba(201,168,76,.04)}
.action-card.primary:hover{border-color:rgba(201,168,76,.5);box-shadow:0 4px 20px rgba(201,168,76,.1)}
.action-card::before{content:'';position:absolute;top:0;left:0;right:0;height:2px}
.action-card.primary::before{background:linear-gradient(90deg,var(--gold-dim),var(--gold))}
.action-card.blue::before{background:linear-gradient(90deg,rgba(79,156,249,.3),var(--blue))}
.action-card.green::before{background:linear-gradient(90deg,rgba(52,211,153,.3),var(--green))}
.action-card.orange::before{background:linear-gradient(90deg,rgba(251,146,60,.3),var(--orange))}
.action-card.purple::before{background:linear-gradient(90deg,rgba(167,139,250,.3),var(--purple))}
.ac-icon{font-size:24px}
.ac-title{font-size:13px;font-weight:700}
.ac-desc{font-size:10px;color:var(--muted);line-height:1.5}
.ac-badge{position:absolute;top:10px;right:10px;background:var(--red);color:#fff;
  font-size:9px;font-weight:700;padding:2px 6px;border-radius:10px}

/* â”€â”€ 2ã‚«ãƒ©ãƒ ã‚³ãƒ³ãƒ†ãƒ³ãƒ„ â”€â”€ */
.content-grid{display:grid;grid-template-columns:1fr 320px;gap:16px}
@media(max-width:960px){.content-grid{grid-template-columns:1fr}}

/* â”€â”€ ãƒ‘ãƒãƒ« â”€â”€ */
.panel{background:var(--card);border:1px solid var(--border);border-radius:12px;padding:18px;margin-bottom:14px}
.panel-title{font-size:11px;font-weight:700;color:var(--gold);letter-spacing:1.5px;
  text-transform:uppercase;margin-bottom:14px;display:flex;align-items:center;gap:8px}
.panel-title::before{content:'';width:3px;height:12px;background:var(--gold);border-radius:2px}

/* â”€â”€ æ¡ˆä»¶ãƒªã‚¹ãƒˆ â”€â”€ */
.case-item{background:var(--card2);border:1px solid var(--border2);border-radius:9px;
  padding:12px 14px;margin-bottom:8px;display:flex;align-items:center;gap:12px;cursor:pointer;
  transition:border-color .15s}
.case-item:hover{border-color:rgba(201,168,76,.3)}
.ci-dot{width:8px;height:8px;border-radius:50%;flex-shrink:0}
.ci-info{flex:1}
.ci-title{font-size:13px;font-weight:600;margin-bottom:2px}
.ci-meta{font-size:10px;color:var(--muted)}
.ci-status{font-size:10px;padding:2px 8px;border-radius:4px;font-weight:600;white-space:nowrap}
.s-active{background:rgba(52,211,153,.12);color:var(--green)}
.s-wait{background:rgba(251,146,60,.12);color:var(--orange)}
.s-draft{background:rgba(79,156,249,.12);color:var(--blue)}

/* â”€â”€ é€šçŸ¥ â”€â”€ */
.notif-item{display:flex;gap:10px;padding:10px 0;border-bottom:1px solid rgba(30,34,53,.6)}
.notif-item:last-child{border-bottom:none}
.ni-icon{font-size:18px;flex-shrink:0;margin-top:1px}
.ni-body{flex:1}
.ni-text{font-size:12px;line-height:1.6}
.ni-time{font-size:10px;color:var(--muted);margin-top:2px;font-family:'DM Mono',monospace}
.ni-new{width:6px;height:6px;border-radius:50%;background:var(--blue);flex-shrink:0;margin-top:5px}

/* â”€â”€ å®Ÿç¸¾ã‚°ãƒ©ãƒ•é¢¨ â”€â”€ */
.perf-grid{display:grid;grid-template-columns:1fr 1fr;gap:8px;margin-bottom:12px}
.perf-card{background:var(--card2);border-radius:8px;padding:12px}
.pc-val{font-family:'DM Mono',monospace;font-size:20px;font-weight:500}
.pc-lbl{font-size:10px;color:var(--muted);margin-top:3px}
.bar-chart{margin-top:12px}
.bar-row{display:flex;align-items:center;gap:8px;margin-bottom:6px;font-size:10px}
.bar-label{color:var(--muted);width:24px;text-align:right;flex-shrink:0}
.bar-wrap{flex:1;height:6px;background:var(--border2);border-radius:3px;overflow:hidden}
.bar-fill{height:100%;border-radius:3px;background:linear-gradient(90deg,var(--gold-dim),var(--gold))}
.bar-val{color:var(--sub);width:30px;text-align:right;font-family:'DM Mono',monospace}

.hidden{display:none!important}
::-webkit-scrollbar{width:4px}::-webkit-scrollbar-thumb{background:var(--border2);border-radius:2px}
</style>

<style>
@media(max-width:768px){
  .header{padding:0 14px!important;height:50px!important}
  .header-right{gap:8px!important}
  .header-name{font-size:12px!important}
  .header-id{font-size:9px!important}
  .btn-logout{font-size:10px!important;padding:5px 10px!important}
  .main{padding:14px 14px 80px!important;max-width:100%!important}
  /* ãƒ—ãƒ­ãƒ•ã‚£ãƒ¼ãƒ«ãƒãƒŠãƒ¼ */
  .profile-banner{flex-direction:row!important;flex-wrap:wrap!important;gap:12px!important;padding:14px!important}
  .avatar{width:48px!important;height:48px!important;font-size:24px!important;flex-shrink:0}
  .profile-stats{display:flex!important;flex-direction:row!important;gap:16px!important;width:100%!important;padding-top:8px!important;border-top:1px solid #1e2235!important}
  .ps-item{margin-top:0!important;flex:1!important;text-align:center!important}
  .ps-val{font-size:16px!important}
  .rank-progress{width:100%!important}
  /* ã‚¢ã‚¯ã‚·ãƒ§ãƒ³ã‚°ãƒªãƒƒãƒ‰: 2Ã—2 */
  .action-grid{grid-template-columns:repeat(2,1fr)!important;gap:8px!important}
  .action-card{min-height:80px!important;padding:12px!important;border-radius:12px!important}
  .ac-icon{font-size:22px!important}
  .ac-title{font-size:11px!important}
  .ac-desc{font-size:9px!important}
  /* ã‚³ãƒ³ãƒ†ãƒ³ãƒ„ã‚°ãƒªãƒƒãƒ‰: 1ã‚«ãƒ©ãƒ  */
  .content-grid{display:flex!important;flex-direction:column!important;gap:12px!important}
  .panel{padding:14px!important;border-radius:12px!important}
  .panel-title{font-size:10px!important}
  /* é€²è¡Œä¸­æ¡ˆä»¶ */
  .case-item{padding:10px 12px!important}
  .ci-title{font-size:12px!important}
  /* ååˆºãƒ—ãƒ¬ãƒ“ãƒ¥ãƒ¼ã‚’ç¸¦ç©ã¿ã« */
  #bc-section>div>div:nth-child(2){flex-direction:column!important}
  #bc-card-preview{min-width:auto!important;width:100%!important}
  /* perf grid */
  .perf-grid{grid-template-columns:1fr 1fr!important}
}
</style>
</head>
<body>

<div class="header">
  <div class="logo">CORETO</div>
  <div class="header-right">
    <div>
      <div class="header-name" id="hdr-name">â€”</div>
      <div class="header-id" id="hdr-id">â€”</div>
    </div>
    <button class="btn-logout" onclick="logout()">ãƒ­ã‚°ã‚¢ã‚¦ãƒˆ</button>
  </div>
</div>

<div class="main">

  <!-- ãƒ—ãƒ­ãƒ•ã‚£ãƒ¼ãƒ«ãƒãƒŠãƒ¼ -->
  <div class="profile-banner" id="profile-banner">
    <div class="avatar" id="avatar">ğŸ‘¤</div>
    <div style="flex:1">
      <div class="profile-greeting">ã“ã‚“ã«ã¡ã¯</div>
      <div class="profile-name" id="profile-name">â€”</div>
      <div class="profile-meta">
        <span class="rank-badge" id="rank-badge">â€”</span>
        <span class="profile-id" id="profile-id">â€”</span>
        <span id="type-label" style="font-size:10px;color:var(--sub)">â€”</span>
      </div>
      <div class="rank-progress" id="rank-progress">
        <div class="rp-label">
          <span id="rp-current">Current</span>
          <span id="rp-next">Next</span>
        </div>
        <div class="rp-bar"><div class="rp-fill" id="rp-fill" style="width:60%"></div></div>
      </div>
    </div>
    <div class="profile-stats">
      <div class="ps-item">
        <div class="ps-val" id="ps-cases">0</div>
        <div class="ps-lbl">ä»Šæœˆæˆç´„</div>
      </div>
      <div class="ps-item" style="margin-top:8px">
        <div class="ps-val" id="ps-reward">Â¥â€”</div>
        <div class="ps-lbl">ä»Šæœˆå ±é…¬è¦‹è¾¼ã¿</div>
      </div>
    </div>
  </div>

  <!-- ã‚¯ã‚¤ãƒƒã‚¯ã‚¢ã‚¯ã‚·ãƒ§ãƒ³ -->
  <div class="section-title">ã‚¯ã‚¤ãƒƒã‚¯ã‚¢ã‚¯ã‚·ãƒ§ãƒ³</div>
  <div class="action-grid" id="action-grid">
    <!-- JSç”Ÿæˆ -->
  </div>

  <!-- ã‚³ãƒ³ãƒ†ãƒ³ãƒ„ -->
  <div class="content-grid">
    <!-- å·¦ï¼šé€²è¡Œä¸­æ¡ˆä»¶ -->
    <div>
      <div class="panel">
        <div class="panel-title">é€²è¡Œä¸­ã®æ¡ˆä»¶</div>
        <div id="cases-list"><!-- JSç”Ÿæˆ --></div>
        <button style="width:100%;padding:9px;border-radius:8px;border:1px solid var(--border2);
          background:transparent;color:var(--sub);font-size:11px;cursor:pointer;font-family:'Noto Sans JP',sans-serif;margin-top:4px"
          onclick="openTool('matching')">
          ğŸ“‹ æ¡ˆä»¶ãƒœãƒ¼ãƒ‰ã‚’è¦‹ã‚‹ â†’
        </button>
      </div>
    </div>

    <!-- å³ï¼šé€šçŸ¥ãƒ»å®Ÿç¸¾ -->
    <div>
      <div class="panel">
        <div class="panel-title">é€šçŸ¥ <span id="notif-count" style="background:var(--blue);color:#fff;font-size:9px;padding:1px 6px;border-radius:8px;margin-left:4px">3</span></div>
        <div id="notif-list"><!-- JSç”Ÿæˆ --></div>
      </div>

      <div class="panel">
        <div class="panel-title">ä»Šæœˆã®å®Ÿç¸¾</div>
        <div class="perf-grid">
          <div class="perf-card">
            <div class="pc-val" id="perf-cases" style="color:var(--gold)">0</div>
            <div class="pc-lbl">æˆç´„ä»¶æ•°</div>
          </div>
          <div class="perf-card">
            <div class="pc-val" id="perf-reward" style="color:var(--green)">Â¥0</div>
            <div class="pc-lbl">å ±é…¬é¡ï¼ˆæ‰‹å–ã‚Šï¼‰</div>
          </div>
        </div>
        <div class="bar-chart" id="bar-chart"><!-- JSç”Ÿæˆ --></div>
      </div>
    </div>
  </div>

    <!-- â•â•â•â• ååˆºç™ºæ³¨ã‚»ã‚¯ã‚·ãƒ§ãƒ³ â•â•â•â• -->
    <div style="background:var(--card);border:1px solid var(--border);border-radius:14px;margin-top:16px;overflow:hidden" id="bc-section">
      <div style="padding:13px 20px;border-bottom:1px solid var(--border);background:var(--card2);
                  display:flex;align-items:center;justify-content:space-between">
        <div style="font-size:9px;color:var(--muted);letter-spacing:2px;text-transform:uppercase;
                    display:flex;align-items:center;gap:8px">
          <span style="display:inline-block;width:3px;height:11px;border-radius:2px;background:var(--gold)"></span>
          ååˆºç™ºæ³¨
        </div>
        <span style="font-size:9px;padding:3px 10px;border-radius:6px;font-weight:700;
                     background:rgba(201,168,76,.13);color:var(--gold);border:1px solid var(--gold-dim)">
          Â¥2,000 / ã‚»ãƒƒãƒˆ
        </span>
      </div>
      <div style="padding:18px 20px">
        <!-- ååˆºãƒ—ãƒ¬ãƒ“ãƒ¥ãƒ¼ -->
        <div style="display:flex;gap:16px;align-items:flex-start;margin-bottom:16px">
          <div id="bc-card-preview" style="background:white;border-radius:8px;padding:14px 18px;
               min-width:200px;box-shadow:0 2px 16px rgba(0,0,0,.25);flex-shrink:0">
            <div style="font-size:8px;color:#888;letter-spacing:2px;margin-bottom:8px">CORETO</div>
            <div style="font-size:15px;font-weight:700;color:#1a1a1a;margin-bottom:2px" id="bc-name">â€”</div>
            <div style="font-size:10px;color:#888;font-family:monospace;margin-bottom:10px" id="bc-kana">â€”</div>
            <div style="width:100%;height:1px;background:#eee;margin-bottom:10px"></div>
            <div style="font-size:9px;color:#555;line-height:1.9" id="bc-contact">â€”</div>
          </div>
          <div style="flex:1;font-size:11px;color:var(--sub);line-height:2">
            <div style="font-weight:700;color:var(--text);margin-bottom:6px">ğŸ“‹ ååˆºã‚»ãƒƒãƒˆå†…å®¹</div>
            100æš / ã‚»ãƒƒãƒˆ<br>
            ç‰‡é¢ ãƒ•ãƒ«ã‚«ãƒ©ãƒ¼å°åˆ·<br>
            ç´æœŸï¼šç™ºæ³¨å¾Œ ç´„1é€±é–“<br>
            è²»ç”¨ï¼š<strong style="color:var(--gold)">Â¥2,000</strong>ï¼ˆç™»éŒ²ã‚«ãƒ¼ãƒ‰ã‚ˆã‚Šå³æ™‚æ±ºæ¸ˆï¼‰<br><br>
            <div style="padding:8px 10px;background:var(--card2);border-radius:8px;
                        border:1px solid var(--border);font-size:10px;color:var(--muted)">
              âœï¸ ãƒ‡ã‚¶ã‚¤ãƒ³å¤‰æ›´ãƒ»æ—§å§“è¡¨è¨˜ã¯<br>
              <a onclick="window.location.href='coreto-account-settings.html'"
                 style="color:var(--blue);cursor:pointer">ã‚¢ã‚«ã‚¦ãƒ³ãƒˆè¨­å®š</a>ã‹ã‚‰è¨­å®šã§ãã¾ã™
            </div>
          </div>
        </div>

        <!-- æ³¨æ–‡ãƒ•ã‚©ãƒ¼ãƒ  -->
        <div id="bc-order-form">
          <!-- å®…å»ºãƒã‚§ãƒƒã‚¯ -->
          <div style="display:flex;align-items:center;gap:10px;padding:12px 14px;
                      background:var(--card2);border:1px solid var(--border);border-radius:10px;margin-bottom:12px">
            <label style="display:flex;align-items:center;gap:8px;font-size:12px;cursor:pointer;flex:1">
              <input type="checkbox" id="bc-takken" onchange="updateBcPreview()">
              <span style="font-size:16px">ğŸ›</span>
              <div>
                <div style="font-weight:700">å®…åœ°å»ºç‰©å–å¼•å£«</div>
                <div style="font-size:10px;color:var(--muted)">ãƒã‚§ãƒƒã‚¯ã§ååˆºã«è‚©æ›¸ãã‚’è¿½åŠ </div>
              </div>
            </label>
            <div id="bc-takken-badge" style="display:none;font-size:9px;padding:3px 10px;border-radius:6px;font-weight:700;
                 background:rgba(201,168,76,.13);color:var(--gold);border:1px solid var(--gold-dim)">
              å®…å»ºå£« è¡¨è¨˜ã‚ã‚Š
            </div>
          </div>

          <!-- ç‰¹è¨˜äº‹é … -->
          <div style="font-size:10px;color:var(--sub);margin-bottom:6px;font-weight:600">ç‰¹è¨˜äº‹é …ï¼ˆä»»æ„ï¼‰</div>
          <textarea id="bc-note" rows="2" placeholder="ä¾‹ï¼šæ—§å§“ã‚’è¡¨è¨˜å¸Œæœ›ãƒ»å½¹è·è¿½åŠ ãªã©"
            style="width:100%;background:#090b13;border:1px solid var(--border2);border-radius:9px;
                   padding:10px 14px;color:var(--text);font-size:12px;
                   font-family:'Noto Sans JP',sans-serif;resize:vertical;outline:none;
                   margin-bottom:12px"></textarea>

          <!-- ã‚¢ã‚¯ã‚·ãƒ§ãƒ³ãƒœã‚¿ãƒ³ç¾¤ -->
          <div style="display:flex;gap:8px;margin-bottom:12px">
            <button onclick="previewBcPdf()"
              style="flex:1;padding:10px;background:rgba(79,156,249,.1);border:1px solid rgba(79,156,249,.3);
                     color:var(--blue);border-radius:9px;font-size:11px;font-weight:700;
                     cursor:pointer;font-family:'Noto Sans JP',sans-serif;
                     display:flex;align-items:center;justify-content:center;gap:6px">
              ğŸ‘ PDFãƒ—ãƒ¬ãƒ“ãƒ¥ãƒ¼ãƒ»å…¥ç¨¿ç”¨PDF
            </button>
            <button onclick="sendToSlack()"
              style="flex:1;padding:10px;background:rgba(74,82,112,.1);border:1px solid var(--border2);
                     color:var(--sub);border-radius:9px;font-size:11px;font-weight:700;
                     cursor:pointer;font-family:'Noto Sans JP',sans-serif;
                     display:flex;align-items:center;justify-content:center;gap:6px">
              ğŸ’¬ Slackã«æƒ…å ±ã‚’é€ä¿¡
            </button>
          </div>

          <div style="padding:12px 14px;background:rgba(201,168,76,.05);
                      border:1px solid var(--gold-dim);border-radius:9px;
                      font-size:11px;color:var(--sub);margin-bottom:14px;line-height:1.9">
            ğŸ’³ ç™ºæ³¨ã™ã‚‹ã¨ç™»éŒ²ã‚«ãƒ¼ãƒ‰ï¼ˆVisa Â·Â·Â·4242ï¼‰ã‚ˆã‚Š <strong style="color:var(--gold)">Â¥2,000</strong> ãŒå³æ™‚æ±ºæ¸ˆã•ã‚Œã¾ã™ã€‚<br>
            ãƒ»<strong style="color:var(--text)">PDFãƒ—ãƒ¬ãƒ“ãƒ¥ãƒ¼</strong>ï¼š91Ã—55mmã®ååˆºPDFã‚’ç”Ÿæˆã€‚å°åˆ·æ¥­è€…ã«ç›´æ¥å…¥ç¨¿å¯èƒ½<br>
            ãƒ»<strong style="color:var(--text)">Slacké€ä¿¡</strong>ï¼šæœ¬éƒ¨ã¸æ°åãƒ»é›»è©±ãƒ»IDãƒ»å®…å»ºæœ‰ç„¡ã‚’é€ä¿¡ï¼ˆæœ¬éƒ¨ãŒAIã§ä½œæˆï¼‰
          </div>

          <!-- ã‚«ãƒ¼ãƒ‰æƒ…å ± -->
          <div style="display:flex;align-items:center;justify-content:space-between;padding:12px 14px;
                      background:var(--card2);border:1px solid var(--border);border-radius:10px;margin-bottom:14px">
            <div style="display:flex;align-items:center;gap:10px">
              <span style="font-size:20px">ğŸ’³</span>
              <div>
                <div style="font-size:11px;font-weight:700">Visa Â·Â·Â·4242</div>
                <div style="font-size:10px;color:var(--muted)">ç™»éŒ²æ¸ˆã¿ã‚«ãƒ¼ãƒ‰</div>
              </div>
            </div>
            <span style="font-size:9px;padding:3px 10px;border-radius:6px;font-weight:700;
                  background:rgba(52,211,153,.13);color:var(--green);border:1px solid rgba(52,211,153,.3)">
              âœ“ æœ‰åŠ¹
            </span>
          </div>

          <button onclick="orderBusinessCard()"
            style="width:100%;padding:13px;background:linear-gradient(135deg,var(--gold),#a8742a);
                   color:#0a0c10;border:none;border-radius:11px;font-size:13px;font-weight:700;
                   cursor:pointer;font-family:'Noto Sans JP',sans-serif;transition:.15s;
                   display:flex;align-items:center;justify-content:center;gap:8px">
            ğŸªª ç™ºæ³¨ã™ã‚‹ï¼ˆÂ¥2,000 å³æ™‚æ±ºæ¸ˆï¼‰
          </button>
        </div>

        <!-- ç™ºæ³¨å±¥æ­´ -->
        <div style="margin-top:18px;border-top:1px solid var(--border);padding-top:14px">
          <div style="font-size:9px;color:var(--muted);letter-spacing:1.5px;text-transform:uppercase;margin-bottom:10px">
            ç™ºæ³¨å±¥æ­´
          </div>
          <div id="bc-history">
            <div style="display:flex;align-items:center;justify-content:space-between;
                        padding:10px 12px;background:var(--card2);border-radius:9px;font-size:11px">
              <div>
                <div style="font-weight:700">2026/01/10 ç™ºæ³¨</div>
                <div style="color:var(--muted);font-size:10px">100æš / é€šå¸¸ãƒ‡ã‚¶ã‚¤ãƒ³</div>
              </div>
              <div style="text-align:right">
                <div style="font-family:'DM Mono',monospace;color:var(--red)">-Â¥2,000</div>
                <span style="font-size:9px;padding:2px 8px;border-radius:5px;font-weight:700;
                             background:rgba(52,211,153,.13);color:var(--green);
                             border:1px solid rgba(52,211,153,.3)">ç´å“æ¸ˆã¿</span>
              </div>
            </div>
          </div>
        </div>
      </div>
    </div>

</div>

<script>
// â”€â”€ XSSã‚¨ã‚¹ã‚±ãƒ¼ãƒ—é–¢æ•° â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
function escHtml(s) {
  if (s == null) return '';
  return String(s)
    .replace(/&/g, '&amp;')
    .replace(/</g, '&lt;')
    .replace(/>/g, '&gt;')
    .replace(/"/g, '&quot;')
    .replace(/'/g, '&#x27;');
}
// â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€

  // â”€â”€ Slacké€šçŸ¥è¨­å®š â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
  // æœ¬ç•ªé‹ç”¨å‰ã« Slack Incoming Webhook URL ã‚’è¨­å®šã—ã¦ãã ã•ã„
  // Slackç®¡ç†ç”»é¢ â†’ ã‚¢ãƒ—ãƒª â†’ Incoming Webhooks â†’ Webhook URLã‚’ã‚³ãƒ”ãƒ¼
  var SLACK_WEBHOOK = window.SLACK_CONFIG
    ? window.SLACK_CONFIG.GENERAL   // db.jsãŒèª­ã¿è¾¼ã¾ã‚Œã¦ã„ã‚‹å ´åˆ
    : 'YOUR_SLACK_WEBHOOK_URL';     // ç›´æ¥è¨­å®šã™ã‚‹å ´åˆã¯ã“ã“ã«è²¼ã‚Šä»˜ã‘

  function notifySlack(msg) {
    if (!SLACK_WEBHOOK || SLACK_WEBHOOK === 'YOUR_SLACK_WEBHOOK_URL') {
      console.log('[Slackï¼ˆæœªè¨­å®šï¼‰]', msg);
      return;
    }
    fetch(SLACK_WEBHOOK, {
      method: 'POST',
      headers: { 'Content-Type': 'application/json' },
      body: JSON.stringify({ text: msg }),
      mode: 'no-cors'
    }).catch(e => console.error('[Slacké€ä¿¡ã‚¨ãƒ©ãƒ¼]', e));
  }
  // â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€

// â•â• AUTH GUARD (è¦ãƒ­ã‚°ã‚¤ãƒ³) â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
(function() {
  var s = null;
  try { s = JSON.parse(sessionStorage.getItem('coreto_session') || 'null'); } catch(e) {}
  if (!s || !s.userId || !s.type) {
    sessionStorage.setItem('coreto_redirect', window.location.href);
    location.replace('coreto-login.html');
    return;
  }
  if (!s.sessionToken || s.sessionToken.length !== 64) {
    sessionStorage.removeItem('coreto_session');
    location.replace('coreto-login.html');
    return;
  }
  var _la = new Date(s.loginAt).getTime();
  if (isNaN(_la) || (Date.now() - _la) > 28800000) {
    sessionStorage.removeItem('coreto_session');
    alert('ã‚»ãƒƒã‚·ãƒ§ãƒ³ã®æœ‰åŠ¹æœŸé™ãŒåˆ‡ã‚Œã¾ã—ãŸã€‚å†åº¦ãƒ­ã‚°ã‚¤ãƒ³ã—ã¦ãã ã•ã„ã€‚');
    location.replace('coreto-login.html');
    return;
  }
  window._SESSION = s;
})();

// â”€â”€ ã‚»ãƒƒã‚·ãƒ§ãƒ³èª­ã¿è¾¼ã¿ â”€â”€
const SESSION_KEY = 'coreto_session';

// ãƒ‡ãƒ¢ç”¨ãƒ‡ãƒ•ã‚©ãƒ«ãƒˆï¼ˆãƒ­ã‚°ã‚¤ãƒ³ãªã—ã§ã‚¢ã‚¯ã‚»ã‚¹ã—ãŸå ´åˆï¼‰
const DEFAULT_SESSION = {
  agId: '10012', name: 'å±±ç”° èª ', rank: 'Gold',
  rankKey: 'gold', type: 're',
};

let session = JSON.parse(sessionStorage.getItem(SESSION_KEY) || 'null') || DEFAULT_SESSION;

// â”€â”€ ãƒ€ãƒŸãƒ¼ãƒ‡ãƒ¼ã‚¿ï¼ˆã‚¨ãƒ¼ã‚¸ã‚§ãƒ³ãƒˆåˆ¥ï¼‰ â”€â”€
const AGENT_DATA = {
  '10012': {
    cases: 3, rewardEstimate: 847000,
    progress: 72, progressLabel: 'Gold â†’ Platinum ã¾ã§ 28%',
    cases_list: [
      {id:'CASE-0234', title:'æ± è¢‹ã‚¨ãƒªã‚¢ è³ƒè²¸ 1K', status:'active', statusLabel:'å…¥é‡‘å¾…ã¡', color:'#fb923c'},
      {id:'CASE-0228', title:'æ–°å®¿ã‚¨ãƒªã‚¢ è³ƒè²¸ 1LDK', status:'active', statusLabel:'å¥‘ç´„æ›¸é€ä»˜æ¸ˆã¿', color:'#34d399'},
      {id:'CASE-0220', title:'æ¸‹è°· å£²è²·ä»²ä»‹', status:'wait', statusLabel:'ITé‡èª¬èª¿æ•´ä¸­', color:'#4f9cf9'},
    ],
    notifs: [
      {icon:'ğŸ’°', text:'CASE-0228 å…¨é¡å…¥é‡‘ãŒç¢ºèªã•ã‚Œã¾ã—ãŸã€‚æˆç´„å ±å‘Šï¼ˆ/closeï¼‰ã‚’é€ä¿¡ã—ã¦ãã ã•ã„ã€‚', time:'10åˆ†å‰', isNew:true},
      {icon:'ğŸ“¦', text:'CASE-0234 ã®å¥‘ç´„æ›¸ãŒé…é”ã•ã‚Œã¾ã—ãŸã€‚', time:'2æ™‚é–“å‰', isNew:true},
      {icon:'ğŸ†', text:'ä»Šæœˆã®æˆç´„æ•°ãŒ3ä»¶ã«é”ã—ã¾ã—ãŸï¼', time:'æ˜¨æ—¥', isNew:false},
    ],
    monthly: [{label:'10æœˆ',val:1},{label:'11æœˆ',val:2},{label:'12æœˆ',val:1},{label:'1æœˆ',val:2},{label:'2æœˆ',val:3}],
  },
  '10008': {
    cases: 2, rewardEstimate: 1250000,
    progress: 90, progressLabel: 'Platinum ç¶­æŒä¸­',
    cases_list: [
      {id:'CASE-0230', title:'ä¸­é‡ è³ƒè²¸ 1K', status:'active', statusLabel:'ç”³è¾¼å¯©æŸ»ä¸­', color:'#4f9cf9'},
      {id:'CASE-0218', title:'ä»£ã€…æœ¨ å£²è²·', status:'wait', statusLabel:'å¥‘ç´„æ›¸åˆ°ç€å¾…ã¡', color:'#fb923c'},
    ],
    notifs: [
      {icon:'ğŸ“©', text:'ç®¡ç†ä¼šç¤¾ã‹ã‚‰æ›¸é¡ãŒå±Šã„ã¦ã„ã¾ã™ã€‚ç¢ºèªã—ã¦ãã ã•ã„ã€‚', time:'1æ™‚é–“å‰', isNew:true},
      {icon:'ğŸ’°', text:'2æœˆåˆ† æŒ¯è¾¼å®Œäº† Â¥980,500', time:'2æ—¥å‰', isNew:false},
    ],
    monthly: [{label:'10æœˆ',val:2},{label:'11æœˆ',val:3},{label:'12æœˆ',val:2},{label:'1æœˆ',val:3},{label:'2æœˆ',val:2}],
  },
  '20005': {
    cases: 1, rewardEstimate: 382000,
    progress: 45, progressLabel: 'Gold â†’ Platinum ã¾ã§ 55%',
    cases_list: [
      {id:'CASE-0231', title:'ITã‚¨ãƒ³ã‚¸ãƒ‹ã‚¢ è»¢è·æ”¯æ´', status:'draft', statusLabel:'é¢æ¥èª¿æ•´ä¸­', color:'#4f9cf9'},
    ],
    notifs: [
      {icon:'ğŸ‘¥', text:'CASE-0231 å€™è£œè€…ã‹ã‚‰é€£çµ¡ãŒæ¥ã¦ã„ã¾ã™ã€‚', time:'30åˆ†å‰', isNew:true},
      {icon:'ğŸ’°', text:'1æœˆåˆ† ç¬¬2å›æ‰•ã„ Â¥187,500 æŒ¯è¾¼å®Œäº†', time:'1é€±é–“å‰', isNew:false},
    ],
    monthly: [{label:'10æœˆ',val:1},{label:'11æœˆ',val:0},{label:'12æœˆ',val:1},{label:'1æœˆ',val:1},{label:'2æœˆ',val:1}],
  },
  '10023': {
    cases: 1, rewardEstimate: 226000,
    progress: 30, progressLabel: 'Silver â†’ Gold ã¾ã§ 70%',
    cases_list: [
      {id:'CASE-0236', title:'è±Šå³¶åŒº è³ƒè²¸ 1LDK', status:'draft', statusLabel:'ç‰©ä»¶æ¢ã—ä¸­', color:'#4f9cf9'},
    ],
    notifs: [
      {icon:'ğŸ“‹', text:'æ–°ã—ã„æ¡ˆä»¶ãŒãƒœãƒ¼ãƒ‰ã«æ²è¼‰ã•ã‚Œã¾ã—ãŸï¼ˆæ± è¢‹ã‚¨ãƒªã‚¢ï¼‰ã€‚', time:'1æ™‚é–“å‰', isNew:true},
    ],
    monthly: [{label:'10æœˆ',val:0},{label:'11æœˆ',val:1},{label:'12æœˆ',val:0},{label:'1æœˆ',val:1},{label:'2æœˆ',val:1}],
  },
  '30007': {
    cases: 2, rewardEstimate: 156000,
    progress: 0, progressLabel: 'ãƒ‘ãƒ¼ãƒˆãƒŠãƒ¼',
    cases_list: [
      {id:'CASE-0234', title:'ç´¹ä»‹æ¡ˆä»¶ï¼šæ± è¢‹ã‚¨ãƒªã‚¢è³ƒè²¸', status:'active', statusLabel:'ã‚¨ãƒ¼ã‚¸ã‚§ãƒ³ãƒˆå¯¾å¿œä¸­', color:'#34d399'},
      {id:'CASE-0235', title:'ç´¹ä»‹æ¡ˆä»¶ï¼šæ–°å®¿ã‚¨ãƒªã‚¢è³ƒè²¸', status:'wait', statusLabel:'ãƒãƒƒãƒãƒ³ã‚°å¾…ã¡', color:'#fb923c'},
    ],
    notifs: [
      {icon:'ğŸ‰', text:'CASE-0228 ãŒæˆç´„ã—ã¾ã—ãŸï¼ç´¹ä»‹å ±é…¬ Â¥78,000 ãŒç¢ºå®šã—ã¾ã—ãŸã€‚', time:'1æ—¥å‰', isNew:true},
    ],
    monthly: [{label:'10æœˆ',val:1},{label:'11æœˆ',val:2},{label:'12æœˆ',val:1},{label:'1æœˆ',val:3},{label:'2æœˆ',val:2}],
  },
};

// â”€â”€ ãƒ„ãƒ¼ãƒ«å®šç¾©ï¼ˆã‚¿ã‚¤ãƒ—åˆ¥è¡¨ç¤ºåˆ‡æ›¿ï¼‰ â”€â”€
const TOOLS = {
  re: [
    {id:'matching', icon:'ğŸ“‹', title:'æ¡ˆä»¶ãƒœãƒ¼ãƒ‰',       desc:'æ–°è¦æ¡ˆä»¶ãƒ»ãƒãƒƒãƒãƒ³ã‚°ç¢ºèª',        color:'blue',    url:'coreto-matching.html'},
    {id:'close',    icon:'ğŸ¯', title:'æˆç´„å ±å‘Š',          desc:'å¯©æŸ»é€šéâ†’å…¥é‡‘ç¢ºèªå¾Œã«é€ä¿¡',        color:'primary', url:'coreto-batch-close.html'},
    {id:'naiken',   icon:'ğŸ ', title:'å†…è¦‹ä¾é ¼æ›¸',        desc:'FAXé€ä»˜ãƒ»æ—¥ç¨‹ç™»éŒ²',               color:'green',   url:'coreto-naiken.html'},
    {id:'it-setsu', icon:'ğŸ“', title:'ITé‡èª¬ãƒ»å¥‘ç´„æ›¸',    desc:'ITé‡èª¬ãƒã‚§ãƒƒã‚¯ãƒ»ã‚¹ã‚­ãƒ£ãƒ³ç®¡ç†',     color:'blue',    url:'coreto-it-setsu.html'},
    {id:'client',   icon:'ğŸ‘¤', title:'é¡§å®¢DB',            desc:'é¡§å®¢ç™»éŒ²ãƒ»ç›¸è«‡å±¥æ­´ç¢ºèª',           color:'orange',  url:'coreto-client-id.html'},
    {id:'label',    icon:'ğŸ“¦', title:'ãƒ¬ã‚¿ãƒ¼ãƒ‘ãƒƒã‚¯',      desc:'å®›åãƒ©ãƒ™ãƒ«å°åˆ·ãƒ»è¿½è·¡',             color:'purple',  url:'coreto-thermal-label.html'},
    {id:'rank',     icon:'â­', title:'ãƒ©ãƒ³ã‚¯ãƒ€ãƒƒã‚·ãƒ¥ãƒœãƒ¼ãƒ‰', desc:'ãƒã‚¤ãƒ³ãƒˆãƒ»å ±é…¬ã‚·ãƒŸãƒ¥ãƒ¬ãƒ¼ã‚¿ãƒ¼',   color:'',        url:'coreto-rank.html'},
    {id:'payment',  icon:'ğŸ’´', title:'æ”¯æ‰•æ˜ç´°æ›¸',        desc:'æœˆæ¬¡å ±é…¬æ˜ç´°ã®ç¢ºèª',               color:'',        url:'coreto-hub.html'},
    {id:'sim',      icon:'ğŸ’°', title:'å ±é…¬ã‚·ãƒŸãƒ¥ãƒ¬ãƒ¼ã‚¿ãƒ¼', desc:'æ‰‹å–ã‚Šé¡ã‚’äº‹å‰ç¢ºèª',              color:'',        url:'coreto-commission-simulator.html'},
  ],
  hr: [
    {id:'matching', icon:'ğŸ“‹', title:'æ¡ˆä»¶ãƒœãƒ¼ãƒ‰',        desc:'æ–°è¦æ¡ˆä»¶ãƒ»ãƒãƒƒãƒãƒ³ã‚°ç¢ºèª',         color:'blue',    url:'coreto-matching.html'},
    {id:'close',    icon:'ğŸ¯', title:'æˆç´„å ±å‘Š',          desc:'å…¥ç¤¾ç¢ºå®šå¾Œã«é€ä¿¡',                 color:'primary', url:'coreto-batch-close.html'},
    {id:'early-quit',icon:'âš ï¸',title:'æ—©æœŸé€€è·ç®¡ç†',      desc:'è¿”é‡‘æ¡ä»¶ç™»éŒ²ãƒ»é€€è·å ±å‘Š',           color:'',        url:'coreto-early-quit.html'},
    {id:'client',   icon:'ğŸ‘¤', title:'é¡§å®¢DB',            desc:'æ±‚è·è€…æƒ…å ±ãƒ»é¢æ¥å±¥æ­´',             color:'orange',  url:'coreto-client-id.html'},
    {id:'rank',     icon:'â­', title:'ãƒ©ãƒ³ã‚¯ãƒ€ãƒƒã‚·ãƒ¥ãƒœãƒ¼ãƒ‰', desc:'ãƒã‚¤ãƒ³ãƒˆãƒ»å ±é…¬ã‚·ãƒŸãƒ¥ãƒ¬ãƒ¼ã‚¿ãƒ¼',   color:'',        url:'coreto-rank.html'},
    {id:'payment',  icon:'ğŸ’´', title:'æ”¯æ‰•æ˜ç´°æ›¸',        desc:'æœˆæ¬¡å ±é…¬æ˜ç´°ã®ç¢ºèª',               color:'',        url:'coreto-hub.html'},
    {id:'sim',      icon:'ğŸ’°', title:'å ±é…¬ã‚·ãƒŸãƒ¥ãƒ¬ãƒ¼ã‚¿ãƒ¼', desc:'2å›æ‰•ã„ã‚¹ã‚±ã‚¸ãƒ¥ãƒ¼ãƒ«ç¢ºèª',         color:'',        url:'coreto-commission-simulator.html'},
  ],
  pt: [
    {id:'portal',   icon:'ğŸ ', title:'ãƒ‘ãƒ¼ãƒˆãƒŠãƒ¼ãƒãƒ¼ã‚¿ãƒ«', desc:'ç´¹ä»‹æ¡ˆä»¶ãƒ»å ±é…¬ãƒ»ã‚³ãƒ¼ãƒ‰ã®ç¢ºèª',    color:'primary', url:'coreto-partner.html'},
    {id:'matching', icon:'ğŸ“‹', title:'æ¡ˆä»¶ãƒœãƒ¼ãƒ‰',        desc:'ç´¹ä»‹æ¡ˆä»¶ã®é€²æ—ç¢ºèª',              color:'blue',    url:'coreto-matching.html'},
    {id:'rank',     icon:'â­', title:'ãƒ©ãƒ³ã‚¯ãƒ€ãƒƒã‚·ãƒ¥ãƒœãƒ¼ãƒ‰', desc:'ãƒã‚¤ãƒ³ãƒˆãƒ»å ±é…¬ã‚·ãƒŸãƒ¥ãƒ¬ãƒ¼ã‚¿ãƒ¼',   color:'',        url:'coreto-rank.html'},
    {id:'payment',  icon:'ğŸ’´', title:'æ”¯æ‰•æ˜ç´°æ›¸',        desc:'æœˆæ¬¡å ±é…¬æ˜ç´°ã®ç¢ºèª',               color:'',        url:'coreto-hub.html'},
    {id:'sim',      icon:'ğŸ’°', title:'å ±é…¬ã‚·ãƒŸãƒ¥ãƒ¬ãƒ¼ã‚¿ãƒ¼', desc:'ç´¹ä»‹å ±é…¬é¡ã‚’ç¢ºèª',                color:'',        url:'coreto-commission-simulator.html'},
  ],
};

const RANK_BADGE_CLASS = {gold:'rb-gold',platinum:'rb-platinum',silver:'rb-silver',bronze:'rb-bronze',pt:'rb-pt'};
const TYPE_LABEL = {re:'ä¸å‹•ç”£ã‚¨ãƒ¼ã‚¸ã‚§ãƒ³ãƒˆ',hr:'äººæã‚¨ãƒ¼ã‚¸ã‚§ãƒ³ãƒˆ',pt:'ãƒ‘ãƒ¼ãƒˆãƒŠãƒ¼'};
const AVATAR_ICON = {re:'ğŸ ',hr:'ğŸ‘¥',pt:'ğŸ¤'};

// â”€â”€ åˆæœŸåŒ– â”€â”€
function init() {
  const ag = session;
  const data = AGENT_DATA[ag.agId] || AGENT_DATA['10012'];

  // ãƒ˜ãƒƒãƒ€ãƒ¼
  document.getElementById('hdr-name').textContent = ag.name;
  document.getElementById('hdr-id').textContent = ag.agId;

  // ãƒãƒŠãƒ¼
  document.getElementById('avatar').textContent = AVATAR_ICON[ag.type] || 'ğŸ‘¤';
  document.getElementById('profile-name').textContent = ag.name + ' æ§˜';
  document.getElementById('profile-id').textContent = ag.agId;
  document.getElementById('type-label').textContent = TYPE_LABEL[ag.type] || '';

  const rb = document.getElementById('rank-badge');
  rb.textContent = ag.rank;
  rb.className = 'rank-badge ' + (RANK_BADGE_CLASS[ag.rankKey] || 'rb-gold');

  document.getElementById('ps-cases').textContent = data.cases + 'ä»¶';
  document.getElementById('ps-reward').textContent = 'Â¥' + data.rewardEstimate.toLocaleString();
  document.getElementById('perf-cases').textContent = data.cases;
  document.getElementById('perf-reward').textContent = 'Â¥' + Math.floor(data.rewardEstimate*.85).toLocaleString();

  // ãƒ©ãƒ³ã‚¯é€²æ—ï¼ˆãƒ‘ãƒ¼ãƒˆãƒŠãƒ¼ã¯éè¡¨ç¤ºï¼‰
  if(ag.type === 'pt') {
    document.getElementById('rank-progress').style.display = 'none';
  } else {
    document.getElementById('rp-current').textContent = ag.rank;
    document.getElementById('rp-next').textContent = data.progressLabel;
    document.getElementById('rp-fill').style.width = data.progress + '%';
  }

  // ã‚¢ã‚¯ã‚·ãƒ§ãƒ³
  renderActions(ag.type);

  // æ¡ˆä»¶ãƒªã‚¹ãƒˆ
  renderCases(data.cases_list);

  // é€šçŸ¥
  renderNotifs(data.notifs);

  // ãƒãƒ¼ãƒãƒ£ãƒ¼ãƒˆ
  renderChart(data.monthly);

  // ååˆºãƒ—ãƒ¬ãƒ“ãƒ¥ãƒ¼
  initBusinessCard(ag);
}

function renderActions(type) {
  const tools = TOOLS[type] || TOOLS['re'];
  document.getElementById('action-grid').innerHTML = tools.map(t => `
    <div class="action-card ${t.color}" onclick="openTool('${t.id}','${t.url}')">
      ${t.id==='close'?'<span class="ac-badge">è¦å¯¾å¿œ</span>':''}
      <div class="ac-icon">${t.icon}</div>
      <div>
        <div class="ac-title">${t.title}</div>
        <div class="ac-desc">${t.desc}</div>
      </div>
    </div>`).join('');
}

function renderCases(list) {
  if(!list.length) {
    document.getElementById('cases-list').innerHTML = '<div style="text-align:center;padding:24px;color:var(--muted);font-size:12px">é€²è¡Œä¸­ã®æ¡ˆä»¶ã¯ã‚ã‚Šã¾ã›ã‚“</div>';
    return;
  }
  document.getElementById('cases-list').innerHTML = list.map(c => `
    <div class="case-item" onclick="openTool('matching','coreto-matching.html')">
      <div class="ci-dot" style="background:${c.color}"></div>
      <div class="ci-info">
        <div class="ci-title">${c.title}</div>
        <div class="ci-meta">${c.id}</div>
      </div>
      <div class="ci-status s-${c.status}">${c.statusLabel}</div>
    </div>`).join('');
}

function renderNotifs(list) {
  document.getElementById('notif-count').textContent = list.filter(n=>n.isNew).length;
  document.getElementById('notif-list').innerHTML = list.map(n => `
    <div class="notif-item">
      <div class="ni-icon">${n.icon}</div>
      <div class="ni-body">
        <div class="ni-text">${escHtml(n.text)}</div>
        <div class="ni-time">${n.time}</div>
      </div>
      ${n.isNew ? '<div class="ni-new"></div>' : ''}
    </div>`).join('');
}

function renderChart(monthly) {
  const max = Math.max(...monthly.map(m=>m.val), 1);
  document.getElementById('bar-chart').innerHTML = monthly.map(m => `
    <div class="bar-row">
      <div class="bar-label">${m.label}</div>
      <div class="bar-wrap"><div class="bar-fill" style="width:${Math.round(m.val/max*100)}%"></div></div>
      <div class="bar-val">${m.val}ä»¶</div>
    </div>`).join('');
}



// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
// ååˆº PDFç”Ÿæˆãƒ»Slacké€ä¿¡
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
let _bcAgent = null; // initBusinessCardæ™‚ã«ä¿å­˜

function initBusinessCard(ag) {
  _bcAgent = ag;
  const nameDisplay = ag.nameOld && ag.showOldOnCard
    ? ag.name.split(' ')[0]+'ï¼ˆæ—§å§“ï¼š'+ag.nameOld+'ï¼‰'+(ag.name.split(' ')[1]||'')
    : (ag.name || 'â€”');
  const nameEl = document.getElementById('bc-name');
  const kanaEl = document.getElementById('bc-kana');
  const contactEl = document.getElementById('bc-contact');
  if (nameEl) nameEl.textContent = nameDisplay;
  if (kanaEl) kanaEl.textContent = ag.nameKana || 'â€”';
  if (contactEl) contactEl.innerHTML = (ag.phone||'â€”')+'<br>'+(ag.email||'â€”');
}

function updateBcPreview() {
  const hasTakken = document.getElementById('bc-takken').checked;
  const badge = document.getElementById('bc-takken-badge');
  if (badge) badge.style.display = hasTakken ? 'inline-flex' : 'none';
  // Update mini preview title
  const titleEl = document.getElementById('bc-takken-title');
  if (titleEl) titleEl.style.display = hasTakken ? 'block' : 'none';
}

// â”€â”€ ãƒ“ã‚¸ãƒã‚¹ã‚«ãƒ¼ãƒ‰ãƒ‡ãƒ¼ã‚¿å–å¾— â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
function getBcData() {
  const ag = _bcAgent || {};
  const hasTakken = (document.getElementById('bc-takken')||{}).checked || false;
  const note      = (document.getElementById('bc-note')||{}).value || '';
  const nameOld   = ag.nameOld || '';
  const showOld   = ag.showOldOnCard || false;
  const nameMain  = showOld && nameOld
    ? ag.name.split(' ')[0]+'ï¼ˆæ—§å§“ï¼š'+nameOld+'ï¼‰'+(ag.name.split(' ')[1]||'')
    : (ag.name || 'â€”');
  return {
    nameMain,
    nameKana:  ag.nameKana  || 'â€”',
    phone:     ag.phone     || 'â€”',
    email:     ag.email     || 'â€”',
    agentId:   ag.id        || 'â€”',
    agentType: ag.type      || 're',
    rank:      ag.rank      || 'â€”',
    hasTakken,
    note,
    company: 'æ ªå¼ä¼šç¤¾CORETO',
    address: 'æ±äº¬éƒ½æ¸‹è°·åŒºæµæ¯”å¯¿1-1-1 COREBLDGãƒ“ãƒ«8F',
    tel_office: '03-1234-5678',
    url: 'https://coreto.jp',
  };
}

// â”€â”€ PDF ãƒ—ãƒ¬ãƒ“ãƒ¥ãƒ¼ï¼ˆæ–°è¦ã‚¦ã‚£ãƒ³ãƒ‰ã‚¦ï¼‰ â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
function previewBcPdf() {
  const d = getBcData();
  const takkenLine = d.hasTakken
    ? `<div style="font-size:6.5pt;color:#c9a84c;letter-spacing:.5px;margin-bottom:5px;font-weight:700">å®…åœ°å»ºç‰©å–å¼•å£«</div>`
    : '';
  const noteDiv = d.note
    ? `<div style="font-size:6pt;color:#999;margin-top:6px;border-top:0.5px solid #ddd;padding-top:4px">${d.note}</div>`
    : '';

  const html = `<!DOCTYPE html>
<html lang="ja">
<head>
<meta charset="UTF-8">
<title>ååˆº â€” ${d.nameMain}</title>
<style>
  @import url('https://fonts.googleapis.com/css2?family=Noto+Sans+JP:wght@300;400;500;700&family=Noto+Serif+JP:wght@400;700&display=swap');
  * { margin:0; padding:0; box-sizing:border-box; }
  html, body { background:#f0f0f0; display:flex; flex-direction:column; align-items:center; justify-content:center; min-height:100vh; font-family:'Noto Sans JP',sans-serif; }

  /* ç”»é¢è¡¨ç¤ºç”¨ */
  .card-wrap {
    background:white;
    width:91mm; height:55mm;
    border-radius:1.5mm;
    box-shadow:0 4px 24px rgba(0,0,0,.2);
    position:relative;
    display:flex;
    overflow:hidden;
  }
  /* å·¦ã‚¢ã‚¯ã‚»ãƒ³ãƒˆãƒ©ã‚¤ãƒ³ */
  .card-accent {
    width:3mm; height:100%;
    background:linear-gradient(180deg,#c9a84c,#7a5f22);
    flex-shrink:0;
  }
  .card-body {
    flex:1;
    padding:5mm 5mm 5mm 4mm;
    display:flex;
    flex-direction:column;
    justify-content:space-between;
  }
  /* ä¸Šéƒ¨ï¼šãƒ­ã‚´ + ç¤¾å */
  .card-top {
    display:flex;
    align-items:center;
    justify-content:space-between;
  }
  .card-logo {
    font-size:10pt;
    font-weight:800;
    letter-spacing:3px;
    color:#c9a84c;
    font-family:'Noto Serif JP','Noto Sans JP',sans-serif;
  }
  .card-id-badge {
    font-size:6pt;
    color:#aaa;
    font-family:monospace;
    border:0.3mm solid #ddd;
    padding:1mm 2mm;
    border-radius:0.5mm;
  }
  /* ä¸­å¤®ï¼šåå‰ */
  .card-center { flex:1; display:flex; flex-direction:column; justify-content:center; padding:2mm 0; }
  .card-takken { font-size:6.5pt; color:#c9a84c; letter-spacing:.5px; margin-bottom:2mm; font-weight:700; }
  .card-name { font-size:16pt; font-weight:700; letter-spacing:1px; color:#1a1a1a; line-height:1.1; margin-bottom:1mm; }
  .card-kana { font-size:7pt; color:#888; letter-spacing:1.5px; font-family:monospace; }
  /* ä¸‹éƒ¨ï¼šé€£çµ¡å…ˆ */
  .card-bottom { font-size:7pt; color:#555; line-height:1.8; }
  .card-company { font-size:6.5pt; color:#999; margin-bottom:0.5mm; }
  .card-divider { width:100%; height:0.2mm; background:#eee; margin:1mm 0; }

  /* å°åˆ·å°‚ç”¨ */
  @media print {
    @page {
      size: 91mm 55mm;
      margin: 0;
    }
    html, body {
      width:91mm; height:55mm;
      background:white;
      display:block;
    }
    .controls { display:none !important; }
    .card-wrap {
      width:91mm; height:55mm;
      box-shadow:none;
      border-radius:0;
    }
  }

/* â”€â”€ ç´¹ä»‹ãƒªãƒ³ã‚¯ãƒ¢ãƒ¼ãƒ€ãƒ« â”€â”€ */
#ref-modal-overlay{display:none;position:fixed;inset:0;background:rgba(0,0,0,.65);z-index:9000;align-items:center;justify-content:center}
#ref-modal-overlay.open{display:flex}
#ref-modal{background:var(--card);border:1px solid var(--border2);border-radius:16px;padding:0;width:min(460px,92vw);overflow:hidden}
.ref-mhdr{padding:16px 20px;border-bottom:1px solid var(--border);display:flex;align-items:center;justify-content:space-between}
.ref-mhdr-t{font-family:'Syne',sans-serif;font-size:14px;font-weight:800;color:var(--gold)}
.ref-mbody{padding:20px}
.ref-url{background:var(--card2);border:1px solid var(--border2);border-radius:8px;padding:10px 12px;font-family:'DM Mono',monospace;font-size:11px;color:var(--sub);word-break:break-all;margin:10px 0;min-height:36px}
.ref-copy-btn{width:100%;padding:10px;border-radius:8px;border:none;cursor:pointer;font-family:inherit;font-size:13px;font-weight:700;background:var(--gold);color:#0a0c10;margin-top:4px}
.ref-copy-btn:hover{opacity:.9}

/* â”€â”€ ç´¹ä»‹ãƒªãƒ³ã‚¯ å·¦ãƒ•ãƒ­ãƒ¼ãƒ†ã‚£ãƒ³ã‚°ãƒœã‚¿ãƒ³ â”€â”€ */
#ref-float-btn {
  position: fixed;
  left: 0;
  top: 50%;
  transform: translateY(-50%) translateX(-100%) rotate(-90deg);
  transform-origin: right bottom;
  z-index: 8000;
  background: rgba(201,168,76,.18);
  border: 1px solid rgba(201,168,76,.4);
  border-bottom: none;
  border-radius: 8px 8px 0 0;
  color: var(--gold);
  padding: 6px 16px;
  font-size: 11px;
  font-weight: 700;
  font-family: inherit;
  cursor: pointer;
  white-space: nowrap;
  letter-spacing: .5px;
  transition: background .15s;
}
#ref-float-btn:hover { background: rgba(201,168,76,.32); }
</style>
<link rel="stylesheet" href="coreto-sp.css">
</head>
<body>

<div class="controls" style="text-align:center;margin-bottom:16px">
  <div style="font-size:13px;color:#666;margin-bottom:12px">
    ååˆºãƒ—ãƒ¬ãƒ“ãƒ¥ãƒ¼ï¼ˆ91Ã—55mmï¼‰â€” å°åˆ·æ¥­è€…å…¥ç¨¿ç”¨
  </div>
  <button onclick="window.print()" style="padding:10px 24px;background:#c9a84c;color:#0a0c10;
    border:none;border-radius:8px;font-size:13px;font-weight:700;cursor:pointer;margin-right:8px;
    font-family:'Noto Sans JP',sans-serif">
    ğŸ“„ PDFã¨ã—ã¦ä¿å­˜ï¼ˆCtrl+P â†’ PDFã§ä¿å­˜ï¼‰
  </button>
  <button onclick="window.close()" style="padding:10px 16px;background:transparent;
    border:1px solid #ccc;border-radius:8px;font-size:12px;cursor:pointer;
    font-family:'Noto Sans JP',sans-serif;color:#666">
    é–‰ã˜ã‚‹
  </button>
  <div style="font-size:10px;color:#aaa;margin-top:10px">
    ãƒ–ãƒ©ã‚¦ã‚¶ã®å°åˆ·ãƒ€ã‚¤ã‚¢ãƒ­ã‚°ã§ã€ŒPDFã«ä¿å­˜ã€ã‚’é¸æŠ â†’ ç”¨ç´™ã‚µã‚¤ã‚ºã€Œã‚«ã‚¹ã‚¿ãƒ : 91Ã—55mmã€ã«è¨­å®š
  </div>
</div>

<div class="card-wrap">
  <div class="card-accent"></div>
  <div class="card-body">
    <div class="card-top">
      <div class="card-logo">CORETO</div>
      <div class="card-id-badge">ID: ${d.agentId}</div>
    </div>
    <div class="card-center">
      ${d.hasTakken ? '<div class="card-takken">å®…åœ°å»ºç‰©å–å¼•å£«</div>' : ''}
      <div class="card-name">${d.nameMain}</div>
      <div class="card-kana">${d.nameKana}</div>
    </div>
    <div>
      <div class="card-divider"></div>
      <div class="card-company">${d.company}</div>
      <div class="card-bottom">
        ğŸ“± ${d.phone}<br>
        âœ‰ ${d.email}
      </div>
      ${d.note ? `<div style="font-size:6pt;color:#999;margin-top:2mm">${d.note}</div>` : ''}
    </div>
  </div>
</div>

<div class="controls" style="margin-top:20px;font-size:10px;color:#aaa;text-align:center;max-width:400px">
  <strong style="color:#666">å°åˆ·æ¥­è€…ã¸ã®å…¥ç¨¿æ‰‹é †ï¼š</strong><br>
  1. ã€ŒPDFã¨ã—ã¦ä¿å­˜ã€ã‚’ã‚¯ãƒªãƒƒã‚¯<br>
  2. å°åˆ·ãƒ€ã‚¤ã‚¢ãƒ­ã‚° â†’ é€ä¿¡å…ˆã€ŒPDFã«ä¿å­˜ã€ã‚’é¸æŠ<br>
  3. ãã®ä»–ã®è¨­å®š â†’ ç”¨ç´™ã‚µã‚¤ã‚ºã€Œã‚«ã‚¹ã‚¿ãƒ ã€â†’ 91mm Ã— 55mm<br>
  4. ä½™ç™½ã‚’ã€Œãªã—ã€ã«è¨­å®šã—ã¦ä¿å­˜<br>
  5. ä¿å­˜ã—ãŸPDFã‚’å°åˆ·æ¥­è€…ã«å…¥ç¨¿
</div>


<!-- SP Bottom Navigation -->
<nav class="sp-bottom-nav" id="sp-bottom-nav" style="display:none">
  <a href="coreto-agent-mypage.html" class="sp-nav-item on" id="spnav-home">
    <span class="sp-nav-icon">ğŸ </span>
    <span class="sp-nav-label">ãƒ›ãƒ¼ãƒ </span>
  </a>
  <a href="coreto-pipeline.html" class="sp-nav-item" id="spnav-pipe">
    <span class="sp-nav-icon">ğŸ“‹</span>
    <span class="sp-nav-label">æ¡ˆä»¶</span>
  </a>
  <a href="coreto-sale-report.html" class="sp-nav-item" id="spnav-report">
    <span class="sp-nav-icon">ğŸ“</span>
    <span class="sp-nav-label">å ±å‘Šæ›¸</span>
  </a>
  <a href="coreto-instant-pay.html" class="sp-nav-item" id="spnav-pay">
    <span class="sp-nav-icon">ğŸ’¸</span>
    <span class="sp-nav-label">å³æ™‚æ‰•ã„</span>
  </a>
  <a href="coreto-account-settings.html" class="sp-nav-item" id="spnav-acct">
    <span class="sp-nav-icon">âš™ï¸</span>
    <span class="sp-nav-label">è¨­å®š</span>
  </a>
</nav>

</body>
</html>`;

  const w = window.open('', '_blank', 'width=700,height=600');
  w.document.write(html);
  w.document.close();
}

// â”€â”€ Slacké€ä¿¡ï¼ˆæ§‹é€ åŒ–ãƒ‡ãƒ¼ã‚¿ï¼‰ â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
function sendToSlack() {
  const d = getBcData();
  const takkenLabel = d.hasTakken ? 'âœ… ã‚ã‚Šï¼ˆè‚©æ›¸ãè¿½åŠ ï¼‰' : 'âŒ ãªã—';
  const msg = [
    'â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”',
    'ğŸªª *ååˆºç™ºæ³¨ãƒªã‚¯ã‚¨ã‚¹ãƒˆ*',
    'â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”',
    `ğŸ‘¤ *æ°å*ï¼š${d.nameMain}`,
    `ã€€ã€€ã‚«ãƒŠï¼š${d.nameKana}`,
    `ğŸªª *ID*ï¼š${d.agentId}`,
    `ğŸ“± *é›»è©±ç•ªå·*ï¼š${d.phone}`,
    `âœ‰ï¸ *ãƒ¡ãƒ¼ãƒ«*ï¼š${d.email}`,
    `ğŸ› *å®…åœ°å»ºç‰©å–å¼•å£«*ï¼š${takkenLabel}`,
    d.note ? `ğŸ“ *ç‰¹è¨˜äº‹é …*ï¼š${d.note}` : null,
    'â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”',
    `ğŸ’³ Â¥2,000 ã‚«ãƒ¼ãƒ‰æ±ºæ¸ˆå®Œäº†`,
    `ğŸ• ${new Date().toLocaleString('ja-JP')}`,
  ].filter(Boolean).join('\n');

  // ãƒ‡ãƒ¢: Slack Webhooké€ä¿¡ã‚·ãƒŸãƒ¥ãƒ¬ãƒ¼ã‚·ãƒ§ãƒ³ï¼ˆæœ¬ç•ªã¯webhook URLã«å·®ã—æ›¿ãˆï¼‰
  notifySlack('Slack payload:', msg);

  // ã‚³ãƒ”ãƒ¼ç”¨ãƒ†ã‚­ã‚¹ãƒˆè¡¨ç¤º
  const textarea = document.createElement('textarea');
  textarea.value = msg;
  document.body.appendChild(textarea);
  textarea.select();
  try { document.execCommand('copy'); } catch(e) {}
  document.body.removeChild(textarea);

  alert('âœ… Slackã«ååˆºç™ºæ³¨æƒ…å ±ã‚’é€ä¿¡ã—ã¾ã—ãŸã€‚\n\n' +
        'â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”\n' + msg.replace(/\*/g,'') + '\nâ”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”\n\n' +
        'ï¼ˆæœ¬éƒ¨Slackã® #ååˆºç™ºæ³¨ ãƒãƒ£ãƒ³ãƒãƒ«ã«æŠ•ç¨¿ã•ã‚Œã¾ã—ãŸï¼‰\n' +
        'ãƒ†ã‚­ã‚¹ãƒˆã‚’ã‚¯ãƒªãƒƒãƒ—ãƒœãƒ¼ãƒ‰ã«ã‚³ãƒ”ãƒ¼ã—ã¾ã—ãŸã€‚');
}

function orderBusinessCard() {
  const note = (document.getElementById('bc-note')||{}).value || '';
  const hasTakken = (document.getElementById('bc-takken')||{}).checked || false;
  if (!confirm('ååˆºã‚’ç™ºæ³¨ã—ã¾ã™ã‹ï¼Ÿ\n\nç™»éŒ²ã‚«ãƒ¼ãƒ‰ï¼ˆVisa Â·Â·Â·4242ï¼‰ã‚ˆã‚Š Â¥2,000 ãŒå³æ™‚æ±ºæ¸ˆã•ã‚Œã¾ã™ã€‚\nç™ºæ³¨å¾Œã®ã‚­ãƒ£ãƒ³ã‚»ãƒ«ã¯ã§ãã¾ã›ã‚“ã€‚')) return;

  const btn = event.target.closest('button');
  btn.disabled = true;
  btn.textContent = 'â³ æ±ºæ¸ˆä¸­...';

  setTimeout(() => {
    btn.textContent = 'âœ… ç™ºæ³¨å®Œäº†';
    btn.style.background = 'rgba(52,211,153,.15)';
    btn.style.border = '1px solid rgba(52,211,153,.3)';
    btn.style.color = 'var(--green)';

    const hist = document.getElementById('bc-history');
    if (hist) {
      const now = new Date().toLocaleDateString('ja-JP',{year:'numeric',month:'2-digit',day:'2-digit'});
      const takkenStr = hasTakken ? 'ãƒ»å®…å»ºå£«è¡¨è¨˜' : '';
      const row = document.createElement('div');
      row.style.cssText = 'display:flex;align-items:center;justify-content:space-between;padding:10px 12px;background:var(--card2);border-radius:9px;font-size:11px;margin-top:8px';
      row.innerHTML = `
        <div>
          <div style="font-weight:700">${now} ç™ºæ³¨</div>
          <div style="color:var(--muted);font-size:10px">100æš / ${note||'é€šå¸¸'}${takkenStr}</div>
        </div>
        <div style="text-align:right">
          <div style="font-family:'DM Mono',monospace;color:var(--red)">-Â¥2,000</div>
          <span style="font-size:9px;padding:2px 8px;border-radius:5px;font-weight:700;
                       background:rgba(251,146,60,.12);color:var(--orange);
                       border:1px solid rgba(251,146,60,.3)">åˆ¶ä½œä¸­</span>
        </div>`;
      hist.insertBefore(row, hist.firstChild);
    }

    // è‡ªå‹•ã§Slacké€šçŸ¥ã‚‚é€ä¿¡
    sendToSlack();
  }, 1400);
}

// â”€â”€ ãƒ„ãƒ¼ãƒ«ã‚’é–‹ãï¼ˆã‚¨ãƒ¼ã‚¸ã‚§ãƒ³ãƒˆæƒ…å ±ã‚’sessionStorageã§æ¸¡ã™ï¼‰ â”€â”€
function openTool(toolId, url) {
  if(!url) return;
  // ã‚»ãƒƒã‚·ãƒ§ãƒ³ã¯æ—¢ã«sessionStorageã«ã‚ã‚‹ã®ã§å„ãƒ„ãƒ¼ãƒ«å´ã§èª­ã¿è¾¼ã‚€
  // åŒä¸€ã‚ªãƒªã‚¸ãƒ³å†…ã§ã‚ã‚Œã° sessionStorage å…±æœ‰å¯èƒ½
  window.location.href = url;
}

// â”€â”€ ãƒ­ã‚°ã‚¢ã‚¦ãƒˆ â”€â”€
function logout() {
  if(confirm('ãƒ­ã‚°ã‚¢ã‚¦ãƒˆã—ã¾ã™ã‹ï¼Ÿ')) {
    sessionStorage.removeItem('coreto_session');
    window.location.href = 'coreto-hub.html';
  }
}

// å„ãƒ„ãƒ¼ãƒ«ã«ã€Œãƒ­ã‚°ã‚¤ãƒ³æƒ…å ±ã‹ã‚‰è‡ªå‹•å…¥åŠ›ã€ã‚’ä¼ãˆã‚‹é–¢æ•°
// å„ãƒ„ãƒ¼ãƒ«ã®ãƒšãƒ¼ã‚¸å´ã§ã¯ä»¥ä¸‹ã‚’å…ˆé ­ã«è¿½åŠ ã™ã‚‹ï¼š
// const s = JSON.parse(sessionStorage.getItem('coreto_session')||'null');
// if(s) { /* ã‚¨ãƒ¼ã‚¸ã‚§ãƒ³ãƒˆåãƒ»IDã‚’ãƒ•ã‚©ãƒ¼ãƒ ã«è‡ªå‹•å…¥åŠ› */ }

init();

// â”€â”€ ç´¹ä»‹ãƒªãƒ³ã‚¯ãƒ¢ãƒ¼ãƒ€ãƒ« â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
var _refCurrentCode = '';
function openRefModal() {
  var overlay = document.getElementById('ref-modal-overlay');
  var selector = document.getElementById('ref-code-selector');
  var isExec = (typeof session !== 'undefined' && session && session.hqRole === 'exec')
            || (typeof CURRENT_USER !== 'undefined' && CURRENT_USER && CURRENT_USER.hqRole === 'exec');
  var agentId = (typeof session !== 'undefined' && session && session.userId) ? session.userId
              : (typeof ME !== 'undefined' && ME && ME.id) ? ME.id
              : (typeof AGENT !== 'undefined' && AGENT && AGENT.id) ? AGENT.id : '10012';
  if (isExec) {
    var SPECIAL = ['FOUNDER2026','WELCOME2026','GOLD_START','HR_PRO75'];
    var opts = SPECIAL.map(function(c){ return '<option value="'+c+'">â­ '+c+'</option>'; }).join('');
    selector.innerHTML =
      '<div style="margin-bottom:12px"><div style="font-size:10px;color:var(--sub);font-weight:600;margin-bottom:5px">ã‚³ãƒ¼ãƒ‰ç¨®åˆ¥</div>'
      +'<select id="ref-code-select" onchange="updateRefLink()" style="width:100%;padding:8px 10px;background:var(--card2);border:1px solid var(--border2);border-radius:8px;color:var(--text);font-size:12px;font-family:inherit">'
      +'<option value="'+agentId+'">è‡ªåˆ†ã®IDï¼ˆ'+agentId+'ï¼‰</option>'
      +'<optgroup label="â”€â”€ ç‰¹åˆ¥ã‚³ãƒ¼ãƒ‰ â”€â”€">'+opts+'</optgroup>'
      +'</select></div>';
    _refCurrentCode = agentId;
  } else {
    selector.innerHTML =
      '<div style="display:flex;align-items:center;gap:8px;margin-bottom:12px;padding:8px 12px;background:rgba(201,168,76,.06);border:1px solid rgba(201,168,76,.2);border-radius:8px">'
      +'<span style="font-size:11px;color:var(--muted)">ç´¹ä»‹ã‚³ãƒ¼ãƒ‰ï¼š</span>'
      +'<span style="font-family:\'DM Mono\',monospace;font-size:13px;font-weight:700;color:var(--gold)">'+agentId+'</span>'
      +'</div>';
    _refCurrentCode = agentId;
  }
  updateRefLink();
  overlay.classList.add('open');
}
function updateRefLink() {
  var sel = document.getElementById('ref-code-select');
  if (sel) _refCurrentCode = sel.value;
  var base = location.origin + location.pathname.replace(/[^/]*$/, '') + 'coreto-agent-signup.html';
  var url = base + '?ref=' + encodeURIComponent(_refCurrentCode);
  document.getElementById('ref-url-display').textContent = url;
}
function closeRefModal() {
  document.getElementById('ref-modal-overlay').classList.remove('open');
}
function copyRefLink() {
  var url = document.getElementById('ref-url-display').textContent;
  navigator.clipboard.writeText(url).then(function() {
    var btn = document.querySelector('.ref-copy-btn');
    btn.textContent = 'âœ… ã‚³ãƒ”ãƒ¼ã—ã¾ã—ãŸ';
    setTimeout(function(){ btn.textContent = 'ğŸ“‹ ã‚³ãƒ”ãƒ¼'; }, 2000);
  }).catch(function() {
    var ta = document.createElement('textarea');
    ta.value = url; document.body.appendChild(ta); ta.select();
    document.execCommand('copy'); document.body.removeChild(ta);
  });
}
</script>

<div id="ref-modal-overlay" onclick="if(event.target===this)closeRefModal()">
  <div id="ref-modal">
    <div class="ref-mhdr">
      <div class="ref-mhdr-t">ğŸ”— ç´¹ä»‹ãƒªãƒ³ã‚¯ç™ºè¡Œ</div>
      <button onclick="closeRefModal()" style="background:none;border:none;color:var(--muted);font-size:20px;cursor:pointer;line-height:1">Ã—</button>
    </div>
    <div class="ref-mbody">
      <div style="font-size:11px;color:var(--sub);margin-bottom:14px;line-height:1.8">ã“ã®ãƒªãƒ³ã‚¯ã‹ã‚‰å…¥ä¼šã™ã‚‹ã¨ç´¹ä»‹ã‚³ãƒ¼ãƒ‰ãŒè‡ªå‹•å…¥åŠ›ã•ã‚Œã¾ã™ã€‚</div>
      <div id="ref-code-selector"></div>
      <div style="font-size:10px;color:var(--muted);margin-bottom:4px;font-weight:600;letter-spacing:.5px">ç™ºè¡Œãƒªãƒ³ã‚¯</div>
      <div class="ref-url" id="ref-url-display">â€”</div>
      <button class="ref-copy-btn" onclick="copyRefLink()">ğŸ“‹ ã‚³ãƒ”ãƒ¼</button>
    </div>
  </div>
</div>

<button id="ref-float-btn" onclick="openRefModal()">ğŸ”— ç´¹ä»‹ãƒªãƒ³ã‚¯ç™ºè¡Œ</button>

<script src="coreto-sp-init.js" data-nav="sp-bottom-nav"></script>
</body>
</html>
