<!DOCTYPE html>
<html lang="ja">
<head>
  <!-- â”€â”€ Content Security Policy (XSSè»½æ¸›) â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
       å¤‰æ›´æ™‚: ä½¿ç”¨ã™ã‚‹å¤–éƒ¨ã‚µãƒ¼ãƒ“ã‚¹ã®ã‚ªãƒªã‚¸ãƒ³ã‚’è¿½åŠ ã—ã¦ãã ã•ã„
       Kintoneè¿½åŠ æ™‚: connect-src ã« *.cybozu.com ã‚’è¿½åŠ 
  â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ -->
  <meta http-equiv="Content-Security-Policy" content="
    default-src 'self';
    script-src 'self' 'unsafe-inline'
      https://cdnjs.cloudflare.com
      https://js.stripe.com
      https://cdn-cgi/scripts;
    style-src 'self' 'unsafe-inline'
      https://fonts.googleapis.com;
    font-src 'self'
      https://fonts.gstatic.com;
    img-src 'self' data: blob:;
    connect-src 'self'
      https://hooks.slack.com
      https://hooks.zapier.com
      https://api.stripe.com
      https://js.stripe.com
      https://www.houjin-bangou.nta.go.jp
      https://www.retio.or.jp;
    frame-src 'none';
    object-src 'none';
    base-uri 'self';
  ">

<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>CORETO å ±é…¬è¨ˆç®—ã‚·ãƒŸãƒ¥ãƒ¬ãƒ¼ã‚¿ãƒ¼ v3</title>
<style>
@import url('https://fonts.googleapis.com/css2?family=Noto+Sans+JP:wght@300;400;500;700&family=DM+Mono:wght@400;500&display=swap');
*{box-sizing:border-box;margin:0;padding:0;}
:root{
  --bg:#0b0d12;--card:#13161f;--card2:#191c27;--border:#222638;
  --gold:#c9a84c;--gold-l:#e8c96a;--gold-dim:#7a5f22;
  --blue:#3b82f6;--green:#22c55e;--red:#ef4444;--orange:#f59e0b;--purple:#a855f7;
  --muted:#5a6378;--sub:#8892a4;--text:#dde1ed;
}
body{font-family:'Noto Sans JP',sans-serif;background:var(--bg);color:var(--text);min-height:100vh;}

.header{background:linear-gradient(135deg,#0d1020,#141828);border-bottom:1px solid var(--border);padding:14px 28px;display:flex;align-items:center;justify-content:space-between;}
.logo{font-family:'DM Mono',monospace;font-size:20px;color:var(--gold);letter-spacing:3px;}
.logo-sub{font-size:10px;color:var(--muted);margin-top:2px;}

/* ã‚¿ãƒ– */
.tabs{background:#0e1019;border-bottom:1px solid var(--border);display:flex;padding:0 28px;}
.tab{padding:12px 20px;font-size:12px;cursor:pointer;border-bottom:2px solid transparent;color:var(--muted);transition:all .2s;letter-spacing:.5px;}
.tab.active{color:var(--gold);border-bottom-color:var(--gold);}

.auto-banner{background:rgba(34,197,94,.05);border-bottom:1px solid rgba(34,197,94,.15);padding:9px 28px;display:flex;align-items:center;gap:18px;flex-wrap:wrap;}
.auto-item{display:flex;align-items:center;gap:6px;font-size:10px;color:var(--sub);}
.auto-dot{width:7px;height:7px;border-radius:50%;background:var(--green);box-shadow:0 0 5px var(--green);animation:blink 2s infinite;}
@keyframes blink{0%,100%{opacity:1}50%{opacity:.3}}
.auto-label{color:var(--green);font-weight:700;}
.div{width:1px;height:18px;background:var(--border);}

.page{display:none;}.page.active{display:block;}
.wrap{display:grid;grid-template-columns:390px 1fr;gap:18px;padding:20px 28px;max-width:1320px;margin:0 auto;}
@media(max-width:920px){.wrap{grid-template-columns:1fr;}}

.panel{background:var(--card);border:1px solid var(--border);border-radius:12px;padding:20px;margin-bottom:14px;}
.panel-title{font-size:12px;font-weight:700;color:var(--gold);letter-spacing:2px;text-transform:uppercase;margin-bottom:16px;display:flex;align-items:center;gap:8px;}
.panel-title::before{content:'';width:3px;height:14px;background:var(--gold);border-radius:2px;}

.s-label{font-size:9px;color:var(--muted);letter-spacing:2px;text-transform:uppercase;padding:10px 0 6px;border-bottom:1px solid rgba(34,38,56,.8);margin-bottom:10px;margin-top:14px;}
.s-label:first-child{margin-top:0;}
.fg{margin-bottom:10px;}
.fg label{font-size:11px;color:var(--sub);display:block;margin-bottom:4px;}
.fg input,.fg select{width:100%;background:#0d0f18;border:1px solid var(--border);border-radius:7px;padding:8px 11px;color:var(--text);font-size:13px;font-family:'Noto Sans JP',sans-serif;transition:border-color .15s;}
.fg input:focus,.fg select:focus{outline:none;border-color:var(--gold);}
.mono{font-family:'DM Mono',monospace;}
.row2{display:grid;grid-template-columns:1fr 1fr;gap:10px;}

.tg-group{display:flex;gap:6px;flex-wrap:wrap;margin-top:4px;}
.tg{padding:5px 11px;border-radius:6px;font-size:11px;cursor:pointer;border:1px solid var(--border);background:transparent;color:var(--sub);font-family:'Noto Sans JP',sans-serif;transition:all .15s;}
.tg.on{background:rgba(201,168,76,.15);border-color:var(--gold-dim);color:var(--gold);font-weight:700;}
.tg.on.green{background:rgba(34,197,94,.15);border-color:rgba(34,197,94,.4);color:var(--green);}
.tg.on.orange{background:rgba(245,158,11,.15);border-color:rgba(245,158,11,.4);color:var(--orange);}
.tg.on.red{background:rgba(239,68,68,.15);border-color:rgba(239,68,68,.4);color:var(--red);}

/* å³æ—¥æ‰•ã„ãƒœãƒƒã‚¯ã‚¹ */
.instant-box{background:rgba(245,158,11,.05);border:1px solid rgba(245,158,11,.25);border-radius:9px;padding:14px;margin-top:8px;}
.instant-title{font-size:11px;font-weight:700;color:var(--orange);margin-bottom:10px;}
.instant-note{font-size:10px;color:var(--muted);line-height:1.8;margin-top:8px;}

/* è§£ç¦çŠ¶æ…‹ */
.unlock-status{display:flex;align-items:center;gap:8px;padding:8px 12px;border-radius:7px;font-size:11px;margin-bottom:8px;}
.unlock-ok{background:rgba(34,197,94,.1);border:1px solid rgba(34,197,94,.3);color:var(--green);}
.unlock-ng{background:rgba(239,68,68,.08);border:1px solid rgba(239,68,68,.25);color:var(--red);}
.unlock-pending{background:rgba(245,158,11,.08);border:1px solid rgba(245,158,11,.25);color:var(--orange);}
.unlock-icon{font-size:14px;}

/* è¿”é‡‘ãƒšãƒ¼ã‚¸å°‚ç”¨ */
.refund-hero{border-radius:12px;padding:22px;margin-bottom:16px;text-align:center;}
.refund-hero.full{background:linear-gradient(135deg,rgba(239,68,68,.12),rgba(239,68,68,.04));border:1px solid rgba(239,68,68,.3);}
.refund-hero.half{background:linear-gradient(135deg,rgba(245,158,11,.1),rgba(245,158,11,.03));border:1px solid rgba(245,158,11,.3);}
.refund-hero.none{background:rgba(34,197,94,.07);border:1px solid rgba(34,197,94,.25);}
.refund-amt{font-family:'DM Mono',monospace;font-size:40px;font-weight:500;margin:8px 0;}
.refund-lbl{font-size:11px;letter-spacing:1px;margin-bottom:4px;}
.refund-note{font-size:11px;line-height:1.8;margin-top:10px;}

/* è«‹æ±‚æ›¸ãƒ—ãƒ¬ãƒ“ãƒ¥ãƒ¼ */
.invoice-preview{background:#fff;border-radius:10px;padding:24px;color:#1a1a1a;font-size:12px;line-height:1.8;margin-bottom:14px;}
.inv-hdr{background:#1a2744;color:#fff;padding:12px 16px;border-radius:6px;display:flex;justify-content:space-between;align-items:center;margin-bottom:16px;}
.inv-logo{font-family:'DM Mono',monospace;font-size:16px;color:#c9a84c;}
.inv-title{font-size:14px;}
.inv-row{display:flex;justify-content:space-between;padding:6px 0;border-bottom:1px solid #eee;}
.inv-row:last-child{border-bottom:none;}
.inv-total{background:#1a2744;color:#fff;padding:10px 14px;border-radius:6px;display:flex;justify-content:space-between;align-items:center;margin-top:10px;font-size:14px;font-weight:700;}
.inv-total .amt{font-family:'DM Mono',monospace;font-size:18px;color:#c9a84c;}
.inv-urgent{background:#fff3cd;border:1px solid #f59e0b;border-radius:6px;padding:10px;margin-top:10px;font-size:11px;color:#92400e;}

/* ã‚¿ã‚¤ãƒ ãƒ©ã‚¤ãƒ³ */
.tl{display:flex;flex-direction:column;}
.tl-row{display:flex;gap:12px;padding-bottom:12px;}
.tl-row:last-child{padding-bottom:0;}
.tl-left{display:flex;flex-direction:column;align-items:center;width:16px;flex-shrink:0;}
.tl-dot{width:10px;height:10px;border-radius:50%;border:2px solid var(--gold);background:var(--bg);margin-top:3px;flex-shrink:0;}
.tl-dot.g{border-color:var(--green);background:var(--green);}
.tl-dot.o{border-color:var(--orange);background:var(--orange);}
.tl-dot.b{border-color:var(--blue);background:var(--blue);}
.tl-dot.r{border-color:var(--red);background:var(--red);}
.tl-dot.f{background:var(--gold);}
.tl-dot.dim{border-color:var(--muted);background:transparent;}
.tl-line{width:1px;background:var(--border);flex:1;margin-top:2px;}
.tl-row:last-child .tl-line{display:none;}
.tl-date{font-family:'DM Mono',monospace;font-size:11px;color:var(--gold);}
.tl-event{font-size:12px;margin-top:1px;}
.tl-sub{font-size:10px;color:var(--muted);margin-top:2px;line-height:1.6;}

/* å†…è¨³ */
.bk{background:var(--card2);border:1px solid var(--border);border-radius:10px;overflow:hidden;margin-bottom:12px;}
.bkr{display:flex;justify-content:space-between;align-items:center;padding:9px 13px;border-bottom:1px solid rgba(34,38,56,.5);font-size:12px;}
.bkr:last-child{border-bottom:none;}
.bkr.ttl{background:rgba(201,168,76,.06);border-top:1px solid rgba(201,168,76,.2);}
.bkl{color:var(--sub);display:flex;align-items:center;gap:5px;flex-wrap:wrap;}
.bkv{font-family:'DM Mono',monospace;font-weight:500;}
.bkr.red .bkv{color:var(--red);}
.bkr.grn .bkv{color:var(--green);}
.bkr.orn .bkv{color:var(--orange);}
.bkr.ppl .bkv{color:var(--purple);}
.badge{font-size:9px;padding:1px 5px;border-radius:3px;font-weight:700;}
.bg{background:rgba(34,197,94,.12);color:var(--green);}
.br{background:rgba(239,68,68,.12);color:var(--red);}
.bb{background:rgba(59,130,246,.12);color:var(--blue);}
.bo{background:rgba(245,158,11,.12);color:var(--orange);}
.bp{background:rgba(168,85,247,.12);color:var(--purple);}
.bg2{background:rgba(201,168,76,.12);color:var(--gold);}

.sc{background:var(--card2);border:1px solid var(--border);border-radius:9px;padding:12px 14px;display:flex;justify-content:space-between;align-items:center;margin-bottom:8px;}
.two{display:grid;grid-template-columns:1fr 1fr;gap:10px;margin-bottom:12px;}
.pc{background:var(--card2);border:1px solid var(--border);border-radius:9px;padding:13px;}
.pc.inst{border-color:rgba(245,158,11,.3);background:rgba(245,158,11,.04);}
.pc.locked{border-color:rgba(239,68,68,.2);background:rgba(239,68,68,.03);}
.pc.unlocked{border-color:rgba(34,197,94,.3);background:rgba(34,197,94,.04);}
.pc-num{font-size:10px;color:var(--muted);margin-bottom:3px;}
.pc-amt{font-family:'DM Mono',monospace;font-size:17px;font-weight:600;}
.pc-when{font-size:10px;color:var(--muted);margin-top:4px;line-height:1.6;}

.tax-note{background:rgba(239,68,68,.05);border:1px solid rgba(239,68,68,.12);border-radius:8px;padding:11px 13px;margin-bottom:12px;font-size:11px;color:var(--sub);line-height:1.8;}
.tax-note strong{color:var(--text);}

.alert{border-radius:8px;padding:10px 13px;font-size:11px;line-height:1.7;margin-bottom:12px;}
.ao{background:rgba(245,158,11,.07);border:1px solid rgba(245,158,11,.22);color:var(--orange);}
.ag{background:rgba(34,197,94,.07);border:1px solid rgba(34,197,94,.22);color:var(--green);}
.ab{background:rgba(59,130,246,.07);border:1px solid rgba(59,130,246,.22);color:var(--blue);}
.ar{background:rgba(239,68,68,.07);border:1px solid rgba(239,68,68,.22);color:var(--red);}

.chk-grid{display:grid;grid-template-columns:1fr 1fr;gap:6px;margin-bottom:12px;}
.chk{background:var(--card2);border:1px solid var(--border);border-radius:7px;padding:8px 11px;display:flex;align-items:center;gap:7px;font-size:11px;color:var(--sub);}

.sec{font-size:10px;color:var(--muted);letter-spacing:1.5px;text-transform:uppercase;margin-bottom:8px;margin-top:2px;}
.empty{text-align:center;padding:60px 20px;color:var(--muted);font-size:13px;line-height:2.2;}

.btn-calc{width:100%;padding:13px;background:var(--gold);color:#0a0c10;font-size:13px;font-weight:700;border:none;border-radius:8px;cursor:pointer;font-family:'Noto Sans JP',sans-serif;letter-spacing:1px;transition:all .15s;margin-top:8px;}
.btn-calc:hover{background:var(--gold-l);}
.btn-calc.red-btn{background:var(--red);color:#fff;}
.btn-calc.red-btn:hover{background:#dc2626;}
.btn-rst{width:100%;padding:9px;background:transparent;color:var(--muted);font-size:11px;border:1px solid var(--border);border-radius:8px;cursor:pointer;font-family:'Noto Sans JP',sans-serif;margin-top:6px;}
.btn-rst:hover{color:var(--text);}
.hidden{display:none!important;}
::-webkit-scrollbar{width:5px;}::-webkit-scrollbar-thumb{background:var(--border);border-radius:3px;}

/* â”€â”€ ç´¹ä»‹ãƒªãƒ³ã‚¯ãƒ¢ãƒ¼ãƒ€ãƒ« â”€â”€ */
#ref-modal-overlay{display:none;position:fixed;inset:0;background:rgba(0,0,0,.65);z-index:9000;align-items:center;justify-content:center}
#ref-modal-overlay.open{display:flex}
#ref-modal{background:var(--card);border:1px solid var(--border2);border-radius:16px;padding:0;width:min(460px,92vw);overflow:hidden}
.ref-mhdr{padding:16px 20px;border-bottom:1px solid var(--border);display:flex;align-items:center;justify-content:space-between}
.ref-mhdr-t{font-family:'Syne',sans-serif;font-size:14px;font-weight:800;color:var(--gold)}
.ref-mbody{padding:20px}
.ref-url{background:var(--card2);border:1px solid var(--border2);border-radius:8px;padding:10px 12px;font-family:'DM Mono',monospace;font-size:11px;color:var(--sub);word-break:break-all;margin:10px 0;min-height:36px}
.ref-copy-btn{width:100%;padding:10px;border-radius:8px;border:none;cursor:pointer;font-family:inherit;font-size:13px;font-weight:700;background:var(--gold);color:#0a0c10;margin-top:4px}
.ref-copy-btn:hover{opacity:.9}

/* â”€â”€ ç´¹ä»‹ãƒªãƒ³ã‚¯ å·¦ãƒ•ãƒ­ãƒ¼ãƒ†ã‚£ãƒ³ã‚°ãƒœã‚¿ãƒ³ â”€â”€ */
#ref-float-btn {
  position: fixed;
  left: 0;
  top: 50%;
  transform: translateY(-50%) translateX(-100%) rotate(-90deg);
  transform-origin: right bottom;
  z-index: 8000;
  background: rgba(201,168,76,.18);
  border: 1px solid rgba(201,168,76,.4);
  border-bottom: none;
  border-radius: 8px 8px 0 0;
  color: var(--gold);
  padding: 6px 16px;
  font-size: 11px;
  font-weight: 700;
  font-family: inherit;
  cursor: pointer;
  white-space: nowrap;
  letter-spacing: .5px;
  transition: background .15s;
}
#ref-float-btn:hover { background: rgba(201,168,76,.32); }
</style>
</head>
<body>

<div class="header">
  <div><div class="logo">CORETO</div><div class="logo-sub">å ±é…¬è¨ˆç®—ã‚·ãƒŸãƒ¥ãƒ¬ãƒ¼ã‚¿ãƒ¼ v3
  </div></div>
  <div style="font-size:10px;color:var(--muted);font-family:'DM Mono',monospace;">INTERNAL TOOL</div>
</div>

<!-- ã‚¿ãƒ– -->
<div class="tabs">
  <div class="tab active" onclick="switchTab(0)">ğŸ§® å ±é…¬è¨ˆç®—</div>
  <div class="tab" onclick="switchTab(1)">âš¡ äººæ å³æ—¥æ‰•ã„ç®¡ç†</div>
  <div class="tab" onclick="switchTab(2)">ğŸ”´ æ—©æœŸé€€è·ãƒ»è¿”é‡‘è«‹æ±‚</div>
</div>

<!-- è‡ªå‹•å‡¦ç†ãƒãƒŠãƒ¼ -->
<div class="auto-banner">
  <div class="auto-item"><div class="auto-dot"></div><span class="auto-label">è‡ªå‹•ï¼š</span>å…¨é¡å…¥é‡‘ç¢ºèª â†’ å ±é…¬è¨ˆç®—å³æ™‚å®Ÿè¡Œ</div>
  <div class="div"></div>
  <div class="auto-item"><div class="auto-dot"></div><span class="auto-label">è‡ªå‹•ï¼š</span>ç¿Œæœˆ1æ—¥ 8é …ç›®ãƒã‚§ãƒƒã‚¯ â†’ ã‚¨ãƒ©ãƒ¼ã®ã¿é€šçŸ¥</div>
  <div class="div"></div>
  <div class="auto-item"><div class="auto-dot"></div><span class="auto-label">è‡ªå‹•ï¼š</span>ç¿Œæœˆ15æ—¥ æ”¯æ‰•æ˜ç´°ç™ºè¡Œ â†’ ç¿Œæœˆ25æ—¥ æŒ¯è¾¼å®Ÿè¡Œ</div>
  <div class="div"></div>
  <div class="auto-item" style="color:var(--orange);">âš¡ æœ¬éƒ¨æ‰‹å‹•ï¼šã‚¨ãƒ©ãƒ¼å¯¾å¿œ ï¼‹ æœ€çµ‚æ‰¿èªã®ã¿</div>
</div>

<!-- â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
     TAB 0: å ±é…¬è¨ˆç®—
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• -->
<div class="page active" id="page-0">
<div class="wrap">
<div>
<div class="panel">
  <div class="panel-title">æ¡ˆä»¶æƒ…å ±ã‚’å…¥åŠ›</div>

  <div class="s-label">äº‹æ¥­ç¨®åˆ¥</div>
  <div class="fg">
    <div class="tg-group" id="g-biz">
      <button class="tg on" data-v="re" onclick="tog('g-biz',this)">ä¸å‹•ç”£ï¼ˆè³ƒè²¸ãƒ»å£²è²·ï¼‰</button>
      <button class="tg" data-v="hr" onclick="tog('g-biz',this)">äººæç´¹ä»‹</button>
    </div>
  </div>
  <div class="fg" id="sec-sanmei">
    <label>å–å¼•å½¢æ…‹</label>
    <div class="tg-group" id="g-deal">
      <button class="tg on" data-v="normal" onclick="tog('g-deal',this)">é€šå¸¸ä»²ä»‹</button>
      <button class="tg" data-v="sanmei" onclick="tog('g-deal',this)">ä¸‰ç‚º</button>
    </div>
  </div>

  <div class="s-label">æ‰‹æ•°æ–™ãƒ»å…¥é‡‘æƒ…å ±</div>
  <div class="fg"><label>ç·è«‹æ±‚é¡ãƒ»æ‰‹æ•°æ–™ï¼ˆç¨è¾¼ï¼‰</label><input type="number" id="fee" class="mono" placeholder="ä¾‹ï¼š335000" min="0" oninput="calc()"></div>
  <div class="fg"><label>å…¨é¡å…¥é‡‘ç¢ºèªæ—¥ <span style="color:var(--gold);font-size:10px">â˜… å ±é…¬è¨ˆç®—åŸºæº–æ—¥</span></label><input type="date" id="fullpay" class="mono" oninput="calc()"></div>

  <div class="s-label">å³æ—¥æ‰•ã„</div>
  <div class="fg">
    <div class="tg-group" id="g-inst">
      <button class="tg on green" data-v="no" onclick="tog('g-inst',this);showInst()">ãªã—</button>
      <button class="tg orange" data-v="yes" onclick="tog('g-inst',this);showInst()">ã‚ã‚Šï¼ˆæ‰‹æ•°æ–™15%ï¼‰</button>
    </div>
  </div>
  <div class="hidden instant-box" id="sec-inst">
    <div class="instant-title">âš¡ å³æ—¥æ‰•ã„è¨­å®š</div>
    <div class="fg"><label>å³æ—¥æ‰•ã„å¯¾è±¡é‡‘é¡</label><input type="number" id="inst-amt" class="mono" placeholder="ä¾‹ï¼š200000" min="0" oninput="calc()"></div>
    <div class="instant-note">ãƒ»æŒ‡å®šé‡‘é¡ã®85%ï¼ˆæ‰‹æ•°æ–™15%å·®å¼•å¾Œï¼‰ã‚’å³æ—¥æŒ¯è¾¼<br>ãƒ»å³æ—¥æ‰•ã„æ¸ˆã¿é‡‘é¡ã¯ç¿Œ25æ—¥ãƒãƒƒãƒã‹ã‚‰<strong style="color:var(--orange)">è‡ªå‹•é™¤å¤–</strong>ã•ã‚Œã¾ã™<br>ãƒ»äººæç´¹ä»‹ã®å ´åˆã¯ã€Œå³æ—¥æ‰•ã„ç®¡ç†ã€ã‚¿ãƒ–ã§è§£ç¦æ—¥ã‚’ç¢ºèªã—ã¦ãã ã•ã„</div>
  </div>

  <div class="s-label">æ‹…å½“ã‚¨ãƒ¼ã‚¸ã‚§ãƒ³ãƒˆ</div>
  <div class="row2">
    <div class="fg"><label>æ°å</label><input type="text" id="ag-name" placeholder="å±±ç”° èª "></div>
    <div class="fg"><label>ID</label><input type="text" id="ag-id" class="mono" placeholder="AG-012"></div>
  </div>
  <div class="fg"><label>ãƒ©ãƒ³ã‚¯</label>
    <div class="tg-group" id="g-rank">
      <button class="tg on" data-v="bronze" onclick="tog('g-rank',this)">Bronze</button>
      <button class="tg" data-v="silver" onclick="tog('g-rank',this)">Silver</button>
      <button class="tg" data-v="gold" onclick="tog('g-rank',this)">Gold</button>
      <button class="tg" data-v="platinum" onclick="tog('g-rank',this)">Platinum</button>
      <button class="tg" data-v="founding" onclick="tog('g-rank',this)">å‰µæ¥­</button>
    </div>
  </div>

  <div class="s-label">æ¡ˆä»¶ã‚¿ã‚¤ãƒ—</div>
  <div class="fg">
    <div class="tg-group" id="g-ct">
      <button class="tg on" data-v="self" onclick="tog('g-ct',this);showCt()">è‡ªå·±é–‹æ‹“</button>
      <button class="tg" data-v="partner" onclick="tog('g-ct',this);showCt()">ãƒ‘ãƒ¼ãƒˆãƒŠãƒ¼ç´¹ä»‹</button>
      <button class="tg" data-v="corp" onclick="tog('g-ct',this);showCt()">å‰µæ¥­æ³•äººæ§‹é€ </button>
    </div>
  </div>

  <div class="hidden" id="sec-partner">
    <div class="row2">
      <div class="fg"><label>ãƒ‘ãƒ¼ãƒˆãƒŠãƒ¼å</label><input type="text" id="pt-name" placeholder="ä½è—¤ ç¾å’²"></div>
      <div class="fg"><label>ID</label><input type="text" id="pt-id" class="mono" placeholder="PT-007"></div>
    </div>
    <div class="fg"><label>ç¨®åˆ¥</label>
      <div class="tg-group" id="g-pt">
        <button class="tg on" data-v="ind" onclick="tog('g-pt',this)">å€‹äºº</button>
        <button class="tg" data-v="corp" onclick="tog('g-pt',this)">æ³•äºº</button>
      </div>
    </div>
    <div class="fg"><label>ãƒ¡ãƒ³ã‚¿ãƒ¼</label>
      <div class="tg-group" id="g-mt">
        <button class="tg on" data-v="no" onclick="tog('g-mt',this);showMt()">ãªã—</button>
        <button class="tg" data-v="yes" onclick="tog('g-mt',this);showMt()">ã‚ã‚Š</button>
      </div>
    </div>
    <div class="hidden row2" id="sec-mt">
      <div class="fg"><label>ãƒ¡ãƒ³ã‚¿ãƒ¼å</label><input type="text" id="mt-name" placeholder="ç”°ä¸­ èŠ±å­"></div>
      <div class="fg"><label>ID</label><input type="text" id="mt-id" class="mono" placeholder="AG-003"></div>
    </div>
  </div>

  <div class="hidden" id="sec-corp">
    <div class="row2">
      <div class="fg"><label>æ³•äººãƒ‘ãƒ¼ãƒˆãƒŠãƒ¼å</label><input type="text" id="lp-name" placeholder="æ ªå¼ä¼šç¤¾â—‹â—‹"></div>
      <div class="fg"><label>æ³•äººID</label><input type="text" id="lp-id" class="mono" placeholder="LP-001"></div>
    </div>
  </div>

  <div class="hidden" id="sec-hr">
    <div class="s-label">äººæç´¹ä»‹ã‚ªãƒ—ã‚·ãƒ§ãƒ³</div>
    <div class="row2">
      <div class="fg"><label>è¿”æˆ»æœŸé–“</label>
        <div class="tg-group" id="g-ref">
          <button class="tg on" data-v="3" onclick="tog('g-ref',this)">3ãƒ¶æœˆ</button>
          <button class="tg" data-v="6" onclick="tog('g-ref',this)">6ãƒ¶æœˆ</button>
        </div>
      </div>
      <div class="fg"><label>å…¥ç¤¾æ—¥</label><input type="date" id="join-date" class="mono" oninput="calc()"></div>
    </div>
  </div>

  <button class="btn-calc" onclick="calc()">è¨ˆã€€ç®—ã€€ã™ã‚‹</button>
  <button class="btn-rst" onclick="resetCalc()">ãƒªã‚»ãƒƒãƒˆ</button>
</div>
</div>

<div id="result">
  <div class="panel"><div class="empty">â¬…ï¸ æ¡ˆä»¶æƒ…å ±ã‚’å…¥åŠ›ã—ã¦ã€Œè¨ˆç®—ã™ã‚‹ã€ã‚’æŠ¼ã—ã¦ãã ã•ã„</div></div>
</div>
</div>
</div>

<!-- â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
     TAB 1: äººæ å³æ—¥æ‰•ã„ç®¡ç†
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• -->
<div class="page" id="page-1">
<div class="wrap">
<div>
<div class="panel">
  <div class="panel-title">å³æ—¥æ‰•ã„è§£ç¦æ—¥ãƒã‚§ãƒƒã‚¯</div>

  <div class="s-label">æ¡ˆä»¶æƒ…å ±</div>
  <div class="row2">
    <div class="fg"><label>ã‚¨ãƒ¼ã‚¸ã‚§ãƒ³ãƒˆå</label><input type="text" id="ip-ag-name" placeholder="å±±ç”° èª "></div>
    <div class="fg"><label>ã‚¨ãƒ¼ã‚¸ã‚§ãƒ³ãƒˆID</label><input type="text" id="ip-ag-id" class="mono" placeholder="AG-012"></div>
  </div>
  <div class="fg"><label>ä¼æ¥­å</label><input type="text" id="ip-corp" placeholder="æ ªå¼ä¼šç¤¾â—‹â—‹"></div>
  <div class="fg"><label>äººææ°å</label><input type="text" id="ip-person" placeholder="ç”°ä¸­ ä¸€éƒ"></div>
  <div class="fg"><label>ç·å ±é…¬é¡ï¼ˆç¨è¾¼ãƒ»ã‚¨ãƒ¼ã‚¸ã‚§ãƒ³ãƒˆæ‰‹å–ã‚Šï¼‰</label><input type="number" id="ip-reward" class="mono" placeholder="ä¾‹ï¼š450000" oninput="ipCalc()"></div>

  <div class="s-label">æ—¥ç¨‹</div>
  <div class="fg"><label>å…¨é¡å…¥é‡‘ç¢ºèªæ—¥</label><input type="date" id="ip-fullpay" class="mono" oninput="ipCalc()"></div>
  <div class="fg"><label>å…¥ç¤¾æ—¥</label><input type="date" id="ip-join" class="mono" oninput="ipCalc()"></div>

  <div class="s-label">æœ¬æ—¥ã®æ—¥ä»˜</div>
  <div class="fg"><label>ç¢ºèªæ—¥ï¼ˆãƒ‡ãƒ•ã‚©ãƒ«ãƒˆï¼šä»Šæ—¥ï¼‰</label><input type="date" id="ip-today" class="mono" oninput="ipCalc()"></div>

  <button class="btn-calc" onclick="ipCalc()">è§£ç¦æ—¥ã‚’ç¢ºèªã™ã‚‹</button>
</div>
</div>

<div id="ip-result">
  <div class="panel"><div class="empty">â¬…ï¸ æƒ…å ±ã‚’å…¥åŠ›ã—ã¦ã€Œè§£ç¦æ—¥ã‚’ç¢ºèªã™ã‚‹ã€ã‚’æŠ¼ã—ã¦ãã ã•ã„</div></div>
</div>
</div>
</div>

<!-- â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
     TAB 2: æ—©æœŸé€€è·ãƒ»è¿”é‡‘è«‹æ±‚
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• -->
<div class="page" id="page-2">
<div class="wrap">
<div>
<div class="panel">
  <div class="panel-title">æ—©æœŸé€€è·ãƒ»è¿”é‡‘è«‹æ±‚</div>

  <div class="alert ao" style="margin-bottom:14px">ğŸ“© ä¼æ¥­ã‹ã‚‰é€€è·é€šçŸ¥ãƒ»è¿”é‡‘é¡ã®é€£çµ¡ãŒæ¥ãŸã‚‰ã€ãã®å†…å®¹ã‚’ãã®ã¾ã¾å…¥åŠ›ã—ã¦ãã ã•ã„ã€‚è¿”é‡‘ç‡ã®è¨ˆç®—ã¯ä¸è¦ã§ã™ã€‚</div>

  <div class="s-label">æ¡ˆä»¶æƒ…å ±</div>
  <div class="row2">
    <div class="fg"><label>ã‚¨ãƒ¼ã‚¸ã‚§ãƒ³ãƒˆå</label><input type="text" id="rf-ag-name" placeholder="å±±ç”° èª "></div>
    <div class="fg"><label>ã‚¨ãƒ¼ã‚¸ã‚§ãƒ³ãƒˆID</label><input type="text" id="rf-ag-id" class="mono" placeholder="AG-012"></div>
  </div>
  <div class="fg"><label>ä¼æ¥­å</label><input type="text" id="rf-corp" placeholder="æ ªå¼ä¼šç¤¾â—‹â—‹"></div>
  <div class="fg"><label>äººææ°å</label><input type="text" id="rf-person" placeholder="ç”°ä¸­ ä¸€éƒ"></div>

  <div class="s-label">ä¼æ¥­ã‹ã‚‰ã®é€šçŸ¥å†…å®¹ï¼ˆãã®ã¾ã¾å…¥åŠ›ï¼‰</div>
  <div class="row2">
    <div class="fg"><label>å…¥ç¤¾æ—¥</label><input type="date" id="rf-join" class="mono" oninput="rfCalc()"></div>
    <div class="fg"><label>é€€è·æ—¥ï¼ˆä¼æ¥­é€šçŸ¥ï¼‰</label><input type="date" id="rf-resign" class="mono" oninput="rfCalc()"></div>
  </div>
  <div class="fg">
    <label>ä¼æ¥­ãŒè«‹æ±‚ã—ã¦ãã‚‹è¿”é‡‘é¡ï¼ˆç¨è¾¼ï¼‰<span style="color:var(--red);font-size:10px"> â˜… ä¼æ¥­ã‹ã‚‰ã®é€šçŸ¥é‡‘é¡ã‚’ãã®ã¾ã¾å…¥åŠ›</span></label>
    <input type="number" id="rf-refund-from-corp" class="mono" placeholder="ä¾‹ï¼š800000" oninput="rfCalc()">
  </div>
  <div class="fg">
    <label>è¿”é‡‘ç†ç”±ãƒ»å‚™è€ƒï¼ˆä¼æ¥­ã‹ã‚‰ã®é€šçŸ¥å†…å®¹ï¼‰</label>
    <input type="text" id="rf-reason" placeholder="ä¾‹ï¼šå…¥ç¤¾2ãƒ¶æœˆã§è‡ªå·±éƒ½åˆé€€è·ã®ãŸã‚å…¨é¡è¿”é‡‘è«‹æ±‚" oninput="rfCalc()">
  </div>

  <div class="s-label">ã‚¨ãƒ¼ã‚¸ã‚§ãƒ³ãƒˆã¸ã®æ”¯æ‰•ã„çŠ¶æ³</div>
  <div class="fg"><label>æ”¯æ‰•ã„æ¸ˆã¿å ±é…¬ã®ç·é¡ï¼ˆæ‰‹å–ã‚Šãƒ»å®Ÿéš›ã«æŒ¯ã‚Šè¾¼ã‚“ã é‡‘é¡ï¼‰</label>
    <input type="number" id="rf-ag-received" class="mono" placeholder="ä¾‹ï¼š336712" oninput="rfCalc()">
  </div>
  <div class="fg"><label>æ”¯æ‰•ã„çŠ¶æ³ã®è©³ç´°</label>
    <div class="tg-group" id="g-rf-paid">
      <button class="tg on" data-v="pay1only" onclick="tog('g-rf-paid',this)">ç¬¬1å›ã®ã¿æ”¯æ‰•æ¸ˆã¿</button>
      <button class="tg" data-v="both" onclick="tog('g-rf-paid',this)">ç¬¬1ãƒ»2å›ä¸¡æ–¹æ”¯æ‰•æ¸ˆã¿</button>
      <button class="tg" data-v="instant" onclick="tog('g-rf-paid',this)">å³æ—¥æ‰•ã„ã‚ã‚Š</button>
      <button class="tg" data-v="none" onclick="tog('g-rf-paid',this)">æœªæ‰•ã„</button>
    </div>
  </div>
  <div class="fg hidden" id="sec-rf-instant-detail">
    <label>ã†ã¡å³æ—¥æ‰•ã„ã§æ”¯æ‰•ã£ãŸé‡‘é¡ï¼ˆæ‰‹å–ã‚Šå¾Œã®å®ŸæŒ¯è¾¼é¡ï¼‰</label>
    <input type="number" id="rf-instant-paid" class="mono" placeholder="ä¾‹ï¼š142000" oninput="rfCalc()">
  </div>

  <button class="btn-calc red-btn" onclick="rfCalc()">è¿”é‡‘è«‹æ±‚æ›¸ã‚’ç”Ÿæˆ</button>
  <button class="btn-rst" onclick="resetRf()">ãƒªã‚»ãƒƒãƒˆ</button>
</div>
</div>

<div id="rf-result">
  <div class="panel"><div class="empty">â¬…ï¸ é€€è·æƒ…å ±ã‚’å…¥åŠ›ã—ã¦ã€Œè¿”é‡‘é¡ãƒ»è«‹æ±‚æ›¸ã‚’ç”Ÿæˆã€ã‚’æŠ¼ã—ã¦ãã ã•ã„</div></div>
</div>
</div>
</div>

<script src="db.js"></script>
<script>
// â•â• AUTH GUARD (è¦ãƒ­ã‚°ã‚¤ãƒ³) â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
(function() {
  var s = null;
  try { s = JSON.parse(sessionStorage.getItem('coreto_session') || 'null'); } catch(e) {}
  if (!s || !s.userId || !s.type) {
    sessionStorage.setItem('coreto_redirect', window.location.href);
    location.replace('coreto-login.html');
    return;
  }
  if (!s.sessionToken || s.sessionToken.length !== 64) {
    sessionStorage.removeItem('coreto_session');
    location.replace('coreto-login.html');
    return;
  }
  var _la = new Date(s.loginAt).getTime();
  if (isNaN(_la) || (Date.now() - _la) > 28800000) {
    sessionStorage.removeItem('coreto_session');
    alert('ã‚»ãƒƒã‚·ãƒ§ãƒ³ã®æœ‰åŠ¹æœŸé™ãŒåˆ‡ã‚Œã¾ã—ãŸã€‚å†åº¦ãƒ­ã‚°ã‚¤ãƒ³ã—ã¦ãã ã•ã„ã€‚');
    location.replace('coreto-login.html');
    return;
  }
  window._SESSION = s;
})();

// â”€â”€ ã‚»ãƒƒã‚·ãƒ§ãƒ³èª­ã¿è¾¼ã¿ï¼ˆãƒã‚¤ãƒšãƒ¼ã‚¸ã‹ã‚‰è‡ªå‹•å…¥åŠ›ï¼‰ â”€â”€
(function() {
  const _S = JSON.parse(sessionStorage.getItem('coreto_session') || 'null');
  if (!_S) return;
  window.addEventListener('DOMContentLoaded', () => {
    // ãƒã‚¤ãƒšãƒ¼ã‚¸ã¸æˆ»ã‚‹ãƒªãƒ³ã‚¯ã‚’ã‚¿ãƒ–ãƒãƒ¼ã«è¿½åŠ 
    const tabs = document.querySelector('.tabs');
    if (tabs) {
      const back = document.createElement('div');
      back.style.cssText = 'margin-left:auto;padding:0 16px;display:flex;align-items:center;gap:10px';
      back.innerHTML = '<span style="font-size:10px;color:var(--muted)">ğŸ‘¤ '+_S.name+'</span>' +
        '<button onclick="window.location.href='coreto-hub.html'" style="font-size:10px;padding:4px 10px;border-radius:6px;border:1px solid var(--border2);background:transparent;color:var(--muted);cursor:pointer;font-family:sans-serif">â† ãƒã‚¤ãƒšãƒ¼ã‚¸</button>';
      tabs.appendChild(back);
    }
  });
})();

// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
// å…±é€š
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
const RATES={re:{bronze:.65,silver:.675,gold:.70,platinum:.75,founding:.90},hr:{bronze:.45,silver:.475,gold:.50,platinum:.55,founding:.90}};
const MF={bronze:980,silver:490,gold:0,platinum:0,founding:0};
const RL={bronze:'ãƒ–ãƒ­ãƒ³ã‚º',silver:'ã‚·ãƒ«ãƒãƒ¼',gold:'ã‚´ãƒ¼ãƒ«ãƒ‰',platinum:'ãƒ—ãƒ©ãƒãƒŠ',founding:'å‰µæ¥­ãƒ¡ãƒ³ãƒãƒ¼'};

function switchTab(i){
  document.querySelectorAll('.tab').forEach((t,j)=>t.classList.toggle('active',i===j));
  document.querySelectorAll('.page').forEach((p,j)=>p.classList.toggle('active',i===j));
}
function tog(gid,btn){document.querySelectorAll('#'+gid+' .tg').forEach(b=>b.classList.remove('on'));btn.classList.add('on');calc();rfCalc();ipCalc();}
function gv(gid){const a=document.querySelector('#'+gid+' .tg.on');return a?a.dataset.v:null;}
function sh(id,show){document.getElementById(id).classList.toggle('hidden',!show);}

function showInst(){setTimeout(()=>{sh('sec-inst',gv('g-inst')==='yes');calc();},0);}
function showCt(){setTimeout(()=>{const ct=gv('g-ct');sh('sec-partner',ct==='partner');sh('sec-corp',ct==='corp');calc();},0);}
function showMt(){setTimeout(()=>{sh('sec-mt',gv('g-mt')==='yes');calc();},0);}
document.querySelectorAll('#g-biz .tg').forEach(b=>b.addEventListener('click',()=>setTimeout(()=>{
  const biz=gv('g-biz');sh('sec-sanmei',biz==='re');sh('sec-hr',biz==='hr');calc();
},0)));
document.querySelectorAll('#g-rf-paid .tg').forEach(b=>b.addEventListener('click',()=>setTimeout(()=>{
  sh('sec-rf-instant-detail',gv('g-rf-paid')==='instant');rfCalc();
},0)));

// â”€â”€ ä»Šæ—¥ã®æ—¥ä»˜ã‚’ãƒ‡ãƒ•ã‚©ãƒ«ãƒˆè¨­å®š â”€â”€
document.getElementById('ip-today').value = new Date().toISOString().split('T')[0];

// â”€â”€ è¨ˆç®—ãƒ¦ãƒ¼ãƒ†ã‚£ãƒªãƒ†ã‚£ â”€â”€
function wh(n){if(n<=0)return 0;const M=1e6;return n<=M?Math.floor(n*.1021):Math.floor(M*.1021+(n-M)*.2042);}
function incentive(fee,rate){
  const T1=5e6,T2=1e7;
  if(fee<=T1)return{r:Math.floor(fee*rate),tiers:[{l:'å…¨é¡',a:fee,r:rate,v:fee*rate}]};
  if(fee<=T2){const r1=T1*rate,r2=(fee-T1)*(rate+.05);return{r:Math.floor(r1+r2),tiers:[{l:'0ã€œ500ä¸‡å††',a:T1,r:rate,v:r1},{l:'500ä¸‡å††ã€œ',a:fee-T1,r:rate+.05,v:r2}]};}
  const r1=T1*rate,r2=(T2-T1)*(rate+.05),r3=(fee-T2)*(rate+.10);
  return{r:Math.floor(r1+r2+r3),tiers:[{l:'0ã€œ500ä¸‡å††',a:T1,r:rate,v:r1},{l:'500ä¸‡ã€œ1000ä¸‡å††',a:T2-T1,r:rate+.05,v:r2},{l:'1000ä¸‡å††è¶…',a:fee-T2,r:rate+.10,v:r3}]};
}
function yen(n){return'Â¥'+Math.round(n).toLocaleString();}
function pct(r){return(r*100).toFixed(1)+'%';}
function fd(d){if(!d)return'â€•';const dt=d instanceof Date?d:new Date(d);return dt.getFullYear()+'å¹´'+(dt.getMonth()+1)+'æœˆ'+dt.getDate()+'æ—¥';}
function pay25from(d){const r=new Date(d);r.setMonth(r.getMonth()+1);r.setDate(25);return r;}
function addM(d,m){const r=new Date(d);r.setMonth(r.getMonth()+m);return r;}
function addD(d,days){const r=new Date(d);r.setDate(r.getDate()+days);return r;}
function diffMonths(a,b){return(b.getFullYear()-a.getFullYear())*12+(b.getMonth()-a.getMonth())+(b.getDate()<a.getDate()?-1:0);}

// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
// TAB 0: å ±é…¬è¨ˆç®—
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
function calc(){
  const fee=parseFloat(document.getElementById('fee').value)||0;
  if(fee<=0){document.getElementById('result').innerHTML='<div class="panel"><div class="empty">æ‰‹æ•°æ–™ã‚’å…¥åŠ›ã—ã¦ãã ã•ã„</div></div>';return;}
  const biz=gv('g-biz'),deal=gv('g-deal'),rnk=gv('g-rank'),ct=gv('g-ct');
  const ptCorp=gv('g-pt')==='corp',mentorOn=gv('g-mt')==='yes';
  const ref=parseInt(gv('g-ref')||'3');
  const instOn=gv('g-inst')==='yes';
  const instInput=parseFloat(document.getElementById('inst-amt').value)||0;
  const fullpayVal=document.getElementById('fullpay').value;
  const joinVal=document.getElementById('join-date').value;
  const agName=document.getElementById('ag-name').value||'ã‚¨ãƒ¼ã‚¸ã‚§ãƒ³ãƒˆ';
  const agId=document.getElementById('ag-id').value||'â€•';
  const ptName=document.getElementById('pt-name').value||'ãƒ‘ãƒ¼ãƒˆãƒŠãƒ¼';
  const ptId=document.getElementById('pt-id').value||'â€•';
  const mtName=document.getElementById('mt-name').value||'ãƒ¡ãƒ³ã‚¿ãƒ¼';
  const mtId=document.getElementById('mt-id').value||'â€•';
  const lpName=document.getElementById('lp-name').value||'æ³•äººãƒ‘ãƒ¼ãƒˆãƒŠãƒ¼';
  const lpId=document.getElementById('lp-id').value||'â€•';

  const mf=MF[rnk]||0;
  const fullpayD=fullpayVal?new Date(fullpayVal):null;
  const pay25D=fullpayD?pay25from(fullpayD):null;
  const payStr=pay25D?fd(pay25D):'ï¼ˆå…¨é¡å…¥é‡‘ç¢ºèªæ—¥ã‚’å…¥åŠ›ã—ã¦ãã ã•ã„ï¼‰';

  let html='';

  if(ct==='self'){
    let base=RATES[biz][rnk];
    const sanmei=biz==='re'&&deal==='sanmei';
    if(sanmei)base-=.15;
    const{r:reward,tiers}=incentive(fee,base);
    const tax=wh(reward);const net=reward-tax;const payout=net-mf;
    const inst=mkInst(instOn,instInput,payout);
    html=`<div class="panel">
      <div class="panel-title">è¨ˆç®—çµæœ ï¼ è‡ªå·±é–‹æ‹“</div>
      ${sanmei?`<div class="alert ao">âš ï¸ ä¸‰ç‚ºå–å¼•ï¼šåŸºæœ¬å ±é…¬ç‡ã‹ã‚‰è£œæ­£æ¸ˆã¿</div>`:''}
      ${heroBox(payout,agName,agId,RL[rnk],pct(base),payStr)}
      ${schedTl(fullpayD,pay25D)}
      <div class="sec">å ±é…¬å†…è¨³</div>
      <div class="bk">
        <div class="bkr"><div class="bkl">ç·æ‰‹æ•°æ–™<span class="badge bb">å…¨é¡å…¥é‡‘ç¢ºèªåŸºæº–</span></div><div class="bkv">${yen(fee)}</div></div>
        ${tiers.length>1?tiers.map(t=>`<div class="bkr"><div class="bkl">â”” ${t.l}ï¼ˆ${pct(t.r)}ï¼‰</div><div class="bkv">${yen(t.v)}</div></div>`).join(''):''}
        <div class="bkr grn"><div class="bkl">å ±é…¬é¡ï¼ˆç¨æŠœï¼‰<span class="badge bg">${pct(base)}</span></div><div class="bkv">${yen(reward)}</div></div>
        <div class="bkr red"><div class="bkl">æºæ³‰å¾´å<span class="badge br">${reward<=1e6?'10.21%':'ç´¯é€²'}</span></div><div class="bkv">âˆ’${yen(tax)}</div></div>
        <div class="bkr"><div class="bkl">æ‰‹å–ã‚Š</div><div class="bkv">${yen(net)}</div></div>
        ${mf>0?`<div class="bkr red"><div class="bkl">æœˆä¼šè²»<span class="badge br">${RL[rnk]}</span></div><div class="bkv">âˆ’${yen(mf)}</div></div>`:''}
        <div class="bkr ttl"><div class="bkl" style="font-weight:700;color:var(--text)">æŒ¯è¾¼é¡</div><div class="bkv" style="color:var(--gold);font-size:15px">${yen(payout)}</div></div>
      </div>
      ${taxNote(reward)}
      ${instHtml(inst,payout,payStr)}
      ${biz==='hr'?hrSchedSimple(payout,inst,joinVal,ref):''}
      ${autoCheck()}
    </div>`;
  }

  else if(ct==='partner'){
    const aR=.25,pR=.25,mR=mentorOn?.05:0,hR=1-aR-pR-mR;
    const aRew=Math.floor(fee*aR),pRew=Math.floor(fee*pR),mRew=Math.floor(fee*mR),hRew=Math.floor(fee*hR);
    const aTax=wh(aRew),pTax=ptCorp?0:wh(pRew),mTax=mentorOn?wh(mRew):0;
    const aNet=aRew-aTax-mf,pNet=pRew-pTax,mNet=mentorOn?mRew-mTax:0;
    const inst=mkInst(instOn,instInput,aNet);
    html=`<div class="panel">
      <div class="panel-title">è¨ˆç®—çµæœ ï¼ ãƒ‘ãƒ¼ãƒˆãƒŠãƒ¼ç´¹ä»‹</div>
      ${heroBox(aNet,agName,agId,'ãƒ‘ãƒ¼ãƒˆãƒŠãƒ¼æ¡ˆä»¶','AG:25%/PT:25%',payStr)}
      ${schedTl(fullpayD,pay25D)}
      <div class="sec">é…åˆ†</div>
      ${splitCard(agName,agId,'ã‚¨ãƒ¼ã‚¸ã‚§ãƒ³ãƒˆ',aR,aNet,'var(--blue)',`æºæ³‰æ§é™¤å¾Œ${mf>0?'ãƒ»æœˆä¼šè²»'+yen(mf)+'æ§é™¤':''}`)}
      ${splitCard(ptName,ptId,`ãƒ‘ãƒ¼ãƒˆãƒŠãƒ¼ï¼ˆ${ptCorp?'æ³•äºº':'å€‹äºº'}ï¼‰`,pR,pNet,'var(--green)',ptCorp?'æºæ³‰å…é™¤ï¼ˆæ³•äººï¼‰':'æºæ³‰æ§é™¤å¾Œ')}
      ${mentorOn?splitCard(mtName,mtId,'ãƒ¡ãƒ³ã‚¿ãƒ¼',mR,mNet,'var(--orange)','æºæ³‰æ§é™¤å¾Œ'):''}
      <div class="sc"><div><div style="font-size:11px;font-weight:600;color:var(--muted)">CORETO æœ¬éƒ¨</div></div><div style="text-align:right"><div style="font-size:10px;color:var(--muted)">${pct(hR)}</div><div style="font-family:'DM Mono',monospace;font-size:14px;color:var(--muted)">${yen(hRew)}</div></div></div>
      ${taxNote(aRew)}
      ${instHtml(inst,aNet,payStr)}
      ${biz==='hr'?hrSchedSimple(aNet,inst,joinVal,ref):''}
      ${autoCheck()}
    </div>`;
  }

  else if(ct==='corp'){
    const cR=.85,iR=.05,hR=.10;
    const cRew=Math.floor(fee*cR),iRew=Math.floor(fee*iR),hRew=Math.floor(fee*hR);
    const iTax=wh(iRew),iNet=iRew-iTax-mf;
    const inst=mkInst(instOn,instInput,iNet);
    html=`<div class="panel">
      <div class="panel-title">è¨ˆç®—çµæœ ï¼ å‰µæ¥­ãƒ¡ãƒ³ãƒãƒ¼æ³•äººæ§‹é€ </div>
      <div class="alert ab">ğŸ’¡ æ´»å‹•ã¯å€‹äººã‚¨ãƒ¼ã‚¸ã‚§ãƒ³ãƒˆã¨ã—ã¦å®Ÿæ–½ã—ã€æ”¯æ‰•æ™‚ã®ã¿æ³•äººå£åº§ã«æŒ¯è¾¼ã™ã‚‹ç‰¹åˆ¥æ§‹é€ ã§ã™ã€‚</div>
      ${heroBox(cRew+iNet,agName,agId,'æ³•äºº85%ï¼‹å€‹äºº5%','æ³•äººæºæ³‰å…é™¤',payStr)}
      ${schedTl(fullpayD,pay25D)}
      <div class="sec">é…åˆ†</div>
      ${splitCard(lpName,lpId,'æ³•äººãƒ‘ãƒ¼ãƒˆãƒŠãƒ¼',cR,cRew,'var(--purple)','æºæ³‰å…é™¤ï¼ˆæ³•äººï¼‰')}
      ${splitCard(agName,agId,'å€‹äºº',iR,iNet,'var(--blue)',`æºæ³‰ âˆ’${yen(iTax)}ãƒ»æœˆä¼šè²» âˆ’${yen(mf)}`)}
      <div class="sc"><div><div style="font-size:11px;font-weight:600;color:var(--muted)">CORETO æœ¬éƒ¨</div></div><div style="text-align:right"><div style="font-size:10px;color:var(--muted)">${pct(hR)}</div><div style="font-family:'DM Mono',monospace;font-size:14px;color:var(--muted)">${yen(hRew)}</div></div></div>
      <div class="sec">æŒ¯è¾¼å…ˆï¼ˆ2å£åº§ï¼‰</div>
      <div class="bk">
        <div class="bkr"><div class="bkl">â‘  æ³•äººå£åº§ï¼ˆ${lpName}ï¼‰<span class="badge bp">æºæ³‰ä¸è¦</span></div><div class="bkv ppl" style="color:var(--purple)">${yen(cRew)}</div></div>
        <div class="bkr"><div class="bkl">â‘¡ å€‹äººå£åº§ï¼ˆ${agName}ï¼‰</div><div class="bkv" style="color:var(--blue)">${yen(iNet)}</div></div>
      </div>
      ${taxNote(iRew)}
      ${instHtml(inst,iNet,payStr)}
      ${autoCheck()}
    </div>`;
  }

  document.getElementById('result').innerHTML=html;
}

// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
// TAB 1: äººæ å³æ—¥æ‰•ã„è§£ç¦æ—¥ãƒã‚§ãƒƒã‚¯
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
function ipCalc(){
  const reward = parseFloat(document.getElementById('ip-reward').value)||0;
  const fpVal  = document.getElementById('ip-fullpay').value;
  const joinVal= document.getElementById('ip-join').value;
  const todayVal=document.getElementById('ip-today').value;
  const agName = document.getElementById('ip-ag-name').value||'ã‚¨ãƒ¼ã‚¸ã‚§ãƒ³ãƒˆ';
  const agId   = document.getElementById('ip-ag-id').value||'â€•';
  const corp   = document.getElementById('ip-corp').value||'ä¼æ¥­åæœªå…¥åŠ›';
  const person = document.getElementById('ip-person').value||'äººææ°åæœªå…¥åŠ›';

  if(reward<=0||!joinVal){document.getElementById('ip-result').innerHTML='<div class="panel"><div class="empty">å ±é…¬é¡ã¨å…¥ç¤¾æ—¥ã‚’å…¥åŠ›ã—ã¦ãã ã•ã„</div></div>';return;}

  const joinD  = new Date(joinVal);
  const today  = todayVal?new Date(todayVal):new Date();
  const fpD    = fpVal?new Date(fpVal):null;

  // è§£ç¦æ—¥è¨ˆç®—
  // ç¬¬1å›ï¼ˆ50%ï¼‰ï¼šå…¨é¡å…¥é‡‘ç¢ºèª AND å…¥ç¤¾1é€±é–“å¾Œ
  const unlock1_join = addD(joinD, 7);       // å…¥ç¤¾ã‹ã‚‰1é€±é–“å¾Œ
  const unlock1 = fpD ? (fpD>unlock1_join?fpD:unlock1_join) : unlock1_join; // ä¸¡æ–¹æº€ãŸã—ãŸæ—¥
  // ç¬¬2å›ï¼ˆæ®‹ã‚Šï¼‰ï¼šå…¥ç¤¾1ãƒ¶æœˆå¾Œ
  const unlock2 = addM(joinD, 1);

  const pay1 = Math.floor(reward * .5);
  const pay2 = reward - pay1;

  // å³æ—¥æ‰•ã„å¯èƒ½é¡ï¼ˆæœ¬æ—¥æ™‚ç‚¹ï¼‰
  const can1 = today >= unlock1 && fpD; // å…¨é¡å…¥é‡‘ç¢ºèªæ¸ˆã¿ãŒå‰æ
  const can2 = today >= unlock2;

  const instFee1 = Math.floor(pay1 * .15);
  const instFee2 = Math.floor(pay2 * .15);
  const instNet1 = pay1 - instFee1;
  const instNet2 = pay2 - instFee2;

  // 25æ—¥æŒ¯è¾¼äºˆå®š
  const batch25_1 = fpD ? pay25from(fpD) : null; // å…¥é‡‘ç¢ºèªç¿Œæœˆ25æ—¥
  const batch25_2 = (() => {const d=addM(joinD,1);d.setDate(25);d.setMonth(d.getMonth()+1);return d;})();

  function statusBadge(ok, locked_reason){
    if(ok) return `<div class="unlock-status unlock-ok"><div class="unlock-icon">âœ…</div><div><strong>å³æ—¥æ‰•ã„å¯èƒ½</strong></div></div>`;
    return `<div class="unlock-status unlock-ng"><div class="unlock-icon">ğŸ”’</div><div><strong>ã¾ã è§£ç¦å‰</strong>ã€€${locked_reason}</div></div>`;
  }
  function pendingBadge(d){
    return`<div class="unlock-status unlock-pending"><div class="unlock-icon">â³</div><div>è§£ç¦æ—¥ï¼š<strong>${fd(d)}</strong></div></div>`;
  }

  const html=`
  <div class="panel">
    <div class="panel-title">å³æ—¥æ‰•ã„è§£ç¦çŠ¶æ³</div>
    <div class="bk" style="margin-bottom:14px">
      <div class="bkr"><div class="bkl">ã‚¨ãƒ¼ã‚¸ã‚§ãƒ³ãƒˆ</div><div class="bkv">${agName}ï¼ˆ${agId}ï¼‰</div></div>
      <div class="bkr"><div class="bkl">ä¼æ¥­</div><div class="bkv">${corp}</div></div>
      <div class="bkr"><div class="bkl">äººææ°å</div><div class="bkv">${person}</div></div>
      <div class="bkr"><div class="bkl">å…¥ç¤¾æ—¥</div><div class="bkv">${fd(joinD)}</div></div>
      <div class="bkr"><div class="bkl">å…¨é¡å…¥é‡‘ç¢ºèªæ—¥</div><div class="bkv">${fpD?fd(fpD):'<span style="color:var(--red)">æœªç¢ºèª</span>'}</div></div>
      <div class="bkr"><div class="bkl">ç¢ºèªæ—¥ï¼ˆæœ¬æ—¥ï¼‰</div><div class="bkv">${fd(today)}</div></div>
    </div>

    <div class="sec">ç¬¬1å›ï¼ˆ50%ï¼‰= ${yen(pay1)}</div>
    <div style="font-size:10px;color:var(--muted);margin-bottom:8px">è§£ç¦æ¡ä»¶ï¼šå…¨é¡å…¥é‡‘ç¢ºèª <strong style="color:var(--text)">ã‹ã¤</strong> å…¥ç¤¾ã‹ã‚‰1é€±é–“å¾Œï¼ˆ${fd(unlock1_join)}ï¼‰ã‚’éãã¦ã„ã‚‹ã“ã¨</div>
    ${!fpD
      ? `<div class="unlock-status unlock-ng"><div class="unlock-icon">ğŸ”’</div><div><strong>æœªè§£ç¦</strong>ã€€å…¨é¡å…¥é‡‘ãŒç¢ºèªã•ã‚Œã¦ã„ã¾ã›ã‚“</div></div>`
      : can1
        ? statusBadge(true)
        : pendingBadge(unlock1)
    }
    <div class="two" style="margin-top:10px">
      <div class="pc ${can1?'unlocked':'locked'}">
        <div class="pc-num">âš¡ å³æ—¥æ‰•ã„ï¼ˆæ‰‹æ•°æ–™15%å·®å¼•å¾Œï¼‰</div>
        <div class="pc-amt" style="color:${can1?'var(--orange)':'var(--muted)'}">${can1?yen(instNet1):'â€•'}</div>
        <div class="pc-when">å…ƒé‡‘ï¼š${yen(pay1)}<br>æ‰‹æ•°æ–™ï¼šâˆ’${yen(instFee1)}</div>
      </div>
      <div class="pc">
        <div class="pc-num">ç¿Œ25æ—¥ãƒãƒƒãƒæ‰•ã„ï¼ˆè§£ç¦å‰ã¯é€šå¸¸æ‰•ã„ï¼‰</div>
        <div class="pc-amt">${yen(pay1)}</div>
        <div class="pc-when">é€šå¸¸æŒ¯è¾¼ï¼š${batch25_1?fd(batch25_1):'â€•'}</div>
      </div>
    </div>

    <div class="sec">ç¬¬2å›ï¼ˆæ®‹ã‚Š50%ï¼‰= ${yen(pay2)}</div>
    <div style="font-size:10px;color:var(--muted);margin-bottom:8px">è§£ç¦æ¡ä»¶ï¼šå…¥ç¤¾ã‹ã‚‰<strong style="color:var(--text)">1ãƒ¶æœˆå¾Œ</strong>ï¼ˆ${fd(unlock2)}ï¼‰ã‚’éãã¦ã„ã‚‹ã“ã¨</div>
    ${can2 ? statusBadge(true) : pendingBadge(unlock2)}
    <div class="two" style="margin-top:10px">
      <div class="pc ${can2?'unlocked':'locked'}">
        <div class="pc-num">âš¡ å³æ—¥æ‰•ã„ï¼ˆæ‰‹æ•°æ–™15%å·®å¼•å¾Œï¼‰</div>
        <div class="pc-amt" style="color:${can2?'var(--orange)':'var(--muted)'}">${can2?yen(instNet2):'â€•'}</div>
        <div class="pc-when">å…ƒé‡‘ï¼š${yen(pay2)}<br>æ‰‹æ•°æ–™ï¼šâˆ’${yen(instFee2)}</div>
      </div>
      <div class="pc">
        <div class="pc-num">ç¿Œ25æ—¥ãƒãƒƒãƒæ‰•ã„ï¼ˆé€šå¸¸ï¼‰</div>
        <div class="pc-amt">${yen(pay2)}</div>
        <div class="pc-when">é€šå¸¸æŒ¯è¾¼ï¼š${fd(batch25_2)}</div>
      </div>
    </div>

    <div class="sec" style="margin-top:4px">æ³¨æ„äº‹é …</div>
    <div class="alert ao">
      ãƒ»å³æ—¥æ‰•ã„ã¯ã‚¨ãƒ¼ã‚¸ã‚§ãƒ³ãƒˆã®ç”³è«‹ãŒå¿…è¦ã§ã™<br>
      ãƒ»å³æ—¥æ‰•ã„ã‚’å®Ÿè¡Œã—ãŸé‡‘é¡ã¯ç¿Œ25æ—¥ãƒãƒƒãƒã‹ã‚‰<strong>è‡ªå‹•é™¤å¤–</strong>ã•ã‚Œã¾ã™<br>
      ãƒ»æ—©æœŸé€€è·ãŒç™ºç”Ÿã—ãŸå ´åˆã€å³æ—¥æ‰•ã„ã—ãŸé‡‘é¡ã‚‚å«ã‚ã¦è¿”é‡‘è«‹æ±‚ã®å¯¾è±¡ã¨ãªã‚Šã¾ã™
    </div>
  </div>`;

  document.getElementById('ip-result').innerHTML=html;
}

// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
// TAB 2: æ—©æœŸé€€è·ãƒ»è¿”é‡‘è«‹æ±‚
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
function rfCalc(){
  const refundFromCorp = parseFloat(document.getElementById('rf-refund-from-corp').value)||0;
  const agReceived     = parseFloat(document.getElementById('rf-ag-received').value)||0;
  const joinVal        = document.getElementById('rf-join').value;
  const resignVal      = document.getElementById('rf-resign').value;
  const reason         = document.getElementById('rf-reason').value||'ï¼ˆä¼æ¥­ã‹ã‚‰ã®é€šçŸ¥å†…å®¹ã‚’å…¥åŠ›ã—ã¦ãã ã•ã„ï¼‰';
  const paidStatus     = gv('g-rf-paid');
  const instPaid       = parseFloat(document.getElementById('rf-instant-paid').value)||0;
  const agName         = document.getElementById('rf-ag-name').value||'ã‚¨ãƒ¼ã‚¸ã‚§ãƒ³ãƒˆ';
  const agId           = document.getElementById('rf-ag-id').value||'â€•';
  const corp           = document.getElementById('rf-corp').value||'ä¼æ¥­å';
  const person         = document.getElementById('rf-person').value||'äººææ°å';

  if(refundFromCorp<=0||!resignVal){
    document.getElementById('rf-result').innerHTML='<div class="panel"><div class="empty">ä¼æ¥­ã‹ã‚‰ã®è¿”é‡‘é¡ã¨é€€è·æ—¥ã‚’å…¥åŠ›ã—ã¦ãã ã•ã„</div></div>';return;
  }

  const resignD = new Date(resignVal);
  const joinD   = joinVal ? new Date(joinVal) : null;
  const months  = joinD ? diffMonths(joinD, resignD) : null;

  // ä¼æ¥­ãŒè¦æ±‚ã™ã‚‹è¿”é‡‘é¡ = ã‚¨ãƒ¼ã‚¸ã‚§ãƒ³ãƒˆã¸ã®è«‹æ±‚é¡ï¼ˆå…¨é¡å›åï¼‰
  const claimToAgent = refundFromCorp;

  const today    = new Date();
  const deadline = addD(today, 14);
  const dueStr   = fd(deadline);
  const unpaid   = paidStatus === 'none';

  let instNote = '';
  if(paidStatus==='instant' && instPaid>0){
    instNote = `ã†ã¡å³æ—¥æ‰•ã„ ${yen(instPaid)} ã‚’å«ã‚€`;
  }

  const html=`<div class="panel">
    <div class="panel-title">è¿”é‡‘è«‹æ±‚æ›¸</div>

    <div class="refund-hero full">
      <div class="refund-lbl" style="color:var(--red)">ä¼æ¥­ã¸ã®è¿”é‡‘é¡ï¼ˆé€šçŸ¥ãƒ™ãƒ¼ã‚¹ï¼‰</div>
      <div class="refund-amt" style="color:var(--red)">${yen(refundFromCorp)}</div>
      <div class="refund-note" style="color:var(--sub)">
        ${joinD ? `å…¥ç¤¾æ—¥ï¼š${fd(joinD)}ã€€â†’ã€€é€€è·æ—¥ï¼š${fd(resignD)}ã€€åœ¨ç± ${months}ãƒ¶æœˆ` : `é€€è·æ—¥ï¼š${fd(resignD)}`}<br>
        ${reason}
      </div>
    </div>

    <div class="sec">è¿”é‡‘å†…è¨³</div>
    <div class="bk">
      <div class="bkr"><div class="bkl">ä¼æ¥­ã‹ã‚‰é€šçŸ¥ã•ã‚ŒãŸè¿”é‡‘é¡<span class="badge br">é€šçŸ¥ãƒ™ãƒ¼ã‚¹</span></div><div class="bkv" style="color:var(--red)">${yen(refundFromCorp)}</div></div>
      <div class="bkr"><div class="bkl">ã‚¨ãƒ¼ã‚¸ã‚§ãƒ³ãƒˆæ”¯æ‰•æ¸ˆã¿å ±é…¬</div><div class="bkv">${agReceived>0?yen(agReceived)+(instNote?'ã€€ï¼ˆ'+instNote+'ï¼‰':''):'æœªæ‰•ã„'}</div></div>
      ${unpaid
        ? `<div class="bkr grn"><div class="bkl">ã‚¨ãƒ¼ã‚¸ã‚§ãƒ³ãƒˆã¸ã®å¯¾å¿œ<span class="badge bg">æŒ¯è¾¼åœæ­¢ã§å¯¾å¿œå¯</span></div><div class="bkv" style="color:var(--green)">æŒ¯è¾¼åœæ­¢</div></div>`
        : `<div class="bkr red"><div class="bkl">ã‚¨ãƒ¼ã‚¸ã‚§ãƒ³ãƒˆã¸ã®è«‹æ±‚é¡<span class="badge br">ä¼æ¥­é€šçŸ¥é¡ã‚’å…¨é¡å›å</span></div><div class="bkv">${yen(claimToAgent)}</div></div>`
      }
    </div>

    ${unpaid ? `<div class="alert ag">âœ… ã‚¨ãƒ¼ã‚¸ã‚§ãƒ³ãƒˆã¸ã®å ±é…¬ã¯æœªæ‰•ã„ã®ãŸã‚ã€<strong>æŒ¯è¾¼ã‚’åœæ­¢</strong>ã™ã‚‹ã ã‘ã§å¯¾å¿œã§ãã¾ã™ã€‚ä¼æ¥­ã¸ã®è¿”é‡‘ ${yen(refundFromCorp)} ã¯åˆ¥é€”æ‰‹é…ã—ã¦ãã ã•ã„ã€‚</div>` : ''}

    <div class="sec">ã‚¨ãƒ¼ã‚¸ã‚§ãƒ³ãƒˆã¸ã®è¿”é‡‘è«‹æ±‚æ›¸</div>
    <div class="invoice-preview">
      <div class="inv-hdr">
        <div class="inv-logo">CORETO</div>
        <div class="inv-title">è¿”é‡‘è«‹æ±‚æ›¸</div>
      </div>
      <div style="margin-bottom:12px;font-size:11px;color:#555">
        ç™ºè¡Œæ—¥ï¼š${fd(today)}<br>
        è¿”é‡‘æœŸé™ï¼š<strong style="color:#c00">${dueStr}</strong>
      </div>
      <strong>${agName}ï¼ˆ${agId}ï¼‰æ§˜</strong>
      <p style="margin:10px 0;font-size:11px;line-height:1.8;color:#444">
        ä¸‹è¨˜ã®é€šã‚Šã€æ—©æœŸé€€è·ã«ä¼´ã†è¿”é‡‘è«‹æ±‚ã‚’ã„ãŸã—ã¾ã™ã€‚<br>
        æœŸæ—¥ã¾ã§ã«ã”è¿”é‡‘ã„ãŸã ãã¾ã™ã‚ˆã†ãŠé¡˜ã„ç”³ã—ä¸Šã’ã¾ã™ã€‚
      </p>
      <div class="inv-row"><span>ç´¹ä»‹å…ˆä¼æ¥­</span><span>${corp}</span></div>
      <div class="inv-row"><span>ç´¹ä»‹äººæ</span><span>${person}</span></div>
      ${joinD ? `<div class="inv-row"><span>å…¥ç¤¾æ—¥</span><span>${fd(joinD)}</span></div>` : ''}
      <div class="inv-row"><span>é€€è·æ—¥ï¼ˆä¼æ¥­é€šçŸ¥ï¼‰</span><span>${fd(resignD)}</span></div>
      ${months !== null ? `<div class="inv-row"><span>åœ¨ç±æœŸé–“</span><span>${months}ãƒ¶æœˆ</span></div>` : ''}
      <div class="inv-row"><span>è¿”é‡‘ç†ç”±</span><span>${reason}</span></div>
      <div class="inv-row"><span>ä¼æ¥­ã¸ã®è¿”é‡‘é¡</span><span style="color:#c00;font-weight:700">${yen(refundFromCorp)}</span></div>
      ${agReceived>0 ? `<div class="inv-row"><span>å—å–æ¸ˆã¿å ±é…¬</span><span>${yen(agReceived)}</span></div>` : ''}
      <div class="inv-total">
        <span>ã”è¿”é‡‘ã„ãŸã ãé‡‘é¡</span>
        <span class="amt">${yen(claimToAgent)}</span>
      </div>
      <div class="inv-urgent">
        âš ï¸ <strong>è¿”é‡‘æœŸé™ï¼š${dueStr}</strong><br>
        æŒ¯è¾¼å…ˆï¼šæ ªå¼ä¼šç¤¾CORETOã€€GMOã‚ãŠãã‚‰ãƒãƒƒãƒˆéŠ€è¡Œ<br>
        æœŸæ—¥ã‚’éããŸå ´åˆã¯ã€åˆ¥é€”é…å»¶æå®³é‡‘ãŒç™ºç”Ÿã™ã‚‹å ´åˆãŒã‚ã‚Šã¾ã™ã€‚
      </div>
    </div>

    <div class="sec">æ—©æœŸé€€è·å¾Œã®å‡¦ç†ãƒ•ãƒ­ãƒ¼</div>
    <div class="tl">
      <div class="tl-row"><div class="tl-left"><div class="tl-dot r"></div><div class="tl-line"></div></div><div><div class="tl-date">${fd(resignD)}</div><div class="tl-event">ä¼æ¥­ã‹ã‚‰é€€è·é€šçŸ¥ãƒ»è¿”é‡‘é¡ã®é€£çµ¡å—é ˜</div><div class="tl-sub">é€šçŸ¥å†…å®¹ã‚’Kintoneã«ç™»éŒ² â†’ æ¡ˆä»¶ã‚¹ãƒ†ãƒ¼ã‚¿ã‚¹ã‚’ã€Œæ—©æœŸé€€è·ã€ã«æ›´æ–°</div></div></div>
      <div class="tl-row"><div class="tl-left"><div class="tl-dot f"></div><div class="tl-line"></div></div><div><div class="tl-date">å³æ™‚</div><div class="tl-event">ç¿Œæœˆ25æ—¥ãƒãƒƒãƒã‚’è‡ªå‹•ä¿ç•™</div><div class="tl-sub">ã‚¨ãƒ¼ã‚¸ã‚§ãƒ³ãƒˆã¸ã®æŒ¯è¾¼ã‚’è‡ªå‹•ã‚¹ãƒˆãƒƒãƒ— â†’ æœ¬éƒ¨Slackã«é€šçŸ¥</div></div></div>
      <div class="tl-row"><div class="tl-left"><div class="tl-dot o"></div><div class="tl-line"></div></div><div><div class="tl-date">${dueStr}ã¾ã§</div><div class="tl-event">ã‚¨ãƒ¼ã‚¸ã‚§ãƒ³ãƒˆã¸è¿”é‡‘è«‹æ±‚æ›¸é€ä»˜</div><div class="tl-sub">æœ¬è«‹æ±‚æ›¸ã‚’ãƒ¡ãƒ¼ãƒ«ã§é€ä»˜ â†’ ${yen(claimToAgent)} ã®è¿”é‡‘ã‚’è«‹æ±‚</div></div></div>
      <div class="tl-row"><div class="tl-left"><div class="tl-dot b"></div><div class="tl-line"></div></div><div><div class="tl-date">ã‚¨ãƒ¼ã‚¸ã‚§ãƒ³ãƒˆè¿”é‡‘ç¢ºèªå¾Œ</div><div class="tl-event">ä¼æ¥­ã¸è¿”é‡‘å®Ÿè¡Œ</div><div class="tl-sub">ä¼æ¥­ã« ${yen(refundFromCorp)} ã‚’è¿”é‡‘</div></div></div>
      <div class="tl-row"><div class="tl-left"><div class="tl-dot g"></div></div><div><div class="tl-date">å®Œäº†</div><div class="tl-event">æ¡ˆä»¶ã‚¯ãƒ­ãƒ¼ã‚º</div><div class="tl-sub">Kintoneã‚¹ãƒ†ãƒ¼ã‚¿ã‚¹ã‚’ã€Œè¿”é‡‘å®Œäº†ã€ã«æ›´æ–°</div></div></div>
    </div>
  </div>`;

  document.getElementById('rf-result').innerHTML=html;
}

// â•â• å…±é€šHTMLãƒ‘ãƒ¼ãƒ„ â•â•
function heroBox(payout,agName,agId,rnkLabel,rateLabel,payStr){
  return`<div style="background:linear-gradient(135deg,rgba(201,168,76,.08),rgba(201,168,76,.02));border:1px solid rgba(201,168,76,.25);border-radius:12px;padding:20px;margin-bottom:14px">
    <div style="font-size:10px;color:var(--muted);margin-bottom:5px">æŒ¯è¾¼é¡ï¼ˆæ‰‹å–ã‚Šï¼‰</div>
    <div style="font-family:'DM Mono',monospace;font-size:36px;font-weight:500"><span style="font-size:22px;color:var(--gold)">Â¥</span>${Math.round(payout).toLocaleString()}</div>
    <div style="font-size:11px;color:var(--sub);margin-top:8px;line-height:1.8">${agName}ï¼ˆ${agId}ï¼‰ã€€${rnkLabel}ã€€å ±é…¬ç‡ ${rateLabel}<br><span style="color:var(--gold)">â˜… åŸºæº–æ—¥ï¼šå…¨é¡å…¥é‡‘ç¢ºèªæ—¥ã€€ç¿Œæœˆ25æ—¥æŒ¯è¾¼ï¼š${payStr}</span></div>
  </div>`;
}
function mkInst(on,input,payout){if(!on||input<=0)return null;const b=Math.min(input,payout);const f=Math.floor(b*.15);return{base:b,fee:f,net:b-f,remain:payout-b};}
function instHtml(inst,payout,payStr){
  if(!inst)return'';
  return`<div class="sec">å³æ—¥æ‰•ã„å†…è¨³</div>
  <div class="alert ao">âš¡ å³æ—¥æ‰•ã„æ¸ˆã¿é‡‘é¡ã¯ç¿Œ25æ—¥ãƒãƒƒãƒã‹ã‚‰<strong>è‡ªå‹•é™¤å¤–</strong>ã•ã‚Œã¾ã™</div>
  <div class="two">
    <div class="pc inst"><div class="pc-num">âš¡ å³æ—¥æŒ¯è¾¼ï¼ˆæœ¬æ—¥ï¼‰</div><div class="pc-amt" style="color:var(--orange)">${yen(inst.net)}</div><div class="pc-when">å…ƒé‡‘ï¼š${yen(inst.base)}<br>æ‰‹æ•°æ–™15%ï¼šâˆ’${yen(inst.fee)}</div></div>
    <div class="pc"><div class="pc-num">ç¿Œ25æ—¥ãƒãƒƒãƒæ‰•ã„ï¼ˆæ®‹é¡ï¼‰</div><div class="pc-amt">${yen(inst.remain)}</div><div class="pc-when">æŒ¯è¾¼äºˆå®šï¼š${payStr}</div></div>
  </div>`;
}
function hrSchedSimple(payout,inst,joinVal,ref){
  const p1=Math.floor(payout*.5),p2=payout-p1;
  let d1='â€•',d2='â€•';
  if(joinVal){const j=new Date(joinVal);const m1=addM(j,1);m1.setDate(25);d1=fd(m1);const m2=addM(j,ref);m2.setDate(25);d2=fd(m2);}
  let a1=p1,a2=p2;
  if(inst){a1=Math.max(0,p1-inst.base);a2=p2-Math.max(0,inst.base-p1);}
  return`<div class="sec">äººæ 2å›æ‰•ã„ã‚¹ã‚±ã‚¸ãƒ¥ãƒ¼ãƒ«</div>
  <div class="two">
    <div class="pc"><div class="pc-num">ç¬¬1å›ï¼ˆå…¥ç¤¾ç¿Œæœˆ25æ—¥ï¼‰</div><div class="pc-amt">${yen(a1)}</div><div class="pc-when">${d1}<br>âš¡å³æ—¥æ‰•ã„è§£ç¦ï¼šå…¥é‡‘ç¢ºèªå¾Œã‹ã¤å…¥ç¤¾1é€±é–“å¾Œ</div></div>
    <div class="pc"><div class="pc-num">ç¬¬2å›ï¼ˆè¿”æˆ»${ref}ãƒ¶æœˆå¾Œç¿Œæœˆ25æ—¥ï¼‰</div><div class="pc-amt">${yen(a2)}</div><div class="pc-when">${d2}<br>âš¡å³æ—¥æ‰•ã„è§£ç¦ï¼šå…¥ç¤¾1ãƒ¶æœˆå¾Œ</div></div>
  </div>`;
}
function schedTl(fpD,p25D){
  if(!fpD)return`<div class="alert ao">ğŸ“… å…¨é¡å…¥é‡‘ç¢ºèªæ—¥ã‚’å…¥åŠ›ã™ã‚‹ã¨æŒ¯è¾¼ã‚¹ã‚±ã‚¸ãƒ¥ãƒ¼ãƒ«ãŒè¡¨ç¤ºã•ã‚Œã¾ã™</div>`;
  const chkD=addM(fpD,1);chkD.setDate(1);
  const meiD=addM(fpD,1);meiD.setDate(15);
  return`<div class="sec">æ”¯æ‰•ã„ã‚¹ã‚±ã‚¸ãƒ¥ãƒ¼ãƒ«ï¼ˆ${fd(fpD)} åŸºæº–ï¼‰</div>
  <div class="tl">
    <div class="tl-row"><div class="tl-left"><div class="tl-dot g"></div><div class="tl-line"></div></div><div><div class="tl-date">${fd(fpD)}</div><div class="tl-event">âœ… å…¨é¡å…¥é‡‘ç¢ºèª â†’ å ±é…¬è¨ˆç®—è‡ªå‹•å®Ÿè¡Œ</div></div></div>
    <div class="tl-row"><div class="tl-left"><div class="tl-dot f"></div><div class="tl-line"></div></div><div><div class="tl-date">æœˆæœ«</div><div class="tl-event">æœˆæœ«ç· ã‚ï¼ˆè‡ªå‹•ï¼‰</div></div></div>
    <div class="tl-row"><div class="tl-left"><div class="tl-dot b"></div><div class="tl-line"></div></div><div><div class="tl-date">${fd(chkD)}</div><div class="tl-event">8é …ç›®è‡ªå‹•ãƒã‚§ãƒƒã‚¯ â†’ ã‚¨ãƒ©ãƒ¼ã®ã¿é€šçŸ¥</div></div></div>
    <div class="tl-row"><div class="tl-left"><div class="tl-dot f"></div><div class="tl-line"></div></div><div><div class="tl-date">${fd(meiD)}</div><div class="tl-event">æ”¯æ‰•æ˜ç´°æ›¸ è‡ªå‹•ç™ºè¡Œãƒ»é€ä»˜</div></div></div>
    <div class="tl-row"><div class="tl-left"><div class="tl-dot o"></div></div><div><div class="tl-date" style="color:var(--orange)">${fd(p25D)}</div><div class="tl-event" style="font-weight:700">ğŸ¦ éŠ€è¡ŒæŒ¯è¾¼å®Ÿè¡Œï¼ˆè‡ªå‹•ï¼‰</div></div></div>
  </div>`;
}
function taxNote(r){
  const M=1e6;
  if(r<=M)return`<div class="tax-note">æºæ³‰å¾´åï¼š<strong>${yen(r)} Ã— 10.21% = ${yen(Math.floor(r*.1021))}</strong>ï¼ˆ100ä¸‡å††ä»¥ä¸‹ï¼‰</div>`;
  const t1=Math.floor(M*.1021),t2=Math.floor((r-M)*.2042);
  return`<div class="tax-note">æºæ³‰å¾´åï¼ˆç´¯é€²ï¼‰ï¼š<strong>100ä¸‡å††ä»¥ä¸‹ ${yen(t1)}</strong> ï¼‹ <strong>è¶…éåˆ† ${yen(r-M)} Ã— 20.42% = ${yen(t2)}</strong>ã€€åˆè¨ˆï¼š<strong>${yen(t1+t2)}</strong></div>`;
}
function splitCard(name,id,role,rate,net,color,note){
  return`<div class="sc"><div><div style="font-size:11px;font-weight:600;color:${color}">${name}</div><div style="font-size:10px;color:var(--muted);font-family:'DM Mono',monospace">${id} / ${role}</div></div><div style="text-align:right"><div style="font-size:10px;color:var(--muted)">${pct(rate)} / ${note}</div><div style="font-family:'DM Mono',monospace;font-size:15px;font-weight:600;color:${color}">${yen(net)}</div></div></div>`;
}
function autoCheck(){
  const items=[['ğŸ’°','å…¥é‡‘ç¢ºèª'],['ğŸ“Š','å ±é…¬ç‡ã®å¦¥å½“æ€§'],['âš ï¸','å ±é…¬é¡ã®ç•°å¸¸å€¤'],['ğŸ§®','æºæ³‰å¾´åã®æ­£ç¢ºæ€§'],['ğŸ”','é‡è¤‡æˆç´„ãƒã‚§ãƒƒã‚¯'],['ğŸ“…','æˆç´„æ—¥ã®å¦¥å½“æ€§'],['ğŸ“ˆ','ç•°å¸¸ãªæˆç´„æ•°'],['ğŸ¦','æŒ¯è¾¼å…ˆå£åº§ç¢ºèª']];
  return`<div class="sec" style="margin-top:4px">ç¿Œæœˆ1æ—¥ æ‰¿èªå‰è‡ªå‹•ãƒã‚§ãƒƒã‚¯ï¼ˆ8é …ç›®ï¼‰</div>
  <div class="alert ag">âœ… å…¨é …ç›®ãƒ‘ã‚¹ â†’ æœ¬éƒ¨é€šçŸ¥ãªã—ãƒ»è‡ªå‹•é€²è¡Œã€€ã€€âŒ ã‚¨ãƒ©ãƒ¼æ™‚ã®ã¿Slacké€šçŸ¥ â†’ æ‰‹å‹•å¯¾å¿œ</div>
  <div class="chk-grid">${items.map(([i,t])=>`<div class="chk"><span>${i}</span>${t}</div>`).join('')}</div>`;
}

function resetCalc(){
  ['fee','fullpay','inst-amt','ag-name','ag-id','pt-name','pt-id','mt-name','mt-id','lp-name','lp-id','join-date'].forEach(id=>{const el=document.getElementById(id);if(el)el.value='';});
  ['g-biz','g-deal','g-rank','g-ct','g-pt','g-mt','g-ref','g-inst'].forEach(g=>{const bs=document.querySelectorAll('#'+g+' .tg');bs.forEach(b=>b.classList.remove('on'));if(bs[0])bs[0].classList.add('on');});
  ['sec-partner','sec-corp','sec-mt','sec-inst','sec-hr'].forEach(id=>{const el=document.getElementById(id);if(el)el.classList.add('hidden');});
  document.getElementById('sec-sanmei').classList.remove('hidden');
  document.getElementById('result').innerHTML='<div class="panel"><div class="empty">â¬…ï¸ æ¡ˆä»¶æƒ…å ±ã‚’å…¥åŠ›ã—ã¦ãã ã•ã„</div></div>';
}
function resetRf(){
  ['rf-refund-from-corp','rf-ag-received','rf-join','rf-resign','rf-ag-name','rf-ag-id','rf-corp','rf-person','rf-reason','rf-instant-paid'].forEach(id=>{const el=document.getElementById(id);if(el)el.value='';});
  ['g-rf-paid'].forEach(g=>{const bs=document.querySelectorAll('#'+g+' .tg');bs.forEach(b=>b.classList.remove('on'));if(bs[0])bs[0].classList.add('on');});
  sh('sec-rf-instant-detail',false);
  document.getElementById('rf-result').innerHTML='<div class="panel"><div class="empty">é€€è·æƒ…å ±ã‚’å…¥åŠ›ã—ã¦ãã ã•ã„</div></div>';
}

// â”€â”€ ç´¹ä»‹ãƒªãƒ³ã‚¯ãƒ¢ãƒ¼ãƒ€ãƒ« â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
var _refCurrentCode = '';
function openRefModal() {
  var overlay = document.getElementById('ref-modal-overlay');
  var selector = document.getElementById('ref-code-selector');
  var isExec = (typeof session !== 'undefined' && session && session.hqRole === 'exec')
            || (typeof CURRENT_USER !== 'undefined' && CURRENT_USER && CURRENT_USER.hqRole === 'exec');
  var agentId = (typeof session !== 'undefined' && session && session.userId) ? session.userId
              : (typeof ME !== 'undefined' && ME && ME.id) ? ME.id
              : (typeof AGENT !== 'undefined' && AGENT && AGENT.id) ? AGENT.id : '10012';
  if (isExec) {
    var SPECIAL = ['FOUNDER2026','WELCOME2026','GOLD_START','HR_PRO75'];
    var opts = SPECIAL.map(function(c){ return '<option value="'+c+'">â­ '+c+'</option>'; }).join('');
    selector.innerHTML =
      '<div style="margin-bottom:12px"><div style="font-size:10px;color:var(--sub);font-weight:600;margin-bottom:5px">ã‚³ãƒ¼ãƒ‰ç¨®åˆ¥</div>'
      +'<select id="ref-code-select" onchange="updateRefLink()" style="width:100%;padding:8px 10px;background:var(--card2);border:1px solid var(--border2);border-radius:8px;color:var(--text);font-size:12px;font-family:inherit">'
      +'<option value="'+agentId+'">è‡ªåˆ†ã®IDï¼ˆ'+agentId+'ï¼‰</option>'
      +'<optgroup label="â”€â”€ ç‰¹åˆ¥ã‚³ãƒ¼ãƒ‰ â”€â”€">'+opts+'</optgroup>'
      +'</select></div>';
    _refCurrentCode = agentId;
  } else {
    selector.innerHTML =
      '<div style="display:flex;align-items:center;gap:8px;margin-bottom:12px;padding:8px 12px;background:rgba(201,168,76,.06);border:1px solid rgba(201,168,76,.2);border-radius:8px">'
      +'<span style="font-size:11px;color:var(--muted)">ç´¹ä»‹ã‚³ãƒ¼ãƒ‰ï¼š</span>'
      +'<span style="font-family:\'DM Mono\',monospace;font-size:13px;font-weight:700;color:var(--gold)">'+agentId+'</span>'
      +'</div>';
    _refCurrentCode = agentId;
  }
  updateRefLink();
  overlay.classList.add('open');
}
function updateRefLink() {
  var sel = document.getElementById('ref-code-select');
  if (sel) _refCurrentCode = sel.value;
  var base = location.origin + location.pathname.replace(/[^/]*$/, '') + 'coreto-agent-signup.html';
  var url = base + '?ref=' + encodeURIComponent(_refCurrentCode);
  document.getElementById('ref-url-display').textContent = url;
}
function closeRefModal() {
  document.getElementById('ref-modal-overlay').classList.remove('open');
}
function copyRefLink() {
  var url = document.getElementById('ref-url-display').textContent;
  navigator.clipboard.writeText(url).then(function() {
    var btn = document.querySelector('.ref-copy-btn');
    btn.textContent = 'âœ… ã‚³ãƒ”ãƒ¼ã—ã¾ã—ãŸ';
    setTimeout(function(){ btn.textContent = 'ğŸ“‹ ã‚³ãƒ”ãƒ¼'; }, 2000);
  }).catch(function() {
    var ta = document.createElement('textarea');
    ta.value = url; document.body.appendChild(ta); ta.select();
    document.execCommand('copy'); document.body.removeChild(ta);
  });
}
</script>

<div id="ref-modal-overlay" onclick="if(event.target===this)closeRefModal()">
  <div id="ref-modal">
    <div class="ref-mhdr">
      <div class="ref-mhdr-t">ğŸ”— ç´¹ä»‹ãƒªãƒ³ã‚¯ç™ºè¡Œ</div>
      <button onclick="closeRefModal()" style="background:none;border:none;color:var(--muted);font-size:20px;cursor:pointer;line-height:1">Ã—</button>
    </div>
    <div class="ref-mbody">
      <div style="font-size:11px;color:var(--sub);margin-bottom:14px;line-height:1.8">ã“ã®ãƒªãƒ³ã‚¯ã‹ã‚‰å…¥ä¼šã™ã‚‹ã¨ç´¹ä»‹ã‚³ãƒ¼ãƒ‰ãŒè‡ªå‹•å…¥åŠ›ã•ã‚Œã¾ã™ã€‚</div>
      <div id="ref-code-selector"></div>
      <div style="font-size:10px;color:var(--muted);margin-bottom:4px;font-weight:600;letter-spacing:.5px">ç™ºè¡Œãƒªãƒ³ã‚¯</div>
      <div class="ref-url" id="ref-url-display">â€”</div>
      <button class="ref-copy-btn" onclick="copyRefLink()">ğŸ“‹ ã‚³ãƒ”ãƒ¼</button>
    </div>
  </div>
</div>

<button id="ref-float-btn" onclick="openRefModal()">ğŸ”— ç´¹ä»‹ãƒªãƒ³ã‚¯ç™ºè¡Œ</button>
</body>
</html>
