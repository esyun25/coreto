<!DOCTYPE html>
<html lang="ja">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width,initial-scale=1">
<title>CORETO â€” å°‚ä»»å®…å»ºå£«ç®¡ç†</title>
<style>
@import url('https://fonts.googleapis.com/css2?family=Noto+Sans+JP:wght@300;400;500;700&family=DM+Mono:wght@400;500&family=Syne:wght@700;800&display=swap');
*{box-sizing:border-box;margin:0;padding:0}
:root{
  --bg:#07090f;--card:#0f1119;--card2:#141720;--border:#1e2235;--border2:#252a3d;
  --gold:#c9a84c;--blue:#4f9cf9;--green:#34d399;--red:#f87171;--orange:#fb923c;
  --purple:#a78bfa;--teal:#2dd4bf;--muted:#4a5270;--sub:#7a849e;--text:#e2e6f3;
}
html,body{min-height:100%;font-family:'Noto Sans JP',sans-serif;background:var(--bg);color:var(--text)}
/* Header */
.hdr{height:54px;display:flex;align-items:center;justify-content:space-between;
  padding:0 26px;border-bottom:1px solid var(--border);
  background:rgba(7,9,15,.96);position:sticky;top:0;z-index:100}
.logo{font-family:'Syne',sans-serif;font-size:17px;font-weight:800;color:var(--gold);letter-spacing:3px}
/* Tabs */
.tabs{display:flex;border-bottom:1px solid var(--border);background:var(--card);
  padding:0 24px;position:sticky;top:54px;z-index:90}
.tab{padding:14px 22px;font-size:12px;font-weight:700;color:var(--muted);cursor:pointer;
  border-bottom:2px solid transparent;transition:.15s;margin-bottom:-1px}
.tab:hover{color:var(--sub)}
.tab.on{color:var(--gold);border-bottom-color:var(--gold)}
/* Layout */
.main{max-width:1100px;margin:0 auto;padding:28px 24px 80px}
/* Cards */
.card{background:var(--card);border:1px solid var(--border);border-radius:14px;margin-bottom:16px}
.ch{padding:13px 20px;border-bottom:1px solid var(--border);
  display:flex;align-items:center;justify-content:space-between}
.ch-t{font-size:9px;color:var(--muted);letter-spacing:2px;text-transform:uppercase;
  display:flex;align-items:center;gap:8px}
.ch-t::before{content:'';width:3px;height:11px;border-radius:2px;background:var(--gold)}
.cb{padding:18px 20px}
/* KPI */
.kpi-row{display:grid;grid-template-columns:repeat(5,1fr);gap:12px;margin-bottom:20px}
.kpi{background:var(--card);border:1px solid var(--border);border-radius:12px;padding:14px 16px}
.kv{font-family:'DM Mono',monospace;font-size:24px;font-weight:500;margin-bottom:3px}
.kl{font-size:10px;color:var(--muted)}
/* Pills */
.pill{display:inline-flex;align-items:center;gap:4px;padding:3px 10px;
  border-radius:6px;font-size:9px;font-weight:700}
.pg{background:rgba(52,211,153,.13);color:var(--green);border:1px solid rgba(52,211,153,.3)}
.pb{background:rgba(79,156,249,.12);color:var(--blue);border:1px solid rgba(79,156,249,.25)}
.pr{background:rgba(248,113,113,.12);color:var(--red);border:1px solid rgba(248,113,113,.3)}
.pm{background:rgba(74,82,112,.15);color:var(--sub);border:1px solid var(--border2)}
.pgold{background:rgba(201,168,76,.12);color:var(--gold);border:1px solid rgba(201,168,76,.3)}
/* Table */
.tbl{width:100%;border-collapse:collapse}
.tbl th{padding:9px 14px;font-size:9px;color:var(--muted);font-weight:700;letter-spacing:.5px;
  text-transform:uppercase;border-bottom:1px solid var(--border);background:var(--card2);text-align:left}
.tbl td{padding:11px 14px;border-bottom:1px solid rgba(30,34,53,.5);font-size:12px;vertical-align:middle}
.tbl tr:last-child td{border:none}
.tbl tr:hover td{background:rgba(255,255,255,.013)}
.mono{font-family:'DM Mono',monospace}
/* Buttons */
.btn{padding:9px 18px;border-radius:9px;font-size:11px;font-weight:700;cursor:pointer;
  font-family:'Noto Sans JP',sans-serif;transition:.15s;border:none;
  display:inline-flex;align-items:center;gap:6px}
.btn-gold{background:linear-gradient(135deg,var(--gold),#a07830);color:#000}
.btn-blue{background:linear-gradient(135deg,var(--blue),#3070c0);color:#fff}
.btn-ghost{background:transparent;border:1px solid var(--border2);color:var(--sub)}
.btn-ghost:hover{color:var(--text);border-color:var(--sub)}
.btn-danger{background:rgba(248,113,113,.12);border:1px solid rgba(248,113,113,.3);color:var(--red)}
.btn-sm{padding:5px 12px;font-size:10px;border-radius:7px}
.btn-ok{background:rgba(52,211,153,.12);border:1px solid rgba(52,211,153,.3);color:var(--green)}
/* Input */
.field{margin-bottom:12px}
.field label{display:block;font-size:10px;color:var(--sub);margin-bottom:5px;font-weight:600}
.field input,.field select{width:100%;background:#090b13;border:1px solid var(--border2);
  border-radius:9px;padding:9px 13px;color:var(--text);font-size:13px;
  font-family:'Noto Sans JP',sans-serif;outline:none;transition:.15s}
.field input:focus,.field select:focus{border-color:var(--blue)}
/* Alert */
.al{display:flex;align-items:flex-start;gap:10px;padding:12px 16px;border-radius:10px;
  margin-bottom:14px;font-size:12px;line-height:1.7}
.al-warn{background:rgba(201,168,76,.07);border:1px solid rgba(201,168,76,.2)}
.al-info{background:rgba(79,156,249,.07);border:1px solid rgba(79,156,249,.2)}
.al-ok{background:rgba(52,211,153,.07);border:1px solid rgba(52,211,153,.2)}
/* Fee input */
.fee-cell{display:flex;align-items:center;gap:6px}
.fee-input{width:90px;background:#090b13;border:1px solid var(--border2);border-radius:7px;
  padding:5px 10px;color:var(--gold);font-family:'DM Mono',monospace;font-size:13px;
  font-weight:500;outline:none;text-align:right}
.fee-input:focus{border-color:var(--gold)}
/* Status dot */
.dot-live{width:7px;height:7px;border-radius:50%;background:var(--green);
  display:inline-block;box-shadow:0 0 0 3px rgba(52,211,153,.2)}
.dot-none{width:7px;height:7px;border-radius:50%;background:var(--muted);display:inline-block}
/* Modal */
.modal-bg{display:none;position:fixed;inset:0;background:rgba(0,0,0,.7);
  z-index:200;align-items:center;justify-content:center}
.modal-bg.open{display:flex}
.modal{background:var(--card);border:1px solid var(--border);border-radius:16px;
  padding:28px;width:460px;max-width:95vw}
.modal-title{font-family:'Syne',sans-serif;font-size:18px;font-weight:800;margin-bottom:6px}
.modal-sub{font-size:12px;color:var(--sub);margin-bottom:20px;line-height:1.7}
.modal-actions{display:flex;gap:10px;justify-content:flex-end;margin-top:20px}
/* æ³•ä»¤æ¯”ç‡ã‚²ãƒ¼ã‚¸ */
.ratio-bar-wrap{height:10px;background:var(--border2);border-radius:5px;overflow:hidden;margin:8px 0}
.ratio-bar{height:10px;border-radius:5px;transition:width .5s}
::-webkit-scrollbar{width:4px}::-webkit-scrollbar-thumb{background:var(--border2);border-radius:2px}
</style>
</head>
<body>

<div class="hdr">
  <div style="display:flex;align-items:center;gap:12px">
    <div class="logo">CORETO</div>
    <div style="width:1px;height:18px;background:var(--border2)"></div>
    <span style="font-size:10px;color:var(--muted);letter-spacing:1px">å°‚ä»»å®…å»ºå£«ç®¡ç†</span>
  </div>
  <button class="btn btn-ghost btn-sm" onclick="location.href='coreto-hub.html'">ğŸ  ãƒ›ãƒ¼ãƒ </button>
</div>

<div class="tabs">
  <div class="tab on" onclick="showTab(0,this)">ğŸ›ï¸ å°‚ä»»å®…å»ºå£«ä¸€è¦§</div>
  <div class="tab"    onclick="showTab(1,this)">ğŸ“Š ITé‡èª¬å ±é…¬å˜ä¾¡</div>
  <div class="tab"    onclick="showTab(2,this)">ğŸ“‹ é‡èª¬å®Ÿç¸¾</div>
  <div class="tab"    onclick="showTab(3,this)">âš–ï¸ æ³•ä»¤æ¯”ç‡ãƒã‚§ãƒƒã‚¯</div>
</div>

<div class="main">

<!-- â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• TAB 0: å°‚ä»»ä¸€è¦§ â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• -->
<div id="tab-0">

  <div class="kpi-row">
    <div class="kpi">
      <div class="kv" style="color:var(--gold)" id="kpi-sennin">0</div>
      <div class="kl">å°‚ä»»å®…å»ºå£«ï¼ˆã‚¢ã‚¯ãƒ†ã‚£ãƒ–ï¼‰</div>
    </div>
    <div class="kpi">
      <div class="kv" style="color:var(--blue)" id="kpi-nintei">0</div>
      <div class="kl">æœ¬éƒ¨èªå®šï¼ˆé‡èª¬å¯¾å¿œå¯ï¼‰</div>
    </div>
    <div class="kpi">
      <div class="kv" style="color:var(--muted)" id="kpi-fuakutiv">0</div>
      <div class="kl">ä¸€èˆ¬ï¼ˆé‡èª¬å¯¾å¿œä¸å¯ï¼‰</div>
    </div>
    <div class="kpi">
      <div class="kv" style="color:var(--green)" id="kpi-jisshi">0</div>
      <div class="kl">ä»Šæœˆé‡èª¬å®Ÿæ–½ä»¶æ•°</div>
    </div>
    <div class="kpi">
      <div class="kv" style="color:var(--orange)" id="kpi-waiting">0</div>
      <div class="kl">é‡èª¬å¾…ã¡ï¼ˆæœªå‰²å½“ï¼‰</div>
    </div>
  </div>

  <div class="al al-warn">
    âš–ï¸ <div>
      <strong style="color:var(--gold)">å®…å»ºæ¥­æ³• ç¬¬31æ¡ã®3</strong> â€” äº‹å‹™æ‰€ã®å¾“æ¥­å“¡5åã«ã¤ã1åä»¥ä¸Šã®<strong>å°‚ä»»</strong>ã®å®…åœ°å»ºç‰©å–å¼•å£«ã®è¨­ç½®ãŒç¾©å‹™ä»˜ã‘ã‚‰ã‚Œã¦ã„ã¾ã™ã€‚
      å°‚ä»»å®…å»ºå£«ã®è§£é™¤ã¯å¿…ãšæ³•ä»¤æ¯”ç‡ãƒã‚§ãƒƒã‚¯ã‚’ç¢ºèªã—ã¦ã‹ã‚‰è¡Œã£ã¦ãã ã•ã„ã€‚
      <strong style="color:var(--red)">è§£é™¤æ“ä½œã¯ç®¡ç†è·ä»¥ä¸Šã®ã¿å®Ÿè¡Œå¯èƒ½ã§ã™ã€‚</strong>
    </div>
  </div>

  <div class="card">
    <div class="ch">
      <div class="ch-t">å®…å»ºå£«ç™»éŒ²ä¸€è¦§</div>
      <div style="display:flex;gap:8px">
        <input type="text" id="search-takken" placeholder="IDãƒ»æ°åã§æ¤œç´¢"
               oninput="filterTakken()"
               style="background:#090b13;border:1px solid var(--border2);color:var(--text);
                      padding:5px 12px;border-radius:7px;font-size:11px;outline:none;width:160px">
        <button class="btn btn-blue btn-sm" onclick="openAddModal()">ï¼‹ å®…å»ºå£«ã‚’è¿½åŠ </button>
        <button class="btn btn-ghost btn-sm" onclick="exportCSV()">ğŸ“¥ CSV</button>
      </div>
    </div>
    <div style="overflow-x:auto">
      <table class="tbl" id="takken-table">
        <thead><tr>
          <th>ã‚¨ãƒ¼ã‚¸ã‚§ãƒ³ãƒˆID</th><th>æ°å</th><th>ç¨®åˆ¥</th><th>å®…å»ºå£«è¨¼ç•ªå·</th>
          <th>ç™»éŒ²éƒ½é“åºœçœŒ</th><th>å°‚ä»»ã‚¹ãƒ†ãƒ¼ã‚¿ã‚¹</th><th>é‡èª¬å¯¾å¿œ</th>
          <th>é‡èª¬å˜ä¾¡</th><th>æœˆä¼šè²»</th><th>ä»Šæœˆå®Ÿæ–½</th><th>å°‚ä»»ç™»éŒ²æ—¥</th><th>æ“ä½œ</th>
        </tr></thead>
        <tbody id="takken-tbody"></tbody>
      </table>
    </div>
  </div>
</div>

<!-- â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• TAB 1: å ±é…¬å˜ä¾¡è¨­å®š â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• -->
<div id="tab-1" style="display:none">

  <div class="al al-info">
    â„¹ï¸ <div>
      ITé‡èª¬1ä»¶ã‚ãŸã‚Šã®å ±é…¬å˜ä¾¡ã‚’ã‚¨ãƒ¼ã‚¸ã‚§ãƒ³ãƒˆã”ã¨ã«è¨­å®šã—ã¾ã™ã€‚
      å˜ä¾¡ã¯çµŒé¨“ãƒ»ã‚¹ã‚­ãƒ«ãƒ»ç¨¼åƒé »åº¦ãªã©ã‚’è€ƒæ…®ã—ã¦æœ¬éƒ¨ãŒæ±ºå®šã—ã¾ã™ã€‚å¤‰æ›´ã¯ãƒªã‚¢ãƒ«ã‚¿ã‚¤ãƒ ã§åæ˜ ã•ã‚Œã¾ã™ã€‚
    </div>
  </div>

  <div class="card">
    <div class="ch">
      <div class="ch-t">é‡èª¬å ±é…¬å˜ä¾¡ä¸€è¦§</div>
      <div style="display:flex;align-items:center;gap:10px">
        <div style="font-size:11px;color:var(--muted)">ãƒ‡ãƒ•ã‚©ãƒ«ãƒˆå˜ä¾¡</div>
        <div style="display:flex;align-items:center;gap:5px">
          <span style="color:var(--sub);font-size:11px">Â¥</span>
          <input type="number" id="default-fee" value="5000" step="500" min="0"
                 class="fee-input" style="width:80px"
                 onchange="applyDefaultFee()">
          <button class="btn btn-ghost btn-sm" onclick="applyDefaultFee()">å…¨å“¡ã«é©ç”¨</button>
        </div>
      </div>
    </div>
    <div style="overflow-x:auto">
      <table class="tbl">
        <thead><tr>
          <th>ã‚¨ãƒ¼ã‚¸ã‚§ãƒ³ãƒˆID</th><th>æ°å</th><th>å°‚ä»»ã‚¹ãƒ†ãƒ¼ã‚¿ã‚¹</th><th>ä»Šæœˆå®Ÿæ–½ä»¶æ•°</th>
          <th>é‡èª¬å ±é…¬å˜ä¾¡ï¼ˆ1ä»¶ã‚ãŸã‚Šï¼‰</th><th>ä»Šæœˆå ±é…¬åˆè¨ˆï¼ˆè¦‹è¾¼ï¼‰</th><th>å¤‰æ›´å±¥æ­´</th>
        </tr></thead>
        <tbody id="fee-tbody"></tbody>
      </table>
    </div>
  </div>

  <div class="card">
    <div class="ch"><div class="ch-t">å˜ä¾¡å¤‰æ›´ãƒ­ã‚°</div><span class="pill pm">ç›´è¿‘10ä»¶</span></div>
    <div style="overflow-x:auto">
      <table class="tbl">
        <thead><tr><th>å¤‰æ›´æ—¥æ™‚</th><th>å¯¾è±¡ã‚¨ãƒ¼ã‚¸ã‚§ãƒ³ãƒˆ</th><th>å¤‰æ›´å‰</th><th>å¤‰æ›´å¾Œ</th><th>å¤‰æ›´è€…</th></tr></thead>
        <tbody id="fee-log-tbody">
          <tr>
            <td class="mono" style="font-size:10px">2026/02/15 14:32</td>
            <td>å±±ç”° èª ï¼ˆ10012ï¼‰</td>
            <td class="mono" style="color:var(--muted)">Â¥5,000</td>
            <td class="mono" style="color:var(--gold)">Â¥6,000</td>
            <td style="font-size:10px;color:var(--sub)">æœ¬éƒ¨ ç®¡ç†è· ç”°æ‘</td>
          </tr>
          <tr>
            <td class="mono" style="font-size:10px">2026/02/10 10:15</td>
            <td>ä½è—¤ èŠ±å­ï¼ˆ10008ï¼‰</td>
            <td class="mono" style="color:var(--muted)">Â¥4,500</td>
            <td class="mono" style="color:var(--gold)">Â¥5,000</td>
            <td style="font-size:10px;color:var(--sub)">æœ¬éƒ¨ ç®¡ç†è· ç”°æ‘</td>
          </tr>
        </tbody>
      </table>
    </div>
  </div>
</div>

<!-- â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• TAB 2: é‡èª¬å®Ÿç¸¾ â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• -->
<div id="tab-2" style="display:none">

  <div style="display:flex;gap:10px;margin-bottom:16px;align-items:center">
    <select id="rec-month" onchange="renderRecords()"
      style="background:#090b13;border:1px solid var(--border2);color:var(--text);
             padding:7px 12px;border-radius:8px;font-size:12px;outline:none">
      <option value="2026-02">2026å¹´2æœˆ</option>
      <option value="2026-01">2026å¹´1æœˆ</option>
      <option value="2025-12">2025å¹´12æœˆ</option>
    </select>
    <button class="btn btn-ghost btn-sm" onclick="exportRecCSV()">ğŸ“¥ CSV</button>
  </div>

  <div style="display:grid;grid-template-columns:repeat(4,1fr);gap:12px;margin-bottom:20px">
    <div class="kpi"><div class="kv" style="color:var(--blue)" id="rec-total">0</div><div class="kl">é‡èª¬å®Ÿæ–½ä»¶æ•°</div></div>
    <div class="kpi"><div class="kv" style="color:var(--gold)" id="rec-pay">Â¥0</div><div class="kl">é‡èª¬å ±é…¬åˆè¨ˆ</div></div>
    <div class="kpi"><div class="kv" style="color:var(--green)" id="rec-agents">0</div><div class="kl">å®Ÿæ–½æ‹…å½“è€…æ•°</div></div>
    <div class="kpi"><div class="kv" style="color:var(--purple)" id="rec-avg">Â¥0</div><div class="kl">å¹³å‡å˜ä¾¡</div></div>
  </div>

  <div class="card">
    <div class="ch"><div class="ch-t">é‡èª¬å®Ÿæ–½è¨˜éŒ²</div></div>
    <div style="overflow-x:auto">
      <table class="tbl">
        <thead><tr>
          <th>æ—¥æ™‚</th><th>æ¡ˆä»¶ID</th><th>é¡§å®¢å</th><th>ç‰©ä»¶</th>
          <th>æ‹…å½“å®…å»ºå£«</th><th>å˜ä¾¡</th><th>ã‚¹ãƒ†ãƒ¼ã‚¿ã‚¹</th>
        </tr></thead>
        <tbody id="rec-tbody"></tbody>
      </table>
    </div>
  </div>
</div>

<!-- â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• TAB 3: æ³•ä»¤æ¯”ç‡ â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• -->
<div id="tab-3" style="display:none">

  <div class="al al-warn">
    âš–ï¸ <div>
      <strong style="color:var(--gold)">å®…å»ºæ¥­æ³•ç¬¬31æ¡ã®3ç¬¬1é …</strong> â€” äº‹å‹™æ‰€ã«ç½®ãå°‚ä»»ã®å®…åœ°å»ºç‰©å–å¼•å£«ã®æ•°ã¯ã€
      <strong>æ¥­å‹™ã«å¾“äº‹ã™ã‚‹è€…5åã«ã¤ã1åä»¥ä¸Š</strong>ã¨ã™ã‚‹ã€‚
      ã“ã®æ¯”ç‡ã‚’ä¸‹å›ã‚‹å ´åˆã€æ¥­å‹™æ”¹å–„æŒ‡ç¤ºãƒ»æ¥­å‹™åœæ­¢å‡¦åˆ†ã®å¯¾è±¡ã¨ãªã‚Šã¾ã™ã€‚
    </div>
  </div>

  <div class="card">
    <div class="ch"><div class="ch-t">ç¾åœ¨ã®æ³•ä»¤æ¯”ç‡</div></div>
    <div class="cb">
      <div style="display:grid;grid-template-columns:1fr 1fr;gap:24px">
        <div>
          <div style="font-size:12px;color:var(--sub);margin-bottom:8px">äº‹å‹™æ‰€å¾“æ¥­å“¡æ•°ï¼ˆæ¥­å¾“è€…ï¼‰</div>
          <div style="font-family:'DM Mono',monospace;font-size:40px;font-weight:700;color:var(--text)" id="law-total">24</div>
          <div style="font-size:10px;color:var(--muted);margin-top:4px">ç™»éŒ²ã‚¨ãƒ¼ã‚¸ã‚§ãƒ³ãƒˆå…¨æ•°</div>
        </div>
        <div>
          <div style="font-size:12px;color:var(--sub);margin-bottom:8px">å¿…è¦å°‚ä»»å®…å»ºå£«æ•°ï¼ˆÃ·5 åˆ‡ä¸Šï¼‰</div>
          <div style="font-family:'DM Mono',monospace;font-size:40px;font-weight:700;color:var(--orange)" id="law-required">5</div>
          <div style="font-size:10px;color:var(--muted);margin-top:4px">æœ€ä½å¿…è¦äººæ•°</div>
        </div>
      </div>

      <div style="margin:20px 0 8px">
        <div style="display:flex;justify-content:space-between;font-size:12px;margin-bottom:4px">
          <span style="color:var(--sub)">ç¾åœ¨ã®å°‚ä»»å®…å»ºå£«æ•°</span>
          <span id="law-current-label" style="font-weight:700">0å</span>
        </div>
        <div class="ratio-bar-wrap">
          <div class="ratio-bar" id="law-bar" style="width:0%;background:var(--green)"></div>
        </div>
        <div style="display:flex;justify-content:space-between;font-size:10px;color:var(--muted);margin-top:3px">
          <span>0</span>
          <span id="law-required-label">æœ€ä½ 5å</span>
        </div>
      </div>

      <div id="law-status-box" style="padding:12px 16px;border-radius:10px;font-size:13px;font-weight:700;text-align:center;margin-top:16px">
        <!-- JS ã§æç”» -->
      </div>
    </div>
  </div>

  <div class="card">
    <div class="ch">
      <div class="ch-t">å°‚ä»»è§£é™¤ã‚·ãƒŸãƒ¥ãƒ¬ãƒ¼ã‚·ãƒ§ãƒ³</div>
      <span class="pill pm">è§£é™¤å‰ã«å¿…ãšç¢ºèª</span>
    </div>
    <div class="cb">
      <div style="font-size:12px;color:var(--sub);margin-bottom:12px">
        ç‰¹å®šã®ã‚¨ãƒ¼ã‚¸ã‚§ãƒ³ãƒˆã‚’å°‚ä»»ã‹ã‚‰è§£é™¤ã—ãŸå ´åˆã®æ¯”ç‡ã‚’äº‹å‰ç¢ºèªã§ãã¾ã™ã€‚
      </div>
      <div style="display:flex;gap:10px;align-items:flex-end;margin-bottom:14px">
        <div style="flex:1" class="field" style="margin:0">
          <label>è§£é™¤äºˆå®šã‚¨ãƒ¼ã‚¸ã‚§ãƒ³ãƒˆ</label>
          <select id="sim-agent" style="width:100%;background:#090b13;border:1px solid var(--border2);
                  color:var(--text);padding:8px 12px;border-radius:8px;font-size:12px;outline:none">
            <option value="">â€” é¸æŠ â€”</option>
          </select>
        </div>
        <button class="btn btn-ghost" onclick="runSim()">ã‚·ãƒŸãƒ¥ãƒ¬ãƒ¼ã‚·ãƒ§ãƒ³</button>
      </div>
      <div id="sim-result" style="display:none;padding:14px;background:var(--card2);border-radius:10px;font-size:12px;line-height:2"></div>
    </div>
  </div>
</div>

</div><!-- /main -->

<!-- â•â•â•â• å°‚ä»»è§£é™¤ Modal â•â•â•â• -->
<div class="modal-bg" id="revoke-modal">
  <div class="modal">
    <div class="modal-title" style="color:var(--red)">âš ï¸ å°‚ä»»ã‚¹ãƒ†ãƒ¼ã‚¿ã‚¹ã®è§£é™¤</div>
    <div class="modal-sub">
      ã“ã®æ“ä½œã¯<strong>ç®¡ç†è·ä»¥ä¸Šã®ã¿</strong>å®Ÿè¡Œã§ãã¾ã™ã€‚è§£é™¤å¾Œã¯é€šå¸¸æœˆä¼šè²»ï¼ˆãƒ–ãƒ­ãƒ³ã‚ºÂ¥980/æœˆï¼‰ãŒç™ºç”Ÿã—ã¾ã™ã€‚<br>
      æ¥­æ³•ä¸Šã®æ¯”ç‡ã‚’å¿…ãšç¢ºèªã—ã¦ãã ã•ã„ã€‚
    </div>
    <div id="revoke-target-info" style="background:var(--card2);border-radius:10px;padding:14px;font-size:12px;line-height:2;margin-bottom:16px"></div>
    <div class="field">
      <label>è§£é™¤ç†ç”± <span style="color:var(--red)">*</span></label>
      <select id="revoke-reason" style="width:100%;background:#090b13;border:1px solid var(--border2);
              color:var(--text);padding:8px 12px;border-radius:8px;font-size:12px;outline:none">
        <option value="">â€” é¸æŠã—ã¦ãã ã•ã„ â€”</option>
        <option>ä»–ç¤¾ã¸ã®å°±è·ãƒ»è»¢è·</option>
        <option>æ¥­å‹™å§”è¨—å¥‘ç´„ã®çµ‚äº†</option>
        <option>æœ¬äººç”³ã—å‡ºã«ã‚ˆã‚‹è§£é™¤</option>
        <option>è¦ç´„é•åã«ã‚ˆã‚‹å¼·åˆ¶è§£é™¤</option>
        <option>ãã®ä»–</option>
      </select>
    </div>
    <div class="field">
      <label>ç¢ºèªã®ãŸã‚ã‚¨ãƒ¼ã‚¸ã‚§ãƒ³ãƒˆIDã‚’å…¥åŠ›</label>
      <input type="text" id="revoke-confirm-id" placeholder="ä¾‹ï¼š10012"
             style="font-family:'DM Mono',monospace" oninput="checkRevokeConfirm()">
    </div>
    <div id="revoke-law-warn" style="display:none;padding:10px 14px;background:rgba(248,113,113,.1);
         border:1px solid rgba(248,113,113,.3);border-radius:8px;font-size:11px;color:var(--red);margin-bottom:12px">
      âš ï¸ ã“ã®è§£é™¤ã«ã‚ˆã‚Šæ³•ä»¤æ¯”ç‡ï¼ˆ5åã«ã¤ã1åï¼‰ã‚’ä¸‹å›ã‚Šã¾ã™ã€‚<br>
      ä»£æ›¿ã®å°‚ä»»å®…å»ºå£«ã‚’ç¢ºä¿ã—ã¦ã‹ã‚‰è§£é™¤ã—ã¦ãã ã•ã„ã€‚
    </div>
    <div class="modal-actions">
      <button class="btn btn-ghost" onclick="closeRevokeModal()">ã‚­ãƒ£ãƒ³ã‚»ãƒ«</button>
      <button class="btn btn-danger" id="revoke-exec-btn" disabled onclick="execRevoke()">è§£é™¤ã‚’å®Ÿè¡Œã™ã‚‹</button>
    </div>
  </div>
</div>

<!-- â•â•â•â• å®…å»ºå£«è¿½åŠ  Modal â•â•â•â• -->
<div class="modal-bg" id="add-modal">
  <div class="modal">
    <div class="modal-title">ğŸ›ï¸ å®…å»ºå£«æƒ…å ±ã®ç™»éŒ²</div>
    <div class="modal-sub">æ—¢å­˜ã‚¨ãƒ¼ã‚¸ã‚§ãƒ³ãƒˆã«å®…å»ºå£«æƒ…å ±ã¨å°‚ä»»ã‚¹ãƒ†ãƒ¼ã‚¿ã‚¹ã‚’ä»˜ä¸ã—ã¾ã™ã€‚</div>
    <div class="field">
      <label>ã‚¨ãƒ¼ã‚¸ã‚§ãƒ³ãƒˆID</label>
      <input type="text" id="add-agent-id" placeholder="ä¾‹ï¼š10012" style="font-family:'DM Mono',monospace" oninput="lookupAgent()">
    </div>
    <div id="add-agent-info" style="display:none;padding:10px 14px;background:var(--card2);border-radius:8px;font-size:12px;margin-bottom:12px;line-height:1.9"></div>
    <div class="field">
      <label>å®…å»ºå£«è¨¼ç•ªå·</label>
      <input type="text" id="add-license-no" placeholder="ä¾‹ï¼šæ±äº¬(1)ç¬¬123456å·" style="font-family:'DM Mono',monospace">
    </div>
    <div class="field">
      <label>ç™»éŒ²éƒ½é“åºœçœŒ</label>
      <select id="add-pref" style="width:100%;background:#090b13;border:1px solid var(--border2);
              color:var(--text);padding:8px 12px;border-radius:8px;font-size:12px;outline:none">
        <option>æ±äº¬éƒ½</option><option>ç¥å¥ˆå·çœŒ</option><option>å¤§é˜ªåºœ</option>
        <option>æ„›çŸ¥çœŒ</option><option>ç¦å²¡çœŒ</option><option>ãã®ä»–</option>
      </select>
    </div>
    <div class="field">
      <label>ã‚¹ãƒ†ãƒ¼ã‚¿ã‚¹</label>
      <select id="add-status" style="width:100%;background:#090b13;border:1px solid var(--border2);
              color:var(--text);padding:8px 12px;border-radius:8px;font-size:12px;outline:none">
        <option value="sennin">å°‚ä»»å®…å»ºå£«ï¼ˆæœˆä¼šè²»ç„¡æ–™ãƒ»é‡èª¬å¯¾å¿œå¯ï¼‰</option>
        <option value="nintei">æœ¬éƒ¨èªå®šï¼ˆé‡èª¬å¯¾å¿œå¯ãƒ»æœˆä¼šè²»ã‚ã‚Šï¼‰</option>
        <option value="general">ä¸€èˆ¬ï¼ˆé‡èª¬å¯¾å¿œä¸å¯ï¼‰</option>
      </select>
    </div>
    <div class="field">
      <label>ITé‡èª¬å ±é…¬å˜ä¾¡ï¼ˆ1ä»¶ã‚ãŸã‚Šï¼‰</label>
      <div style="display:flex;align-items:center;gap:8px">
        <span style="color:var(--sub)">Â¥</span>
        <input type="number" id="add-fee" value="5000" step="500" min="0"
               style="flex:1;font-family:'DM Mono',monospace;color:var(--gold)">
      </div>
    </div>
    <div class="modal-actions">
      <button class="btn btn-ghost" onclick="closeAddModal()">ã‚­ãƒ£ãƒ³ã‚»ãƒ«</button>
      <button class="btn btn-gold" onclick="execAdd()">ç™»éŒ²ã™ã‚‹</button>
    </div>
  </div>
</div>

<script>
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
//  ãƒ‡ãƒ¼ã‚¿
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
var TAKKEN = [
  { id:'10012', name:'å±±ç”° èª ',   agType:'RE', licNo:'æ±äº¬(1)ç¬¬123456å·', pref:'æ±äº¬éƒ½',
    status:'sennin', itOk:true, fee:6000, monthCount:4, registeredAt:'2025/11/01', fee0:false },
  { id:'10008', name:'ä½è—¤ èŠ±å­', agType:'RE', licNo:'ç¥å¥ˆå·(3)ç¬¬789012å·', pref:'ç¥å¥ˆå·çœŒ',
    status:'sennin', itOk:true, fee:5000, monthCount:6, registeredAt:'2025/10/15', fee0:false },
  { id:'10023', name:'éˆ´æœ¨ å¥å¤ª', agType:'RE', licNo:'æ±äº¬(2)ç¬¬345678å·', pref:'æ±äº¬éƒ½',
    status:'nintei', itOk:true, fee:4500, monthCount:2, registeredAt:'2025/12/01', fee0:false },
  { id:'10041', name:'æ¸¡è¾º éš†',   agType:'RE', licNo:'æ±äº¬(1)ç¬¬901234å·', pref:'æ±äº¬éƒ½',
    status:'sennin', itOk:true, fee:5000, monthCount:1, registeredAt:'2025/09/20', fee0:false },
  { id:'20005', name:'ç”°ä¸­ ç¾ç©‚', agType:'HR', licNo:'å¤§é˜ª(2)ç¬¬567890å·', pref:'å¤§é˜ªåºœ',
    status:'general', itOk:false, fee:5000, monthCount:0, registeredAt:'2026/01/10', fee0:false },
];

var RECORDS = [
  { date:'2026/02/20 14:30', caseId:'R000234', client:'ç”°ä¸­ é›„ä»‹', prop:'æ–°å®¿åŒºè¥¿æ–°å®¿2LDK', agentId:'10012', agentName:'å±±ç”° èª ',   fee:6000, status:'å®Œäº†' },
  { date:'2026/02/18 10:00', caseId:'R000220', client:'éˆ´æœ¨ ä¸€éƒ', prop:'æ¸‹è°·åŒºä»£ã€…æœ¨1LDK', agentId:'10008', agentName:'ä½è—¤ èŠ±å­', fee:5000, status:'å®Œäº†' },
  { date:'2026/02/15 15:00', caseId:'R000210', client:'åŠ è—¤ é‡Œå¥ˆ', prop:'æ¸¯åŒºèŠæµ¦3LDK',     agentId:'10012', agentName:'å±±ç”° èª ',   fee:6000, status:'å®Œäº†' },
  { date:'2026/02/12 13:00', caseId:'R000201', client:'å°æ— ä¿®',   prop:'å“å·åŒºå¤§å´1K',    agentId:'10023', agentName:'éˆ´æœ¨ å¥å¤ª', fee:4500, status:'å®Œäº†' },
  { date:'2026/02/10 11:30', caseId:'R000195', client:'ä¼Šè—¤ éº»ç¾', prop:'ç›®é»’åŒºä¸­ç›®é»’2LDK', agentId:'10008', agentName:'ä½è—¤ èŠ±å­', fee:5000, status:'å®Œäº†' },
  { date:'2026/02/08 16:00', caseId:'R000188', client:'ä¸­æ‘ å“²ä¹Ÿ', prop:'æ‰ä¸¦åŒºè»çªª2K',     agentId:'10041', agentName:'æ¸¡è¾º éš†',   fee:5000, status:'å®Œäº†' },
  { date:'2026/02/05 14:00', caseId:'R000177', client:'å‰ç”° å¹¸å­', prop:'ä¸–ç”°è°·åŒºä¸‰è»’èŒ¶å±‹1LDK', agentId:'10012', agentName:'å±±ç”° èª ', fee:6000, status:'å®Œäº†' },
  { date:'2026/02/22 10:00', caseId:'R000245', client:'æ¾æœ¬ ç¾©é›„', prop:'æ±Ÿæ±åŒºè±Šæ´²2LDK',   agentId:'10008', agentName:'ä½è—¤ èŠ±å­', fee:5000, status:'äºˆå®š' },
];

var TOTAL_AGENTS = 24; // æ¥­å¾“è€…æ•°ï¼ˆå›ºå®šãƒ‡ãƒ¢å€¤ï¼‰
var revokeTargetId = null;

// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
//  Tab
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
function showTab(n, btn) {
  for (var i=0;i<4;i++) {
    document.getElementById('tab-'+i).style.display = i===n?'block':'none';
  }
  document.querySelectorAll('.tab').forEach(function(t,i){ t.classList.toggle('on',i===n); });
  if (n===0) renderTakkenTable();
  if (n===1) renderFeeTable();
  if (n===2) renderRecords();
  if (n===3) renderLawCheck();
}

// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
//  Tab 0: ä¸€è¦§
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
function renderTakkenTable() {
  var sennin  = TAKKEN.filter(function(t){return t.status==='sennin';}).length;
  var nintei  = TAKKEN.filter(function(t){return t.status==='nintei';}).length;
  var general = TAKKEN.filter(function(t){return t.status==='general';}).length;
  var jisshi  = RECORDS.filter(function(r){return r.status==='å®Œäº†';}).length;
  document.getElementById('kpi-sennin').textContent   = sennin + 'å';
  document.getElementById('kpi-nintei').textContent   = nintei + 'å';
  document.getElementById('kpi-fuakutiv').textContent = general + 'å';
  document.getElementById('kpi-jisshi').textContent   = jisshi + 'ä»¶';
  document.getElementById('kpi-waiting').textContent  = '1ä»¶';

  var tbody = document.getElementById('takken-tbody');
  tbody.innerHTML = TAKKEN.map(function(t) {
    var statusPill = t.status === 'sennin'
      ? '<span class="pill pgold">ğŸ›ï¸ å°‚ä»»</span>'
      : t.status === 'nintei'
      ? '<span class="pill pg">âœ“ æœ¬éƒ¨èªå®š</span>'
      : '<span class="pill pm">ä¸€èˆ¬</span>';
    var itPill = t.itOk
      ? '<span class="pill pg">é‡èª¬å¯¾å¿œå¯</span>'
      : '<span class="pill pm">å¯¾å¿œä¸å¯</span>';
    var feeFree = t.status === 'sennin' ? '<span class="pill pgold">ç„¡æ–™</span>' : '<span class="pill pm">Â¥980ã€œ</span>';
    return '<tr>' +
      '<td class="mono" style="color:var(--gold)">' + t.id + '</td>' +
      '<td style="font-weight:700">' + t.name + '</td>' +
      '<td><span class="pill pb">' + t.agType + '</span></td>' +
      '<td class="mono" style="font-size:10px;color:var(--sub)">' + t.licNo + '</td>' +
      '<td style="font-size:11px">' + t.pref + '</td>' +
      '<td>' + statusPill + '</td>' +
      '<td>' + itPill + '</td>' +
      '<td class="mono" style="color:var(--gold);font-weight:600">Â¥' + t.fee.toLocaleString() + '</td>' +
      '<td>' + feeFree + '</td>' +
      '<td class="mono">' + t.monthCount + 'ä»¶</td>' +
      '<td class="mono" style="font-size:10px">' + t.registeredAt + '</td>' +
      '<td>' +
        '<div style="display:flex;gap:5px">' +
          (t.itOk && t.status !== 'nintei'
            ? '<button class="btn btn-ghost btn-sm" onclick="toggleNintei(\'' + t.id + '\')">' +
              (t.status==='nintei'?'èªå®šè§£é™¤':'é‡èª¬èªå®š') + '</button>'
            : '') +
          (t.status === 'sennin'
            ? '<button class="btn btn-danger btn-sm" onclick="openRevokeModal(\'' + t.id + '\')">å°‚ä»»è§£é™¤</button>'
            : '') +
        '</div>' +
      '</td>' +
    '</tr>';
  }).join('');
}

function filterTakken() {
  var q = document.getElementById('search-takken').value.toLowerCase();
  document.querySelectorAll('#takken-tbody tr').forEach(function(row) {
    row.style.display = row.textContent.toLowerCase().includes(q) ? '' : 'none';
  });
}

function toggleNintei(id) {
  var t = TAKKEN.find(function(x){ return x.id===id; });
  if (!t) return;
  if (t.status === 'nintei') {
    t.status = 'general'; t.itOk = false;
    alert('âœ… ' + t.name + ' ã®æœ¬éƒ¨èªå®šã‚’è§£é™¤ã—ã¾ã—ãŸã€‚');
  } else {
    t.status = 'nintei'; t.itOk = true;
    alert('âœ… ' + t.name + ' ã‚’æœ¬éƒ¨èªå®šï¼ˆé‡èª¬å¯¾å¿œå¯ï¼‰ã«è¨­å®šã—ã¾ã—ãŸã€‚');
  }
  renderTakkenTable();
}

// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
//  Tab 1: å˜ä¾¡è¨­å®š
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
function renderFeeTable() {
  var tbody = document.getElementById('fee-tbody');
  tbody.innerHTML = TAKKEN.filter(function(t){ return t.itOk; }).map(function(t) {
    var total = t.fee * t.monthCount;
    var statusPill = t.status === 'sennin'
      ? '<span class="pill pgold">å°‚ä»»</span>'
      : '<span class="pill pg">èªå®š</span>';
    return '<tr>' +
      '<td class="mono" style="color:var(--gold)">' + t.id + '</td>' +
      '<td style="font-weight:700">' + t.name + '</td>' +
      '<td>' + statusPill + '</td>' +
      '<td class="mono">' + t.monthCount + 'ä»¶</td>' +
      '<td>' +
        '<div class="fee-cell">' +
          '<span style="color:var(--sub);font-size:11px">Â¥</span>' +
          '<input class="fee-input" type="number" step="500" min="0" value="' + t.fee + '"' +
            ' id="fee-input-' + t.id + '"' +
            ' onchange="updateFee(\'' + t.id + '\',this.value)">' +
        '</div>' +
      '</td>' +
      '<td class="mono" style="color:var(--gold);font-weight:600">Â¥' + total.toLocaleString() + '</td>' +
      '<td>' +
        '<button class="btn btn-ghost btn-sm" onclick="updateFee(\'' + t.id + '\',document.getElementById(\'fee-input-' + t.id + '\').value,true)">' +
          'âœ“ ç¢ºå®š' +
        '</button>' +
      '</td>' +
    '</tr>';
  }).join('');
}

function updateFee(id, val, confirm_flag) {
  var t = TAKKEN.find(function(x){ return x.id===id; });
  if (!t) return;
  var newFee = parseInt(val) || 0;
  if (newFee < 0) return;
  var old = t.fee;
  t.fee = newFee;
  if (confirm_flag) {
    // ãƒ­ã‚°è¿½åŠ 
    var tbody = document.getElementById('fee-log-tbody');
    var now = new Date().toLocaleString('ja-JP').slice(0,-3);
    var newRow = document.createElement('tr');
    newRow.innerHTML =
      '<td class="mono" style="font-size:10px">' + now + '</td>' +
      '<td>' + t.name + 'ï¼ˆ' + id + 'ï¼‰</td>' +
      '<td class="mono" style="color:var(--muted)">Â¥' + old.toLocaleString() + '</td>' +
      '<td class="mono" style="color:var(--gold)">Â¥' + newFee.toLocaleString() + '</td>' +
      '<td style="font-size:10px;color:var(--sub)">æœ¬éƒ¨ ç®¡ç†è· ç”°æ‘</td>';
    tbody.insertBefore(newRow, tbody.firstChild);
    alert('âœ… ' + t.name + ' ã®å˜ä¾¡ã‚’ Â¥' + newFee.toLocaleString() + ' ã«æ›´æ–°ã—ã¾ã—ãŸã€‚');
    renderFeeTable();
  }
}

function applyDefaultFee() {
  var val = parseInt(document.getElementById('default-fee').value) || 5000;
  if (!confirm('é‡èª¬å¯¾å¿œå¯ã®å…¨ã‚¨ãƒ¼ã‚¸ã‚§ãƒ³ãƒˆã®å˜ä¾¡ã‚’ Â¥' + val.toLocaleString() + ' ã«è¨­å®šã—ã¾ã™ã‹ï¼Ÿ')) return;
  TAKKEN.forEach(function(t){ if(t.itOk) t.fee = val; });
  renderFeeTable();
  alert('âœ… å…¨å“¡ã®å˜ä¾¡ã‚’æ›´æ–°ã—ã¾ã—ãŸã€‚');
}

// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
//  Tab 2: å®Ÿç¸¾
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
function renderRecords() {
  var done = RECORDS.filter(function(r){ return r.status==='å®Œäº†'; });
  var totalPay = done.reduce(function(s,r){ return s+r.fee; }, 0);
  var agents = [...new Set(done.map(function(r){ return r.agentId; }))].length;
  var avg = done.length ? Math.round(totalPay/done.length) : 0;
  document.getElementById('rec-total').textContent  = done.length + 'ä»¶';
  document.getElementById('rec-pay').textContent    = 'Â¥'+totalPay.toLocaleString();
  document.getElementById('rec-agents').textContent = agents + 'å';
  document.getElementById('rec-avg').textContent    = 'Â¥'+avg.toLocaleString();

  document.getElementById('rec-tbody').innerHTML = RECORDS.map(function(r) {
    var t = TAKKEN.find(function(x){ return x.id===r.agentId; });
    return '<tr>' +
      '<td class="mono" style="font-size:10px">' + r.date + '</td>' +
      '<td class="mono" style="font-size:10px;color:var(--blue)">' + r.caseId + '</td>' +
      '<td style="font-weight:600">' + r.client + '</td>' +
      '<td style="font-size:11px;color:var(--sub)">' + r.prop + '</td>' +
      '<td>' + r.agentName + 'ï¼ˆ' + r.agentId + 'ï¼‰</td>' +
      '<td class="mono" style="color:var(--gold)">Â¥' + r.fee.toLocaleString() + '</td>' +
      '<td><span class="pill ' + (r.status==='å®Œäº†'?'pg':'pb') + '">' + r.status + '</span></td>' +
    '</tr>';
  }).join('');
}

function exportRecCSV() {
  var rows = [['æ—¥æ™‚','æ¡ˆä»¶ID','é¡§å®¢å','ç‰©ä»¶','æ‹…å½“å®…å»ºå£«','ID','å˜ä¾¡','ã‚¹ãƒ†ãƒ¼ã‚¿ã‚¹']].concat(
    RECORDS.map(function(r){ return [r.date,r.caseId,r.client,r.prop,r.agentName,r.agentId,r.fee,r.status]; })
  );
  var csv = rows.map(function(r){ return r.join(','); }).join('\n');
  var a = document.createElement('a'); a.href='data:text/csv;charset=utf-8,\uFEFF'+encodeURIComponent(csv);
  a.download='coreto_itsetsu_records.csv'; a.click();
}

// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
//  Tab 3: æ³•ä»¤æ¯”ç‡
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
function renderLawCheck() {
  var sennin = TAKKEN.filter(function(t){ return t.status==='sennin'; }).length;
  var required = Math.ceil(TOTAL_AGENTS / 5);
  var pct = Math.min(100, Math.round(sennin / required * 100));
  var ok = sennin >= required;

  document.getElementById('law-total').textContent    = TOTAL_AGENTS + 'å';
  document.getElementById('law-required').textContent = required + 'å';
  document.getElementById('law-current-label').textContent = sennin + 'å';
  document.getElementById('law-required-label').textContent = 'æœ€ä½ ' + required + 'å';

  var bar = document.getElementById('law-bar');
  bar.style.width = pct + '%';
  bar.style.background = ok ? 'var(--green)' : 'var(--red)';

  var box = document.getElementById('law-status-box');
  if (ok) {
    box.style.cssText = 'padding:12px 16px;border-radius:10px;font-size:13px;font-weight:700;text-align:center;margin-top:16px;background:rgba(52,211,153,.1);border:1px solid rgba(52,211,153,.3);color:var(--green)';
    box.innerHTML = 'âœ… æ³•ä»¤æ¯”ç‡ã‚’æº€ãŸã—ã¦ã„ã¾ã™ï¼ˆå°‚ä»» ' + sennin + 'å / å¿…è¦ ' + required + 'åï¼‰';
  } else {
    box.style.cssText = 'padding:12px 16px;border-radius:10px;font-size:13px;font-weight:700;text-align:center;margin-top:16px;background:rgba(248,113,113,.1);border:1px solid rgba(248,113,113,.3);color:var(--red)';
    box.innerHTML = 'âŒ æ³•ä»¤æ¯”ç‡ã‚’ä¸‹å›ã£ã¦ã„ã¾ã™ã€‚å°‚ä»»å®…å»ºå£«ã‚’ã‚ã¨ ' + (required - sennin) + 'åç¢ºä¿ã—ã¦ãã ã•ã„ã€‚';
  }

  // ã‚·ãƒŸãƒ¥ãƒ¬ãƒ¼ã‚·ãƒ§ãƒ³ select
  var sel = document.getElementById('sim-agent');
  sel.innerHTML = '<option value="">â€” é¸æŠ â€”</option>';
  TAKKEN.filter(function(t){ return t.status==='sennin'; }).forEach(function(t) {
    var opt = document.createElement('option');
    opt.value = t.id; opt.textContent = t.name + 'ï¼ˆ' + t.id + 'ï¼‰';
    sel.appendChild(opt);
  });
}

function runSim() {
  var id = document.getElementById('sim-agent').value;
  if (!id) { alert('å¯¾è±¡ã‚¨ãƒ¼ã‚¸ã‚§ãƒ³ãƒˆã‚’é¸æŠã—ã¦ãã ã•ã„'); return; }
  var sennin = TAKKEN.filter(function(t){ return t.status==='sennin'; }).length;
  var required = Math.ceil(TOTAL_AGENTS / 5);
  var afterSennin = sennin - 1;
  var ok = afterSennin >= required;
  var res = document.getElementById('sim-result');
  res.style.display = 'block';
  res.innerHTML =
    'è§£é™¤å¾Œã®å°‚ä»»å®…å»ºå£«æ•°ï¼š<strong style="color:' + (ok?'var(--green)':'var(--red)') + '">' + afterSennin + 'å</strong>ï¼ˆå¿…è¦ ' + required + 'åï¼‰<br>' +
    'æ³•ä»¤æ¯”ç‡ï¼š<strong style="color:' + (ok?'var(--green)':'var(--red)') + '">' + (ok?'âœ… é©åˆ':'âŒ é•å') + '</strong><br>' +
    (ok ? 'è§£é™¤ã—ã¦ã‚‚æ³•ä»¤æ¯”ç‡ã‚’æº€ãŸã—ã¾ã™ã€‚' : '<span style="color:var(--red)">âš ï¸ ã“ã®è§£é™¤ã¯æ¥­æ³•é•åã«ãªã‚Šã¾ã™ã€‚ä»£æ›¿ã®å°‚ä»»å®…å»ºå£«ã‚’ç¢ºä¿ã—ã¦ãã ã•ã„ã€‚</span>');
}

// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
//  å°‚ä»»è§£é™¤ Modal
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
function openRevokeModal(id) {
  var t = TAKKEN.find(function(x){ return x.id===id; });
  if (!t) return;
  revokeTargetId = id;
  document.getElementById('revoke-target-info').innerHTML =
    'å¯¾è±¡ï¼š<strong>' + t.name + 'ï¼ˆ' + t.id + 'ï¼‰</strong><br>' +
    'ç¾ã‚¹ãƒ†ãƒ¼ã‚¿ã‚¹ï¼šå°‚ä»»å®…å»ºå£«<br>' +
    'è§£é™¤å¾Œã®æœˆä¼šè²»ï¼š<strong style="color:var(--orange)">Â¥980/æœˆ</strong>ï¼ˆãƒ–ãƒ­ãƒ³ã‚ºã€ç¿Œæœˆã‹ã‚‰ç™ºç”Ÿï¼‰<br>' +
    'å®…å»ºå£«è¨¼ï¼š' + t.licNo;
  document.getElementById('revoke-confirm-id').value = '';
  document.getElementById('revoke-reason').value = '';
  document.getElementById('revoke-exec-btn').disabled = true;

  // æ³•ä»¤æ¯”ç‡ãƒã‚§ãƒƒã‚¯
  var sennin = TAKKEN.filter(function(t){ return t.status==='sennin'; }).length;
  var required = Math.ceil(TOTAL_AGENTS / 5);
  var warn = document.getElementById('revoke-law-warn');
  warn.style.display = (sennin - 1) < required ? 'block' : 'none';

  document.getElementById('revoke-modal').classList.add('open');
}

function closeRevokeModal() {
  document.getElementById('revoke-modal').classList.remove('open');
  revokeTargetId = null;
}

function checkRevokeConfirm() {
  var id = document.getElementById('revoke-confirm-id').value.trim();
  var reason = document.getElementById('revoke-reason').value;
  var btn = document.getElementById('revoke-exec-btn');
  btn.disabled = !(id === revokeTargetId && reason);
}

function execRevoke() {
  if (!revokeTargetId) return;
  var t = TAKKEN.find(function(x){ return x.id===revokeTargetId; });
  if (!t) return;
  t.status = 'general';
  t.itOk   = false;
  closeRevokeModal();
  renderTakkenTable();
  alert('âœ… ' + t.name + ' ã®å°‚ä»»ã‚¹ãƒ†ãƒ¼ã‚¿ã‚¹ã‚’è§£é™¤ã—ã¾ã—ãŸã€‚\nç¿Œæœˆã‚ˆã‚Šæœˆä¼šè²»ï¼ˆÂ¥980ï¼‰ãŒç™ºç”Ÿã—ã¾ã™ã€‚\nSlackã§ã‚¨ãƒ¼ã‚¸ã‚§ãƒ³ãƒˆã«é€šçŸ¥ãŒé€ä¿¡ã•ã‚Œã¾ã™ã€‚');
}

// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
//  å®…å»ºå£«è¿½åŠ  Modal
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
var KNOWN_AGENTS = [
  { id:'10012', name:'å±±ç”° èª ' },{ id:'10008', name:'ä½è—¤ èŠ±å­' },
  { id:'10023', name:'éˆ´æœ¨ å¥å¤ª' },{ id:'10041', name:'æ¸¡è¾º éš†' },
  { id:'20005', name:'ç”°ä¸­ ç¾ç©‚' },{ id:'10055', name:'æœ¨æ‘ æœ‹å­' },
];

function openAddModal() {
  document.getElementById('add-agent-id').value   = '';
  document.getElementById('add-license-no').value = '';
  document.getElementById('add-agent-info').style.display = 'none';
  document.getElementById('add-modal').classList.add('open');
}
function closeAddModal() {
  document.getElementById('add-modal').classList.remove('open');
}
function lookupAgent() {
  var id = document.getElementById('add-agent-id').value.trim();
  var ag = KNOWN_AGENTS.find(function(a){ return a.id===id; });
  var box = document.getElementById('add-agent-info');
  if (ag) {
    box.style.display = 'block';
    box.innerHTML = 'æ°åï¼š<strong>' + ag.name + '</strong>ã€€IDï¼š' + ag.id;
  } else {
    box.style.display = id.length>=5 ? 'block' : 'none';
    box.innerHTML = id.length>=5 ? '<span style="color:var(--muted)">ã‚¨ãƒ¼ã‚¸ã‚§ãƒ³ãƒˆãŒè¦‹ã¤ã‹ã‚Šã¾ã›ã‚“</span>' : '';
  }
}
function execAdd() {
  var id      = document.getElementById('add-agent-id').value.trim();
  var licNo   = document.getElementById('add-license-no').value.trim();
  var pref    = document.getElementById('add-pref').value;
  var status  = document.getElementById('add-status').value;
  var fee     = parseInt(document.getElementById('add-fee').value) || 5000;
  if (!id || !licNo) { alert('ã‚¨ãƒ¼ã‚¸ã‚§ãƒ³ãƒˆIDã¨å®…å»ºå£«è¨¼ç•ªå·ã¯å¿…é ˆã§ã™'); return; }
  var ag = KNOWN_AGENTS.find(function(a){ return a.id===id; });
  var name = ag ? ag.name : 'ï¼ˆID: '+id+'ï¼‰';
  TAKKEN.push({
    id:id, name:name, agType:'RE', licNo:licNo, pref:pref,
    status:status, itOk:status!=='general', fee:fee, monthCount:0,
    registeredAt:new Date().toLocaleDateString('ja-JP'), fee0:false
  });
  closeAddModal();
  renderTakkenTable();
  alert('âœ… ' + name + ' ã‚’å®…å»ºå£«ã¨ã—ã¦ç™»éŒ²ã—ã¾ã—ãŸã€‚');
}

function exportCSV() {
  var rows = [['ID','æ°å','ç¨®åˆ¥','å®…å»ºå£«è¨¼ç•ªå·','éƒ½é“åºœçœŒ','å°‚ä»»ã‚¹ãƒ†ãƒ¼ã‚¿ã‚¹','é‡èª¬å¯¾å¿œ','å˜ä¾¡']].concat(
    TAKKEN.map(function(t){ return [t.id,t.name,t.agType,t.licNo,t.pref,t.status,t.itOk?'å¯':'ä¸å¯',t.fee]; })
  );
  var csv = rows.map(function(r){ return r.join(','); }).join('\n');
  var a = document.createElement('a'); a.href='data:text/csv;charset=utf-8,\uFEFF'+encodeURIComponent(csv);
  a.download='coreto_takken.csv'; a.click();
}

// â•â•â•â• Init â•â•â•â•
renderTakkenTable();
</script>
</body>
</html>
