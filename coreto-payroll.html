<!DOCTYPE html>
<html lang="ja">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>CORETO â€” æœˆæ¬¡å ±é…¬ç¢ºå®šãƒ»æŒ¯è¾¼</title>
<style>
@import url('https://fonts.googleapis.com/css2?family=Noto+Sans+JP:wght@300;400;500;700&family=DM+Mono:wght@400;500&family=Syne:wght@700;800&display=swap');
*{box-sizing:border-box;margin:0;padding:0}
:root{
  --bg:#07090f;--card:#0f1119;--card2:#141720;--border:#1e2235;--border2:#252a3d;
  --gold:#c9a84c;--gold-dim:#7a5f22;
  --blue:#4f9cf9;--green:#34d399;--red:#f87171;--orange:#fb923c;--purple:#a78bfa;
  --muted:#4a5270;--sub:#7a849e;--text:#e2e6f3;
}
html,body{height:100%;font-family:'Noto Sans JP',sans-serif;background:var(--bg);color:var(--text)}
.hdr{height:54px;display:flex;align-items:center;justify-content:space-between;
  padding:0 26px;border-bottom:1px solid var(--border);background:rgba(7,9,15,.95);position:sticky;top:0;z-index:100}
.logo{font-family:'Syne',sans-serif;font-size:17px;font-weight:800;color:var(--gold);letter-spacing:3px}
.main{max-width:1200px;margin:0 auto;padding:26px 28px 80px}
.ptitle{font-family:'Syne',sans-serif;font-size:17px;font-weight:800;margin-bottom:4px}
.psub{font-size:11px;color:var(--sub);margin-bottom:22px}
.card{background:var(--card);border:1px solid var(--border);border-radius:14px;margin-bottom:14px}
.ch{padding:12px 20px;border-bottom:1px solid var(--border);display:flex;align-items:center;justify-content:space-between}
.ch-t{font-size:9px;color:var(--muted);letter-spacing:2px;text-transform:uppercase;display:flex;align-items:center;gap:8px}
.ch-t::before{content:'';width:3px;height:11px;border-radius:2px;background:var(--gold)}
.cb{padding:18px 20px}
.pill{display:inline-flex;align-items:center;gap:4px;padding:3px 10px;border-radius:6px;font-size:9px;font-weight:700}
.pg{background:rgba(52,211,153,.13);color:var(--green);border:1px solid rgba(52,211,153,.3)}
.pb{background:rgba(79,156,249,.12);color:var(--blue);border:1px solid rgba(79,156,249,.25)}
.po{background:rgba(251,146,60,.12);color:var(--orange);border:1px solid rgba(251,146,60,.3)}
.pr{background:rgba(248,113,113,.12);color:var(--red);border:1px solid rgba(248,113,113,.3)}
.pm{background:rgba(74,82,112,.15);color:var(--sub);border:1px solid var(--border2)}
.pgd{background:rgba(201,168,76,.13);color:var(--gold);border:1px solid var(--gold-dim)}
.btn{padding:9px 18px;border-radius:9px;font-size:11px;font-weight:700;cursor:pointer;
  font-family:'Noto Sans JP',sans-serif;transition:.15s;border:none;display:inline-flex;align-items:center;gap:6px}
.btn-blue{background:linear-gradient(135deg,var(--blue),#3070c0);color:#fff}
.btn-blue:hover{filter:brightness(1.1)}
.btn-gold{background:linear-gradient(135deg,var(--gold),#a8742a);color:#0a0c10}
.btn-ghost{background:transparent;border:1px solid var(--border2);color:var(--sub)}
.btn-ghost:hover{color:var(--text);border-color:var(--sub)}
.btn-ok{background:rgba(52,211,153,.12);border:1px solid rgba(52,211,153,.3);color:var(--green)}
.btn-danger{background:rgba(248,113,113,.12);border:1px solid rgba(248,113,113,.3);color:var(--red)}
.btn-sm{padding:5px 12px;font-size:10px;border-radius:7px}
.btn:disabled{opacity:.4;cursor:not-allowed}
.al{display:flex;align-items:flex-start;gap:10px;padding:12px 16px;border-radius:10px;margin-bottom:12px;font-size:12px;line-height:1.7}
.al-info{background:rgba(79,156,249,.07);border:1px solid rgba(79,156,249,.2)}
.al-ok{background:rgba(52,211,153,.07);border:1px solid rgba(52,211,153,.2)}
.al-warn{background:rgba(251,146,60,.07);border:1px solid rgba(251,146,60,.22)}
.g4{display:grid;grid-template-columns:repeat(4,1fr);gap:12px;margin-bottom:20px}
.stat-card{background:var(--card);border:1px solid var(--border);border-radius:12px;padding:16px}
.g2{display:grid;grid-template-columns:1fr 1fr;gap:14px}
/* Table */
.tbl{width:100%;border-collapse:collapse}
.tbl th{padding:9px 14px;font-size:9px;color:var(--muted);font-weight:700;letter-spacing:.5px;
  text-transform:uppercase;border-bottom:1px solid var(--border);background:var(--card2);text-align:left;white-space:nowrap}
.tbl td{padding:11px 14px;border-bottom:1px solid rgba(30,34,53,.5);font-size:12px;vertical-align:middle}
.tbl tr:last-child td{border:none}
.tbl tr:hover td{background:rgba(255,255,255,.012)}
.tbl input[type=number]{background:#090b13;border:1px solid var(--border2);border-radius:7px;
  padding:6px 10px;color:var(--text);font-size:12px;font-family:'DM Mono',monospace;width:110px;outline:none}
.tbl input[type=number]:focus{border-color:var(--blue)}
.mono{font-family:'DM Mono',monospace}
/* Steps */
.steps{display:flex;align-items:center;gap:0;margin-bottom:20px}
.step-item{display:flex;align-items:center;gap:10px;padding:10px 16px;border-radius:10px;
  flex:1;transition:.15s;border:1px solid var(--border2)}
.step-item.on{background:rgba(79,156,249,.07);border-color:rgba(79,156,249,.3)}
.step-item.done{background:rgba(52,211,153,.06);border-color:rgba(52,211,153,.25)}
.step-arrow{color:var(--muted);font-size:18px;flex-shrink:0;padding:0 6px}
.step-num{width:28px;height:28px;border-radius:50%;background:var(--card2);
  display:flex;align-items:center;justify-content:center;font-size:11px;font-weight:700;flex-shrink:0}
.step-item.on .step-num{background:var(--blue);color:#fff}
.step-item.done .step-num{background:var(--green);color:#0a0c10}
/* Month tabs */
.month-tabs{display:flex;gap:8px;margin-bottom:20px;flex-wrap:wrap}
.month-tab{padding:7px 16px;border-radius:8px;font-size:11px;font-weight:700;cursor:pointer;
  border:1px solid var(--border2);background:transparent;color:var(--sub);transition:.15s;
  font-family:'Noto Sans JP',sans-serif}
.month-tab.on{background:rgba(79,156,249,.1);border-color:rgba(79,156,249,.35);color:var(--blue)}
::-webkit-scrollbar{width:4px}::-webkit-scrollbar-thumb{background:var(--border2);border-radius:2px}

/* â”€â”€ ç´¹ä»‹ãƒªãƒ³ã‚¯ãƒ¢ãƒ¼ãƒ€ãƒ« â”€â”€ */
#ref-modal-overlay{display:none;position:fixed;inset:0;background:rgba(0,0,0,.65);z-index:9000;align-items:center;justify-content:center}
#ref-modal-overlay.open{display:flex}
#ref-modal{background:var(--card);border:1px solid var(--border2);border-radius:16px;padding:0;width:min(460px,92vw);overflow:hidden}
.ref-mhdr{padding:16px 20px;border-bottom:1px solid var(--border);display:flex;align-items:center;justify-content:space-between}
.ref-mhdr-t{font-family:'Syne',sans-serif;font-size:14px;font-weight:800;color:var(--gold)}
.ref-mbody{padding:20px}
.ref-url{background:var(--card2);border:1px solid var(--border2);border-radius:8px;padding:10px 12px;font-family:'DM Mono',monospace;font-size:11px;color:var(--sub);word-break:break-all;margin:10px 0;min-height:36px}
.ref-copy-btn{width:100%;padding:10px;border-radius:8px;border:none;cursor:pointer;font-family:inherit;font-size:13px;font-weight:700;background:var(--gold);color:#0a0c10;margin-top:4px}
.ref-copy-btn:hover{opacity:.9}

/* â”€â”€ ç´¹ä»‹ãƒªãƒ³ã‚¯ å·¦ãƒ•ãƒ­ãƒ¼ãƒ†ã‚£ãƒ³ã‚°ãƒœã‚¿ãƒ³ â”€â”€ */
#ref-float-btn {
  position: fixed;
  left: 0;
  top: 50%;
  transform: translateY(-50%) translateX(-100%) rotate(-90deg);
  transform-origin: right bottom;
  z-index: 8000;
  background: rgba(201,168,76,.18);
  border: 1px solid rgba(201,168,76,.4);
  border-bottom: none;
  border-radius: 8px 8px 0 0;
  color: var(--gold);
  padding: 6px 16px;
  font-size: 11px;
  font-weight: 700;
  font-family: inherit;
  cursor: pointer;
  white-space: nowrap;
  letter-spacing: .5px;
  transition: background .15s;
}
#ref-float-btn:hover { background: rgba(201,168,76,.32); }
</style>
</head>
<body>
<div class="hdr">
  <div style="display:flex;align-items:center;gap:12px">
    <div class="logo">CORETO</div>
    <div style="width:1px;height:18px;background:var(--border2)"></div>
    <span style="font-size:10px;color:var(--muted);letter-spacing:1px">æœˆæ¬¡å ±é…¬ç¢ºå®šãƒ»æŒ¯è¾¼æŒ‡ç¤º</span>
  </div>
  <div style="display:flex;gap:10px;align-items:center">
    <span class="pill pgd">HQå°‚ç”¨</span>
    <button class="btn btn-ghost btn-sm" onclick="window.location.href='coreto-hub.html'">ğŸ  ãƒ›ãƒ¼ãƒ </button>
  </div>
</div>

<div class="main">
  <div class="ptitle">æœˆæ¬¡å ±é…¬ç¢ºå®šãƒ»æŒ¯è¾¼æŒ‡ç¤º</div>
  <div class="psub">æ¡ˆä»¶å ±é…¬ã®é›†è¨ˆãƒ»ç¢ºå®šãƒ»æºæ³‰æ§é™¤ãƒ»æŒ¯è¾¼æŒ‡ç¤ºãƒ•ã‚¡ã‚¤ãƒ«ç”Ÿæˆã¾ã§ä¸€æ‹¬ç®¡ç†</div>

  <!-- æœˆé¸æŠ -->
  <div class="month-tabs">
    <button class="month-tab" onclick="selMonth(this,'2025-12')">2025å¹´12æœˆ</button>
    <button class="month-tab" onclick="selMonth(this,'2026-01')">2026å¹´1æœˆ</button>
    <button class="month-tab on" onclick="selMonth(this,'2026-02')">2026å¹´2æœˆ <span style="font-size:8px;background:var(--orange);color:#fff;padding:1px 5px;border-radius:4px;margin-left:4px">å‡¦ç†ä¸­</span></button>
  </div>

  <!-- é€²æ—ã‚¹ãƒ†ãƒƒãƒ— -->
  <div class="steps">
    <div class="step-item done" id="sp1">
      <div class="step-num">âœ“</div>
      <div><div style="font-size:11px;font-weight:700">æ¡ˆä»¶é›†è¨ˆ</div><div style="font-size:10px;color:var(--muted)">ç· æœˆç¢ºå®šæ¡ˆä»¶</div></div>
    </div>
    <div class="step-arrow">â†’</div>
    <div class="step-item on" id="sp2">
      <div class="step-num">2</div>
      <div><div style="font-size:11px;font-weight:700">é‡‘é¡ç¢ºå®š</div><div style="font-size:10px;color:var(--muted)">å€‹åˆ¥èª¿æ•´ãƒ»ç¢ºèª</div></div>
    </div>
    <div class="step-arrow">â†’</div>
    <div class="step-item" id="sp3">
      <div class="step-num">3</div>
      <div><div style="font-size:11px;font-weight:700">HQæ‰¿èª</div><div style="font-size:10px;color:var(--muted)">æœ€çµ‚ç¢ºèª</div></div>
    </div>
    <div class="step-arrow">â†’</div>
    <div class="step-item" id="sp4">
      <div class="step-num">4</div>
      <div><div style="font-size:11px;font-weight:700">æŒ¯è¾¼æŒ‡ç¤º</div><div style="font-size:10px;color:var(--muted)">å…¨éŠ€ãƒ•ã‚¡ã‚¤ãƒ«ç”Ÿæˆ</div></div>
    </div>
    <div class="step-arrow">â†’</div>
    <div class="step-item" id="sp5">
      <div class="step-num">5</div>
      <div><div style="font-size:11px;font-weight:700">å®Œäº†ãƒ»é€šçŸ¥</div><div style="font-size:10px;color:var(--muted)">æ˜ç´°é€ä»˜</div></div>
    </div>
  </div>

  <!-- KPI -->
  <div class="g4" id="kpi-area">
    <div class="stat-card">
      <div style="font-size:18px;margin-bottom:6px">ğŸ’´</div>
      <div class="mono" style="font-size:24px;color:var(--gold)" id="stat-total">Â¥4,820,000</div>
      <div style="font-size:10px;color:var(--muted)">æŒ¯è¾¼ç·é¡ï¼ˆæ§é™¤å‰ï¼‰</div>
    </div>
    <div class="stat-card">
      <div style="font-size:18px;margin-bottom:6px">ğŸ›</div>
      <div class="mono" style="font-size:24px;color:var(--orange)" id="stat-tax">Â¥492,300</div>
      <div style="font-size:10px;color:var(--muted)">æºæ³‰å¾´ååˆè¨ˆ</div>
    </div>
    <div class="stat-card">
      <div style="font-size:18px;margin-bottom:6px">ğŸ“¤</div>
      <div class="mono" style="font-size:24px;color:var(--blue)" id="stat-net">Â¥4,327,700</div>
      <div style="font-size:10px;color:var(--muted)">å®ŸæŒ¯è¾¼é¡åˆè¨ˆ</div>
    </div>
    <div class="stat-card">
      <div style="font-size:18px;margin-bottom:6px">ğŸ‘¥</div>
      <div class="mono" style="font-size:24px;color:var(--green)" id="stat-count">12å</div>
      <div style="font-size:10px;color:var(--muted)">æŒ¯è¾¼å¯¾è±¡ã‚¨ãƒ¼ã‚¸ã‚§ãƒ³ãƒˆ</div>
    </div>
  </div>

  <!-- å ±é…¬æ˜ç´°ãƒ†ãƒ¼ãƒ–ãƒ« -->
  <div class="card">
    <div class="ch">
      <div class="ch-t">2026å¹´2æœˆ å ±é…¬æ˜ç´°ï¼ˆç·¨é›†å¯ï¼‰</div>
      <div style="display:flex;gap:8px">
        <button class="btn btn-ghost btn-sm" onclick="recalcAll()">ğŸ”„ å†è¨ˆç®—</button>
        <button class="btn btn-ghost btn-sm" onclick="exportCSV()">ğŸ“Š CSVå‡ºåŠ›</button>
        <button class="btn btn-blue btn-sm" onclick="approvePayroll()">âœ… HQæ‰¿èªã¸</button>
      </div>
    </div>
    <div style="overflow-x:auto">
      <table class="tbl" id="payroll-tbl">
        <thead>
          <tr>
            <th>ID</th><th>æ°å</th><th>ç¨®åˆ¥</th><th>ãƒ©ãƒ³ã‚¯</th>
            <th>æ¡ˆä»¶æ•°</th><th>æˆç´„å ±é…¬ï¼ˆç¨å‰ï¼‰</th><th>æœˆä¼šè²»</th><th>é‡èª¬å ±é…¬</th><th>èª¿æ•´é¡</th>
            <th>æ”¯æ‰•é¡åˆè¨ˆ</th><th>æºæ³‰å¾´å</th><th>å®ŸæŒ¯è¾¼é¡</th><th>å£åº§</th><th>çŠ¶æ…‹</th>
          </tr>
        </thead>
        <tbody id="payroll-body"></tbody>
        <tfoot>
          <tr style="background:var(--card2);font-weight:700">
            <td colspan="4" style="font-size:11px">åˆè¨ˆ</td>
            <td class="mono" id="ft-cases">â€”</td>
            <td class="mono" id="ft-gross">â€”</td>
            <td class="mono" id="ft-fee">â€”</td>
            <td class="mono" id="ft-adj">â€”</td>
            <td class="mono" id="ft-total">â€”</td>
            <td class="mono" id="ft-tax">â€”</td>
            <td class="mono" id="ft-net">â€”</td>
            <td colspan="2"></td>
          </tr>
        </tfoot>
      </table>
    </div>
  </div>

  <!-- æŒ¯è¾¼æŒ‡ç¤º -->
  <div class="card" id="transfer-card" style="display:none">
    <div class="ch">
      <div class="ch-t">æŒ¯è¾¼æŒ‡ç¤ºãƒ•ã‚¡ã‚¤ãƒ«ç”Ÿæˆ</div>
      <span class="pill pg">âœ“ æ‰¿èªæ¸ˆã¿</span>
    </div>
    <div class="cb">
      <div class="al al-ok" style="margin-bottom:14px">
        âœ… HQæ‰¿èªãŒå®Œäº†ã—ã¾ã—ãŸã€‚æŒ¯è¾¼æŒ‡ç¤ºãƒ•ã‚¡ã‚¤ãƒ«ã‚’ç”Ÿæˆã—ã¦éŠ€è¡Œã«æå‡ºã—ã¦ãã ã•ã„ã€‚
      </div>
      <div class="g2">
        <div>
          <div style="font-size:10px;color:var(--sub);margin-bottom:10px;font-weight:600">ç”Ÿæˆå½¢å¼</div>
          <div style="display:flex;flex-direction:column;gap:8px">
            <label style="display:flex;align-items:center;gap:8px;padding:10px 14px;
                          background:var(--card2);border-radius:9px;cursor:pointer;font-size:12px">
              <input type="radio" name="fmt" value="zengin" checked>
              å…¨éŠ€ãƒ•ã‚©ãƒ¼ãƒãƒƒãƒˆï¼ˆ.txtï¼‰â€” éŠ€è¡ŒAPIãƒ»ãƒãƒƒãƒˆãƒãƒ³ã‚¯å¯¾å¿œ
            </label>
            <label style="display:flex;align-items:center;gap:8px;padding:10px 14px;
                          background:var(--card2);border-radius:9px;cursor:pointer;font-size:12px">
              <input type="radio" name="fmt" value="csv">
              CSVå½¢å¼ â€” çµŒç†ã‚½ãƒ•ãƒˆãƒ»æ‰‹å‹•ç¢ºèªç”¨
            </label>
          </div>
        </div>
        <div>
          <div style="font-size:10px;color:var(--sub);margin-bottom:10px;font-weight:600">æŒ¯è¾¼æŒ‡å®šæ—¥</div>
          <input type="date" value="2026-02-25"
            style="width:100%;background:#090b13;border:1px solid var(--border2);border-radius:9px;
                   padding:10px 14px;color:var(--text);font-size:12px;outline:none">
          <div style="font-size:10px;color:var(--muted);margin-top:6px">é€šå¸¸ã¯æ¯æœˆ25æ—¥</div>
        </div>
      </div>
      <div style="display:flex;gap:10px;margin-top:16px">
        <button class="btn btn-gold" onclick="generateZengin()" style="flex:1;justify-content:center">
          ğŸ“„ æŒ¯è¾¼æŒ‡ç¤ºãƒ•ã‚¡ã‚¤ãƒ«ã‚’ç”Ÿæˆãƒ»ãƒ€ã‚¦ãƒ³ãƒ­ãƒ¼ãƒ‰
        </button>
        <button class="btn btn-ghost" onclick="sendPayslips()">
          ğŸ’¬ å…¨å“¡ã«æ˜ç´°ã‚’Slacké€šçŸ¥
        </button>
      </div>
    </div>
  </div>

  <!-- æœˆæ¬¡ä¼šè²»å¼•ãè½ã¨ã— -->
  <div class="card">
    <div class="ch">
      <div class="ch-t">æœˆæ¬¡ä¼šè²» å¼•ãè½ã¨ã—çŠ¶æ³</div>
      <span class="pill pm">2026å¹´2æœˆ</span>
    </div>
    <div class="cb">
      <div class="al al-info" style="margin-bottom:14px">
        â„¹ï¸ HQã§ã‚¢ã‚«ã‚¦ãƒ³ãƒˆã‚’åœæ­¢ã—ãŸã‚¨ãƒ¼ã‚¸ã‚§ãƒ³ãƒˆã¯ä¼šè²»å¼•ãè½ã¨ã—å¯¾è±¡ã‹ã‚‰è‡ªå‹•é™¤å¤–ã•ã‚Œã¾ã™ã€‚
      </div>
      <table class="tbl">
        <thead><tr><th>ID</th><th>æ°å</th><th>ä¼šè²»</th><th>ã‚«ãƒ¼ãƒ‰</th><th>çŠ¶æ…‹</th><th>å‚™è€ƒ</th></tr></thead>
        <tbody>
          <tr><td class="mono">10012</td><td>å±±ç”° èª </td><td class="mono" style="color:var(--muted);font-size:10px" id="fee-display">ãƒ©ãƒ³ã‚¯åˆ¥</td>
              <td style="font-size:11px">Visa Â·Â·Â·4242</td><td><span class="pill pg">âœ“ æ±ºæ¸ˆå®Œäº†</span></td><td></td></tr>
          <tr><td class="mono">10008</td><td>ä½è—¤ èŠ±å­</td><td class="mono" style="color:var(--muted);font-size:10px" id="fee-display">ãƒ©ãƒ³ã‚¯åˆ¥</td>
              <td style="font-size:11px">MC Â·Â·Â·3210</td><td><span class="pill pg">âœ“ æ±ºæ¸ˆå®Œäº†</span></td><td></td></tr>
          <tr><td class="mono">10023</td><td>éˆ´æœ¨ å¥å¤ª</td><td class="mono" style="color:var(--muted);font-size:10px" id="fee-display">ãƒ©ãƒ³ã‚¯åˆ¥</td>
              <td style="font-size:11px">Visa Â·Â·Â·8877</td><td><span class="pill pr">âœ— å¤±æ•—</span></td>
              <td style="font-size:11px;color:var(--red)">ã‚«ãƒ¼ãƒ‰æœŸé™åˆ‡ã‚Œ</td></tr>
          <tr><td class="mono">99001</td><td style="color:var(--muted)">ï¼ˆã‚¢ã‚«ã‚¦ãƒ³ãƒˆåœæ­¢ï¼‰</td>
              <td class="mono" style="color:var(--muted)">ãƒ©ãƒ³ã‚¯åˆ¥</td>
              <td style="font-size:11px;color:var(--muted)">â€”</td>
              <td><span class="pill pm">â›” é™¤å¤–</span></td>
              <td style="font-size:11px;color:var(--muted)">2026/02/10 HQåœæ­¢</td></tr>
        </tbody>
      </table>
    </div>
  </div>
</div>

<script>
// â•â• AUTH GUARD (HQå°‚ç”¨ãƒšãƒ¼ã‚¸) â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
(function() {
  var s = null;
  try { s = JSON.parse(sessionStorage.getItem('coreto_session') || 'null'); } catch(e) {}
  if (!s || s.type !== 'hq') { location.replace('coreto-hub.html'); }
  window._SESSION = s;
})();

// â”€â”€â”€ ãƒ‡ãƒ¢ ãƒ‡ãƒ¼ã‚¿ â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
const yen = v => 'Â¥' + Math.round(v).toLocaleString();
const AGENTS = [
  {id:'10012',name:'å±±ç”° èª ',   type:'re',rank:'Gold',    cases:5, gross:1200000, fee:0, adj:0, bank:'GMOã‚ãŠãã‚‰Â·Â·Â·4567', itCount:4, itFee:6000, sennin:true},
  {id:'10008',name:'ä½è—¤ èŠ±å­', type:'re',rank:'Platinum',cases:8, gross:1800000, fee:0, adj:0, bank:'ä¸‰è±UFJÂ·Â·Â·3210', itCount:6, itFee:5000, sennin:true},
  {id:'10023',name:'éˆ´æœ¨ å¥å¤ª', type:'re',rank:'Silver',  cases:3, gross:720000,  fee:490, adj:5000, bank:'æ¥½å¤©Â·Â·Â·8877', itCount:2, itFee:4500, sennin:false},
  {id:'10041',name:'æ¸¡è¾º éš†',   type:'re',rank:'Bronze',  cases:1, gross:240000,  fee:980, adj:0, bank:'ã‚†ã†ã¡ã‚‡Â·Â·Â·2345', itCount:1, itFee:5000, sennin:true},
  {id:'20005',name:'ç”°ä¸­ ç¾ç©‚', type:'hr',rank:'Gold',    cases:4, gross:860000,  fee:0, adj:0, bank:'PayPayÂ·Â·Â·7654', itCount:0, itFee:0, sennin:false},
];

function calcRow(ag) {
  const total = ag.gross - ag.fee + ag.adj;
  const tax   = total <= 1000000 ? Math.floor(total*0.1021) : Math.floor(1000000*0.1021+(total-1000000)*0.2042);
  const net   = total - tax;
  return { total, tax, net };
}

function renderTable() {
  const tbody = document.getElementById('payroll-body');
  let totCases=0, totGross=0, totFee=0, totAdj=0, totTotal=0, totTax=0, totNet=0;
  tbody.innerHTML = AGENTS.map(ag => {
    const {total,tax,net} = calcRow(ag);
    totCases+=ag.cases; totGross+=ag.gross; totFee+=ag.fee; totAdj+=ag.adj;
    totTotal+=total; totTax+=tax; totNet+=net;
    const rankColor = {Gold:'var(--gold)',Platinum:'var(--purple)',Silver:'#c0c0c0',Bronze:'#cd7f32'}[ag.rank]||'var(--sub)';
    return `<tr>
      <td class="mono">${ag.id}</td>
      <td style="font-weight:700">${ag.name}</td>
      <td><span class="pill ${ag.type==='re'?'pb':'pg'}">${ag.type==='re'?'RE':'HR'}</span></td>
      <td style="color:${rankColor};font-weight:700;font-size:11px">${ag.rank}</td>
      <td class="mono">${ag.cases}ä»¶</td>
      <td class="mono">${yen(ag.gross)}</td>
      <td class="mono" style="color:var(--red)">-${yen(ag.fee)}</td>
      <td class="mono" style="color:var(--purple)">${ag.itCount>0 ? '+'+yen((ag.itCount||0)*(ag.itFee||0))+"ï¼ˆ"+ag.itCount+"ä»¶ï¼‰" : "â€”"}</td>
      <td><input type="number" value="${ag.adj}" step="1000"
                 onchange="AGENTS.find(a=>a.id==='${ag.id}').adj=+this.value; recalcAll()"
                 style="width:90px"></td>
      <td class="mono" style="font-weight:700">${yen(total)}</td>
      <td class="mono" style="color:var(--orange)">-${yen(tax)}</td>
      <td class="mono" style="color:var(--green);font-weight:700">${yen(net)}</td>
      <td style="font-size:10px;color:var(--muted)">${ag.bank}</td>
      <td><span class="pill pg">ç¢ºèªæ¸ˆã¿</span></td>
    </tr>`;
  }).join('');
  // footer
  document.getElementById('ft-cases').textContent  = totCases+'ä»¶';
  document.getElementById('ft-gross').textContent  = yen(totGross);
  document.getElementById('ft-fee').textContent    = '-'+yen(totFee);
  document.getElementById('ft-adj').textContent   = yen(totAdj);
  document.getElementById('ft-total').textContent  = yen(totTotal);
  document.getElementById('ft-tax').textContent    = '-'+yen(totTax);
  document.getElementById('ft-net').textContent    = yen(totNet);
  // update KPI
  document.getElementById('stat-total').textContent = yen(totGross);
  document.getElementById('stat-tax').textContent   = yen(totTax);
  document.getElementById('stat-net').textContent   = yen(totNet);
  document.getElementById('stat-count').textContent = AGENTS.length+'å';
}

function recalcAll() { renderTable(); }

function selMonth(btn, m) {
  document.querySelectorAll('.month-tab').forEach(b=>b.classList.remove('on'));
  btn.classList.add('on');
}

function approvePayroll() {
  if (!confirm('2026å¹´2æœˆåˆ†ã®å ±é…¬ã‚’ç¢ºå®šã—HQæ‰¿èªã—ã¾ã™ã‹ï¼Ÿ\nç¢ºå®šå¾Œã¯é‡‘é¡ã®å¤‰æ›´ãŒã§ãã¾ã›ã‚“ã€‚')) return;
  document.getElementById('sp2').className='step-item done';
  document.getElementById('sp2').querySelector('.step-num').textContent='âœ“';
  document.getElementById('sp3').className='step-item done';
  document.getElementById('sp3').querySelector('.step-num').textContent='âœ“';
  document.getElementById('sp4').className='step-item on';
  document.getElementById('transfer-card').style.display='block';
  document.getElementById('transfer-card').scrollIntoView({behavior:'smooth'});
  alert('âœ… 2026å¹´2æœˆåˆ†å ±é…¬ã‚’ç¢ºå®šã—ã¾ã—ãŸã€‚\næŒ¯è¾¼æŒ‡ç¤ºãƒ•ã‚¡ã‚¤ãƒ«ã‚’ç”Ÿæˆã—ã¦ãã ã•ã„ã€‚');
}

function generateZengin() {
  const fmt = document.querySelector('input[name="fmt"]:checked').value;
  if (fmt === 'zengin') {
    // å…¨éŠ€ãƒ•ã‚©ãƒ¼ãƒãƒƒãƒˆç”Ÿæˆ
    let zengin = '1', header='';
    header = '21' + // ç¨®åˆ¥
      'CORETO'.padEnd(40,' ') + // å§”è¨—è€…å
      '0123456789' + // å§”è¨—è€…ã‚³ãƒ¼ãƒ‰
      '20260225' + // æŒ¯è¾¼æ—¥
      '0010' + // éŠ€è¡Œã‚³ãƒ¼ãƒ‰ï¼ˆGMOã‚ãŠãã‚‰ï¼‰
      '010' + // æ”¯åº—ã‚³ãƒ¼ãƒ‰
      '1' + // é é‡‘ç¨®åˆ¥
      '1234567'; // å£åº§ç•ªå·
    const rows = AGENTS.map(ag => {
      const {net} = calcRow(ag);
      return `21${ag.bank.padEnd(15,' ')}${String(Math.round(net)).padStart(10,'0')}${ag.name.padEnd(30,' ')}`;
    }).join('\r\n');
    const total = AGENTS.reduce((s,ag)=>s+calcRow(ag).net,0);
    const trailer = `80${String(AGENTS.length).padStart(6,'0')}${String(Math.round(total)).padStart(12,'0')}`;
    const content = [header,rows,trailer,'99'].join('\r\n');
    const blob = new Blob([content],{type:'text/plain;charset=shift-jis'});
    const a = document.createElement('a');
    a.href = URL.createObjectURL(blob);
    a.download = `coreto_transfer_202602.txt`;
    a.click();
  } else {
    exportCSV();
  }
  document.getElementById('sp4').className='step-item done';
  document.getElementById('sp4').querySelector('.step-num').textContent='âœ“';
  document.getElementById('sp5').className='step-item on';
  setTimeout(()=>{
    if(confirm('æŒ¯è¾¼æŒ‡ç¤ºãƒ•ã‚¡ã‚¤ãƒ«ã‚’ç”Ÿæˆã—ã¾ã—ãŸã€‚\nå…¨ã‚¨ãƒ¼ã‚¸ã‚§ãƒ³ãƒˆã«å ±é…¬æ˜ç´°ã‚’Slackã§é€šçŸ¥ã—ã¾ã™ã‹ï¼Ÿ')) sendPayslips();
  },400);
}

function exportCSV() {
  const header = ['ID','æ°å','ç¨®åˆ¥','ãƒ©ãƒ³ã‚¯','æ¡ˆä»¶æ•°','æˆç´„å ±é…¬','ä¼šè²»','èª¿æ•´é¡','æ”¯æ‰•é¡','æºæ³‰å¾´å','å®ŸæŒ¯è¾¼é¡','å£åº§'];
  const rows = AGENTS.map(ag => {
    const {total,tax,net} = calcRow(ag);
    return [ag.id,ag.name,ag.type,ag.rank,ag.cases,ag.gross,-ag.fee,ag.adj,total,-tax,net,ag.bank];
  });
  const csv = [header,...rows].map(r=>r.join(',')).join('\n');
  const blob = new Blob(['\uFEFF'+csv],{type:'text/csv'});
  const a = document.createElement('a');
  a.href = URL.createObjectURL(blob);
  a.download = 'coreto_payroll_202602.csv';
  a.click();
}

function sendPayslips() {
  document.getElementById('sp5').className='step-item done';
  document.getElementById('sp5').querySelector('.step-num').textContent='âœ“';
  alert('âœ… å…¨ã‚¨ãƒ¼ã‚¸ã‚§ãƒ³ãƒˆã«2026å¹´2æœˆåˆ†ã®å ±é…¬æ˜ç´°ã‚’Slackã§é€ä¿¡ã—ã¾ã—ãŸã€‚');
}

renderTable();

// â”€â”€ ç´¹ä»‹ãƒªãƒ³ã‚¯ãƒ¢ãƒ¼ãƒ€ãƒ« â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
var _refCurrentCode = '';
function openRefModal() {
  var overlay = document.getElementById('ref-modal-overlay');
  var selector = document.getElementById('ref-code-selector');
  var isExec = (typeof session !== 'undefined' && session && session.hqRole === 'exec')
            || (typeof CURRENT_USER !== 'undefined' && CURRENT_USER && CURRENT_USER.hqRole === 'exec');
  var agentId = (typeof session !== 'undefined' && session && session.userId) ? session.userId
              : (typeof ME !== 'undefined' && ME && ME.id) ? ME.id
              : (typeof AGENT !== 'undefined' && AGENT && AGENT.id) ? AGENT.id : '10012';
  if (isExec) {
    var SPECIAL = ['FOUNDER2026','WELCOME2026','GOLD_START','HR_PRO75'];
    var opts = SPECIAL.map(function(c){ return '<option value="'+c+'">â­ '+c+'</option>'; }).join('');
    selector.innerHTML =
      '<div style="margin-bottom:12px"><div style="font-size:10px;color:var(--sub);font-weight:600;margin-bottom:5px">ã‚³ãƒ¼ãƒ‰ç¨®åˆ¥</div>'
      +'<select id="ref-code-select" onchange="updateRefLink()" style="width:100%;padding:8px 10px;background:var(--card2);border:1px solid var(--border2);border-radius:8px;color:var(--text);font-size:12px;font-family:inherit">'
      +'<option value="'+agentId+'">è‡ªåˆ†ã®IDï¼ˆ'+agentId+'ï¼‰</option>'
      +'<optgroup label="â”€â”€ ç‰¹åˆ¥ã‚³ãƒ¼ãƒ‰ â”€â”€">'+opts+'</optgroup>'
      +'</select></div>';
    _refCurrentCode = agentId;
  } else {
    selector.innerHTML =
      '<div style="display:flex;align-items:center;gap:8px;margin-bottom:12px;padding:8px 12px;background:rgba(201,168,76,.06);border:1px solid rgba(201,168,76,.2);border-radius:8px">'
      +'<span style="font-size:11px;color:var(--muted)">ç´¹ä»‹ã‚³ãƒ¼ãƒ‰ï¼š</span>'
      +'<span style="font-family:\'DM Mono\',monospace;font-size:13px;font-weight:700;color:var(--gold)">'+agentId+'</span>'
      +'</div>';
    _refCurrentCode = agentId;
  }
  updateRefLink();
  overlay.classList.add('open');
}
function updateRefLink() {
  var sel = document.getElementById('ref-code-select');
  if (sel) _refCurrentCode = sel.value;
  var base = location.origin + location.pathname.replace(/[^/]*$/, '') + 'coreto-agent-signup.html';
  var url = base + '?ref=' + encodeURIComponent(_refCurrentCode);
  document.getElementById('ref-url-display').textContent = url;
}
function closeRefModal() {
  document.getElementById('ref-modal-overlay').classList.remove('open');
}
function copyRefLink() {
  var url = document.getElementById('ref-url-display').textContent;
  navigator.clipboard.writeText(url).then(function() {
    var btn = document.querySelector('.ref-copy-btn');
    btn.textContent = 'âœ… ã‚³ãƒ”ãƒ¼ã—ã¾ã—ãŸ';
    setTimeout(function(){ btn.textContent = 'ğŸ“‹ ã‚³ãƒ”ãƒ¼'; }, 2000);
  }).catch(function() {
    var ta = document.createElement('textarea');
    ta.value = url; document.body.appendChild(ta); ta.select();
    document.execCommand('copy'); document.body.removeChild(ta);
  });
}
</script>

<div id="ref-modal-overlay" onclick="if(event.target===this)closeRefModal()">
  <div id="ref-modal">
    <div class="ref-mhdr">
      <div class="ref-mhdr-t">ğŸ”— ç´¹ä»‹ãƒªãƒ³ã‚¯ç™ºè¡Œ</div>
      <button onclick="closeRefModal()" style="background:none;border:none;color:var(--muted);font-size:20px;cursor:pointer;line-height:1">Ã—</button>
    </div>
    <div class="ref-mbody">
      <div style="font-size:11px;color:var(--sub);margin-bottom:14px;line-height:1.8">ã“ã®ãƒªãƒ³ã‚¯ã‹ã‚‰å…¥ä¼šã™ã‚‹ã¨ç´¹ä»‹ã‚³ãƒ¼ãƒ‰ãŒè‡ªå‹•å…¥åŠ›ã•ã‚Œã¾ã™ã€‚</div>
      <div id="ref-code-selector"></div>
      <div style="font-size:10px;color:var(--muted);margin-bottom:4px;font-weight:600;letter-spacing:.5px">ç™ºè¡Œãƒªãƒ³ã‚¯</div>
      <div class="ref-url" id="ref-url-display">â€”</div>
      <button class="ref-copy-btn" onclick="copyRefLink()">ğŸ“‹ ã‚³ãƒ”ãƒ¼</button>
    </div>
  </div>
</div>

<button id="ref-float-btn" onclick="openRefModal()">ğŸ”— ç´¹ä»‹ãƒªãƒ³ã‚¯ç™ºè¡Œ</button>
</body>
</html>
