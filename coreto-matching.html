<!DOCTYPE html>
<html lang="ja">
<head>
  <!-- â”€â”€ Content Security Policy (XSSè»½æ¸›) â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
       å¤‰æ›´æ™‚: ä½¿ç”¨ã™ã‚‹å¤–éƒ¨ã‚µãƒ¼ãƒ“ã‚¹ã®ã‚ªãƒªã‚¸ãƒ³ã‚’è¿½åŠ ã—ã¦ãã ã•ã„
       Kintoneè¿½åŠ æ™‚: connect-src ã« *.cybozu.com ã‚’è¿½åŠ 
  â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ -->
  <meta http-equiv="Content-Security-Policy" content="
    default-src 'self';
    script-src 'self' 'unsafe-inline'
      https://cdnjs.cloudflare.com
      https://js.stripe.com
      https://cdn-cgi/scripts;
    style-src 'self' 'unsafe-inline'
      https://fonts.googleapis.com;
    font-src 'self'
      https://fonts.gstatic.com;
    img-src 'self' data: blob:;
    connect-src 'self'
      https://hooks.slack.com
      https://hooks.zapier.com
      https://api.stripe.com
      https://js.stripe.com
      https://www.houjin-bangou.nta.go.jp
      https://www.retio.or.jp;
    frame-src 'none';
    object-src 'none';
    base-uri 'self';
  ">

<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>CORETO ãƒãƒƒãƒãƒ³ã‚°ã‚·ã‚¹ãƒ†ãƒ </title>
<style>
@import url('https://fonts.googleapis.com/css2?family=Noto+Sans+JP:wght@300;400;500;700&family=DM+Mono:wght@400;500&display=swap');
*{box-sizing:border-box;margin:0;padding:0}
:root{
  --bg:#0b0d12;--card:#13161f;--card2:#191c27;--border:#222638;
  --gold:#c9a84c;--gold-l:#e8c96a;--gold-dim:#7a5f22;
  --blue:#3b82f6;--green:#22c55e;--red:#ef4444;--orange:#f59e0b;--purple:#a855f7;--teal:#14b8a6;
  --muted:#5a6378;--sub:#8892a4;--text:#dde1ed;
}
body{font-family:'Noto Sans JP',sans-serif;background:var(--bg);color:var(--text);min-height:100vh}

/* â”€â”€ ãƒ˜ãƒƒãƒ€ãƒ¼ â”€â”€ */
.header{background:linear-gradient(135deg,#0d1020,#141828);border-bottom:1px solid var(--border);padding:0 28px;display:flex;align-items:center;justify-content:space-between;height:52px}
.logo{font-family:'DM Mono',monospace;font-size:18px;color:var(--gold);letter-spacing:3px}
.logo-sub{font-size:9px;color:var(--muted);letter-spacing:1px;margin-top:1px}
.hdr-right{display:flex;align-items:center;gap:12px}
.role-badge{font-size:10px;padding:3px 10px;border-radius:20px;font-weight:700;letter-spacing:.5px}
.rb-hq{background:rgba(168,85,247,.2);color:var(--purple);border:1px solid rgba(168,85,247,.3)}
.rb-ag{background:rgba(59,130,246,.2);color:var(--blue);border:1px solid rgba(59,130,246,.3)}
.rb-pt{background:rgba(34,197,94,.2);color:var(--green);border:1px solid rgba(34,197,94,.3)}
.role-sw{display:flex;gap:4px}
.rsw{font-size:10px;padding:3px 8px;border-radius:4px;cursor:pointer;border:1px solid var(--border);background:transparent;color:var(--muted);font-family:'Noto Sans JP',sans-serif}
.rsw.on{background:rgba(201,168,76,.15);border-color:var(--gold-dim);color:var(--gold)}

/* â”€â”€ ã‚¿ãƒ– â”€â”€ */
.tabs{background:#0e1019;border-bottom:1px solid var(--border);display:flex;padding:0 28px;gap:0}
.tab{padding:11px 18px;font-size:11px;cursor:pointer;border-bottom:2px solid transparent;color:var(--muted);transition:all .2s;white-space:nowrap}
.tab.on{color:var(--gold);border-bottom-color:var(--gold)}
.tab-badge{display:inline-flex;align-items:center;justify-content:center;width:16px;height:16px;border-radius:50%;font-size:9px;font-weight:700;margin-left:5px;background:var(--red);color:#fff}

/* â”€â”€ ãƒšãƒ¼ã‚¸ â”€â”€ */
.page{display:none;padding:20px 28px;max-width:1320px;margin:0 auto}.page.on{display:block}

/* â”€â”€ å…±é€šã‚³ãƒ³ãƒãƒ¼ãƒãƒ³ãƒˆ â”€â”€ */
.panel{background:var(--card);border:1px solid var(--border);border-radius:12px;padding:18px;margin-bottom:14px}
.panel-title{font-size:11px;font-weight:700;color:var(--gold);letter-spacing:2px;text-transform:uppercase;margin-bottom:14px;display:flex;align-items:center;gap:8px}
.panel-title::before{content:'';width:3px;height:13px;background:var(--gold);border-radius:2px;flex-shrink:0}
.s-label{font-size:9px;color:var(--muted);letter-spacing:2px;text-transform:uppercase;padding:9px 0 6px;border-bottom:1px solid rgba(34,38,56,.8);margin-bottom:9px;margin-top:12px}
.s-label:first-child{margin-top:0}
.fg{margin-bottom:9px}
.fg label{font-size:11px;color:var(--sub);display:block;margin-bottom:3px}
.fg input,.fg select,.fg textarea{width:100%;background:#0d0f18;border:1px solid var(--border);border-radius:7px;padding:8px 11px;color:var(--text);font-size:13px;font-family:'Noto Sans JP',sans-serif;transition:border-color .15s}
.fg textarea{resize:vertical;min-height:70px}
.fg input:focus,.fg select:focus,.fg textarea:focus{outline:none;border-color:var(--gold)}
.mono{font-family:'DM Mono',monospace}
.row2{display:grid;grid-template-columns:1fr 1fr;gap:10px}
.row3{display:grid;grid-template-columns:1fr 1fr 1fr;gap:10px}
.tg-group{display:flex;gap:6px;flex-wrap:wrap;margin-top:4px}
.tg{padding:5px 11px;border-radius:6px;font-size:11px;cursor:pointer;border:1px solid var(--border);background:transparent;color:var(--sub);font-family:'Noto Sans JP',sans-serif;transition:all .15s}
.tg.on{background:rgba(201,168,76,.15);border-color:var(--gold-dim);color:var(--gold);font-weight:700}
.tg.on.blue{background:rgba(59,130,246,.15);border-color:rgba(59,130,246,.4);color:var(--blue)}
.tg.on.green{background:rgba(34,197,94,.15);border-color:rgba(34,197,94,.4);color:var(--green)}
.tg.on.red{background:rgba(239,68,68,.15);border-color:rgba(239,68,68,.4);color:var(--red)}

/* â”€â”€ ãƒœã‚¿ãƒ³ â”€â”€ */
.btn{padding:10px 18px;border-radius:8px;font-size:12px;font-weight:700;cursor:pointer;border:none;font-family:'Noto Sans JP',sans-serif;transition:all .15s;letter-spacing:.5px}
.btn-gold{background:var(--gold);color:#0a0c10}.btn-gold:hover{background:var(--gold-l)}
.btn-blue{background:rgba(59,130,246,.2);color:var(--blue);border:1px solid rgba(59,130,246,.4)}.btn-blue:hover{background:rgba(59,130,246,.3)}
.btn-green{background:rgba(34,197,94,.2);color:var(--green);border:1px solid rgba(34,197,94,.4)}.btn-green:hover{background:rgba(34,197,94,.3)}
.btn-red{background:rgba(239,68,68,.2);color:var(--red);border:1px solid rgba(239,68,68,.4)}.btn-red:hover{background:rgba(239,68,68,.3)}
.btn-muted{background:transparent;color:var(--muted);border:1px solid var(--border)}.btn-muted:hover{color:var(--text)}
.btn-sm{padding:5px 11px;font-size:10px;border-radius:5px}
.btn-full{width:100%;padding:12px;font-size:13px;margin-top:8px}

/* â”€â”€ ã‚¢ãƒ©ãƒ¼ãƒˆ â”€â”€ */
.alert{border-radius:8px;padding:10px 13px;font-size:11px;line-height:1.7;margin-bottom:12px}
.ao{background:rgba(245,158,11,.07);border:1px solid rgba(245,158,11,.22);color:var(--orange)}
.ag{background:rgba(34,197,94,.07);border:1px solid rgba(34,197,94,.22);color:var(--green)}
.ab{background:rgba(59,130,246,.07);border:1px solid rgba(59,130,246,.22);color:var(--blue)}
.ar{background:rgba(239,68,68,.07);border:1px solid rgba(239,68,68,.22);color:var(--red)}
.ap{background:rgba(168,85,247,.07);border:1px solid rgba(168,85,247,.22);color:var(--purple)}

/* â”€â”€ ãƒãƒƒã‚¸ â”€â”€ */
.badge{display:inline-flex;align-items:center;padding:2px 7px;border-radius:4px;font-size:9px;font-weight:700;white-space:nowrap}
.bdg-re{background:rgba(59,130,246,.15);color:var(--blue)}
.bdg-hr{background:rgba(20,184,166,.15);color:var(--teal)}
.bdg-pt{background:rgba(34,197,94,.15);color:var(--green)}
.bdg-hq{background:rgba(168,85,247,.15);color:var(--purple)}
.bdg-gold{background:rgba(201,168,76,.15);color:var(--gold)}
.bdg-wait{background:rgba(245,158,11,.15);color:var(--orange)}
.bdg-matched{background:rgba(34,197,94,.15);color:var(--green)}
.bdg-open{background:rgba(59,130,246,.15);color:var(--blue)}
.bdg-closed{background:rgba(90,99,120,.15);color:var(--muted)}

/* â”€â”€ æ¡ˆä»¶ã‚«ãƒ¼ãƒ‰ â”€â”€ */
.case-grid{display:grid;grid-template-columns:repeat(auto-fill,minmax(340px,1fr));gap:14px;margin-bottom:14px}
.case-card{background:var(--card);border:1px solid var(--border);border-radius:12px;padding:16px;cursor:pointer;transition:border-color .15s;position:relative}
.case-card:hover{border-color:rgba(201,168,76,.4)}
.case-card.selected{border-color:var(--gold);box-shadow:0 0 0 1px var(--gold-dim)}
.case-card.matched{border-color:rgba(34,197,94,.4)}
.case-card.applying{border-color:rgba(59,130,246,.4)}
.cc-head{display:flex;justify-content:space-between;align-items:flex-start;margin-bottom:10px}
.cc-id{font-family:'DM Mono',monospace;font-size:10px;color:var(--muted)}
.cc-badges{display:flex;gap:5px;flex-wrap:wrap}
.cc-title{font-size:14px;font-weight:700;margin-bottom:4px;color:var(--text)}
.cc-sub{font-size:11px;color:var(--sub);margin-bottom:8px}
.cc-meta{display:grid;grid-template-columns:1fr 1fr;gap:4px;margin-bottom:10px}
.cc-meta-item{font-size:10px;color:var(--muted)}.cc-meta-item span{color:var(--sub);font-weight:500}
.cc-footer{display:flex;justify-content:space-between;align-items:center;padding-top:10px;border-top:1px solid rgba(34,38,56,.6)}
.cc-timer{font-size:10px;color:var(--orange);display:flex;align-items:center;gap:4px}
.cc-apply-count{font-size:10px;color:var(--muted)}
.cc-status-bar{position:absolute;top:0;left:0;right:0;height:3px;border-radius:12px 12px 0 0}
.sb-open{background:linear-gradient(90deg,var(--blue),rgba(59,130,246,.3))}
.sb-matched{background:linear-gradient(90deg,var(--green),rgba(34,197,94,.3))}
.sb-closed{background:var(--border)}
.sb-pending{background:linear-gradient(90deg,var(--orange),rgba(245,158,11,.3))}

/* â”€â”€ æ¡ˆä»¶è©³ç´°ãƒ¢ãƒ¼ãƒ€ãƒ«é¢¨ã‚µã‚¤ãƒ‰ãƒ‘ãƒãƒ« â”€â”€ */
.detail-wrap{display:grid;grid-template-columns:1fr 380px;gap:14px}
@media(max-width:1100px){.detail-wrap{grid-template-columns:1fr}}
.detail-panel{background:var(--card);border:1px solid var(--border);border-radius:12px;padding:20px;position:sticky;top:20px;height:fit-content}
.dp-section{margin-bottom:16px}
.dp-label{font-size:9px;color:var(--muted);letter-spacing:2px;text-transform:uppercase;margin-bottom:6px}
.dp-val{font-size:13px;color:var(--text)}
.dp-divider{height:1px;background:var(--border);margin:14px 0}
.masked{font-size:13px;color:var(--muted);font-style:italic;display:flex;align-items:center;gap:6px}
.mask-icon{font-size:16px}

/* â”€â”€ å¿œå‹Ÿè€…ãƒªã‚¹ãƒˆ â”€â”€ */
.applicant-list{display:flex;flex-direction:column;gap:8px}
.applicant-row{background:var(--card2);border:1px solid var(--border);border-radius:9px;padding:11px 14px;display:flex;align-items:center;justify-content:space-between;gap:10px}
.applicant-row.first{border-color:rgba(201,168,76,.4);background:rgba(201,168,76,.04)}
.ap-info{flex:1}
.ap-name{font-size:13px;font-weight:600}
.ap-meta{font-size:10px;color:var(--muted);margin-top:2px;display:flex;gap:8px;align-items:center}
.ap-time{font-family:'DM Mono',monospace;font-size:10px;color:var(--orange)}
.ap-rank{font-size:10px;padding:2px 6px;border-radius:4px;font-weight:700}
.rank-bronze{background:rgba(180,120,60,.15);color:#cd7f32}
.rank-silver{background:rgba(160,160,160,.15);color:#c0c0c0}
.rank-gold{background:rgba(201,168,76,.15);color:var(--gold)}
.rank-platinum{background:rgba(200,200,255,.12);color:#b0c4de}
.rank-founding{background:rgba(168,85,247,.15);color:var(--purple)}

/* â”€â”€ ã‚¿ã‚¤ãƒ ãƒ©ã‚¤ãƒ³ â”€â”€ */
.tl{display:flex;flex-direction:column}
.tl-row{display:flex;gap:10px;padding-bottom:10px}
.tl-row:last-child{padding-bottom:0}
.tl-left{display:flex;flex-direction:column;align-items:center;width:14px;flex-shrink:0}
.tl-dot{width:9px;height:9px;border-radius:50%;border:2px solid var(--gold);background:var(--bg);margin-top:3px;flex-shrink:0}
.tl-dot.g{border-color:var(--green);background:var(--green)}
.tl-dot.o{border-color:var(--orange);background:var(--orange)}
.tl-dot.b{border-color:var(--blue);background:var(--blue)}
.tl-dot.f{background:var(--gold)}
.tl-dot.m{border-color:var(--muted);background:transparent}
.tl-line{width:1px;background:var(--border);flex:1;margin-top:2px}
.tl-row:last-child .tl-line{display:none}
.tl-date{font-family:'DM Mono',monospace;font-size:10px;color:var(--gold)}
.tl-event{font-size:11px;margin-top:1px}
.tl-sub{font-size:10px;color:var(--muted);margin-top:2px;line-height:1.5}

/* â”€â”€ ãƒ•ã‚£ãƒ«ã‚¿ãƒ¼ãƒãƒ¼ â”€â”€ */
.filter-bar{display:flex;gap:8px;align-items:center;flex-wrap:wrap;margin-bottom:14px;padding-bottom:12px;border-bottom:1px solid var(--border)}
.filter-chip{padding:4px 12px;border-radius:20px;font-size:11px;cursor:pointer;border:1px solid var(--border);background:transparent;color:var(--muted);font-family:'Noto Sans JP',sans-serif;transition:all .15s}
.filter-chip.on{background:rgba(201,168,76,.15);border-color:var(--gold-dim);color:var(--gold);font-weight:700}
.search-box{flex:1;min-width:180px;max-width:280px;position:relative}
.search-box input{background:#0d0f18;border:1px solid var(--border);border-radius:20px;padding:5px 12px 5px 30px;color:var(--text);font-size:11px;width:100%;font-family:'Noto Sans JP',sans-serif}
.search-box::before{content:'ğŸ”';position:absolute;left:10px;top:50%;transform:translateY(-50%);font-size:11px}

/* â”€â”€ çµ±è¨ˆã‚«ãƒ¼ãƒ‰ â”€â”€ */
.stats-row{display:grid;grid-template-columns:repeat(4,1fr);gap:10px;margin-bottom:14px}
@media(max-width:900px){.stats-row{grid-template-columns:repeat(2,1fr)}}
.stat-card{background:var(--card);border:1px solid var(--border);border-radius:10px;padding:14px}
.stat-num{font-family:'DM Mono',monospace;font-size:28px;font-weight:500;line-height:1}
.stat-label{font-size:10px;color:var(--muted);margin-top:4px}

.empty{text-align:center;padding:48px 20px;color:var(--muted);font-size:13px;line-height:2}
.hidden{display:none!important}
::-webkit-scrollbar{width:5px}::-webkit-scrollbar-thumb{background:var(--border);border-radius:3px}

/* æ¡ˆä»¶ã‚½ãƒ¼ã‚¹åˆ¥ã‚«ãƒ©ãƒ¼ */
.src-pt .cc-status-bar{background:linear-gradient(90deg,var(--green),rgba(34,197,94,.2))}
.src-hq .cc-status-bar{background:linear-gradient(90deg,var(--purple),rgba(168,85,247,.2))}
.src-self .cc-status-bar{background:linear-gradient(90deg,var(--blue),rgba(59,130,246,.2))}

/* é€šçŸ¥ãƒ‰ãƒƒãƒˆ */
.notify-dot{width:8px;height:8px;border-radius:50%;background:var(--red);display:inline-block;margin-left:4px;animation:blink 1.5s infinite}
@keyframes blink{0%,100%{opacity:1}50%{opacity:.3}}

/* ç¢ºèªãƒ€ã‚¤ã‚¢ãƒ­ã‚°é¢¨ */
.confirm-box{background:rgba(201,168,76,.06);border:1px solid rgba(201,168,76,.25);border-radius:10px;padding:16px;margin-bottom:12px}

/* â”€â”€ Client Autocomplete â”€â”€ */
.cl-search-wrap{position:relative}
.cl-input{width:100%;padding:9px 12px;background:var(--input-bg,#1a1e2a);border:1px solid var(--border);border-radius:8px;color:var(--text,#e8eaf0);font-size:12px;font-family:inherit;outline:none;transition:border-color .15s}
.cl-input:focus{border-color:var(--gold,#c9a840)}
.cl-dropdown{position:absolute;top:calc(100% + 4px);left:0;right:0;background:var(--card,#151822);border:1px solid var(--border2,#2e3447);border-radius:8px;z-index:999;max-height:200px;overflow-y:auto;box-shadow:0 8px 24px rgba(0,0,0,.5);display:none}
.cl-option{padding:9px 13px;cursor:pointer;border-bottom:1px solid var(--border,#2a2f42);display:flex;align-items:center;gap:10px;transition:background .1s}
.cl-option:last-child{border-bottom:none}
.cl-option:hover,.cl-option.focused{background:rgba(201,168,64,.1)}
.cl-opt-id{font-family:'DM Mono',monospace;font-size:10px;color:var(--gold,#c9a840);min-width:80px;flex-shrink:0}
.cl-opt-name{font-size:12px;font-weight:600}
.cl-opt-kana{font-size:10px;color:var(--muted,#4a4f68)}
.cl-hint{padding:7px 13px;font-size:10px;color:var(--muted,#4a4f68);border-top:1px solid var(--border,#2a2f42)}

/* â”€â”€ ç´¹ä»‹ãƒªãƒ³ã‚¯ãƒ¢ãƒ¼ãƒ€ãƒ« â”€â”€ */
#ref-modal-overlay{display:none;position:fixed;inset:0;background:rgba(0,0,0,.65);z-index:9000;align-items:center;justify-content:center}
#ref-modal-overlay.open{display:flex}
#ref-modal{background:var(--card);border:1px solid var(--border2);border-radius:16px;padding:0;width:min(460px,92vw);overflow:hidden}
.ref-mhdr{padding:16px 20px;border-bottom:1px solid var(--border);display:flex;align-items:center;justify-content:space-between}
.ref-mhdr-t{font-family:'Syne',sans-serif;font-size:14px;font-weight:800;color:var(--gold)}
.ref-mbody{padding:20px}
.ref-url{background:var(--card2);border:1px solid var(--border2);border-radius:8px;padding:10px 12px;font-family:'DM Mono',monospace;font-size:11px;color:var(--sub);word-break:break-all;margin:10px 0;min-height:36px}
.ref-copy-btn{width:100%;padding:10px;border-radius:8px;border:none;cursor:pointer;font-family:inherit;font-size:13px;font-weight:700;background:var(--gold);color:#0a0c10;margin-top:4px}
.ref-copy-btn:hover{opacity:.9}

/* â”€â”€ ç´¹ä»‹ãƒªãƒ³ã‚¯ å·¦ãƒ•ãƒ­ãƒ¼ãƒ†ã‚£ãƒ³ã‚°ãƒœã‚¿ãƒ³ â”€â”€ */
#ref-float-btn {
  position: fixed;
  left: 0;
  top: 50%;
  transform: translateY(-50%) translateX(-100%) rotate(-90deg);
  transform-origin: right bottom;
  z-index: 8000;
  background: rgba(201,168,76,.18);
  border: 1px solid rgba(201,168,76,.4);
  border-bottom: none;
  border-radius: 8px 8px 0 0;
  color: var(--gold);
  padding: 6px 16px;
  font-size: 11px;
  font-weight: 700;
  font-family: inherit;
  cursor: pointer;
  white-space: nowrap;
  letter-spacing: .5px;
  transition: background .15s;
}
#ref-float-btn:hover { background: rgba(201,168,76,.32); }
</style>
</head>
<body>

<!-- â”€â”€ ãƒ˜ãƒƒãƒ€ãƒ¼ â”€â”€ -->
<div class="header">
  <div>
    <div class="logo">CORETO</div>
    <div class="logo-sub">ãƒãƒƒãƒãƒ³ã‚°ã‚·ã‚¹ãƒ†ãƒ </div>
  </div>
  <div class="hdr-right">
    <div class="role-sw">
      <button class="rsw on" onclick="setRole('hq',this)">æœ¬éƒ¨HQ</button>
      <button class="rsw" onclick="setRole('ag',this)">ã‚¨ãƒ¼ã‚¸ã‚§ãƒ³ãƒˆ</button>
      <button class="rsw" onclick="setRole('pt',this)">ãƒ‘ãƒ¼ãƒˆãƒŠãƒ¼</button>
    </div>
    <div id="role-badge" class="role-badge rb-hq">æœ¬éƒ¨ HQ</div>
  </div>
</div>

<!-- â”€â”€ ã‚¿ãƒ– â”€â”€ -->
<div class="tabs" id="tabs-bar">
  <!-- HQ tabs -->
  <div class="tab on" id="tab-board" onclick="switchTab('board')">ğŸ“‹ æ¡ˆä»¶ãƒœãƒ¼ãƒ‰</div>
  <div class="tab" id="tab-post" onclick="switchTab('post')">âœï¸ æ¡ˆä»¶èµ·ç¥¨</div>
  <div class="tab" id="tab-mgmt" onclick="switchTab('mgmt')">âš™ï¸ ãƒãƒƒãƒãƒ³ã‚°ç®¡ç† <span class="tab-badge" id="badge-mgmt">2</span></div>
  <div class="tab" id="tab-history" onclick="switchTab('history')">ğŸ“ å±¥æ­´</div>
</div>

<!-- â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
  PAGE: æ¡ˆä»¶ãƒœãƒ¼ãƒ‰
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• -->
<div class="page on" id="page-board">

  <!-- çµ±è¨ˆ -->
  <div class="stats-row">
    <div class="stat-card"><div class="stat-num" style="color:var(--blue)">8</div><div class="stat-label">ğŸ“‹ å‹Ÿé›†ä¸­</div></div>
    <div class="stat-card"><div class="stat-num" style="color:var(--orange)">2</div><div class="stat-label">â³ æ‰¿èªå¾…ã¡ï¼ˆä»®ãƒãƒƒãƒï¼‰</div></div>
    <div class="stat-card"><div class="stat-num" style="color:var(--green)">15</div><div class="stat-label">âœ… ä»Šæœˆãƒãƒƒãƒãƒ³ã‚°æ¸ˆã¿</div></div>
    <div class="stat-card"><div class="stat-num" style="color:var(--gold)">3</div><div class="stat-label">ğŸ‰ ä»Šæœˆæˆç´„</div></div>
  </div>

  <!-- ãƒ•ã‚£ãƒ«ã‚¿ãƒ¼ -->
  <div class="filter-bar">
    <div class="search-box"><input type="text" placeholder="ã‚¨ãƒªã‚¢ãƒ»ç‰©ä»¶åãƒ»æ¡ä»¶ã§æ¤œç´¢..." oninput="filterCases()"></div>
    <button class="filter-chip on" onclick="filterBy(this,'all')">ã™ã¹ã¦</button>
    <button class="filter-chip" onclick="filterBy(this,'re')">ğŸ  ä¸å‹•ç”£</button>
    <button class="filter-chip" onclick="filterBy(this,'hr')">ğŸ‘¥ äººæ</button>
    <button class="filter-chip" onclick="filterBy(this,'open')">å‹Ÿé›†ä¸­</button>
    <button class="filter-chip" onclick="filterBy(this,'mine')">è‡ªåˆ†ã®æ¡ˆä»¶</button>
    <div style="margin-left:auto;font-size:10px;color:var(--muted)" id="case-count">8ä»¶è¡¨ç¤ºä¸­</div>
  </div>

  <!-- æ¡ˆä»¶ã‚°ãƒªãƒƒãƒ‰ + è©³ç´° -->
  <div class="detail-wrap">
    <div>
      <div class="case-grid" id="case-grid"><!-- JSç”Ÿæˆ --></div>
    </div>
    <!-- æ¡ˆä»¶è©³ç´°ã‚µã‚¤ãƒ‰ãƒ‘ãƒãƒ« -->
    <div id="detail-panel">
      <div class="panel"><div class="empty">â† æ¡ˆä»¶ã‚’é¸æŠã—ã¦ãã ã•ã„</div></div>
    </div>
  </div>
</div>

<!-- â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
  PAGE: æ¡ˆä»¶èµ·ç¥¨ï¼ˆPTæŠ•ç¨¿ / HQèµ·ç¥¨ï¼‰
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• -->
<div class="page" id="page-post">
<div style="max-width:680px">
  <div class="panel">
    <div class="panel-title">æ¡ˆä»¶èµ·ç¥¨</div>

    <div class="alert ab" id="post-mode-note">HQãƒ¢ãƒ¼ãƒ‰ï¼šç›´æ¥ã‚¢ã‚µã‚¤ãƒ³ ã¾ãŸã¯ ãƒœãƒ¼ãƒ‰æ²è¼‰ã‚’é¸æŠã§ãã¾ã™</div>

    <div class="s-label">æ¡ˆä»¶ã‚½ãƒ¼ã‚¹</div>
    <div class="fg">
      <div class="tg-group" id="g-source">
        <button class="tg on" data-v="pt" onclick="tog('g-source',this);updatePostMode()">ãƒ‘ãƒ¼ãƒˆãƒŠãƒ¼ç´¹ä»‹</button>
        <button class="tg" data-v="hq" onclick="tog('g-source',this);updatePostMode()">æœ¬éƒ¨èµ·ç¥¨ï¼ˆHQï¼‰</button>
        <button class="tg" data-v="self" onclick="tog('g-source',this);updatePostMode()">è‡ªå·±é–‹æ‹“ï¼ˆAGï¼‰</button>
      </div>
    </div>

    <!-- HQèµ·ç¥¨ã‚ªãƒ—ã‚·ãƒ§ãƒ³ -->
    <div id="sec-hq-assign" class="hidden">
      <div class="fg">
        <label>ã‚¢ã‚µã‚¤ãƒ³æ–¹æ³•</label>
        <div class="tg-group" id="g-assign-mode">
          <button class="tg on green" data-v="direct" onclick="tog('g-assign-mode',this);toggleDirectAssign()">ç›´æ¥æŒ‡å®š</button>
          <button class="tg" data-v="board" onclick="tog('g-assign-mode',this);toggleDirectAssign()">ãƒœãƒ¼ãƒ‰æ²è¼‰ï¼ˆå…ˆç€ï¼‰</button>
        </div>
      </div>
      <div id="sec-direct-agent" class="row2">
        <div class="fg"><label>æ‹…å½“ã‚¨ãƒ¼ã‚¸ã‚§ãƒ³ãƒˆæŒ‡å®š</label>
          <select id="direct-agent">
            <option value="">-- ã‚¨ãƒ¼ã‚¸ã‚§ãƒ³ãƒˆã‚’é¸æŠ --</option>
            <option>å±±ç”° èª ï¼ˆAG-012ï¼‰Gold / ä¸å‹•ç”£</option>
            <option>ä½è—¤ èŠ±å­ï¼ˆAG-008ï¼‰Platinum / ä¸å‹•ç”£</option>
            <option>éˆ´æœ¨ å¥å¤ªï¼ˆAG-023ï¼‰Silver / ä¸å‹•ç”£</option>
            <option>ç”°ä¸­ ç¾ç©‚ï¼ˆHR-005ï¼‰Gold / äººæ</option>
          </select>
        </div>
        <div class="fg"><label>ä¾é ¼ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸ï¼ˆä»»æ„ï¼‰</label>
          <input type="text" placeholder="ä¾‹ï¼šæ€¥ãã§ãŠé¡˜ã„ã—ã¾ã™">
        </div>
      </div>
    </div>

    <!-- PTèµ·ç¥¨ã®å ´åˆï¼šãƒ‘ãƒ¼ãƒˆãƒŠãƒ¼æƒ…å ± -->
    <div id="sec-pt-info" class="row2">
      <div class="fg"><label>ãƒ‘ãƒ¼ãƒˆãƒŠãƒ¼å</label><input type="text" id="pt-name" placeholder="ä½è—¤ ç¾å’²"></div>
      <div class="fg"><label>ãƒ‘ãƒ¼ãƒˆãƒŠãƒ¼ID</label><input type="text" id="pt-id" class="mono" placeholder="PT-007"></div>
    </div>

    <div class="s-label">äº‹æ¥­ç¨®åˆ¥</div>
    <div class="fg">
      <div class="tg-group" id="g-biz">
        <button class="tg on blue" data-v="re-rent" onclick="tog('g-biz',this);updateBizFields()">ğŸ  è³ƒè²¸ä»²ä»‹</button>
        <button class="tg" data-v="re-sale" onclick="tog('g-biz',this);updateBizFields()">ğŸ¢ å£²è²·ä»²ä»‹</button>
        <button class="tg" data-v="hr" onclick="tog('g-biz',this);updateBizFields()">ğŸ‘¥ äººæç´¹ä»‹</button>
      </div>
    </div>

    <!-- ä¸å‹•ç”£ãƒ•ã‚£ãƒ¼ãƒ«ãƒ‰ -->
    <div id="sec-re">
      <div class="s-label">ç‰©ä»¶æƒ…å ±</div>
      <div class="row2">
        <div class="fg"><label>ã‚¨ãƒªã‚¢ãƒ»é§…</label><input type="text" placeholder="ä¾‹ï¼šæ± è¢‹é§…å¾’æ­©10åˆ†ä»¥å†…"></div>
        <div class="fg"><label>å®¶è³ƒï¼ˆè³ƒè²¸ï¼‰/ ä¾¡æ ¼å¸¯ï¼ˆå£²è²·ï¼‰</label><input type="text" class="mono" placeholder="ä¾‹ï¼š80,000ã€œ100,000å††"></div>
      </div>
      <div class="row3">
        <div class="fg"><label>é–“å–ã‚Š</label><input type="text" placeholder="ä¾‹ï¼š1Kã€œ1LDK"></div>
        <div class="fg"><label>å…¥å±…å¸Œæœ›æ™‚æœŸ</label><input type="date"></div>
        <div class="fg"><label>ãã®ä»–æ¡ä»¶</label><input type="text" placeholder="ä¾‹ï¼šãƒšãƒƒãƒˆå¯ã€é§è»Šå ´å¸Œæœ›"></div>
      </div>
    </div>

    <!-- äººæç´¹ä»‹ãƒ•ã‚£ãƒ¼ãƒ«ãƒ‰ -->
    <div id="sec-hr" class="hidden">
      <div class="s-label">äººææƒ…å ±</div>
      <div class="row2">
        <div class="fg"><label>å¸Œæœ›æ¥­ç•Œ</label><input type="text" placeholder="ä¾‹ï¼šITãƒ»Webã€ä¸å‹•ç”£"></div>
        <div class="fg"><label>å¸Œæœ›è·ç¨®</label><input type="text" placeholder="ä¾‹ï¼šã‚¨ãƒ³ã‚¸ãƒ‹ã‚¢ã€å–¶æ¥­"></div>
      </div>
      <div class="row3">
        <div class="fg"><label>ç¾è·ç¨®ãƒ»çµŒé¨“</label><input type="text" placeholder="ä¾‹ï¼šå–¶æ¥­3å¹´"></div>
        <div class="fg"><label>å¸Œæœ›å¹´å</label><input type="text" class="mono" placeholder="ä¾‹ï¼š500ã€œ700ä¸‡å††"></div>
        <div class="fg"><label>è»¢è·å¸Œæœ›æ™‚æœŸ</label>
          <select>
            <option>ã§ãã‚‹ã ã‘æ—©ã</option>
            <option>1ãƒ¶æœˆä»¥å†…</option>
            <option>3ãƒ¶æœˆä»¥å†…</option>
            <option>åŠå¹´ä»¥å†…</option>
          </select>
        </div>
      </div>
    </div>

    <!-- é¡§å®¢æƒ…å ±ï¼ˆã‚¹ã‚¿ãƒƒãƒ•å…¥åŠ›ãƒ»éå…¬é–‹ï¼‰ -->
    <div class="s-label">ã‚¯ãƒ©ã‚¤ã‚¢ãƒ³ãƒˆæƒ…å ± <span style="color:var(--red);font-size:9px">ğŸ”’ ãƒãƒƒãƒãƒ³ã‚°ç¢ºå®šå¾Œã«æ‹…å½“AGã¸é–‹ç¤º</span></div>
    <div class="fg" style="margin-bottom:10px">
      <label>ã‚¯ãƒ©ã‚¤ã‚¢ãƒ³ãƒˆID / æ°å <span style="color:var(--muted);font-size:9px">ï¼ˆIDãƒ»åå‰ãƒ»ã‚«ãƒŠã§æ¤œç´¢ï¼‰</span></label>
      <div class="cl-search-wrap">
        <input class="cl-input" id="mc-client-search" type="text" placeholder="CL-00001 ã¾ãŸã¯ å±±ç”° ã§æ¤œç´¢â€¦" autocomplete="off">
        <div class="cl-dropdown" id="mc-client-dropdown"></div>
      </div>
      <input type="hidden" id="mc-client-id">
      <input type="hidden" id="mc-client-name">
    </div>
    <div class="row2">
      <div class="fg"><label>é›»è©±ç•ªå·</label><input type="tel" id="mc-client-tel" class="mono" placeholder="080-XXXX-XXXX"></div>
      <div class="fg"><label>ãƒ¡ãƒ¼ãƒ«ã‚¢ãƒ‰ãƒ¬ã‚¹</label><input type="email" id="mc-client-email" placeholder="taro@example.com"></div>
    </div>

    <div class="s-label">å…¬é–‹æƒ…å ±ãƒ»å‚™è€ƒ</div>
    <div class="fg"><label>ãƒœãƒ¼ãƒ‰ã¸ã®æ²è¼‰ãƒ¡ãƒ¢ï¼ˆã‚¨ãƒ¼ã‚¸ã‚§ãƒ³ãƒˆã«è¦‹ã›ã‚‹æƒ…å ±ï¼‰</label>
      <textarea placeholder="ä¾‹ï¼šæ¡ä»¶ã¯æŸ”è»Ÿã§ã™ã€‚æ€¥ãã§å‹•ã„ã¦ã„ã¾ã™ã€‚å†…è¦‹å¯¾å¿œã§ãã‚‹æ–¹æ­“è¿ã€‚"></textarea>
    </div>
    <div class="row2">
      <div class="fg"><label>å¸Œæœ›ã‚¨ãƒ¼ã‚¸ã‚§ãƒ³ãƒˆãƒ©ãƒ³ã‚¯ï¼ˆæœ€ä½ãƒ©ãƒ³ã‚¯ï¼‰</label>
        <select>
          <option value="">æŒ‡å®šãªã—ï¼ˆå…¨ãƒ©ãƒ³ã‚¯å¯¾è±¡ï¼‰</option>
          <option value="silver">Silverä»¥ä¸Š</option>
          <option value="gold">Goldä»¥ä¸Š</option>
          <option value="platinum">Platinumä»¥ä¸Š</option>
        </select>
      </div>
      <div class="fg"><label>å¿œå‹ŸæœŸé™</label>
        <select>
          <option>24æ™‚é–“</option>
          <option>48æ™‚é–“</option>
          <option>72æ™‚é–“</option>
          <option>æœŸé™ãªã—</option>
        </select>
      </div>
    </div>

    <button class="btn btn-gold btn-full" onclick="submitCase()">æ¡ˆä»¶ã‚’ãƒœãƒ¼ãƒ‰ã«æ²è¼‰ã™ã‚‹</button>
  </div>
</div>
</div>

<!-- â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
  PAGE: ãƒãƒƒãƒãƒ³ã‚°ç®¡ç†ï¼ˆHQï¼‰
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• -->
<div class="page" id="page-mgmt">

  <div class="alert ao" style="margin-bottom:14px">
    âš¡ å…ˆç€1åãŒè‡ªå‹•ã§ä»®ãƒãƒƒãƒãƒ³ã‚°ã•ã‚Œã¾ã™ã€‚æœ¬éƒ¨ã®æ‰¿èªã§ç¢ºå®šã—ã€æ‹…å½“ã‚¨ãƒ¼ã‚¸ã‚§ãƒ³ãƒˆã«é¡§å®¢æƒ…å ±ãŒé–‹ç¤ºã•ã‚Œã¾ã™ã€‚
  </div>

  <!-- æ‰¿èªå¾…ã¡æ¡ˆä»¶ -->
  <div class="panel">
    <div class="panel-title">æ‰¿èªå¾…ã¡ï¼ˆä»®ãƒãƒƒãƒãƒ³ã‚°æ¸ˆã¿ï¼‰ <span class="notify-dot"></span></div>

    <!-- æ¡ˆä»¶1 -->
    <div class="confirm-box" style="margin-bottom:12px">
      <div style="display:flex;justify-content:space-between;align-items:flex-start;margin-bottom:12px">
        <div>
          <div style="display:flex;align-items:center;gap:8px;margin-bottom:4px">
            <span class="badge bdg-re">è³ƒè²¸</span>
            <span class="badge bdg-pt">PTç´¹ä»‹</span>
            <span style="font-family:'DM Mono',monospace;font-size:10px;color:var(--muted)">0234</span>
          </div>
          <div style="font-size:15px;font-weight:700">æ± è¢‹ã‚¨ãƒªã‚¢ 1Kã€œ1LDK è³ƒè²¸</div>
          <div style="font-size:11px;color:var(--sub);margin-top:2px">ç´¹ä»‹ï¼šä½è—¤ ç¾å’²ï¼ˆPT-007ï¼‰ã€€å®¶è³ƒï¼šÂ¥80,000ã€œ100,000</div>
        </div>
        <div style="text-align:right">
          <div style="font-size:10px;color:var(--muted)">ä»®ãƒãƒƒãƒãƒ³ã‚°</div>
          <div style="font-size:11px;color:var(--orange);font-weight:600">â³ æ‰¿èªå¾…ã¡</div>
        </div>
      </div>

      <!-- ä»®ãƒãƒƒãƒæ¸ˆã¿ã‚¨ãƒ¼ã‚¸ã‚§ãƒ³ãƒˆ -->
      <div style="background:rgba(201,168,76,.06);border:1px solid rgba(201,168,76,.2);border-radius:8px;padding:12px;margin-bottom:10px">
        <div style="font-size:10px;color:var(--muted);margin-bottom:6px">ğŸ† ä»®ãƒãƒƒãƒãƒ³ã‚°ï¼ˆå…ˆç€1ç•ªï¼‰</div>
        <div style="display:flex;align-items:center;justify-content:space-between">
          <div>
            <div style="font-size:14px;font-weight:700">å±±ç”° èª </div>
            <div style="font-size:10px;color:var(--muted);margin-top:2px">
              <span class="ap-rank rank-gold">Gold</span>
              &nbsp;AG-012 / ä¸å‹•ç”£ã‚¨ãƒ¼ã‚¸ã‚§ãƒ³ãƒˆ
            </div>
            <div style="font-size:10px;color:var(--muted);margin-top:2px">å¾—æ„ã‚¨ãƒªã‚¢ï¼šæ± è¢‹ãƒ»è±Šå³¶åŒºã€€å®Ÿç¸¾ï¼šä»Šæœˆ3ä»¶æˆç´„</div>
          </div>
          <div style="text-align:right">
            <div style="font-family:'DM Mono',monospace;font-size:10px;color:var(--orange)">å¿œå‹Ÿ 14:32:08</div>
            <div style="font-size:10px;color:var(--muted);margin-top:2px">æ¡ˆä»¶æŠ•ç¨¿ã‹ã‚‰ 3åˆ†å¾Œ</div>
          </div>
        </div>
      </div>

      <!-- ä»–ã®å¿œå‹Ÿè€… -->
      <div style="font-size:10px;color:var(--muted);margin-bottom:6px">ãã®ä»–ã®å¿œå‹Ÿè€…ï¼ˆ2åï¼‰</div>
      <div class="applicant-list" style="margin-bottom:12px">
        <div class="applicant-row">
          <div class="ap-info">
            <div class="ap-name">éˆ´æœ¨ å¥å¤ª</div>
            <div class="ap-meta">
              <span class="ap-rank rank-silver">Silver</span>
              AG-023 / ä¸å‹•ç”£
              <span class="ap-time">14:38:52ï¼ˆ6åˆ†å¾Œï¼‰</span>
            </div>
          </div>
        </div>
        <div class="applicant-row">
          <div class="ap-info">
            <div class="ap-name">æ¸¡è¾º éš†</div>
            <div class="ap-meta">
              <span class="ap-rank rank-bronze">Bronze</span>
              AG-041 / ä¸å‹•ç”£
              <span class="ap-time">14:45:11ï¼ˆ13åˆ†å¾Œï¼‰</span>
            </div>
          </div>
        </div>
      </div>

      <div style="display:flex;gap:8px">
        <button class="btn btn-green" onclick="confirmMatch('0234','å±±ç”° èª ','AG-012')">âœ… å±±ç”° èª  ã«ç¢ºå®šãƒ»é¡§å®¢æƒ…å ±ã‚’é–‹ç¤º</button>
        <button class="btn btn-muted btn-sm" onclick="changeAgent('0234')">æ‹…å½“è€…ã‚’å¤‰æ›´</button>
        <button class="btn btn-red btn-sm">æ¡ˆä»¶ã‚’æˆ»ã™</button>
      </div>
    </div>

    <!-- æ¡ˆä»¶2 -->
    <div class="confirm-box">
      <div style="display:flex;justify-content:space-between;align-items:flex-start;margin-bottom:12px">
        <div>
          <div style="display:flex;align-items:center;gap:8px;margin-bottom:4px">
            <span class="badge bdg-hr">äººæ</span>
            <span class="badge bdg-hq">HQèµ·ç¥¨</span>
            <span style="font-family:'DM Mono',monospace;font-size:10px;color:var(--muted)">0231</span>
          </div>
          <div style="font-size:15px;font-weight:700">ITãƒ»Webç³» ã‚¨ãƒ³ã‚¸ãƒ‹ã‚¢è»¢è·æ”¯æ´</div>
          <div style="font-size:11px;color:var(--sub);margin-top:2px">çµŒé¨“3å¹´ãƒ»å¸Œæœ›å¹´å600ã€œ800ä¸‡å††ãƒ»3ãƒ¶æœˆä»¥å†…è»¢è·å¸Œæœ›</div>
        </div>
        <div style="text-align:right">
          <div style="font-size:10px;color:var(--muted)">ä»®ãƒãƒƒãƒãƒ³ã‚°</div>
          <div style="font-size:11px;color:var(--orange);font-weight:600">â³ æ‰¿èªå¾…ã¡</div>
        </div>
      </div>
      <div style="background:rgba(201,168,76,.06);border:1px solid rgba(201,168,76,.2);border-radius:8px;padding:12px;margin-bottom:10px">
        <div style="font-size:10px;color:var(--muted);margin-bottom:6px">ğŸ† ä»®ãƒãƒƒãƒãƒ³ã‚°ï¼ˆå…ˆç€1ç•ªï¼‰</div>
        <div style="display:flex;align-items:center;justify-content:space-between">
          <div>
            <div style="font-size:14px;font-weight:700">ç”°ä¸­ ç¾ç©‚</div>
            <div style="font-size:10px;color:var(--muted);margin-top:2px">
              <span class="ap-rank rank-gold">Gold</span>
              &nbsp;HR-005 / äººæã‚¨ãƒ¼ã‚¸ã‚§ãƒ³ãƒˆ
            </div>
            <div style="font-size:10px;color:var(--muted);margin-top:2px">å¾—æ„æ¥­ç•Œï¼šITãƒ»Webãƒ»ã‚¹ã‚¿ãƒ¼ãƒˆã‚¢ãƒƒãƒ—ã€€CA/RAä¸¡é¢å‹</div>
          </div>
          <div style="text-align:right">
            <div style="font-family:'DM Mono',monospace;font-size:10px;color:var(--orange)">å¿œå‹Ÿ 09:15:44</div>
          </div>
        </div>
      </div>
      <div style="display:flex;gap:8px">
        <button class="btn btn-green" onclick="confirmMatch('0231','ç”°ä¸­ ç¾ç©‚','HR-005')">âœ… ç”°ä¸­ ç¾ç©‚ ã«ç¢ºå®šãƒ»é¡§å®¢æƒ…å ±ã‚’é–‹ç¤º</button>
        <button class="btn btn-muted btn-sm">æ‹…å½“è€…ã‚’å¤‰æ›´</button>
      </div>
    </div>
  </div>

  <!-- ãƒãƒƒãƒãƒ³ã‚°æ¸ˆã¿ï¼ˆé€²è¡Œä¸­ï¼‰ -->
  <div class="panel">
    <div class="panel-title">ãƒãƒƒãƒãƒ³ã‚°ç¢ºå®šæ¸ˆã¿ï¼ˆé€²è¡Œä¸­ï¼‰</div>
    <table style="width:100%;border-collapse:collapse;font-size:12px">
      <thead>
        <tr style="border-bottom:1px solid var(--border)">
          <th style="text-align:left;padding:8px 10px;font-size:10px;color:var(--muted);font-weight:600">æ¡ˆä»¶ID</th>
          <th style="text-align:left;padding:8px 10px;font-size:10px;color:var(--muted);font-weight:600">å†…å®¹</th>
          <th style="text-align:left;padding:8px 10px;font-size:10px;color:var(--muted);font-weight:600">æ‹…å½“AG</th>
          <th style="text-align:left;padding:8px 10px;font-size:10px;color:var(--muted);font-weight:600">ç¢ºå®šæ—¥</th>
          <th style="text-align:left;padding:8px 10px;font-size:10px;color:var(--muted);font-weight:600">ã‚¹ãƒ†ãƒ¼ã‚¿ã‚¹</th>
          <th style="padding:8px 10px"></th>
        </tr>
      </thead>
      <tbody id="matched-table">
        <tr style="border-bottom:1px solid rgba(34,38,56,.4)">
          <td style="padding:9px 10px;font-family:'DM Mono',monospace;font-size:10px;color:var(--muted)">0228</td>
          <td style="padding:9px 10px"><div style="font-weight:600">æ–°å®¿ã‚¨ãƒªã‚¢ è³ƒè²¸</div><div style="font-size:10px;color:var(--sub)">PTç´¹ä»‹ / å®¶è³ƒ10ä¸‡å††å°</div></td>
          <td style="padding:9px 10px"><div>ä½è—¤ èŠ±å­</div><div style="font-size:10px;color:var(--muted)">AG-008 Platinum</div></td>
          <td style="padding:9px 10px;font-family:'DM Mono',monospace;font-size:10px;color:var(--muted)">2/19</td>
          <td style="padding:9px 10px"><span class="badge" style="background:rgba(245,158,11,.15);color:var(--orange)">å…¥é‡‘å¾…ã¡</span></td>
          <td style="padding:9px 10px"><button class="btn btn-muted btn-sm" onclick="viewCaseDetail('0228')">è©³ç´°</button></td>
        </tr>
        <tr style="border-bottom:1px solid rgba(34,38,56,.4)">
          <td style="padding:9px 10px;font-family:'DM Mono',monospace;font-size:10px;color:var(--muted)">0225</td>
          <td style="padding:9px 10px"><div style="font-weight:600">ãƒ¡ãƒ¼ã‚«ãƒ¼å–¶æ¥­ è»¢è·æ”¯æ´</div><div style="font-size:10px;color:var(--sub)">HQèµ·ç¥¨ / å¸Œæœ›å¹´å500ä¸‡å††</div></td>
          <td style="padding:9px 10px"><div>ç”°ä¸­ ç¾ç©‚</div><div style="font-size:10px;color:var(--muted)">HR-005 Gold</div></td>
          <td style="padding:9px 10px;font-family:'DM Mono',monospace;font-size:10px;color:var(--muted)">2/18</td>
          <td style="padding:9px 10px"><span class="badge" style="background:rgba(59,130,246,.15);color:var(--blue)">é¢æ¥èª¿æ•´ä¸­</span></td>
          <td style="padding:9px 10px"><button class="btn btn-muted btn-sm">è©³ç´°</button></td>
        </tr>
        <tr>
          <td style="padding:9px 10px;font-family:'DM Mono',monospace;font-size:10px;color:var(--muted)">0220</td>
          <td style="padding:9px 10px"><div style="font-weight:600">æ¸‹è°· å£²è²·ä»²ä»‹</div><div style="font-size:10px;color:var(--sub)">è‡ªå·±é–‹æ‹“ / 3,500ä¸‡å††å°</div></td>
          <td style="padding:9px 10px"><div>å±±ç”° èª </div><div style="font-size:10px;color:var(--muted)">AG-012 Gold</div></td>
          <td style="padding:9px 10px;font-family:'DM Mono',monospace;font-size:10px;color:var(--muted)">2/15</td>
          <td style="padding:9px 10px"><span class="badge" style="background:rgba(34,197,94,.15);color:var(--green)">å¥‘ç´„æ›¸é€ä»˜æ¸ˆã¿</span></td>
          <td style="padding:9px 10px"><button class="btn btn-muted btn-sm">è©³ç´°</button></td>
        </tr>
      </tbody>
    </table>
  </div>
</div>

<!-- â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
  PAGE: å±¥æ­´
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• -->
<div class="page" id="page-history">
  <div class="panel">
    <div class="panel-title">ãƒãƒƒãƒãƒ³ã‚°å±¥æ­´</div>
    <div class="filter-bar">
      <button class="filter-chip on">ã™ã¹ã¦</button>
      <button class="filter-chip">æˆç´„æ¸ˆã¿</button>
      <button class="filter-chip">ä¸æˆç«‹</button>
      <button class="filter-chip">ã‚­ãƒ£ãƒ³ã‚»ãƒ«</button>
    </div>
    <div class="empty">ğŸ“ å±¥æ­´ãƒ‡ãƒ¼ã‚¿ã¯ã“ã“ã«è¡¨ç¤ºã•ã‚Œã¾ã™</div>
  </div>
</div>

<script>
// â”€â”€ XSSã‚¨ã‚¹ã‚±ãƒ¼ãƒ—é–¢æ•° â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
function escHtml(s) {
  if (s == null) return '';
  return String(s)
    .replace(/&/g, '&amp;')
    .replace(/</g, '&lt;')
    .replace(/>/g, '&gt;')
    .replace(/"/g, '&quot;')
    .replace(/'/g, '&#x27;');
}
// â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€

  // â”€â”€ Slacké€šçŸ¥è¨­å®š â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
  // æœ¬ç•ªé‹ç”¨å‰ã« Slack Incoming Webhook URL ã‚’è¨­å®šã—ã¦ãã ã•ã„
  // Slackç®¡ç†ç”»é¢ â†’ ã‚¢ãƒ—ãƒª â†’ Incoming Webhooks â†’ Webhook URLã‚’ã‚³ãƒ”ãƒ¼
  var SLACK_WEBHOOK = window.SLACK_CONFIG
    ? window.SLACK_CONFIG.GENERAL   // db.jsãŒèª­ã¿è¾¼ã¾ã‚Œã¦ã„ã‚‹å ´åˆ
    : 'YOUR_SLACK_WEBHOOK_URL';     // ç›´æ¥è¨­å®šã™ã‚‹å ´åˆã¯ã“ã“ã«è²¼ã‚Šä»˜ã‘

  function notifySlack(msg) {
    if (!SLACK_WEBHOOK || SLACK_WEBHOOK === 'YOUR_SLACK_WEBHOOK_URL') {
      console.log('[Slackï¼ˆæœªè¨­å®šï¼‰]', msg);
      return;
    }
    fetch(SLACK_WEBHOOK, {
      method: 'POST',
      headers: { 'Content-Type': 'application/json' },
      body: JSON.stringify({ text: msg }),
      mode: 'no-cors'
    }).catch(e => console.error('[Slacké€ä¿¡ã‚¨ãƒ©ãƒ¼]', e));
  }
  // â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€

// â•â• AUTH GUARD (ãƒ­ã‚°ã‚¤ãƒ³å¿…é ˆ) â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
(function() {
  var s = null;
  try { s = JSON.parse(sessionStorage.getItem('coreto_session') || 'null'); } catch(e) {}
  if (!s || !s.userId || !s.sessionToken || s.sessionToken.length !== 64) { sessionStorage.removeItem('coreto_session'); location.replace('coreto-login.html'); return; }
  var _la = new Date(s.loginAt).getTime();
  if (isNaN(_la) || (Date.now() - _la) > 28800000) { sessionStorage.removeItem('coreto_session'); alert('ã‚»ãƒƒã‚·ãƒ§ãƒ³ã®æœ‰åŠ¹æœŸé™ãŒåˆ‡ã‚Œã¾ã—ãŸã€‚'); location.replace('coreto-login.html'); return; }
  window._SESSION = s;
})();


// â”€â”€ ã‚¯ãƒ©ã‚¤ã‚¢ãƒ³ãƒˆDBï¼ˆå…±é€šï¼‰ â”€â”€
const CUSTOMERS_DB = [
  {id:'CL-00001',name:'å±±ç”° å¤ªéƒ', kana:'ãƒ¤ãƒãƒ€ ã‚¿ãƒ­ã‚¦',   tel:'080-1111-1111', email:'yamada@example.com'},
  {id:'CL-00012',name:'ä½è—¤ èŠ±å­', kana:'ã‚µãƒˆã‚¦ ãƒãƒŠã‚³',   tel:'080-2222-2222', email:'sato@example.com'},
  {id:'CL-00023',name:'éˆ´æœ¨ å¥ä¸€', kana:'ã‚¹ã‚ºã‚­ ã‚±ãƒ³ã‚¤ãƒ', tel:'090-3333-3333', email:'suzuki@example.com'},
  {id:'CL-00047',name:'ç”°ä¸­ ç¾å’²', kana:'ã‚¿ãƒŠã‚« ãƒŸã‚µã‚­',   tel:'080-4444-4444', email:'tanaka@example.com'},
  {id:'CL-00058',name:'å°æ— æµ©äºŒ', kana:'ã‚³ãƒãƒ¤ã‚· ã‚³ã‚¦ã‚¸', tel:'090-5555-5555', email:'kobayashi@example.com'},
  {id:'CL-00071',name:'æ¸¡è¾º æµå­', kana:'ãƒ¯ã‚¿ãƒŠãƒ™ ã‚±ã‚¤ã‚³', tel:'080-6666-6666', email:'watanabe@example.com'},
];

function initClientSearch(inputId, idHiddenId, nameHiddenId, dropdownId, onSelectFn) {
  const input = document.getElementById(inputId);
  const dropdown = document.getElementById(dropdownId);
  if (!input || !dropdown) return;
  let focusedIdx = -1;

  input.addEventListener('input', () => {
    const q = input.value.trim().toLowerCase();
    focusedIdx = -1;
    if (!q) { dropdown.style.display='none'; return; }
    const matches = CUSTOMERS_DB.filter(c =>
      c.id.toLowerCase().includes(q) ||
      c.name.includes(q) ||
      (c.kana||'').toLowerCase().includes(q)
    ).slice(0, 8);
    if (!matches.length) { dropdown.style.display='none'; return; }
    dropdown.innerHTML = matches.map((c,i) =>
      `<div class="cl-option" data-i="${i}" data-id="${c.id}" data-name="${escHtml(c.name)}"
            data-tel="${c.tel||''}" data-email="${c.email||''}"
            onmousedown="event.preventDefault()"
            onclick="pickClient(event,'${inputId}','${idHiddenId}','${nameHiddenId}','${dropdownId}')">
        <span class="cl-opt-id">${c.id}</span>
        <span class="cl-opt-name">${escHtml(c.name)}</span>
        <span class="cl-opt-kana">${c.kana||''}</span>
      </div>`
    ).join('') + '<div class="cl-hint">è¦‹ã¤ã‹ã‚‰ãªã„å ´åˆã¯ãã®ã¾ã¾å…¥åŠ›ã—ã¦ãã ã•ã„</div>';
    dropdown.style.display = 'block';
    if (onSelectFn) dropdown.dataset.callback = onSelectFn;
  });
  input.addEventListener('keydown', e => {
    const opts = dropdown.querySelectorAll('.cl-option');
    if (!opts.length || dropdown.style.display==='none') return;
    if (e.key==='ArrowDown') { focusedIdx=Math.min(focusedIdx+1,opts.length-1); hlOpt(opts); e.preventDefault(); }
    else if (e.key==='ArrowUp') { focusedIdx=Math.max(focusedIdx-1,0); hlOpt(opts); e.preventDefault(); }
    else if (e.key==='Enter' && focusedIdx>=0) { opts[focusedIdx].click(); e.preventDefault(); }
    else if (e.key==='Escape') dropdown.style.display='none';
  });
  input.addEventListener('blur', () => setTimeout(()=>{ dropdown.style.display='none'; }, 150));
  input.addEventListener('focus', () => { if(input.value.trim()) input.dispatchEvent(new Event('input')); });
  function hlOpt(opts) {
    opts.forEach((o,i)=>o.classList.toggle('focused',i===focusedIdx));
    if(focusedIdx>=0) opts[focusedIdx].scrollIntoView({block:'nearest'});
  }
}

function pickClient(event, inputId, idHiddenId, nameHiddenId, dropdownId) {
  const opt = event.currentTarget;
  const id = opt.dataset.id, name = opt.dataset.name;
  const tel = opt.dataset.tel, email = opt.dataset.email;
  const input = document.getElementById(inputId);
  const dropdown = document.getElementById(dropdownId);
  if(input) input.value = id + ' / ' + name;
  if(idHiddenId) { const el=document.getElementById(idHiddenId); if(el) el.value=id; }
  if(nameHiddenId) { const el=document.getElementById(nameHiddenId); if(el) el.value=name; }
  if(dropdown) dropdown.style.display='none';
  // Fill extra fields if available
  const telEl = document.getElementById('mc-client-tel');
  const emailEl = document.getElementById('mc-client-email');
  if(telEl && tel) telEl.value = tel;
  if(emailEl && email) emailEl.value = email;
  const cb = dropdown && dropdown.dataset.callback;
  if(cb && typeof window[cb]==='function') window[cb](id, name);
}


// â”€â”€ ã‚»ãƒƒã‚·ãƒ§ãƒ³èª­ã¿è¾¼ã¿ï¼ˆãƒã‚¤ãƒšãƒ¼ã‚¸ã‹ã‚‰è‡ªå‹•å…¥åŠ›ï¼‰ â”€â”€
(function() {
  const _S = JSON.parse(sessionStorage.getItem('coreto_session') || 'null');
  if (!_S) return;
  window.addEventListener('DOMContentLoaded', () => {
    // ãƒã‚¤ãƒšãƒ¼ã‚¸ã¸æˆ»ã‚‹ãƒªãƒ³ã‚¯ã‚’ã‚¿ãƒ–ãƒãƒ¼ã«è¿½åŠ 
    const tabs = document.querySelector('.tabs');
    if (tabs) {
      const back = document.createElement('div');
      back.style.cssText = 'margin-left:auto;padding:0 16px;display:flex;align-items:center;gap:10px';
      back.innerHTML = '<span style="font-size:10px;color:var(--muted)">ğŸ‘¤ '+_S.name+'</span>' +
        (()=>{
    var _s=JSON.parse(sessionStorage.getItem('coreto_session')||'null');
    var _dest=(_s&&_s.type==='hq')?'coreto-hub.html':'coreto-agent-mypage.html';
    return '<button onclick="location.href=\''+_dest+'\'" style="font-size:10px;padding:4px 10px;border-radius:6px;border:1px solid var(--border2);background:transparent;color:var(--muted);cursor:pointer;font-family:sans-serif">â† ãƒã‚¤ãƒšãƒ¼ã‚¸</button>';
  })();
      tabs.appendChild(back);
    }
  });
})();

// â”€â”€ çŠ¶æ…‹ â”€â”€
let currentRole = 'hq';
let selectedCase = null;
let currentFilter = 'all';

// â”€â”€ ã‚µãƒ³ãƒ—ãƒ«ãƒ‡ãƒ¼ã‚¿ â”€â”€
const CASES = [
  {id:'0234',biz:'re',bizLabel:'è³ƒè²¸',src:'pt',srcLabel:'PTç´¹ä»‹',
   title:'æ± è¢‹ã‚¨ãƒªã‚¢ 1Kã€œ1LDK è³ƒè²¸',
   area:'æ± è¢‹é§…å¾’æ­©10åˆ†ä»¥å†…',rent:'Â¥80,000ã€œ100,000',madori:'1Kã€œ1LDK',
   date:'3æœˆä¸­',note:'æ¡ä»¶ã¯æŸ”è»Ÿã§ã™ã€‚æ€¥ãã§å‹•ã„ã¦ã„ã¾ã™ã€‚å†…è¦‹ã™ãå¯¾å¿œã§ãã‚‹æ–¹æ­“è¿ã€‚',
   minRank:'none',posted:'14:29',deadline:'23h32m',
   applyCount:3,status:'pending_approval',
   ptName:'ä½è—¤ ç¾å’²',ptId:'PT-007',
   // é¡§å®¢æƒ…å ±ã¯ãƒãƒƒãƒãƒ³ã‚°ç¢ºå®šå¾Œã®ã¿é–‹ç¤º
   customerName:'ã€ç¢ºå®šå¾Œã«é–‹ç¤ºã€‘',customerPhone:'ã€ç¢ºå®šå¾Œã«é–‹ç¤ºã€‘',customerEmail:'ã€ç¢ºå®šå¾Œã«é–‹ç¤ºã€‘'},

  {id:'0233',biz:'re',bizLabel:'è³ƒè²¸',src:'pt',srcLabel:'PTç´¹ä»‹',
   title:'æ–°å®¿ 2LDK ãƒ•ã‚¡ãƒŸãƒªãƒ¼å‘ã‘',
   area:'æ–°å®¿é§…15åˆ†åœå†…',rent:'Â¥130,000ã€œ150,000',madori:'2LDK',
   date:'4æœˆåˆæ—¬',note:'ãƒ•ã‚¡ãƒŸãƒªãƒ¼å‘ã‘ã€‚å°å­¦æ ¡åŒºã‚’é‡è¦–ã€‚',
   minRank:'silver',posted:'11:15',deadline:'36h15m',
   applyCount:1,status:'open',
   ptName:'æœ¨æ‘ æ‹“æµ·',ptId:'PT-012',
   customerName:'ã€ç¢ºå®šå¾Œã«é–‹ç¤ºã€‘',customerPhone:'ã€ç¢ºå®šå¾Œã«é–‹ç¤ºã€‘',customerEmail:'ã€ç¢ºå®šå¾Œã«é–‹ç¤ºã€‘'},

  {id:'0232',biz:'hr',bizLabel:'äººæ',src:'hq',srcLabel:'HQèµ·ç¥¨',
   title:'Webç³»ã‚¹ã‚¿ãƒ¼ãƒˆã‚¢ãƒƒãƒ— / ãƒ—ãƒ­ãƒ€ã‚¯ãƒˆãƒãƒãƒ¼ã‚¸ãƒ£ãƒ¼',
   area:'â€”',rent:'â€”',
   industry:'ITãƒ»Webãƒ»ã‚¹ã‚¿ãƒ¼ãƒˆã‚¢ãƒƒãƒ—',job:'ãƒ—ãƒ­ãƒ€ã‚¯ãƒˆãƒãƒãƒ¼ã‚¸ãƒ£ãƒ¼',exp:'PMçµŒé¨“2å¹´ä»¥ä¸Š',salary:'700ã€œ1,000ä¸‡å††',timing:'1ãƒ¶æœˆä»¥å†…',
   note:'ã‚·ãƒªãƒ¼ã‚ºBèª¿é”æ¸ˆã¿ã®æ€¥æˆé•·ã‚¹ã‚¿ãƒ¼ãƒˆã‚¢ãƒƒãƒ—ã€‚ã‚¹ãƒ”ãƒ¼ãƒ‰æ„Ÿã‚’å¤§äº‹ã«ã™ã‚‹æ–¹ã€‚',
   minRank:'gold',posted:'09:00',deadline:'47h',
   applyCount:0,status:'open',ptName:'â€”',ptId:'â€”',
   customerName:'ã€ç¢ºå®šå¾Œã«é–‹ç¤ºã€‘',customerPhone:'ã€ç¢ºå®šå¾Œã«é–‹ç¤ºã€‘',customerEmail:'ã€ç¢ºå®šå¾Œã«é–‹ç¤ºã€‘'},

  {id:'0231',biz:'hr',bizLabel:'äººæ',src:'hq',srcLabel:'HQèµ·ç¥¨',
   title:'ITãƒ»Webç³» ã‚¨ãƒ³ã‚¸ãƒ‹ã‚¢è»¢è·æ”¯æ´',
   area:'â€”',rent:'â€”',
   industry:'ITãƒ»Web',job:'ã‚¨ãƒ³ã‚¸ãƒ‹ã‚¢ï¼ˆãƒ•ãƒ­ãƒ³ãƒˆ/ãƒãƒƒã‚¯å•ã‚ãšï¼‰',exp:'çµŒé¨“3å¹´ä»¥ä¸Š',salary:'600ã€œ800ä¸‡å††',timing:'3ãƒ¶æœˆä»¥å†…',
   note:'æŠ€è¡“ã‚¹ã‚¿ãƒƒã‚¯ã¯å•ã‚ãªã„ã€‚äººæŸ„é‡è¦–ã®ä¼æ¥­ã€‚',
   minRank:'none',posted:'08:50',deadline:'æ‰¿èªå¾…ã¡',
   applyCount:1,status:'pending_approval',ptName:'â€”',ptId:'â€”',
   customerName:'ã€ç¢ºå®šå¾Œã«é–‹ç¤ºã€‘',customerPhone:'ã€ç¢ºå®šå¾Œã«é–‹ç¤ºã€‘',customerEmail:'ã€ç¢ºå®šå¾Œã«é–‹ç¤ºã€‘'},

  {id:'0230',biz:'re',bizLabel:'è³ƒè²¸',src:'pt',srcLabel:'PTç´¹ä»‹',
   title:'ä¸­é‡ å˜èº«å‘ã‘ 1R / 1K',
   area:'ä¸­é‡ã€œæ±ä¸­é‡ã‚¨ãƒªã‚¢',rent:'Â¥65,000ã€œ80,000',madori:'1Rã€œ1K',
   date:'2æœˆæœ«',note:'å­¦ç”Ÿãƒ»è‹¥æ‰‹ç¤¾ä¼šäººã€‚ãƒã‚¤ã‚¯é§è¼ªå ´å¸Œæœ›ã€‚',
   minRank:'none',posted:'æ˜¨æ—¥',deadline:'5h30m',
   applyCount:5,status:'open',
   ptName:'æ£® ã•ãã‚‰',ptId:'PT-031',
   customerName:'ã€ç¢ºå®šå¾Œã«é–‹ç¤ºã€‘',customerPhone:'ã€ç¢ºå®šå¾Œã«é–‹ç¤ºã€‘',customerEmail:'ã€ç¢ºå®šå¾Œã«é–‹ç¤ºã€‘'},

  {id:'0228',biz:'re',bizLabel:'è³ƒè²¸',src:'pt',srcLabel:'PTç´¹ä»‹',
   title:'æ–°å®¿ã‚¨ãƒªã‚¢ è³ƒè²¸ï¼ˆãƒãƒƒãƒãƒ³ã‚°æ¸ˆã¿ï¼‰',
   area:'æ–°å®¿é§…å‘¨è¾º',rent:'Â¥100,000ã€œ120,000',madori:'1LDK',
   date:'3æœˆ',note:'',
   minRank:'none',posted:'2/18',deadline:'â€”',
   applyCount:2,status:'matched',assignedAg:'ä½è—¤ èŠ±å­ï¼ˆAG-008ï¼‰',
   ptName:'ç”°ä¸­ å¥',ptId:'PT-019',
   customerName:'éˆ´æœ¨ ä¸€éƒ',customerPhone:'090-1234-5678',customerEmail:'ichiro@example.com'},

  {id:'0226',biz:'re',bizLabel:'å£²è²·',src:'self',srcLabel:'è‡ªå·±é–‹æ‹“',
   title:'è±Šå³¶åŒº æˆ¸å»ºã¦ å£²è²·',
   area:'æ± è¢‹ã‚¨ãƒªã‚¢',rent:'â€”',price:'2,800ã€œ3,200ä¸‡å††',
   note:'å¤«å©¦2äººã€‚ç¯‰20å¹´ä»¥å†…ã€‚é§è»Šå ´å¿…é ˆã€‚',
   minRank:'none',posted:'2/17',deadline:'â€”',
   applyCount:0,status:'self',assignedAg:'å±±ç”° èª ï¼ˆAG-012ï¼‰',
   customerName:'ã€ç¢ºå®šå¾Œã«é–‹ç¤ºã€‘',customerPhone:'ã€ç¢ºå®šå¾Œã«é–‹ç¤ºã€‘',customerEmail:'ã€ç¢ºå®šå¾Œã«é–‹ç¤ºã€‘'},

  {id:'0224',biz:'hr',bizLabel:'äººæ',src:'pt',srcLabel:'PTç´¹ä»‹',
   title:'é‡‘èç³» å–¶æ¥­è· è»¢è·æ”¯æ´',
   area:'â€”',rent:'â€”',
   industry:'é‡‘èãƒ»ä¿é™º',job:'å–¶æ¥­è·',exp:'é‡‘èå–¶æ¥­çµŒé¨“1å¹´ä»¥ä¸Š',salary:'400ã€œ600ä¸‡å††',timing:'åŠå¹´ä»¥å†…',
   note:'å¤§æ‰‹éŠ€è¡Œãƒ»è¨¼åˆ¸ä¼šç¤¾ã®ç´¹ä»‹å®Ÿç¸¾ãŒã‚ã‚‹æ–¹æ­“è¿ã€‚',
   minRank:'silver',posted:'2/16',deadline:'æœŸé™åˆ‡ã‚Œ',
   applyCount:0,status:'expired',ptName:'â€”',ptId:'â€”',
   customerName:'ã€ç¢ºå®šå¾Œã«é–‹ç¤ºã€‘',customerPhone:'ã€ç¢ºå®šå¾Œã«é–‹ç¤ºã€‘',customerEmail:'ã€ç¢ºå®šå¾Œã«é–‹ç¤ºã€‘'},
];

const RANK_ORDER = {none:0,bronze:1,silver:2,gold:3,platinum:4,founding:5};
const RANK_LABEL = {none:'æŒ‡å®šãªã—',bronze:'Bronzeä»¥ä¸Š',silver:'Silverä»¥ä¸Š',gold:'Goldä»¥ä¸Š',platinum:'Platinumä»¥ä¸Š'};
const STATUS_LABEL = {open:'å‹Ÿé›†ä¸­',pending_approval:'æ‰¿èªå¾…ã¡',matched:'ãƒãƒƒãƒãƒ³ã‚°æ¸ˆã¿',self:'è‡ªå·±é–‹æ‹“',expired:'æœŸé™åˆ‡ã‚Œ'};
const STATUS_BADGE = {
  open:'bdg-open',pending_approval:'bdg-wait',matched:'bdg-matched',
  self:'bdg-pt',expired:'bdg-closed'
};

// â”€â”€ ãƒ­ãƒ¼ãƒ«åˆ‡æ›¿ â”€â”€
function setRole(role, btn) {
  currentRole = role;
  document.querySelectorAll('.rsw').forEach(b=>b.classList.remove('on'));
  btn.classList.add('on');
  const badge = document.getElementById('role-badge');
  badge.className = 'role-badge';
  if(role==='hq'){badge.classList.add('rb-hq');badge.textContent='æœ¬éƒ¨ HQ';}
  else if(role==='ag'){badge.classList.add('rb-ag');badge.textContent='ã‚¨ãƒ¼ã‚¸ã‚§ãƒ³ãƒˆ';}
  else{badge.classList.add('rb-pt');badge.textContent='ãƒ‘ãƒ¼ãƒˆãƒŠãƒ¼';}
  updateTabsForRole();
  renderCases();
}

function updateTabsForRole() {
  const mgmtTab = document.getElementById('tab-mgmt');
  const postTab = document.getElementById('tab-post');
  if(currentRole==='hq'){
    mgmtTab.style.display='';postTab.style.display='';
    document.getElementById('post-mode-note').textContent='HQãƒ¢ãƒ¼ãƒ‰ï¼šç›´æ¥ã‚¢ã‚µã‚¤ãƒ³ ã¾ãŸã¯ ãƒœãƒ¼ãƒ‰æ²è¼‰ã‚’é¸æŠã§ãã¾ã™';
    document.getElementById('post-mode-note').className='alert ab';
  } else if(currentRole==='pt'){
    mgmtTab.style.display='none';
    postTab.style.display='';
    document.getElementById('post-mode-note').textContent='ãƒ‘ãƒ¼ãƒˆãƒŠãƒ¼ãƒ¢ãƒ¼ãƒ‰ï¼šæ¡ˆä»¶æƒ…å ±ã‚’å…¥åŠ›ã—ã¦ãƒœãƒ¼ãƒ‰ã«æŠ•ç¨¿ã—ã¦ãã ã•ã„ã€‚é¡§å®¢ã®å€‹äººæƒ…å ±ã¯ãƒãƒƒãƒãƒ³ã‚°ç¢ºå®šå¾Œã«æ‹…å½“ã‚¨ãƒ¼ã‚¸ã‚§ãƒ³ãƒˆã¸é–‹ç¤ºã•ã‚Œã¾ã™ã€‚';
    document.getElementById('post-mode-note').className='alert ag';
    document.getElementById('sec-hq-assign').classList.add('hidden');
  } else {
    mgmtTab.style.display='none';postTab.style.display='none';
  }
}

// â”€â”€ ãƒˆã‚°ãƒ« â”€â”€
function tog(gid, btn) {
  document.querySelectorAll('#'+gid+' .tg').forEach(b=>b.classList.remove('on'));
  btn.classList.add('on');
}
function gv(gid){const a=document.querySelector('#'+gid+' .tg.on');return a?a.dataset.v:null;}

// â”€â”€ æŠ•ç¨¿ãƒ•ã‚©ãƒ¼ãƒ åˆ¶å¾¡ â”€â”€
function updatePostMode() {
  const src = gv('g-source');
  document.getElementById('sec-pt-info').classList.toggle('hidden', src!=='pt');
  document.getElementById('sec-hq-assign').classList.toggle('hidden', src!=='hq');
}
function toggleDirectAssign() {
  const mode = gv('g-assign-mode');
  document.getElementById('sec-direct-agent').classList.toggle('hidden', mode!=='direct');
}
function updateBizFields() {
  const biz = gv('g-biz');
  document.getElementById('sec-re').classList.toggle('hidden', biz==='hr');
  document.getElementById('sec-hr').classList.toggle('hidden', biz!=='hr');
}

// â”€â”€ ã‚¿ãƒ–åˆ‡æ›¿ â”€â”€
function switchTab(name) {
  ['board','post','mgmt','history'].forEach(n=>{
    document.getElementById('tab-'+n)?.classList.toggle('on',n===name);
    document.getElementById('page-'+n)?.classList.toggle('on',n===name);
  });
  if(name==='board') renderCases();
}

// â”€â”€ ãƒ•ã‚£ãƒ«ã‚¿ãƒ¼ â”€â”€
function filterBy(btn, filter) {
  document.querySelectorAll('.filter-chip').forEach(b=>b.classList.remove('on'));
  btn.classList.add('on');
  currentFilter = filter;
  renderCases();
}
function filterCases(){renderCases();}

// â”€â”€ æ¡ˆä»¶ãƒœãƒ¼ãƒ‰ãƒ¬ãƒ³ãƒ€ãƒ¼ â”€â”€
function renderCases() {
  const grid = document.getElementById('case-grid');
  let filtered = CASES.filter(c=>{
    if(currentRole==='ag' && c.status==='expired') return false;
    if(currentRole==='pt') return c.src==='pt';
    if(currentFilter==='re') return c.biz==='re';
    if(currentFilter==='hr') return c.biz==='hr';
    if(currentFilter==='open') return c.status==='open';
    if(currentFilter==='mine') return c.assignedAg && c.assignedAg.includes('AG-012');
    return true;
  });

  document.getElementById('case-count').textContent = filtered.length+'ä»¶è¡¨ç¤ºä¸­';

  if(!filtered.length){
    grid.innerHTML='<div class="empty" style="grid-column:1/-1">æ¡ˆä»¶ãŒã‚ã‚Šã¾ã›ã‚“</div>';
    return;
  }

  grid.innerHTML = filtered.map(c => {
    const srcClass = c.src==='pt'?'src-pt':c.src==='hq'?'src-hq':'src-self';
    const isSelected = selectedCase===c.id;
    const isMatched = c.status==='matched';
    const isApplied = c.id==='0230'; // è‡ªåˆ†ãŒå¿œå‹Ÿæ¸ˆã¿ã‚µãƒ³ãƒ—ãƒ«

    let statusBar = '';
    if(c.status==='open') statusBar='sb-open';
    else if(c.status==='pending_approval') statusBar='sb-pending';
    else if(c.status==='matched') statusBar='sb-matched';
    else statusBar='sb-closed';

    let metaHtml = '';
    if(c.biz==='re'){
      metaHtml = `
        <div class="cc-meta-item">ã‚¨ãƒªã‚¢<br><span>${c.area||'â€”'}</span></div>
        <div class="cc-meta-item">å®¶è³ƒ<br><span>${c.rent||c.price||'â€”'}</span></div>
        <div class="cc-meta-item">é–“å–ã‚Š<br><span>${c.madori||'â€”'}</span></div>
        <div class="cc-meta-item">å…¥å±…å¸Œæœ›<br><span>${c.date||'â€”'}</span></div>
      `;
    } else {
      metaHtml = `
        <div class="cc-meta-item">å¸Œæœ›æ¥­ç•Œ<br><span>${c.industry||'â€”'}</span></div>
        <div class="cc-meta-item">å¸Œæœ›å¹´å<br><span>${c.salary||'â€”'}</span></div>
        <div class="cc-meta-item">çµŒé¨“<br><span>${c.exp||'â€”'}</span></div>
        <div class="cc-meta-item">è»¢è·å¸Œæœ›<br><span>${c.timing||'â€”'}</span></div>
      `;
    }

    let footerHtml = '';
    if(isMatched){
      footerHtml = `<div style="font-size:10px;color:var(--green)">âœ… æ‹…å½“ï¼š${c.assignedAg}</div>`;
    } else if(c.status==='open' && currentRole==='ag'){
      if(isApplied){
        footerHtml = `<span class="badge" style="background:rgba(59,130,246,.15);color:var(--blue)">âœ‹ å¿œå‹Ÿæ¸ˆã¿ï¼ˆå…ˆç€1ç•ªï¼‰</span>`;
      } else {
        footerHtml = `<button class="btn btn-green btn-sm" onclick="applyCase(event,'${c.id}')">âœ‹ å¯¾å¿œã™ã‚‹</button>`;
      }
    } else if(c.status==='pending_approval'){
      footerHtml = `<span class="badge bdg-wait">â³ æœ¬éƒ¨æ‰¿èªå¾…ã¡</span>`;
    } else if(c.status==='expired'){
      footerHtml = `<span class="badge bdg-closed">æœŸé™åˆ‡ã‚Œ</span>`;
    } else {
      footerHtml = `<div style="font-size:10px;color:var(--muted)">æŠ•ç¨¿ï¼š${c.posted}</div>`;
    }

    return `
    <div class="case-card ${srcClass} ${isSelected?'selected':''} ${isMatched?'matched':''} ${isApplied?'applying':''}"
         onclick="selectCase('${c.id}')">
      <div class="cc-status-bar ${statusBar}"></div>
      <div class="cc-head">
        <div class="cc-id">${c.id}</div>
        <div class="cc-badges">
          <span class="badge ${c.biz==='re'?'bdg-re':'bdg-hr'}">${c.bizLabel}</span>
          <span class="badge ${c.src==='pt'?'bdg-pt':c.src==='hq'?'bdg-hq':'bdg-re'}">${c.srcLabel}</span>
          <span class="badge ${STATUS_BADGE[c.status]||'bdg-closed'}">${STATUS_LABEL[c.status]||c.status}</span>
        </div>
      </div>
      <div class="cc-title">${c.title}</div>
      <div class="cc-sub">${c.note||'å‚™è€ƒãªã—'}</div>
      <div class="cc-meta">${metaHtml}</div>
      <div class="cc-footer">
        ${footerHtml}
        <div style="display:flex;align-items:center;gap:8px">
          ${c.minRank && c.minRank!=='none'?`<span class="badge bdg-gold">ğŸ… ${RANK_LABEL[c.minRank]}</span>`:''}
          ${c.status==='open'?`<div class="cc-timer">â± ${c.deadline}</div>`:''}
          ${c.applyCount>0?`<div class="cc-apply-count">${c.applyCount}åå¿œå‹Ÿ</div>`:''}
        </div>
      </div>
    </div>`;
  }).join('');
}

// â”€â”€ æ¡ˆä»¶é¸æŠ â†’ ã‚µã‚¤ãƒ‰ãƒ‘ãƒãƒ« â”€â”€
function selectCase(id) {
  selectedCase = id;
  const c = CASES.find(x=>x.id===id);
  if(!c) return;
  renderCases();

  const isRevealed = c.status==='matched';
  const canSeeCustomer = (currentRole==='hq') || 
    (isRevealed && (c.assignedAg||'').includes('AG-012'));

  const customerHtml = canSeeCustomer ? `
    <div class="dp-label">é¡§å®¢æƒ…å ±ï¼ˆé–‹ç¤ºæ¸ˆã¿ï¼‰</div>
    <div style="background:rgba(34,197,94,.05);border:1px solid rgba(34,197,94,.2);border-radius:8px;padding:12px;margin-bottom:8px">
      <div style="font-size:12px;font-weight:700;margin-bottom:4px">${c.customerName}</div>
      <div style="font-size:11px;color:var(--sub)">${c.customerPhone}</div>
      <div style="font-size:11px;color:var(--sub)">${c.customerEmail}</div>
    </div>
  ` : `
    <div class="dp-label">é¡§å®¢æƒ…å ±</div>
    <div class="masked"><div class="mask-icon">ğŸ”’</div>ãƒãƒƒãƒãƒ³ã‚°ç¢ºå®šå¾Œã«æ‹…å½“ã‚¨ãƒ¼ã‚¸ã‚§ãƒ³ãƒˆã¸é–‹ç¤ºã•ã‚Œã¾ã™</div>
  `;

  let detailFields = '';
  if(c.biz==='re'){
    detailFields = `
      <div class="dp-label">ç‰©ä»¶æƒ…å ±</div>
      <div class="dp-val">${c.area}</div>
      <div style="height:6px"></div>
      <div class="dp-label">å®¶è³ƒ / ä¾¡æ ¼</div>
      <div class="dp-val">${c.rent||c.price||'â€”'}</div>
      <div style="height:6px"></div>
      <div class="dp-label">é–“å–ã‚Š</div>
      <div class="dp-val">${c.madori||'â€”'}</div>
      <div style="height:6px"></div>
      <div class="dp-label">å…¥å±…å¸Œæœ›</div>
      <div class="dp-val">${c.date||'â€”'}</div>
    `;
  } else {
    detailFields = `
      <div class="dp-label">å¸Œæœ›æ¥­ç•Œ</div><div class="dp-val">${c.industry||'â€”'}</div>
      <div style="height:6px"></div>
      <div class="dp-label">å¸Œæœ›è·ç¨®</div><div class="dp-val">${c.job||'â€”'}</div>
      <div style="height:6px"></div>
      <div class="dp-label">çµŒé¨“</div><div class="dp-val">${c.exp||'â€”'}</div>
      <div style="height:6px"></div>
      <div class="dp-label">å¸Œæœ›å¹´å</div><div class="dp-val">${c.salary||'â€”'}</div>
      <div style="height:6px"></div>
      <div class="dp-label">è»¢è·å¸Œæœ›æ™‚æœŸ</div><div class="dp-val">${c.timing||'â€”'}</div>
    `;
  }

  const actionHtml = (currentRole==='ag' && c.status==='open') ?
    `<button class="btn btn-green btn-full" onclick="applyCase(event,'${c.id}')">âœ‹ ã“ã®æ¡ˆä»¶ã«å¯¾å¿œã™ã‚‹</button>
     <div style="font-size:10px;color:var(--muted);text-align:center;margin-top:6px">å…ˆç€é †ãƒ»æœ¬éƒ¨ç¢ºå®šå¾Œã«é¡§å®¢æƒ…å ±ãŒå±Šãã¾ã™</div>` :
    (c.status==='matched' && currentRole==='hq') ?
    `<button class="btn btn-muted btn-full" style="margin-top:8px">æ‹…å½“è€…ã‚’å¤‰æ›´</button>` : '';

  document.getElementById('detail-panel').innerHTML = `
  <div class="detail-panel">
    <div style="display:flex;justify-content:space-between;align-items:flex-start;margin-bottom:14px">
      <div>
        <div class="cc-badges" style="margin-bottom:6px">
          <span class="badge ${c.biz==='re'?'bdg-re':'bdg-hr'}">${c.bizLabel}</span>
          <span class="badge ${c.src==='pt'?'bdg-pt':c.src==='hq'?'bdg-hq':'bdg-re'}">${c.srcLabel}</span>
        </div>
        <div style="font-size:16px;font-weight:700">${c.title}</div>
        <div style="font-family:'DM Mono',monospace;font-size:10px;color:var(--muted);margin-top:4px">${c.id}</div>
      </div>
      <span class="badge ${STATUS_BADGE[c.status]||'bdg-closed'}">${STATUS_LABEL[c.status]||c.status}</span>
    </div>

    <div class="dp-divider"></div>

    <div class="dp-section">
      ${detailFields}
    </div>

    ${c.note ? `<div class="dp-divider"></div>
    <div class="dp-section">
      <div class="dp-label">å‚™è€ƒãƒ»ãƒ¡ãƒ¢</div>
      <div style="font-size:12px;color:var(--sub);line-height:1.7">${c.note}</div>
    </div>` : ''}

    <div class="dp-divider"></div>

    <div class="dp-section">
      ${customerHtml}
    </div>

    ${c.src==='pt' ? `
    <div class="dp-divider"></div>
    <div class="dp-section">
      <div class="dp-label">ç´¹ä»‹ãƒ‘ãƒ¼ãƒˆãƒŠãƒ¼</div>
      <div class="dp-val">${c.ptName} <span style="font-family:'DM Mono',monospace;font-size:10px;color:var(--muted)">(${c.ptId})</span></div>
    </div>` : ''}

    <div class="dp-divider"></div>

    <div class="dp-section">
      <div class="dp-label">å¿œå‹Ÿæ¡ä»¶</div>
      <div style="font-size:12px;color:var(--sub)">${RANK_LABEL[c.minRank]||'æŒ‡å®šãªã—'}</div>
    </div>
    <div class="dp-section">
      <div class="dp-label">å¿œå‹Ÿç· åˆ‡</div>
      <div style="font-size:12px;color:${c.deadline.includes('h')?'var(--orange)':'var(--sub)'}">${c.deadline}</div>
    </div>
    <div class="dp-section">
      <div class="dp-label">å¿œå‹ŸçŠ¶æ³</div>
      <div style="font-size:12px;color:var(--sub)">${c.applyCount}åå¿œå‹Ÿ</div>
    </div>

    ${actionHtml}
  </div>`;
}

// â”€â”€ æ¡ˆä»¶å¿œå‹Ÿ â”€â”€
function applyCase(e, id) {
  e.stopPropagation();
  const c = CASES.find(x=>x.id===id);
  if(!c) return;
  c.applyCount++;
  if(c.status==='open'){
    c.status='pending_approval';
    alert(`âœ‹ æ¡ˆä»¶ã€Œ${c.title}ã€ã«å¯¾å¿œç”³è«‹ã—ã¾ã—ãŸã€‚\n\nå…ˆç€1ç•ªã¨ã—ã¦ä»®ãƒãƒƒãƒãƒ³ã‚°ã•ã‚Œã¾ã—ãŸã€‚\næœ¬éƒ¨ã®æ‰¿èªå¾Œã«é¡§å®¢æƒ…å ±ãŒé–‹ç¤ºã•ã‚Œã¾ã™ã€‚\n\nSlackã«ã‚‚é€šçŸ¥ãŒå±Šãã¾ã™ã€‚`);
  }
  renderCases();
}

// â”€â”€ ãƒãƒƒãƒãƒ³ã‚°ç¢ºå®š â”€â”€
function confirmMatch(caseId, agName, agId) {
  const c = CASES.find(x=>x.id===caseId);
  if(!c) return;

  if(confirm(`ã€Œ${c.title}ã€ã‚’\n${agName}ï¼ˆ${agId}ï¼‰ã«ç¢ºå®šã—ã¾ã™ã‹ï¼Ÿ\n\nç¢ºå®šå¾Œã€é¡§å®¢æƒ…å ±ãŒ${agName}ã«é–‹ç¤ºã•ã‚Œã¾ã™ã€‚`)){
    c.status = 'matched';
    c.assignedAg = `${agName}ï¼ˆ${agId}ï¼‰`;
    c.customerName = 'ç”°ä¸­ ä¸€éƒï¼ˆã‚µãƒ³ãƒ—ãƒ«ï¼‰';
    c.customerPhone = '090-1234-5678';
    c.customerEmail = 'ichiro.tanaka@example.com';

    document.getElementById('badge-mgmt').textContent =
      parseInt(document.getElementById('badge-mgmt').textContent) - 1;

    // Slacké€šçŸ¥
    notifyMatchToSlack({ c, agName, agId });

    // LINE WORKSãƒˆãƒ¼ã‚¯ãƒ«ãƒ¼ãƒ ä½œæˆãƒ¢ãƒ¼ãƒ€ãƒ«ã‚’è¡¨ç¤º
    showWorksModal({ c, agName, agId });

    switchTab('board');
  }
}

// â”€â”€ Slacké€šçŸ¥ï¼ˆãƒãƒƒãƒãƒ³ã‚°ç¢ºå®šï¼‰â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
function notifyMatchToSlack({ c, agName, agId }) {
  const today = new Date();
  const dateStr = today.getFullYear()+'/'+(today.getMonth()+1).toString().padStart(2,'0')+'/'+today.getDate().toString().padStart(2,'0');
  const roomName = `ã€æ¡ˆä»¶ã€‘${c.title.slice(0,12)}_${dateStr.slice(5).replace('/','')}_${agId}`;
  const payload = {
    text: 'ğŸ”” æ¡ˆä»¶ãƒãƒƒãƒãƒ³ã‚°ç¢ºå®š â€” LINE WORKSãƒˆãƒ¼ã‚¯ãƒ«ãƒ¼ãƒ ã‚’ä½œæˆã—ã¦ãã ã•ã„',
    attachments: [{
      color: '#c9a840',
      blocks: [
        { type:'section', text:{ type:'mrkdwn',
          text:`*ğŸ”” æ¡ˆä»¶ãƒãƒƒãƒãƒ³ã‚°ç¢ºå®š â€” ãƒˆãƒ¼ã‚¯ãƒ«ãƒ¼ãƒ ä½œæˆã‚’ãŠé¡˜ã„ã—ã¾ã™*` }},
        { type:'section', fields:[
          { type:'mrkdwn', text:`*æ¡ˆä»¶*\n${c.title}` },
          { type:'mrkdwn', text:`*æ¡ˆä»¶ID*\n\`${c.id}\`` },
          { type:'mrkdwn', text:`*ã‚¨ãƒ¼ã‚¸ã‚§ãƒ³ãƒˆ*\n${agName}ï¼ˆ${agId}ï¼‰` },
          { type:'mrkdwn', text:`*ãƒ‘ãƒ¼ãƒˆãƒŠãƒ¼*\n${c.ptName||'â€”'}ï¼ˆ${c.ptId||'â€”'}ï¼‰` },
          { type:'mrkdwn', text:`*ç¨®åˆ¥*\n${c.bizLabel} / ${c.srcLabel}` },
          { type:'mrkdwn', text:`*ã‚¨ãƒªã‚¢*\n${c.area||'â€”'}` },
        ]},
        { type:'section', text:{ type:'mrkdwn',
          text:`*ğŸ“± LINE WORKSãƒˆãƒ¼ã‚¯ãƒ«ãƒ¼ãƒ ä½œæˆæ‰‹é †*\n1. LINE WORKSã‚’é–‹ã\n2. *${agName}* ã¨ *${c.ptName||'ãƒ‘ãƒ¼ãƒˆãƒŠãƒ¼'}* ã‚’ãƒˆãƒ¼ã‚¯ãƒ«ãƒ¼ãƒ ã«è¿½åŠ \n3. ãƒˆãƒ¼ã‚¯ãƒ«ãƒ¼ãƒ åï¼š\`${roomName}\`\n4. æœ€åˆã®ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸ã‚’é€ä¿¡ï¼ˆä¸‹è¨˜ãƒ†ãƒ³ãƒ—ãƒ¬ãƒ¼ãƒˆã‚’ã‚³ãƒ”ãƒ¼ï¼‰` }},
        { type:'section', text:{ type:'mrkdwn',
          text:`*ğŸ’¬ æœ€åˆã®ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸ï¼ˆã‚³ãƒ”ãƒ¼ç”¨ï¼‰*\n\`\`\`${agName}ã•ã‚“ã€${c.ptName||'ãƒ‘ãƒ¼ãƒˆãƒŠãƒ¼'}ã•ã‚“\nCORETOæœ¬éƒ¨ã§ã™ã€‚æ¡ˆä»¶ã€Œ${c.title}ã€ã®ãƒãƒƒãƒãƒ³ã‚°ãŒç¢ºå®šã—ã¾ã—ãŸã€‚\nã“ã¡ã‚‰ã®ãƒ«ãƒ¼ãƒ ã§é€£çµ¡ã‚’å–ã‚Šåˆã£ã¦ãã ã•ã„ã€‚ã‚ˆã‚ã—ããŠé¡˜ã„ã—ã¾ã™ã€‚\`\`\`` }},
      ]
    }]
  };
  // æœ¬ç•ª: fetch(SLACK_WEBHOOK, {method:'POST', body:JSON.stringify(payload)});
  console.log('[Slack ãƒãƒƒãƒãƒ³ã‚°é€šçŸ¥]', JSON.stringify(payload, null, 2));
}

// â”€â”€ LINE WORKSãƒˆãƒ¼ã‚¯ãƒ«ãƒ¼ãƒ ä½œæˆæ”¯æ´ãƒ¢ãƒ¼ãƒ€ãƒ« â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
function showWorksModal({ c, agName, agId }) {
  const today = new Date();
  const dateStr = today.getFullYear()+'/'+(today.getMonth()+1).toString().padStart(2,'0')+'/'+today.getDate().toString().padStart(2,'0');
  const roomName = `ã€æ¡ˆä»¶ã€‘${c.title.slice(0,12)}_${dateStr.slice(5).replace('/','')}_${agId}`;
  const firstMsg = `${agName}ã•ã‚“ã€${c.ptName||'ãƒ‘ãƒ¼ãƒˆãƒŠãƒ¼'}ã•ã‚“\nCORETOæœ¬éƒ¨ã§ã™ã€‚æ¡ˆä»¶ã€Œ${c.title}ã€ã®ãƒãƒƒãƒãƒ³ã‚°ãŒç¢ºå®šã—ã¾ã—ãŸã€‚\nã“ã¡ã‚‰ã®ãƒ«ãƒ¼ãƒ ã§é€£çµ¡ã‚’å–ã‚Šåˆã£ã¦ãã ã•ã„ã€‚ã‚ˆã‚ã—ããŠé¡˜ã„ã—ã¾ã™ã€‚`;

  let modal = document.getElementById('works-modal');
  if (!modal) {
    modal = document.createElement('div');
    modal.id = 'works-modal';
    modal.style.cssText = 'position:fixed;inset:0;background:rgba(0,0,0,.7);z-index:9999;display:flex;align-items:center;justify-content:center;padding:16px';
    modal.innerHTML = `
      <div style="background:#141820;border:1px solid rgba(201,168,76,.4);border-radius:16px;width:min(520px,100%);max-height:90vh;overflow-y:auto">
        <div style="padding:18px 20px;border-bottom:1px solid #1e2435;display:flex;align-items:center;justify-content:space-between">
          <div style="font-family:'Syne',sans-serif;font-size:15px;font-weight:800;color:#c9a840">ğŸ“± LINE WORKSãƒˆãƒ¼ã‚¯ãƒ«ãƒ¼ãƒ ä½œæˆ</div>
          <button onclick="document.getElementById('works-modal').remove()" style="background:none;border:none;color:#4a4f68;font-size:20px;cursor:pointer">Ã—</button>
        </div>
        <div style="padding:20px;display:flex;flex-direction:column;gap:14px">

          <div style="background:rgba(201,168,76,.08);border:1px solid rgba(201,168,76,.25);border-radius:10px;padding:12px 14px;font-size:12px;color:#e4e7f0;line-height:1.8">
            âœ… ãƒãƒƒãƒãƒ³ã‚°ãŒç¢ºå®šã—ã¾ã—ãŸã€‚Slackã«é€šçŸ¥ã‚’é€ã‚Šã¾ã—ãŸã€‚<br>
            ä¸‹è¨˜ã®æƒ…å ±ã‚’ã‚‚ã¨ã«<strong style="color:#c9a840">LINE WORKSã§ãƒˆãƒ¼ã‚¯ãƒ«ãƒ¼ãƒ ã‚’ä½œæˆ</strong>ã—ã¦ãã ã•ã„ã€‚
          </div>

          <div style="display:flex;flex-direction:column;gap:10px">
            <div id="wm-room" style="background:#191e28;border:1px solid #252c3d;border-radius:8px;padding:10px 14px">
              <div style="font-size:10px;color:#4a4f68;margin-bottom:5px;font-weight:600;letter-spacing:.5px">ãƒˆãƒ¼ã‚¯ãƒ«ãƒ¼ãƒ å</div>
              <div style="display:flex;align-items:center;gap:8px">
                <div style="font-family:'DM Mono',monospace;font-size:12px;color:#c9a840;flex:1" id="wm-room-name"></div>
                <button onclick="copyWM('wm-room-name')" style="font-size:10px;padding:3px 8px;border:1px solid #252c3d;border-radius:5px;background:transparent;color:#7a82a0;cursor:pointer">ã‚³ãƒ”ãƒ¼</button>
              </div>
            </div>

            <div style="background:#191e28;border:1px solid #252c3d;border-radius:8px;padding:10px 14px">
              <div style="font-size:10px;color:#4a4f68;margin-bottom:8px;font-weight:600;letter-spacing:.5px">æ‹›å¾…ãƒ¡ãƒ³ãƒãƒ¼</div>
              <div id="wm-members" style="display:flex;flex-direction:column;gap:6px;font-size:12px"></div>
            </div>

            <div style="background:#191e28;border:1px solid #252c3d;border-radius:8px;padding:10px 14px">
              <div style="font-size:10px;color:#4a4f68;margin-bottom:5px;font-weight:600;letter-spacing:.5px">æœ€åˆã®ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸ï¼ˆã‚³ãƒ”ãƒ¼ã—ã¦è²¼ã‚Šä»˜ã‘ï¼‰</div>
              <div style="font-size:12px;color:#e4e7f0;line-height:1.8;white-space:pre-wrap;margin-bottom:8px" id="wm-msg"></div>
              <button onclick="copyWM('wm-msg')" style="font-size:10px;padding:4px 10px;border:1px solid #252c3d;border-radius:5px;background:transparent;color:#7a82a0;cursor:pointer">ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸ã‚’ã‚³ãƒ”ãƒ¼</button>
            </div>
          </div>

          <a href="https://talk.worksmobile.com/" target="_blank"
             style="display:block;text-align:center;padding:12px;background:#c9a840;color:#0d0f14;border-radius:10px;font-weight:800;font-size:14px;text-decoration:none">
            ğŸ“± LINE WORKSã‚’é–‹ã â†’
          </a>
          <button onclick="document.getElementById('works-modal').remove()"
                  style="padding:10px;border:1px solid #252c3d;border-radius:8px;background:transparent;color:#7a82a0;font-size:13px;cursor:pointer;font-family:inherit">
            é–‰ã˜ã‚‹
          </button>
        </div>
      </div>`;
    document.body.appendChild(modal);
  }

  document.getElementById('wm-room-name').textContent = roomName;
  document.getElementById('wm-msg').textContent = firstMsg.replace(/\n/g, '\n');
  document.getElementById('wm-members').innerHTML = `
    <div style="display:flex;align-items:center;gap:8px;padding:6px 8px;background:#141820;border-radius:6px">
      <span style="font-size:14px">ğŸ¢</span>
      <div><div style="font-weight:700;color:#e4e7f0">CORETOæœ¬éƒ¨</div><div style="color:#4a4f68;font-size:10px">LINE WORKSã‚¢ã‚«ã‚¦ãƒ³ãƒˆï¼ˆè‡ªåˆ†ï¼‰</div></div>
    </div>
    <div style="display:flex;align-items:center;gap:8px;padding:6px 8px;background:#141820;border-radius:6px">
      <span style="font-size:14px">ğŸ§‘â€ğŸ’¼</span>
      <div><div style="font-weight:700;color:#e4e7f0">${agName} <span style="font-size:10px;color:#4a4f68">${agId}</span></div><div style="color:#4a4f68;font-size:10px">ã‚¨ãƒ¼ã‚¸ã‚§ãƒ³ãƒˆ â€” LINE WORKSã¾ãŸã¯LINEã§æ‹›å¾…</div></div>
    </div>
    <div style="display:flex;align-items:center;gap:8px;padding:6px 8px;background:#141820;border-radius:6px">
      <span style="font-size:14px">ğŸ¤</span>
      <div><div style="font-weight:700;color:#e4e7f0">${c.ptName||'ãƒ‘ãƒ¼ãƒˆãƒŠãƒ¼'} <span style="font-size:10px;color:#4a4f68">${c.ptId||'â€”'}</span></div><div style="color:#4a4f68;font-size:10px">ãƒ‘ãƒ¼ãƒˆãƒŠãƒ¼ â€” LINEã§æ‹›å¾…</div></div>
    </div>`;
}

function copyWM(id) {
  const el = document.getElementById(id);
  if (!el) return;
  const ta = document.createElement('textarea');
  ta.value = el.textContent; document.body.appendChild(ta); ta.select();
  document.execCommand('copy'); document.body.removeChild(ta);
  showMatchToast('ã‚³ãƒ”ãƒ¼ã—ã¾ã—ãŸ âœ…');
}

function showMatchToast(msg) {
  let t = document.getElementById('match-toast');
  if (!t) {
    t = document.createElement('div');
    t.id = 'match-toast';
    t.style.cssText = 'position:fixed;bottom:24px;right:24px;background:#1e2a1e;border:1px solid #34d399;color:#34d399;padding:10px 18px;border-radius:8px;font-size:12px;font-weight:600;z-index:99999;opacity:0;transition:opacity .3s;font-family:inherit';
    document.body.appendChild(t);
  }
  t.textContent = msg; t.style.opacity = '1';
  setTimeout(() => { t.style.opacity = '0'; }, 2000);
}

// â”€â”€ æ¡ˆä»¶è©³ç´°ï¼ˆç®¡ç†ãƒ†ãƒ¼ãƒ–ãƒ«ã‹ã‚‰ï¼‰ â”€â”€
function viewCaseDetail(caseId) {
  switchTab('board');
  setTimeout(() => selectCase(caseId), 50);
}

// â”€â”€ æ‹…å½“è€…å¤‰æ›´ â”€â”€
function changeAgent(caseId) {
  alert('æ‹…å½“è€…å¤‰æ›´ï¼šä»–ã®å¿œå‹Ÿè€…ã‹ã‚‰é¸æŠã€ã¾ãŸã¯æ–°ãŸã«ãƒœãƒ¼ãƒ‰ã«æˆ»ã™ã“ã¨ãŒã§ãã¾ã™ã€‚\n\nï¼ˆæœ¬å®Ÿè£…ã§ã¯ãƒ¢ãƒ¼ãƒ€ãƒ«ã§é¸æŠUIï¼‰');
}

// â”€â”€ æ¡ˆä»¶èµ·ç¥¨ â”€â”€
function submitCase() {
  const src = gv('g-source');
  const biz = gv('g-biz');
  const assignMode = src==='hq' ? gv('g-assign-mode') : 'board';

  let msg = 'æ¡ˆä»¶ã‚’æ²è¼‰ã—ã¾ã—ãŸï¼\n\n';
  if(src==='hq' && assignMode==='direct'){
    const ag = document.getElementById('direct-agent').value;
    msg += ag ? `âœ… æ‹…å½“ã‚¨ãƒ¼ã‚¸ã‚§ãƒ³ãƒˆã€Œ${ag}ã€ã«ç›´æ¥ã‚¢ã‚µã‚¤ãƒ³ã•ã‚Œã¾ã—ãŸã€‚\nSlack DMã§é€šçŸ¥ã•ã‚Œã¾ã™ã€‚` : 'æ‹…å½“ã‚¨ãƒ¼ã‚¸ã‚§ãƒ³ãƒˆã‚’é¸æŠã—ã¦ãã ã•ã„ã€‚';
  } else {
    msg += 'ğŸ“‹ æ¡ˆä»¶ãƒœãƒ¼ãƒ‰ã«æ²è¼‰ã•ã‚Œã¾ã—ãŸã€‚\nã‚¨ãƒ¼ã‚¸ã‚§ãƒ³ãƒˆã‹ã‚‰ã®å¿œå‹Ÿã‚’å¾…ã¡ã¾ã™ã€‚\nå…ˆç€1åãŒä»®ãƒãƒƒãƒãƒ³ã‚°ã•ã‚Œã€æœ¬éƒ¨ã®æ‰¿èªå¾Œã«é¡§å®¢æƒ…å ±ãŒé–‹ç¤ºã•ã‚Œã¾ã™ã€‚';
  }
  if(document.getElementById('direct-agent')?.value || src!=='hq' || assignMode!=='direct'){
    alert(msg);
    switchTab('board');
  }
}

// â”€â”€ åˆæœŸæç”» â”€â”€
renderCases();
updateTabsForRole();

// â”€â”€ ã‚¯ãƒ©ã‚¤ã‚¢ãƒ³ãƒˆæ¤œç´¢åˆæœŸåŒ– â”€â”€
document.addEventListener('DOMContentLoaded', function(){
  initClientSearch('mc-client-search','mc-client-id','mc-client-name','mc-client-dropdown', null);
});

// â”€â”€ ç´¹ä»‹ãƒªãƒ³ã‚¯ãƒ¢ãƒ¼ãƒ€ãƒ« â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
var _refCurrentCode = '';
function openRefModal() {
  var overlay = document.getElementById('ref-modal-overlay');
  var selector = document.getElementById('ref-code-selector');
  var isExec = (typeof session !== 'undefined' && session && session.hqRole === 'exec')
            || (typeof CURRENT_USER !== 'undefined' && CURRENT_USER && CURRENT_USER.hqRole === 'exec');
  var agentId = (typeof session !== 'undefined' && session && session.userId) ? session.userId
              : (typeof ME !== 'undefined' && ME && ME.id) ? ME.id
              : (typeof AGENT !== 'undefined' && AGENT && AGENT.id) ? AGENT.id : '10012';
  if (isExec) {
    var SPECIAL = ['FOUNDER2026','WELCOME2026','GOLD_START','HR_PRO75'];
    var opts = SPECIAL.map(function(c){ return '<option value="'+c+'">â­ '+c+'</option>'; }).join('');
    selector.innerHTML =
      '<div style="margin-bottom:12px"><div style="font-size:10px;color:var(--sub);font-weight:600;margin-bottom:5px">ã‚³ãƒ¼ãƒ‰ç¨®åˆ¥</div>'
      +'<select id="ref-code-select" onchange="updateRefLink()" style="width:100%;padding:8px 10px;background:var(--card2);border:1px solid var(--border2);border-radius:8px;color:var(--text);font-size:12px;font-family:inherit">'
      +'<option value="'+agentId+'">è‡ªåˆ†ã®IDï¼ˆ'+agentId+'ï¼‰</option>'
      +'<optgroup label="â”€â”€ ç‰¹åˆ¥ã‚³ãƒ¼ãƒ‰ â”€â”€">'+opts+'</optgroup>'
      +'</select></div>';
    _refCurrentCode = agentId;
  } else {
    selector.innerHTML =
      '<div style="display:flex;align-items:center;gap:8px;margin-bottom:12px;padding:8px 12px;background:rgba(201,168,76,.06);border:1px solid rgba(201,168,76,.2);border-radius:8px">'
      +'<span style="font-size:11px;color:var(--muted)">ç´¹ä»‹ã‚³ãƒ¼ãƒ‰ï¼š</span>'
      +'<span style="font-family:\'DM Mono\',monospace;font-size:13px;font-weight:700;color:var(--gold)">'+agentId+'</span>'
      +'</div>';
    _refCurrentCode = agentId;
  }
  updateRefLink();
  overlay.classList.add('open');
}
function updateRefLink() {
  var sel = document.getElementById('ref-code-select');
  if (sel) _refCurrentCode = sel.value;
  var base = location.origin + location.pathname.replace(/[^/]*$/, '') + 'coreto-agent-signup.html';
  var url = base + '?ref=' + encodeURIComponent(_refCurrentCode);
  document.getElementById('ref-url-display').textContent = url;
}
function closeRefModal() {
  document.getElementById('ref-modal-overlay').classList.remove('open');
}
function copyRefLink() {
  var url = document.getElementById('ref-url-display').textContent;
  navigator.clipboard.writeText(url).then(function() {
    var btn = document.querySelector('.ref-copy-btn');
    btn.textContent = 'âœ… ã‚³ãƒ”ãƒ¼ã—ã¾ã—ãŸ';
    setTimeout(function(){ btn.textContent = 'ğŸ“‹ ã‚³ãƒ”ãƒ¼'; }, 2000);
  }).catch(function() {
    var ta = document.createElement('textarea');
    ta.value = url; document.body.appendChild(ta); ta.select();
    document.execCommand('copy'); document.body.removeChild(ta);
  });
}

// Role-based auto-set from session
(function() {
  var s = window._SESSION;
  if (!s) return;
  var roleMap = { hq: 'hq', re: 'ag', hr: 'ag', pt: 'pt' };
  var myRole = roleMap[s.type] || 'ag';
  // Auto-set role
  var allBtns = document.querySelectorAll('.rsw');
  allBtns.forEach(function(b) {
    var r = b.onclick ? b.onclick.toString().match(/setRole\('(\w+)'/) : null;
    if (r && r[1] === myRole) { b.click(); }
  });
  // Hide role switcher for non-HQ (they cannot switch to another role's view)
  if (s.type !== 'hq') {
    var sw = document.querySelector('.role-sw');
    if (sw) sw.style.display = 'none';
  }
})();
</script>

<div id="ref-modal-overlay" onclick="if(event.target===this)closeRefModal()">
  <div id="ref-modal">
    <div class="ref-mhdr">
      <div class="ref-mhdr-t">ğŸ”— ç´¹ä»‹ãƒªãƒ³ã‚¯ç™ºè¡Œ</div>
      <button onclick="closeRefModal()" style="background:none;border:none;color:var(--muted);font-size:20px;cursor:pointer;line-height:1">Ã—</button>
    </div>
    <div class="ref-mbody">
      <div style="font-size:11px;color:var(--sub);margin-bottom:14px;line-height:1.8">ã“ã®ãƒªãƒ³ã‚¯ã‹ã‚‰å…¥ä¼šã™ã‚‹ã¨ç´¹ä»‹ã‚³ãƒ¼ãƒ‰ãŒè‡ªå‹•å…¥åŠ›ã•ã‚Œã¾ã™ã€‚</div>
      <div id="ref-code-selector"></div>
      <div style="font-size:10px;color:var(--muted);margin-bottom:4px;font-weight:600;letter-spacing:.5px">ç™ºè¡Œãƒªãƒ³ã‚¯</div>
      <div class="ref-url" id="ref-url-display">â€”</div>
      <button class="ref-copy-btn" onclick="copyRefLink()">ğŸ“‹ ã‚³ãƒ”ãƒ¼</button>
    </div>
  </div>
</div>

<button id="ref-float-btn" onclick="openRefModal()">ğŸ”— ç´¹ä»‹ãƒªãƒ³ã‚¯ç™ºè¡Œ</button>
</body>
</html>
