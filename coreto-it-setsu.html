<!DOCTYPE html>
<html lang="ja">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>CORETO ITé‡èª¬ &amp; å¥‘ç´„æ›¸ç®¡ç†</title>
<style>
@import url('https://fonts.googleapis.com/css2?family=Noto+Sans+JP:wght@300;400;500;700&family=DM+Mono:wght@400;500&family=Syne:wght@700;800&display=swap');
*{box-sizing:border-box;margin:0;padding:0}
:root{
  --bg:#07090f;--card:#0f1119;--card2:#141720;--border:#1e2235;--border2:#252a3d;
  --gold:#c9a84c;--gold-l:#e8c96a;--gold-dim:#7a5f22;
  --blue:#4f9cf9;--green:#34d399;--red:#f87171;--orange:#fb923c;--purple:#a78bfa;
  --teal:#2dd4bf;--muted:#4a5270;--sub:#7a849e;--text:#e2e6f3;
}
body{font-family:'Noto Sans JP',sans-serif;background:var(--bg);color:var(--text);min-height:100vh;
  background-image:radial-gradient(ellipse 50% 40% at 70% 5%,rgba(79,156,249,.04),transparent 60%)}

/* â”€ Header â”€ */
.header{display:flex;align-items:center;justify-content:space-between;padding:0 28px;height:54px;
  border-bottom:1px solid var(--border);background:rgba(7,9,15,.9);backdrop-filter:blur(12px);
  position:sticky;top:0;z-index:200}
.logo{font-family:'Syne',sans-serif;font-size:18px;font-weight:800;color:var(--gold);letter-spacing:3px}
.hdr-mid{display:flex;align-items:center;gap:10px}
.hdr-badge{font-size:9px;font-weight:700;padding:3px 9px;border-radius:4px;letter-spacing:1px}
.badge-it{background:rgba(79,156,249,.15);border:1px solid rgba(79,156,249,.3);color:var(--blue)}
.badge-scan{background:rgba(52,211,153,.12);border:1px solid rgba(52,211,153,.25);color:var(--green)}

/* â”€ Layout: 2-pane â”€ */
.layout{display:grid;grid-template-columns:300px 1fr;height:calc(100vh - 54px)}

/* â”€ Left: Case list â”€ */
.caselist{background:var(--card2);border-right:1px solid var(--border);overflow-y:auto}
.cl-header{padding:14px 16px 10px;border-bottom:1px solid var(--border);display:flex;align-items:center;justify-content:space-between}
.cl-title{font-size:9px;color:var(--muted);letter-spacing:2px;text-transform:uppercase}
.cl-count{font-family:'DM Mono',monospace;font-size:11px;color:var(--sub)}
.cl-filter{display:flex;gap:4px;padding:8px 10px;border-bottom:1px solid var(--border)}
.clf{flex:1;padding:5px 0;font-size:9px;font-weight:700;border-radius:5px;letter-spacing:.5px;
  border:1px solid var(--border2);background:transparent;color:var(--muted);cursor:pointer;
  font-family:'Noto Sans JP',sans-serif;transition:all .15s;text-align:center}
.clf.on{background:rgba(79,156,249,.12);border-color:rgba(79,156,249,.35);color:var(--blue)}
.case-item{padding:12px 14px;cursor:pointer;border-bottom:1px solid rgba(30,34,53,.7);
  transition:background .1s;position:relative}
.case-item:hover{background:rgba(255,255,255,.02)}
.case-item.active{background:rgba(79,156,249,.05);border-left:2px solid var(--blue);padding-left:12px}
.ci-id{font-family:'DM Mono',monospace;font-size:10px;color:var(--muted);margin-bottom:3px}
.ci-name{font-size:12px;font-weight:700;margin-bottom:3px}
.ci-meta{display:flex;gap:6px;align-items:center;flex-wrap:wrap}
.ci-status{position:absolute;top:12px;right:12px;width:8px;height:8px;border-radius:50%}
.st-waiting{background:var(--orange)}
.st-it-done{background:var(--blue)}
.st-scan-pending{background:var(--purple)}
.st-complete{background:var(--green)}
.ci-badge{font-size:8px;font-weight:700;padding:1px 5px;border-radius:3px}

/* â”€ Main â”€ */
.main{display:flex;flex-direction:column;overflow:hidden}

/* â”€ Case header â”€ */
.case-hdr{padding:18px 26px 0;border-bottom:1px solid var(--border);background:rgba(7,9,15,.5)}
.case-hdr-top{display:flex;align-items:flex-start;justify-content:space-between;gap:16px;padding-bottom:14px}
.case-title-area{}
.case-id{font-family:'DM Mono',monospace;font-size:10px;color:var(--muted);margin-bottom:4px}
.case-name{font-size:20px;font-weight:700;margin-bottom:5px}
.case-meta{display:flex;gap:8px;flex-wrap:wrap;align-items:center}
.prop-tag{font-size:10px;font-weight:600;padding:3px 9px;border-radius:5px;
  background:rgba(79,156,249,.12);border:1px solid rgba(79,156,249,.25);color:var(--blue)}
.case-detail-row{font-size:11px;color:var(--sub)}
/* Overall progress */
.case-progress{display:flex;flex-direction:column;align-items:flex-end;gap:4px;flex-shrink:0}
.cp-pct{font-family:'Syne',sans-serif;font-size:28px;font-weight:800;line-height:1}
.cp-label{font-size:9px;color:var(--muted);letter-spacing:1px}
.cp-bar-wrap{width:120px;height:5px;background:var(--border2);border-radius:3px;overflow:hidden}
.cp-bar{height:100%;border-radius:3px;transition:width .5s}

/* Timeline tabs */
.timeline-tabs{display:flex;gap:0;border-top:1px solid var(--border)}
.tt{padding:10px 16px;font-size:10px;font-weight:700;cursor:pointer;color:var(--muted);
  border-bottom:2px solid transparent;transition:all .15s;letter-spacing:.5px;white-space:nowrap;
  display:flex;align-items:center;gap:6px}
.tt.on{color:var(--blue);border-bottom-color:var(--blue)}
.tt-dot{width:7px;height:7px;border-radius:50%}

/* â”€ Scroll area â”€ */
.main-scroll{flex:1;overflow-y:auto;padding:22px 26px 80px}

/* â”€ Section card â”€ */
.sec-card{background:var(--card);border:1px solid var(--border);border-radius:13px;
  margin-bottom:14px;overflow:hidden}
.sec-hdr{display:flex;align-items:center;justify-content:space-between;padding:13px 18px;
  cursor:pointer;user-select:none;transition:background .15s}
.sec-hdr:hover{background:rgba(255,255,255,.02)}
.sec-hdr-left{display:flex;align-items:center;gap:10px}
.sec-icon{font-size:17px;width:26px;text-align:center}
.sec-title-text{font-size:12px;font-weight:700}

.sec-right{display:flex;align-items:center;gap:10px}
.sec-prog{font-size:10px;font-family:'DM Mono',monospace;color:var(--sub)}
.sec-chev{color:var(--muted);font-size:12px;transition:transform .2s}
.sec-chev.open{transform:rotate(90deg)}
.sec-body{border-top:1px solid var(--border)}
.sec-body.collapsed{display:none}

/* â”€ Check items â”€ */
.chk{display:grid;grid-template-columns:22px 1fr auto;gap:10px;align-items:start;
  padding:12px 18px;border-bottom:1px solid rgba(30,34,53,.5);transition:background .1s}
.chk:last-child{border-bottom:none}
.chk.ok-row{background:rgba(52,211,153,.02)}
.chk.ng-row{background:rgba(248,113,113,.04)}
.chk-num{font-family:'DM Mono',monospace;font-size:9px;color:var(--muted);padding-top:2px}
.chk-body{}
.chk-label{font-size:12px;font-weight:600;margin-bottom:2px;line-height:1.5}
.chk-desc{font-size:10px;color:var(--sub);line-height:1.7}
.chk-tag{display:inline-block;font-size:8px;font-weight:700;padding:1px 5px;border-radius:3px;
  margin-left:5px;vertical-align:middle}
.tag-req{background:rgba(248,113,113,.15);color:var(--red)}
.tag-takken{background:rgba(167,139,250,.15);color:var(--purple)}
.tag-record{background:rgba(79,156,249,.12);color:var(--blue)}
.chk-alert{font-size:10px;color:var(--red);margin-top:4px;display:none}
.chk-alert.show{display:block}
.chk-input{margin-top:6px;display:none}
.chk-input.show{display:block}
.chk-input input,.chk-input select,.chk-input textarea{
  width:100%;background:#090b13;border:1px solid var(--border2);border-radius:6px;
  padding:7px 10px;color:var(--text);font-size:11px;font-family:'Noto Sans JP',sans-serif}
.chk-input textarea{resize:vertical;min-height:56px}
.chk-input input:focus,.chk-input select:focus,.chk-input textarea:focus{
  outline:none;border-color:var(--blue)}

/* â”€ Status buttons â”€ */
.sbg{display:flex;gap:4px;flex-shrink:0;margin-top:1px}
.sb{width:30px;height:27px;border-radius:6px;border:1px solid var(--border2);background:transparent;
  cursor:pointer;font-size:12px;display:flex;align-items:center;justify-content:center;transition:all .1s}
.sb:hover{background:rgba(255,255,255,.03)}
.sb.ok{background:rgba(52,211,153,.15);border-color:rgba(52,211,153,.4)}
.sb.ng{background:rgba(248,113,113,.15);border-color:rgba(248,113,113,.4)}
.sb.na{background:rgba(74,82,112,.15);border-color:var(--border2)}

/* â”€ Scan panel â”€ */
.scan-panel{background:var(--card);border:1px solid var(--border);border-radius:13px;padding:20px;margin-bottom:14px}
.scan-grid{display:grid;grid-template-columns:repeat(3,1fr);gap:12px;margin-bottom:14px}
.scan-item{background:var(--card2);border:1px solid var(--border2);border-radius:10px;padding:14px}
.scan-item.filled{border-color:rgba(52,211,153,.3);background:rgba(52,211,153,.03)}
.scan-item.missing{border-color:rgba(251,146,60,.3)}
.si-label{font-size:9px;color:var(--muted);letter-spacing:1px;text-transform:uppercase;margin-bottom:8px}
.si-num{font-family:'DM Mono',monospace;font-size:14px;font-weight:600;
  letter-spacing:2px;margin-bottom:8px;min-height:24px;color:var(--text)}
.si-num.empty{color:var(--border2);font-style:italic;font-size:11px}
.si-type-badge{font-size:9px;font-weight:700;padding:2px 7px;border-radius:3px;margin-bottom:8px;display:inline-block}
.scan-input-row{display:flex;gap:6px}
.scan-input-row input{flex:1;background:#090b13;border:1px solid var(--border2);border-radius:6px;
  padding:7px 10px;color:var(--text);font-size:12px;font-family:'DM Mono',monospace;letter-spacing:1px}
.scan-input-row input:focus{outline:none;border-color:var(--green)}
.scan-input-row input::placeholder{font-family:'Noto Sans JP',sans-serif;font-size:11px;letter-spacing:0}
.scan-btn{padding:6px 10px;border-radius:6px;border:1px solid var(--border2);background:var(--card);
  color:var(--sub);font-size:11px;cursor:pointer;font-family:'Noto Sans JP',sans-serif;transition:all .15s;white-space:nowrap}
.scan-btn:hover{color:var(--text);border-color:var(--sub)}
.scan-btn.scan-go{background:rgba(52,211,153,.12);border-color:rgba(52,211,153,.3);color:var(--green)}
.si-status{font-size:10px;margin-top:6px;display:flex;align-items:center;gap:5px}
.si-date{font-size:9px;color:var(--muted);margin-top:3px}



/* â”€ Bottom action bar â”€ */
.action-bar{position:sticky;bottom:0;background:rgba(7,9,15,.95);backdrop-filter:blur(12px);
  border-top:1px solid var(--border);padding:13px 26px;display:flex;align-items:center;gap:12px}
.ab-progress{flex:1;font-size:11px;color:var(--sub)}
.ab-btn{padding:9px 20px;border-radius:9px;font-size:12px;font-weight:700;cursor:pointer;
  border:none;font-family:'Noto Sans JP',sans-serif;transition:all .2s;letter-spacing:.5px}
.ab-primary{background:linear-gradient(135deg,var(--green),#22a876);color:#0a0c10}
.ab-primary:hover{filter:brightness(1.08);transform:translateY(-1px)}
.ab-secondary{background:rgba(201,168,76,.12);border:1px solid var(--gold-dim);color:var(--gold)}
.ab-ghost{background:transparent;border:1px solid var(--border2);color:var(--sub)}
.ab-ghost:hover{color:var(--text)}

/* â”€ Note â”€ */
.note-area{background:var(--card2);border-radius:10px;padding:14px;margin-bottom:14px}
.note-label{font-size:9px;color:var(--muted);letter-spacing:1px;text-transform:uppercase;margin-bottom:8px}
.note-area textarea{width:100%;background:#090b13;border:1px solid var(--border2);border-radius:7px;
  padding:10px 12px;color:var(--text);font-size:12px;font-family:'Noto Sans JP',sans-serif;
  resize:vertical;min-height:72px;line-height:1.7}
.note-area textarea:focus{outline:none;border-color:var(--blue)}

/* â”€ Empty state â”€ */
.empty{display:flex;flex-direction:column;align-items:center;justify-content:center;
  height:100%;gap:12px;color:var(--muted)}
.empty-icon{font-size:48px;opacity:.35}

/* â”€ Result modal â”€ */
.modal-overlay{position:fixed;inset:0;background:rgba(0,0,0,.75);backdrop-filter:blur(4px);
  z-index:300;display:none;align-items:center;justify-content:center}
.modal-overlay.show{display:flex}
.modal{background:var(--card);border:1px solid var(--border);border-radius:16px;
  width:500px;padding:28px}
.modal-title{font-family:'Syne',sans-serif;font-size:15px;font-weight:800;color:var(--gold);margin-bottom:4px}
.modal-sub{font-size:11px;color:var(--sub);margin-bottom:20px}
.modal-row{display:flex;justify-content:space-between;padding:7px 0;
  border-bottom:1px solid rgba(30,34,53,.6);font-size:12px}
.modal-row:last-of-type{border:none}
.mr-key{color:var(--sub)}
.mr-val{font-weight:600;font-family:'DM Mono',monospace}
.modal-actions{display:flex;gap:8px;margin-top:20px;justify-content:flex-end}
.ma-btn{padding:9px 18px;border-radius:9px;font-size:12px;font-weight:700;cursor:pointer;
  font-family:'Noto Sans JP',sans-serif}
.ma-confirm{background:linear-gradient(135deg,var(--green),#22a876);border:none;color:#0a0c10}
.ma-cancel{background:transparent;border:1px solid var(--border2);color:var(--sub)}

::-webkit-scrollbar{width:4px}::-webkit-scrollbar-thumb{background:var(--border2);border-radius:2px}
/* â”€ Drive doc items â”€ */
.drive-doc{background:var(--card2);border:1px solid var(--border2);border-radius:11px;padding:14px 16px;transition:.15s}
.drive-doc.ready{border-color:rgba(0,185,0,.35);background:rgba(0,185,0,.04)}
.drive-doc.missing{border-color:rgba(251,146,60,.3)}
.dd-head{display:flex;align-items:center;gap:10px;margin-bottom:10px}
.dd-icon{font-size:18px;flex-shrink:0}
.dd-name{font-size:12px;font-weight:700;flex:1}
.dd-status{font-size:9px;font-weight:700;padding:2px 9px;border-radius:5px}
.dd-status.ok{background:rgba(0,185,0,.12);color:#00b900;border:1px solid rgba(0,185,0,.3)}
.dd-status.ng{background:rgba(251,146,60,.12);color:var(--orange);border:1px solid rgba(251,146,60,.3)}
.dd-url-row{display:flex;gap:7px;align-items:center}
.dd-url-input{flex:1;background:#090b13;border:1px solid var(--border2);border-radius:8px;
  padding:8px 12px;color:var(--text);font-size:11px;font-family:'DM Mono',monospace;
  outline:none;transition:.15s}
.dd-url-input:focus{border-color:#00b900}
.dd-url-input.has-url{border-color:rgba(0,185,0,.4);color:#00d900}
.dd-open-btn{padding:7px 13px;background:#00b900;color:#fff;border:none;border-radius:8px;
  font-size:11px;font-weight:700;cursor:pointer;white-space:nowrap;transition:.15s;
  font-family:'Noto Sans JP',sans-serif}
.dd-open-btn:hover{filter:brightness(1.1)}
.dd-open-btn:disabled{background:var(--border2);cursor:not-allowed}
.dd-remove{padding:5px 8px;background:transparent;border:1px solid var(--border2);
  border-radius:7px;color:var(--muted);font-size:10px;cursor:pointer;transition:.15s;
  font-family:'Noto Sans JP',sans-serif}
.dd-remove:hover{border-color:var(--red);color:var(--red)}
/* â”€ Drop zone â”€ */
.drop-zone{border:2px dashed var(--border2);border-radius:12px;padding:28px 20px;text-align:center;
  cursor:pointer;transition:.2s;background:rgba(255,255,255,.01)}
.drop-zone:hover,.drop-zone.over{border-color:var(--blue);background:rgba(79,156,249,.04)}
.dz-icon{font-size:32px;margin-bottom:10px}
.dz-main{font-size:13px;font-weight:700;color:var(--text);margin-bottom:5px}
.dz-sub{font-size:11px;color:var(--muted);margin-bottom:10px}
.dz-badge{display:inline-block;padding:3px 10px;border-radius:6px;font-size:9px;font-weight:700;
  background:rgba(79,156,249,.1);color:var(--blue);border:1px solid rgba(79,156,249,.25)}
/* â”€ Upload progress â”€ */
.upl-row{display:flex;align-items:center;gap:10px;padding:10px 14px;
  background:var(--card2);border:1px solid var(--border2);border-radius:10px}
.upl-name{flex:1;font-size:12px;font-weight:600;white-space:nowrap;overflow:hidden;text-overflow:ellipsis}
.upl-bar-wrap{width:100px;height:5px;background:var(--border2);border-radius:3px;flex-shrink:0}
.upl-bar{height:5px;border-radius:3px;background:var(--blue);width:0;transition:width .3s}
.upl-pct{font-size:10px;color:var(--muted);width:30px;text-align:right;font-family:'DM Mono',monospace}
.upl-ok{font-size:14px;width:20px;text-align:center}
</style>
</head>
<body>

<div class="header">
  <div style="display:flex;align-items:center;gap:12px">
    <div class="logo">CORETO</div>
    <div style="width:1px;height:18px;background:var(--border2)"></div>
    <div class="hdr-mid">
      <span class="hdr-badge badge-it">ğŸ“‹ ITé‡èª¬ãƒã‚§ãƒƒã‚¯ãƒªã‚¹ãƒˆ</span>
      <span style="color:var(--border2)">+</span>
      <span class="hdr-badge badge-scan">ğŸ“¦ å¥‘ç´„æ›¸ã‚¹ã‚­ãƒ£ãƒ³ç®¡ç†</span>
    </div>
  </div>
  <button onclick="window.location.href='coreto-hub.html'"
          style="font-size:10px;padding:5px 12px;border-radius:6px;border:1px solid var(--border2);
          background:transparent;color:var(--muted);cursor:pointer;font-family:'Noto Sans JP',sans-serif">
    â† ãƒã‚¤ãƒšãƒ¼ã‚¸
  </button>
</div>

<div class="layout">

<!-- â”€ Left: Case list â”€ -->
<div class="caselist">
  <div class="cl-header">
    <div class="cl-title">æ¡ˆä»¶ä¸€è¦§</div>
    <div class="cl-count" id="cl-count">â€” ä»¶</div>
  </div>
  <div class="cl-filter">
    <div class="clf on" data-f="all" onclick="filterCases('all',this)">å…¨ã¦</div>
    <div class="clf" data-f="it" onclick="filterCases('it',this)">ITé‡èª¬å¾…</div>
    <div class="clf" data-f="scan" onclick="filterCases('scan',this)">æ›¸é¡ç®¡ç†</div>
    <div class="clf" data-f="done" onclick="filterCases('done',this)">å®Œäº†</div>
  </div>
  <div id="case-list"></div>
</div>

<!-- â”€ Right: Main â”€ -->
<div class="main" id="main-pane">
  <div class="empty" id="empty-state">
    <div class="empty-icon">ğŸ“‹</div>
    <div style="font-size:13px">æ¡ˆä»¶ã‚’é¸æŠã—ã¦ãã ã•ã„</div>
  </div>

  <!-- Case content (hidden until selected) -->
  <div id="case-content" style="display:none;flex-direction:column;height:100%">

    <!-- Header -->
    <div class="case-hdr">
      <div class="case-hdr-top">
        <div class="case-title-area">
          <div class="case-id" id="c-id">â€”</div>
          <div class="case-name" id="c-name">â€”</div>
          <div class="case-meta" id="c-meta"></div>
        </div>
        <div class="case-progress">
          <div class="cp-pct" id="c-pct" style="color:var(--gold)">0%</div>
          <div class="cp-label">å®Œäº†</div>
          <div class="cp-bar-wrap">
            <div class="cp-bar" id="c-bar" style="background:var(--gold)"></div>
          </div>
        </div>
      </div>
      <!-- Tab -->
      <div class="timeline-tabs" id="timeline-tabs">
        <div class="tt on" onclick="switchPane(0,this)" data-p="0">
          <div class="tt-dot" style="background:var(--blue)"></div>ITé‡èª¬ãƒã‚§ãƒƒã‚¯ãƒªã‚¹ãƒˆ
        </div>
        <div class="tt" onclick="switchPane(1,this)" data-p="1">
          <div class="tt-dot" style="background:var(--green)"></div>å¥‘ç´„æ›¸ãƒ»æ›¸é¡ã‚¹ã‚­ãƒ£ãƒ³
        </div>
      </div>
    </div>

    <!-- â”€ PANE 0: ITé‡èª¬ â”€ -->
    <div class="main-scroll" id="pane-0">
      <!-- â•â• æ›¸é¡ã‚¯ã‚¤ãƒƒã‚¯ã‚¢ã‚¯ã‚»ã‚¹ï¼ˆé‡èª¬ä¸­ç”¨ï¼‰ â•â• -->
      <div id="docs-quickbar" style="display:none;margin-bottom:14px;
           background:rgba(0,185,0,.05);border:1px solid rgba(0,185,0,.25);border-radius:12px;padding:12px 16px">
        <div style="display:flex;align-items:center;justify-content:space-between;margin-bottom:10px">
          <div style="font-size:9px;color:var(--muted);letter-spacing:2px;text-transform:uppercase;
                      display:flex;align-items:center;gap:7px">
            <div style="width:3px;height:10px;background:#00b900;border-radius:2px"></div>
            ã‚¹ã‚­ãƒ£ãƒ³æ›¸é¡ï¼ˆé‡èª¬ä¸­ã«é–‹ãï¼‰
          </div>
          <button onclick="switchPane(1,null)"
            style="font-size:9px;color:var(--muted);background:transparent;border:none;cursor:pointer;
                   font-family:'Noto Sans JP',sans-serif;padding:2px 6px">
            æ›¸é¡ç®¡ç† â†’
          </button>
        </div>
        <div id="docs-quickbar-list" style="display:flex;flex-wrap:wrap;gap:7px"></div>
      </div>

      <!-- Checklist body -->
      <div id="it-checklist-body"></div>

      <!-- æ‰€è¦‹ãƒ¡ãƒ¢ -->
      <div class="note-area">
        <div class="note-label">é‡èª¬ æ‰€è¦‹ãƒ»ãƒ¡ãƒ¢</div>
        <textarea id="it-memo" placeholder="å®Ÿæ–½ä¸­ã®ç‰¹è¨˜äº‹é …ã€é¡§å®¢ã®è³ªå•å†…å®¹ã€æ‡¸å¿µç‚¹ãªã©ã‚’è¨˜å…¥"></textarea>
      </div>
    </div>

    <!-- â”€ PANE 1: ã‚¹ã‚­ãƒ£ãƒ³ â”€ -->
    <div class="main-scroll" id="pane-1" style="display:none">

      <!-- â•â• ITé‡èª¬ç”¨ã‚¹ã‚­ãƒ£ãƒ³æ›¸é¡ï¼ˆGoogle Driveï¼‰ â•â• -->
      <div class="scan-panel" id="drive-docs-panel" style="margin-bottom:16px;border-color:rgba(0,185,0,.25)">

        <!-- ãƒ˜ãƒƒãƒ€ãƒ¼ -->
        <div style="display:flex;align-items:center;justify-content:space-between;margin-bottom:14px">
          <div class="card-title" style="font-size:9px;color:var(--muted);letter-spacing:2px;
               text-transform:uppercase;display:flex;align-items:center;gap:8px;margin:0">
            <div style="width:3px;height:12px;background:#00b900;border-radius:2px"></div>
            ITé‡èª¬ç”¨ã‚¹ã‚­ãƒ£ãƒ³æ›¸é¡
          </div>
          <div style="display:flex;align-items:center;gap:8px">
            <div id="drive-overall-badge" style="font-size:10px;padding:3px 10px;border-radius:6px;
                 background:rgba(74,82,112,.15);color:var(--sub);border:1px solid var(--border2)">
              æœªã‚¢ãƒƒãƒ—ãƒ­ãƒ¼ãƒ‰
            </div>
            <button onclick="slackShareAll()" id="slack-all-btn"
              style="padding:5px 12px;background:rgba(79,156,249,.1);border:1px solid rgba(79,156,249,.25);
                     color:var(--blue);border-radius:7px;font-size:10px;font-weight:700;cursor:pointer;
                     font-family:'Noto Sans JP',sans-serif;display:none">
              ğŸ“¢ å…¨ä»¶ã‚’Slackã§å…±æœ‰
            </button>
          </div>
        </div>

        <!-- æ¨©é™ãƒãƒŠãƒ¼ -->
        <div style="display:flex;align-items:center;gap:10px;padding:9px 14px;
                    background:rgba(201,168,76,.07);border:1px solid rgba(201,168,76,.2);
                    border-radius:9px;margin-bottom:14px;font-size:11px">
          ğŸ”’ <div>
            <strong style="color:var(--gold)">ã‚¢ã‚¯ã‚»ã‚¹æ¨©é™ï¼šãƒªãƒ³ã‚¯ã‚’çŸ¥ã£ã¦ã„ã‚‹äººã®ã¿é–²è¦§å¯</strong>
            <span style="color:var(--muted)">ï¼ˆè‡ªå‹•è¨­å®šï¼‰â€” å¤–éƒ¨å…¬é–‹ãªã—ãƒ»ç¤¾å¤–æµå‡ºå¯¾ç­–æ¸ˆã¿</span>
          </div>
        </div>

        <!-- ãƒ‰ãƒ­ãƒƒãƒ—ã‚¾ãƒ¼ãƒ³ -->
        <div id="drop-zone" class="drop-zone"
          ondragover="dzOver(event)" ondragleave="dzLeave(event)" ondrop="dzDrop(event)"
          onclick="document.getElementById('file-input').click()">
          <div class="dz-icon">ğŸ“‚</div>
          <div class="dz-main">PDFã‚’ã“ã“ã«ãƒ‰ãƒ©ãƒƒã‚°ï¼†ãƒ‰ãƒ­ãƒƒãƒ—</div>
          <div class="dz-sub">ã¾ãŸã¯ã‚¯ãƒªãƒƒã‚¯ã—ã¦ãƒ•ã‚¡ã‚¤ãƒ«ã‚’é¸æŠ</div>
          <div class="dz-badge">PDF / è¤‡æ•°ãƒ•ã‚¡ã‚¤ãƒ«å¯¾å¿œ</div>
        </div>
        <input type="file" id="file-input" accept=".pdf,application/pdf" multiple
               style="display:none" onchange="handleFileSelect(this.files)">

        <!-- ã‚¢ãƒƒãƒ—ãƒ­ãƒ¼ãƒ‰ä¸­ãƒªã‚¹ãƒˆ -->
        <div id="upload-progress-list" style="display:none;flex-direction:column;gap:8px;margin:12px 0"></div>

        <!-- æ›¸é¡ãƒªã‚¹ãƒˆï¼ˆå®Œäº†æ¸ˆã¿ï¼‰ -->
        <div id="drive-doc-list" style="display:flex;flex-direction:column;gap:10px;margin-top:12px">
          <!-- JS ã§æç”» -->
        </div>

        <!-- è¿½åŠ æ›¸é¡ãƒœã‚¿ãƒ³ -->
        <button onclick="addDriveDoc()" style="width:100%;margin-top:10px;padding:8px;background:transparent;
          border:1px dashed var(--border2);border-radius:9px;color:var(--muted);font-size:11px;
          cursor:pointer;font-family:'Noto Sans JP',sans-serif;transition:.15s"
          onmouseover="this.style.borderColor='var(--blue)';this.style.color='var(--blue)'"
          onmouseout="this.style.borderColor='var(--border2)';this.style.color='var(--muted)'">
          ï¼‹ ãƒ•ã‚¡ã‚¤ãƒ«åã®ã¿ã§æ‰‹å‹•ç™»éŒ²ã™ã‚‹
        </button>

        <!-- æ‹…å½“è€…ãƒ¡ã‚¿ -->
        <div id="scan-meta" style="display:none;margin-top:12px;padding:8px 14px;
             background:var(--card2);border-radius:9px;font-size:10px;color:var(--muted)">
          æœ€çµ‚ã‚¢ãƒƒãƒ—ãƒ­ãƒ¼ãƒ‰ï¼š<span id="scan-meta-who" style="color:var(--text)"></span>ã€€
          <span id="scan-meta-when" style="color:var(--text)"></span>
        </div>
      </div>

      <!-- Tracking numbers -->
      <div class="scan-panel">
        <div class="card-title" style="font-size:9px;color:var(--muted);letter-spacing:2px;
             text-transform:uppercase;margin-bottom:14px;display:flex;align-items:center;gap:8px">
          <div style="width:3px;height:12px;background:var(--green);border-radius:2px"></div>
          è¿½è·¡ç•ªå·ç®¡ç†ï¼ˆãƒ¬ã‚¿ãƒ¼ãƒ‘ãƒƒã‚¯ï¼‰
        </div>
        <div class="scan-grid" id="scan-grid"></div>
        <div style="padding:10px 14px;background:rgba(52,211,153,.05);border:1px solid rgba(52,211,153,.12);
                    border-radius:9px;font-size:11px;color:var(--sub);line-height:1.8">
          ğŸ’¡ <strong style="color:var(--text)">ãƒãƒ¼ã‚³ãƒ¼ãƒ‰ã‚¹ã‚­ãƒ£ãƒŠãƒ¼å¯¾å¿œï¼š</strong>
          è¿½è·¡ç•ªå·ãƒ•ã‚£ãƒ¼ãƒ«ãƒ‰ã‚’ã‚¯ãƒªãƒƒã‚¯ â†’ ãƒãƒ¼ã‚³ãƒ¼ãƒ‰ã‚¹ã‚­ãƒ£ãƒ³ â†’ è‡ªå‹•å…¥åŠ›ï¼ˆæ‰€è¦10ç§’ï¼‰<br>
          Honeywell Voyager 1200gï¼ˆUSBæ¥ç¶šã€ãƒ‰ãƒ©ã‚¤ãƒä¸è¦ï¼‰æ¨å¥¨
        </div>
      </div>

      <!-- Document scan status -->
      <div class="sec-card">
        <div class="sec-hdr" onclick="toggleSec('doc-scan',this)">
          <div class="sec-hdr-left">
            <div class="sec-icon">ğŸ“„</div>
            <div class="sec-title-text">æ›¸é¡ã‚¹ã‚­ãƒ£ãƒ³ãƒ»ç¢ºèªãƒã‚§ãƒƒã‚¯ãƒªã‚¹ãƒˆ</div>
          </div>
          <div class="sec-right">
            <div class="sec-prog" id="doc-prog">0/â€”</div>
            <div class="sec-chev open">â€º</div>
          </div>
        </div>
        <div class="sec-body" id="sec-doc-scan"></div>
      </div>

      <!-- Scan note -->
      <div class="note-area">
        <div class="note-label">æ›¸é¡ç®¡ç† ãƒ¡ãƒ¢</div>
        <textarea id="scan-memo" placeholder="æ›¸é¡ã®çŠ¶æ…‹ã€è¿”é€äºˆå®šæ—¥ã€ç®¡ç†ä¼šç¤¾ã¸ã®é€£çµ¡äº‹é …ãªã©"></textarea>
      </div>
    </div>

    <!-- Action bar -->
    <div class="action-bar">
      <div class="ab-progress" id="ab-progress">â€”</div>
      <button class="ab-btn ab-primary" id="ab-complete-btn" onclick="showCompleteModal()">
        âœ… ITé‡èª¬å®Œäº†ãƒ»é€ä¿¡
      </button>
    </div>

  </div>
</div>

</div><!-- /layout -->

<!-- â”€ Complete Modal â”€ -->
<div class="modal-overlay" id="modal-overlay" onclick="if(event.target===this)closeModal()">
<div class="modal">
  <div class="modal-title">ITé‡èª¬ å®Œäº†å ±å‘Š</div>
  <div class="modal-sub">å†…å®¹ã‚’ç¢ºèªã—ã¦ãã ã•ã„</div>
  <div id="modal-body"></div>
  <div id="modal-progress" style="display:none;padding:14px 0 0">
    <div style="font-size:12px;color:var(--sub);margin-bottom:10px" id="modal-progress-msg">å‡¦ç†ä¸­...</div>
    <div style="height:4px;background:var(--border2);border-radius:2px;overflow:hidden">
      <div id="modal-progress-bar" style="height:100%;width:0%;background:var(--gold);border-radius:2px;transition:width .4s ease"></div>
    </div>
  </div>
  <div class="modal-actions" id="modal-actions">
    <button class="ma-btn ma-cancel" onclick="closeModal()">ã‚­ãƒ£ãƒ³ã‚»ãƒ«</button>
    <button class="ma-btn ma-confirm" id="modal-submit-btn" onclick="submitComplete()">
      âœ… å®Œäº†å ±å‘Š
    </button>
  </div>
</div>
</div>

<script>
// â•â• AUTH GUARD (è¦ãƒ­ã‚°ã‚¤ãƒ³) â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
(function() {
  var s = null;
  try { s = JSON.parse(sessionStorage.getItem('coreto_session') || 'null'); } catch(e) {}
  if (!s) { location.replace('coreto-hub.html'); }
  window._SESSION = s;
})();

// â”€â”€ ã‚¢ã‚¯ã‚»ã‚¹åˆ¶å¾¡: ä¸å‹•ç”£ã‚¨ãƒ¼ã‚¸ã‚§ãƒ³ãƒˆï¼ˆREï¼‰å°‚ç”¨ â”€â”€
(function(){
  const s = JSON.parse(sessionStorage.getItem('coreto_session') || 'null');
  if (!s || s.type !== 're') {
    document.body.innerHTML = '<div style="display:flex;align-items:center;justify-content:center;height:100vh;background:#0b0d12;color:#4a4f68;font-family:sans-serif;flex-direction:column;gap:12px"><div style="font-size:32px">ğŸ”’</div><div style="font-size:14px">ã“ã®ãƒšãƒ¼ã‚¸ã¯ä¸å‹•ç”£ã‚¨ãƒ¼ã‚¸ã‚§ãƒ³ãƒˆå°‚ç”¨ã§ã™</div><a href=\"coreto-hub.html\" style=\"color:#c9a840;font-size:12px;margin-top:8px\">â† Hub ã¸æˆ»ã‚‹</a></div>';
    return;
  }
})();

// ================================================================
//  Demo Cases
// ================================================================

// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
//  ITé‡èª¬ç”¨ã‚¹ã‚­ãƒ£ãƒ³æ›¸é¡ â€” Google Drive ã‚¢ãƒƒãƒ—ãƒ­ãƒ¼ãƒ‰ï¼†å…±æœ‰
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

// ãƒ‡ãƒ•ã‚©ãƒ«ãƒˆæ›¸é¡ãƒ†ãƒ³ãƒ—ãƒ¬ãƒ¼ãƒˆ
var DRIVE_DOCS_DEFAULT = [
  { key:'jyusetsu', label:'é‡è¦äº‹é …èª¬æ˜æ›¸', required:true  },
  { key:'keiyaku',  label:'è³ƒè²¸å€Ÿå¥‘ç´„æ›¸',   required:true  },
  { key:'setsubi',  label:'è¨­å‚™ç¢ºèªæ›¸',      required:false },
];

// ã‚±ãƒ¼ã‚¹ã”ã¨ã®æ›¸é¡ãƒ‡ãƒ¼ã‚¿
var caseDriveDocs = {};

function getDriveDocs(caseId) {
  if (!caseDriveDocs[caseId]) {
    caseDriveDocs[caseId] = DRIVE_DOCS_DEFAULT.map(function(d) {
      return { key:d.key, label:d.label, required:d.required,
               url:'', fileName:'', uploadedAt:'', uploadedBy:'' };
    });
  }
  return caseDriveDocs[caseId];
}

// â”€â”€ Drag & Drop â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
function dzOver(e) {
  e.preventDefault();
  document.getElementById('drop-zone').classList.add('over');
}
function dzLeave(e) {
  document.getElementById('drop-zone').classList.remove('over');
}
function dzDrop(e) {
  e.preventDefault();
  document.getElementById('drop-zone').classList.remove('over');
  handleFileSelect(e.dataTransfer.files);
}

function handleFileSelect(files) {
  if (!files || !files.length) return;
  var arr = Array.from(files).filter(function(f) {
    return f.name.toLowerCase().endsWith('.pdf') || f.type === 'application/pdf';
  });
  if (!arr.length) { alert('PDFãƒ•ã‚¡ã‚¤ãƒ«ã®ã¿å¯¾å¿œã—ã¦ã„ã¾ã™'); return; }
  arr.forEach(function(file) { simulateUpload(file); });
}

// â”€â”€ ã‚¢ãƒƒãƒ—ãƒ­ãƒ¼ãƒ‰ã‚·ãƒŸãƒ¥ãƒ¬ãƒ¼ã‚·ãƒ§ãƒ³ â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
function simulateUpload(file) {
  var caseId = currentCase.id;
  var docs = getDriveDocs(caseId);

  // ãƒ•ã‚¡ã‚¤ãƒ«åã‹ã‚‰æ›¸é¡ç¨®åˆ¥ã‚’æ¨å®š
  var matched = autoMatchDoc(file.name, docs);

  // ãƒ—ãƒ­ã‚°ãƒ¬ã‚¹ãƒãƒ¼ã‚’è¡¨ç¤º
  var progList = document.getElementById('upload-progress-list');
  progList.style.display = 'flex';
  var rowId = 'upl-' + Date.now() + '-' + Math.random().toString(36).slice(2,6);
  var row = document.createElement('div');
  row.className = 'upl-row';
  row.id = rowId;
  row.innerHTML =
    '<div class="upl-ok" id="' + rowId + '-ok">ğŸ“„</div>' +
    '<div class="upl-name">' + file.name + '</div>' +
    '<div class="upl-bar-wrap"><div class="upl-bar" id="' + rowId + '-bar"></div></div>' +
    '<div class="upl-pct" id="' + rowId + '-pct">0%</div>';
  progList.appendChild(row);

  // ã‚¢ãƒƒãƒ—ãƒ­ãƒ¼ãƒ‰é€²è¡Œã‚¢ãƒ‹ãƒ¡ãƒ¼ã‚·ãƒ§ãƒ³
  var pct = 0;
  var interval = setInterval(function() {
    pct += Math.floor(Math.random() * 18 + 8);
    if (pct >= 100) pct = 100;
    var bar = document.getElementById(rowId + '-bar');
    var pctEl = document.getElementById(rowId + '-pct');
    if (bar) bar.style.width = pct + '%';
    if (pctEl) pctEl.textContent = pct + '%';
    if (pct >= 100) {
      clearInterval(interval);
      // å®Œäº†
      var okEl = document.getElementById(rowId + '-ok');
      if (okEl) okEl.textContent = 'âœ…';
      if (bar) bar.style.background = 'var(--green)';

      // å½ã®Drive URLã‚’ç”Ÿæˆ
      var fakeId = 'CORETO_' + caseId + '_' + randomStr(12);
      var fakeUrl = 'https://drive.google.com/file/d/' + fakeId + '/view?usp=sharing';
      var now = new Date().toLocaleString('ja-JP').slice(0,-3);
      var who = 'å±±ç”° èª ';

      // æ›¸é¡ãƒªã‚¹ãƒˆã«ç™»éŒ²
      if (matched !== null) {
        docs[matched].url        = fakeUrl;
        docs[matched].fileName   = file.name;
        docs[matched].uploadedAt = now;
        docs[matched].uploadedBy = who;
      } else {
        // ãƒãƒƒãƒã—ãªã‹ã£ãŸå ´åˆã¯æ–°è¦è¿½åŠ 
        docs.push({
          key: 'custom-' + Date.now(),
          label: file.name.replace(/\.pdf$/i,''),
          required: false,
          url: fakeUrl,
          fileName: file.name,
          uploadedAt: now,
          uploadedBy: who
        });
      }

      // 3ç§’å¾Œã«ãƒ—ãƒ­ã‚°ãƒ¬ã‚¹è¡Œã‚’æ¶ˆå»ã—ã¦ãƒ‰ã‚­ãƒ¥ãƒ¡ãƒ³ãƒˆãƒªã‚¹ãƒˆã‚’æ›´æ–°
      setTimeout(function() {
        var r = document.getElementById(rowId);
        if (r) r.remove();
        if (!progList.children.length) progList.style.display = 'none';
        renderDriveDocs();
        updateScanMeta(who, now);
      }, 1200);
    }
  }, 120);
}

function autoMatchDoc(fileName, docs) {
  var fn = fileName.toLowerCase();
  var keywords = [
    ['jyusetsu', ['é‡èª¬','é‡è¦äº‹é …','jusetsu','jyusetsu']],
    ['keiyaku',  ['å¥‘ç´„','keiyaku']],
    ['setsubi',  ['è¨­å‚™','setsubi']],
  ];
  for (var ki = 0; ki < keywords.length; ki++) {
    var key = keywords[ki][0];
    var kws = keywords[ki][1];
    for (var wi = 0; wi < kws.length; wi++) {
      if (fn.indexOf(kws[wi]) >= 0) {
        var docIdx = docs.findIndex(function(d){ return d.key === key; });
        if (docIdx >= 0 && !docs[docIdx].url) return docIdx;
      }
    }
  }
  // æœªç™»éŒ²ã®requiredã‚’å„ªå…ˆåŸ‹ã‚
  for (var di = 0; di < docs.length; di++) {
    if (!docs[di].url) return di;
  }
  return null;
}

function randomStr(len) {
  var chars = 'ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789';
  var out = '';
  for (var i = 0; i < len; i++) out += chars[Math.floor(Math.random()*chars.length)];
  return out;
}

function updateScanMeta(who, when) {
  var meta = document.getElementById('scan-meta');
  if (meta) {
    meta.style.display = 'block';
    document.getElementById('scan-meta-who').textContent  = who;
    document.getElementById('scan-meta-when').textContent = when;
  }
}

// â”€â”€ æ›¸é¡ãƒªã‚¹ãƒˆæç”» â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
function renderDriveDocs() {
  var caseId = currentCase ? currentCase.id : null;
  if (!caseId) return;
  var docs = getDriveDocs(caseId);
  var list = document.getElementById('drive-doc-list');
  if (!list) return;

  list.innerHTML = docs.map(function(doc, idx) {
    var hasUrl = !!doc.url;
    return '<div class="drive-doc ' + (hasUrl ? 'ready' : doc.required ? 'missing' : '') + '">' +
      '<div class="dd-head">' +
        '<div class="dd-icon">' + (hasUrl ? 'ğŸ“„' : 'ğŸ”²') + '</div>' +
        '<div>' +
          '<div class="dd-name">' + doc.label +
            (doc.required ? '' : ' <span style="font-size:9px;color:var(--muted);font-weight:400">ä»»æ„</span>') +
          '</div>' +
          (hasUrl ? '<div style="font-size:10px;color:var(--muted);margin-top:2px">' +
            doc.fileName + 'ã€€ã‚¢ãƒƒãƒ—ãƒ­ãƒ¼ãƒ‰ï¼š' + doc.uploadedBy + 'ã€€' + doc.uploadedAt + '</div>' : '') +
        '</div>' +
        '<div class="dd-status ' + (hasUrl ? 'ok' : 'ng') + '">' + (hasUrl ? 'âœ“ æ¸ˆã¿' : 'æœª') + '</div>' +
        '<button class="dd-remove" onclick="removeDriveDoc(' + idx + ')">âœ•</button>' +
      '</div>' +
      '<div class="dd-url-row">' +
        '<div style="flex:1;padding:7px 12px;background:#090b13;border:1px solid ' +
          (hasUrl ? 'rgba(0,185,0,.3)' : 'var(--border2)') + ';border-radius:8px;' +
          'font-size:10px;font-family:\'DM Mono\',monospace;color:' +
          (hasUrl ? '#00d900' : 'var(--muted)') + ';overflow:hidden;text-overflow:ellipsis;white-space:nowrap">' +
          (hasUrl ? doc.url : 'â€” ã¾ã ã‚¢ãƒƒãƒ—ãƒ­ãƒ¼ãƒ‰ã•ã‚Œã¦ã„ã¾ã›ã‚“ â€”') +
        '</div>' +
        '<button class="dd-open-btn" onclick="openDrive(' + idx + ')"' + (hasUrl ? '' : ' disabled') + '>' +
          'ğŸ”— é–‹ã' +
        '</button>' +
        '<button onclick="slackShareOne(' + idx + ')"' +
          ' style="padding:6px 10px;background:rgba(79,156,249,.1);border:1px solid rgba(79,156,249,.25);' +
          'color:var(--blue);border-radius:7px;font-size:10px;font-weight:700;cursor:pointer;' +
          'font-family:\'Noto Sans JP\',sans-serif;white-space:nowrap;' +
          (hasUrl ? '' : 'opacity:.35;cursor:not-allowed;') + '"' +
          (hasUrl ? '' : ' disabled') + '>' +
          'ğŸ“¢ å…±æœ‰' +
        '</button>' +
      '</div>' +
    '</div>';
  }).join('');

  updateDriveOverallBadge(docs);
  renderDocsQuickbar(docs);
}

function renderDocsQuickbar(docs) {
  var bar  = document.getElementById('docs-quickbar');
  var list = document.getElementById('docs-quickbar-list');
  if (!bar || !list) return;
  var ready = docs.filter(function(d){ return !!d.url; });
  if (!ready.length) { bar.style.display = 'none'; return; }
  bar.style.display = 'block';
  list.innerHTML = ready.map(function(doc, i) {
    return '<button onclick="window.open(\'' + doc.url + '\',\'_blank\')"' +
      ' style="display:inline-flex;align-items:center;gap:6px;padding:7px 13px;' +
      'background:rgba(0,185,0,.1);border:1px solid rgba(0,185,0,.3);' +
      'border-radius:8px;color:#00c900;font-size:11px;font-weight:700;cursor:pointer;' +
      'font-family:\'Noto Sans JP\',sans-serif;transition:.15s"' +
      ' onmouseover="this.style.background=\'rgba(0,185,0,.2)\'"' +
      ' onmouseout="this.style.background=\'rgba(0,185,0,.1)\'">' +
      'ğŸ“„ ' + doc.label +
      '</button>';
  }).join('');
}

function openDrive(idx) {
  var docs = getDriveDocs(currentCase.id);
  if (docs[idx] && docs[idx].url) window.open(docs[idx].url, '_blank');
}

function removeDriveDoc(idx) {
  var docs = getDriveDocs(currentCase.id);
  if (docs[idx].required) { alert('å¿…é ˆæ›¸é¡ã¯å‰Šé™¤ã§ãã¾ã›ã‚“'); return; }
  if (!confirm(docs[idx].label + ' ã‚’å‰Šé™¤ã—ã¾ã™ã‹ï¼Ÿ')) return;
  docs.splice(idx, 1);
  renderDriveDocs();
}

function addDriveDoc() {
  var label = window.prompt('æ›¸é¡åã‚’å…¥åŠ›ã—ã¦ãã ã•ã„ï¼ˆä¾‹ï¼šé–“å–ã‚Šå›³ã€éµå¼•æ¸¡ç¢ºèªæ›¸ï¼‰');
  if (!label || !label.trim()) return;
  var docs = getDriveDocs(currentCase.id);
  docs.push({ key:'custom-'+Date.now(), label:label.trim(), required:false,
               url:'', fileName:'', uploadedAt:'', uploadedBy:'' });
  renderDriveDocs();
}

function updateDriveOverallBadge(docs) {
  var badge = document.getElementById('drive-overall-badge');
  var slackBtn = document.getElementById('slack-all-btn');
  if (!badge) return;
  var required  = docs.filter(function(d){ return d.required; });
  var allReady  = required.every(function(d){ return !!d.url; });
  var anyReady  = docs.some(function(d){ return !!d.url; });
  var readyCnt  = docs.filter(function(d){ return !!d.url; }).length;

  if (allReady && required.length > 0) {
    badge.style.cssText = 'font-size:10px;padding:3px 10px;border-radius:6px;' +
      'background:rgba(0,185,0,.12);color:#00b900;border:1px solid rgba(0,185,0,.3)';
    badge.textContent = 'âœ“ æº–å‚™å®Œäº†ï¼ˆ' + readyCnt + '/' + docs.length + 'ä»¶ï¼‰';
  } else if (anyReady) {
    badge.style.cssText = 'font-size:10px;padding:3px 10px;border-radius:6px;' +
      'background:rgba(251,146,60,.1);color:var(--orange);border:1px solid rgba(251,146,60,.3)';
    badge.textContent = 'æº–å‚™ä¸­ï¼ˆ' + readyCnt + '/' + docs.length + 'ä»¶ï¼‰';
  } else {
    badge.style.cssText = 'font-size:10px;padding:3px 10px;border-radius:6px;' +
      'background:rgba(74,82,112,.15);color:var(--sub);border:1px solid var(--border2)';
    badge.textContent = 'æœªã‚¢ãƒƒãƒ—ãƒ­ãƒ¼ãƒ‰';
  }
  if (slackBtn) slackBtn.style.display = anyReady ? 'inline-flex' : 'none';
}

// â”€â”€ Slackå…±æœ‰ â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
function slackShareOne(idx) {
  var docs = getDriveDocs(currentCase.id);
  var doc  = docs[idx];
  if (!doc || !doc.url) return;
  var c = currentCase;
  var msg =
    'ğŸ“„ *ITé‡èª¬ã‚¹ã‚­ãƒ£ãƒ³æ›¸é¡ï¼ˆ' + doc.label + 'ï¼‰*\n' +
    'æ¡ˆä»¶ï¼š' + c.name + ' æ§˜ã€€' + c.prop + '\n' +
    'é‡èª¬æ—¥ï¼š' + c.itDate + '\n' +
    'ğŸ”— ' + doc.url + '\n' +
    'ğŸ”’ ãƒªãƒ³ã‚¯ã‚’çŸ¥ã£ã¦ã„ã‚‹äººã®ã¿é–²è¦§å¯ã€€ã‚¢ãƒƒãƒ—ãƒ­ãƒ¼ãƒ‰ï¼š' + doc.uploadedBy;
  navigator.clipboard.writeText(msg).then(function(){}, function(){});
  showSlackToast('ğŸ“¢ ' + doc.label + ' ã®ãƒªãƒ³ã‚¯ã‚’Slackç”¨ã«ã‚³ãƒ”ãƒ¼ã—ã¾ã—ãŸ');
}

function slackShareAll() {
  var docs = getDriveDocs(currentCase.id);
  var ready = docs.filter(function(d){ return !!d.url; });
  if (!ready.length) return;
  var c = currentCase;
  var lines = [
    'ğŸ“‹ *ITé‡èª¬ã‚¹ã‚­ãƒ£ãƒ³æ›¸é¡ä¸€å¼*',
    'æ¡ˆä»¶ï¼š' + c.name + ' æ§˜ã€€' + c.prop,
    'é‡èª¬æ—¥ï¼š' + c.itDate,
    'æ‹…å½“ï¼š' + c.agent,
    'â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€',
  ];
  ready.forEach(function(d) {
    lines.push((d.required ? 'ğŸ“„' : 'ğŸ“') + ' ' + d.label + 'ã€€' + d.url);
  });
  lines.push('â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€');
  lines.push('ğŸ”’ å…¨ãƒ•ã‚¡ã‚¤ãƒ«ã€Œãƒªãƒ³ã‚¯ã‚’çŸ¥ã£ã¦ã„ã‚‹äººã®ã¿é–²è¦§å¯ã€è¨­å®šæ¸ˆã¿');
  var msg = lines.join('\n');
  navigator.clipboard.writeText(msg).then(function(){}, function(){});
  showSlackToast('ğŸ“¢ å…¨' + ready.length + 'ä»¶ã®ãƒªãƒ³ã‚¯ã‚’Slackç”¨ã«ã‚³ãƒ”ãƒ¼ã—ã¾ã—ãŸ\nãã®ã¾ã¾Slackã«è²¼ã‚Šä»˜ã‘ã¦ãã ã•ã„');
}

function showSlackToast(msg) {
  var t = document.getElementById('slack-toast');
  if (!t) {
    t = document.createElement('div');
    t.id = 'slack-toast';
    t.style.cssText = 'position:fixed;bottom:24px;right:24px;z-index:9999;' +
      'background:#0f1119;border:1px solid rgba(79,156,249,.4);border-radius:12px;' +
      'padding:14px 20px;font-size:12px;color:var(--text);max-width:320px;' +
      'box-shadow:0 8px 32px rgba(0,0,0,.5);line-height:1.7;white-space:pre-line';
    document.body.appendChild(t);
  }
  t.textContent = msg;
  t.style.opacity = '1';
  clearTimeout(t._timer);
  t._timer = setTimeout(function(){ t.style.opacity='0'; }, 3500);
}


const CASES = [
  {
    id:'0234', name:'ç”°ä¸­ é›„ä»‹', prop:'æ¸‹è°·åŒºæ±2ä¸ç›®ãƒãƒ³ã‚·ãƒ§ãƒ³ 302å·å®¤',
    agent:'10012 å±±ç”°èª ', mgmt:'æ ªå¼ä¼šç¤¾ã‚¨ã‚¤ãƒ–ãƒ«æ¸‹è°·', rent:120000,
    itDate:'2026-02-22 14:00', itStatus:'scheduled',
    trackNos:{ send:'', reply:'', key:'' },
    status:'it-pending', checkState:{},
    docCheckState:{},
  },
  {
    id:'0228', name:'ä½è—¤ æ˜æ—¥é¦™', prop:'æ¸¯åŒºå—é’å±±4ä¸ç›®1LDK',
    agent:'10012 å±±ç”°èª ', mgmt:'æ ªå¼ä¼šç¤¾ãƒã‚¦ã‚¹ãƒ¡ã‚¤ãƒˆ', rent:185000,
    itDate:'2026-02-20 10:00', itStatus:'done',
    itDoneAt:'2026-02-20 11:02', itDuration:62,
    trackNos:{ send:'123456789012', reply:'987654321098', key:'' },
    status:'scan-pending', checkState:{ 'pre-1':'ok','pre-2':'ok','pre-3':'ok','pre-4':'ok',
      'ice-1':'ok','exp-1':'ok','exp-2':'ok','exp-3':'ok','exp-4':'ok','exp-5':'ok',
      'cnt-1':'ok','cnt-2':'ok','cnt-3':'ok','end-1':'ok','end-2':'ok','end-3':'ok' },
    docCheckState:{},
  },
  {
    id:'0220', name:'éˆ´æœ¨ å¥ä¸€', prop:'æ–°å®¿åŒºè¥¿æ–°å®¿2LDK',
    agent:'10012 å±±ç”°èª ', mgmt:'ç©å’Œä¸å‹•ç”£', rent:155000,
    itDate:'2026-02-15 15:00', itStatus:'done',
    itDoneAt:'2026-02-15 16:05', itDuration:65,
    trackNos:{ send:'111222333444', reply:'555666777888', key:'999000111222' },
    status:'complete', checkState:{ 'pre-1':'ok','pre-2':'ok','pre-3':'ok','pre-4':'ok',
      'ice-1':'ok','exp-1':'ok','exp-2':'ok','exp-3':'ok','exp-4':'ok','exp-5':'ok',
      'cnt-1':'ok','cnt-2':'ok','cnt-3':'ok','end-1':'ok','end-2':'ok','end-3':'ok' },
    docCheckState:{ 'doc-1':'ok','doc-2':'ok','doc-3':'ok','doc-4':'ok','doc-5':'ok','doc-6':'ok' },
  },
];

// ================================================================
//  ITé‡èª¬ãƒã‚§ãƒƒã‚¯ãƒªã‚¹ãƒˆå®šç¾©
// ================================================================
const IT_CHECKLIST = [
  {
    id:'prep', icon:'ğŸ“‹', title:'äº‹å‰æº–å‚™',
    items:[
      { id:'pre-1', label:'Calendlyäºˆç´„ã®ç¢ºèª',
        desc:'äºˆç´„æ—¥æ™‚ãƒ»é¡§å®¢åãƒ»Google Meet URLã‚’ç¢ºèªã€‚ãƒªãƒã‚¤ãƒ³ãƒ‰ãƒ¡ãƒ¼ãƒ«é€ä»˜æ¸ˆã¿ã‹ç¢ºèª' },
      { id:'pre-2', label:'Google Meet URLã®å‹•ä½œç¢ºèª',
        desc:'å®Ÿéš›ã«URLã‚’é–‹ãæ¥ç¶šãƒ†ã‚¹ãƒˆã€‚éŸ³å£°ãƒ»ãƒ“ãƒ‡ã‚ªãŒæ­£å¸¸ã‹ç¢ºèª' },
      { id:'pre-3', label:'é‡èª¬æ›¸ãƒ»å¥‘ç´„æ›¸ã®æ‰‹å…ƒç¢ºèª',
        desc:'é¡§å®¢ã«åŸæœ¬ï¼ˆéƒµé€æ¸ˆã¿ï¼‰ãŒå±Šã„ã¦ã„ã‚‹ã‹äº‹å‰ã«ç¢ºèªã™ã‚‹',
        tag:'required', tagLabel:'å¿…é ˆ' },
      { id:'pre-4', label:'å®…å»ºå£«è¨¼ã®æº–å‚™',
        desc:'å®…å»ºå£«è¨¼ã‚’æ‰‹å…ƒã«ç”¨æ„ã€‚ã‚«ãƒ¡ãƒ©ã«æ˜ ã›ã‚‹çŠ¶æ…‹ã«ã—ã¦ãŠã',
        tag:'takken', tagLabel:'å®…å»ºå£«å¿…é ˆ' },
    ]
  },
  {
    id:'ice', icon:'ğŸ‘‹', title:'ã‚¢ã‚¤ã‚¹ãƒ–ãƒ¬ã‚¤ã‚¯',
    items:[
      { id:'ice-1', label:'è‡ªå·±ç´¹ä»‹ãƒ»å®…å»ºå£«è¨¼ã®æç¤º',
        desc:'æ°åãƒ»å®…å»ºå£«ç™»éŒ²ç•ªå·ã‚’å£é ­ã§èª¬æ˜ã—ã€å®…å»ºå£«è¨¼ã‚’ã‚«ãƒ¡ãƒ©ã«æ˜ ã—ã¦æç¤º',
        tag:'takken', tagLabel:'å®…å»ºå£«è¨¼æç¤º' },
      { id:'ice-2', label:'é¡§å®¢æ‰‹å…ƒã®æ›¸é¡ç¢ºèª',
        desc:'ã€ŒãŠæ‰‹å…ƒã«é‡è¦äº‹é …èª¬æ˜æ›¸ã¨è³ƒè²¸å€Ÿå¥‘ç´„æ›¸ã¯ã”ã–ã„ã¾ã™ã‹ï¼Ÿã€ã¨ç¢ºèªã™ã‚‹',
        tag:'required', tagLabel:'å¿…é ˆ' },
      { id:'ice-3', label:'æœ¬æ—¥ã®æµã‚Œã®èª¬æ˜',
        desc:'ã€Œé‡è¦äº‹é …èª¬æ˜â†’å¥‘ç´„æ›¸ã®ã”èª¬æ˜â†’æºå°ç®‡æ‰€ã®ã”æ¡ˆå†…ã®3éƒ¨æ§‹æˆã§ã™ã€' },
    ]
  },
  {
    id:'jyusetsu', icon:'ğŸ“œ', title:'é‡è¦äº‹é …èª¬æ˜',
    items:[
      { id:'exp-1', label:'å„é …ç›®ã®èª­ã¿ä¸Šã’ã¨èª¬æ˜',
        desc:'ç‰©ä»¶æ¦‚è¦ãƒ»ç™»è¨˜äº‹é …ãƒ»éƒ½å¸‚è¨ˆç”»ãƒ»è¨­å‚™çŠ¶æ³ãƒ»ç®¡ç†è¦ç´„ãƒ»ç‰¹ç´„äº‹é …ã‚’é †ã«èª­ã¿ä¸Šã’ã‚‹ï¼ˆé¡§å®¢ã¯æ‰‹å…ƒã®æ›¸é¡ã‚’å‚ç…§ï¼‰' },
      { id:'exp-2', label:'è³ªç–‘å¿œç­”ãƒ»é¡§å®¢ã®ç†è§£ç¢ºèª',
        desc:'ã€Œã”ä¸æ˜ãªç‚¹ã¯ã‚ã‚Šã¾ã™ã‹ï¼Ÿã€ã‚’å„ã‚»ã‚¯ã‚·ãƒ§ãƒ³å¾Œã«å¿…ãšç¢ºèªã€‚å†…å®¹ã¯è¨˜éŒ²ã«æ®‹ã™' },
      { id:'exp-3', label:'é¡§å®¢ã®åŒæ„ç¢ºèªï¼ˆå£é ­ï¼‰',
        desc:'ã€Œé‡è¦äº‹é …ã«ã¤ã„ã¦ã”ç†è§£ã„ãŸã ã‘ã¾ã—ãŸã‹ï¼Ÿã€â†’ã€Œã¯ã„ã€ã®å£é ­ç¢ºèªã‚’å–ã‚‹',
        tag:'required', tagLabel:'å¿…é ˆ' },
      { id:'exp-4', label:'é›»ç£çš„æ–¹æ³•ã«ã‚ˆã‚‹é‡èª¬ã®åŒæ„ç¢ºèª',
        desc:'ã€ŒITé‡èª¬ã«ã‚ˆã‚‹é›»ç£çš„æ–¹æ³•ã§ã®èª¬æ˜ã«åŒæ„ã„ãŸã ã‘ã¾ã™ã‹ï¼Ÿã€ã®ç¢ºèª',
        tag:'required', tagLabel:'æ³•å®šå¿…é ˆ' },
    ]
  },
  {
    id:'contract', icon:'âœï¸', title:'å¥‘ç´„æ›¸èª¬æ˜',
    items:[
      { id:'cnt-1', label:'å¥‘ç´„æ›¸ãƒšãƒ¼ã‚¸ã®æ¡ˆå†…',
        desc:'ã€Œæ¬¡ã«è³ƒè²¸å€Ÿå¥‘ç´„æ›¸ã‚’ã”è¦§ãã ã•ã„ã€ã¨ä¼ãˆã€é¡§å®¢ã«æ‰‹å…ƒã®å¥‘ç´„æ›¸ã‚’é–‹ã„ã¦ã‚‚ã‚‰ã†' },
      { id:'cnt-2', label:'å¥‘ç´„å†…å®¹ã®èª¬æ˜',
        desc:'å¥‘ç´„æœŸé–“ãƒ»æ›´æ–°æ¡ä»¶ï¼ˆè‡ªå‹•æ›´æ–°ã®æœ‰ç„¡ï¼‰ãƒ»è§£ç´„æ¡ä»¶ãƒ»ç‰¹ç´„äº‹é …ã‚’èª¬æ˜' },
    ]
  },
  {
    id:'hanko', icon:'ğŸ”', title:'æºå°ç®‡æ‰€ã®ã”æ¡ˆå†…',
    items:[
      { id:'hk-1', label:'é‡è¦äº‹é …èª¬æ˜æ›¸ â€” æ°åãƒ»æºå°æ¬„',
        desc:'ã€Œé‡è¦äº‹é …èª¬æ˜æ›¸ã®æœ«å°¾ã€ç½²åæ¬„ã«ã”ç½²åã¨æºå°ã‚’ãŠé¡˜ã„ã—ã¾ã™ï¼ˆèªå°ã§å¯ï¼‰ã€' },
      { id:'hk-2', label:'è³ƒè²¸å€Ÿå¥‘ç´„æ›¸ â€” å€Ÿä¸»ç½²åæ¬„',
        desc:'ã€Œè³ƒè²¸å€Ÿå¥‘ç´„æ›¸ã®1æšç›®ã€å€Ÿä¸»ã®ç½²åæ¬„ã«ä½æ‰€ãƒ»æ°åã‚’ã”è¨˜å…¥ãã ã•ã„ã€' },
      { id:'hk-3', label:'è³ƒè²¸å€Ÿå¥‘ç´„æ›¸ â€” æºå°ç®‡æ‰€ï¼ˆå…¨ãƒšãƒ¼ã‚¸ï¼‰',
        desc:'ã€Œå¥‘ç´„æ›¸ã®å„ãƒšãƒ¼ã‚¸ã«æºå°ç®‡æ‰€ãŒã‚ã‚Šã¾ã™ã€‚ãƒšãƒ¼ã‚¸ã‚’ã‚ãã‚ŠãªãŒã‚‰èµ¤æ ã«æºå°ã—ã¦ãã ã•ã„ã€' },
      { id:'hk-4', label:'é€£å¸¯ä¿è¨¼äººæ¬„ï¼ˆè©²å½“è€…ã®ã¿ï¼‰',
        desc:'ã€Œé€£å¸¯ä¿è¨¼äººæ§˜ã®ç½²åãƒ»æºå°æ¬„ãŒæœ«å°¾ã«ã”ã–ã„ã¾ã™ã€‚å¾Œæ—¥ä¿è¨¼äººæ§˜ã«ã”å¯¾å¿œã„ãŸã ãæ—¨ã‚’ãŠä¼ãˆãã ã•ã„ã€' },
      { id:'hk-5', label:'æºå°æ¼ã‚Œã®æœ€çµ‚ç¢ºèªã‚’ä¾é ¼',
        desc:'ã€Œæ›¸é¡å…¨ä½“ã‚’ã‚‚ã†ä¸€åº¦ã”ç¢ºèªã„ãŸã ãã€æºå°æ¼ã‚ŒãŒãªã„ã‹ãƒã‚§ãƒƒã‚¯ã‚’ãŠé¡˜ã„ã—ã¾ã™ã€',
        tag:'required', tagLabel:'å¿…é ˆ' },
    ]
  },
  {
    id:'closing', icon:'ğŸ”‘', title:'ä»Šå¾Œã®æµã‚Œèª¬æ˜',
    items:[
      { id:'end-1', label:'è¿”é€æ–¹æ³•ã®æ¡ˆå†…',
        desc:'ã€Œç½²åãƒ»æºå°å¾Œã¯ãƒ¬ã‚¿ãƒ¼ãƒ‘ãƒƒã‚¯ãƒ©ã‚¤ãƒˆã§è¿”é€ã—ã¦ãã ã•ã„ã€‚é€ä»˜å…ˆã¯åŒå°ã®å°ç­’ã«è¨˜è¼‰ã—ã¦ã„ã¾ã™ã€' },
      { id:'end-2', label:'éµã®å—ã‘æ¸¡ã—æ–¹æ³•ã®ç¢ºèª',
        desc:'å…¥å±…æ—¥ãƒ»éµã®å—å–æ–¹æ³•ï¼ˆéƒµé€ or ç›´æ¥å—å–ï¼‰ã‚’å†ç¢ºèªã—ã¦Kintoneã«è¨˜éŒ²' },
      { id:'end-3', label:'å…¥å±…æ—¥ãƒ»ä»Šå¾Œã®ã‚¹ã‚±ã‚¸ãƒ¥ãƒ¼ãƒ«ç¢ºèª',
        desc:'å…¥å±…äºˆå®šæ—¥ãƒ»ãƒ©ã‚¤ãƒ•ãƒ©ã‚¤ãƒ³æ‰‹ç¶šãï¼ˆé›»æ°—ãƒ»ã‚¬ã‚¹ãƒ»æ°´é“ï¼‰ã®æ¡ˆå†…' },
      { id:'end-4', label:'é‡èª¬å®Ÿæ–½ã®å®Œäº†è¨˜éŒ²',
        desc:'å®…å»ºå£«åãƒ»å®Ÿæ–½æ—¥ãƒ»é¡§å®¢ç¢ºèªã®è¨˜éŒ²ï¼ˆæœ¬ãƒ•ã‚©ãƒ¼ãƒ é€ä¿¡ã§è‡ªå‹•è¨˜éŒ²ï¼‰',
        tag:'record', tagLabel:'Kintoneè¨˜éŒ²' },
    ]
  },
];

// ================================================================
//  Document scan checklist
// ================================================================
const DOC_CHECKLIST = [
  { id:'doc-1', label:'å¥‘ç´„æ›¸ï¼ˆå¾€è·¯ï¼‰ç™ºé€ â€” è¿½è·¡ç•ªå·ç™»éŒ²',
    desc:'ç®¡ç†ä¼šç¤¾ã‹ã‚‰å±Šã„ãŸå¥‘ç´„æ›¸ã‚’é¡§å®¢ã¸ç™ºé€ã€‚è¿½è·¡ç•ªå·ã‚’ã‚¹ã‚­ãƒ£ãƒ³å…¥åŠ›', required:true },
  { id:'doc-2', label:'è¿”ä¿¡ç”¨ãƒ¬ã‚¿ãƒ¼ãƒ‘ãƒƒã‚¯å°å…¥ç¢ºèª',
    desc:'è¿”é€ç”¨ãƒ¬ã‚¿ãƒ¼ãƒ‘ãƒƒã‚¯ãƒ©ã‚¤ãƒˆï¼ˆé€ä»˜å…ˆå°å­—æ¸ˆã¿ï¼‰ã‚’å¥‘ç´„æ›¸ã«åŒå°', required:true },
  { id:'doc-3', label:'å¥‘ç´„æ›¸ï¼ˆå¾€è·¯ï¼‰é¡§å®¢ç€ç¢ºèª',
    desc:'è¿½è·¡ã‚µã‚¤ãƒˆã§é…é”å®Œäº†ã‚’ç¢ºèªã€‚ã¾ãŸã¯é¡§å®¢ã‹ã‚‰ç€è·é€£çµ¡ã‚’å—ã‘ã‚‹' },
  { id:'doc-4', label:'ITé‡èª¬å®Ÿæ–½ç¢ºèª',
    desc:'ITé‡èª¬ãŒå®Œäº†ã—ã¦ã„ã‚‹ã‹ç¢ºèªï¼ˆæœ¬ãƒšãƒ¼ã‚¸ã®ITé‡èª¬ã‚¿ãƒ–ã‚’å‚ç…§ï¼‰', required:true },
  { id:'doc-5', label:'å¥‘ç´„æ›¸ï¼ˆå¾©è·¯ï¼‰è¿”é€ç¢ºèª â€” è¿½è·¡ç•ªå·ç™»éŒ²',
    desc:'é¡§å®¢ãŒç½²åæºå°ã—ã¦è¿”é€ã€‚è¿½è·¡ç•ªå·ã‚’ã‚¹ã‚­ãƒ£ãƒ³å…¥åŠ›ã€ç€è·ã‚’ç¢ºèª', required:true },
  { id:'doc-6', label:'å¥‘ç´„æ›¸å†…å®¹ã®æœ€çµ‚ç¢ºèªï¼ˆç½²åãƒ»æºå°ï¼‰',
    desc:'è¿”é€ã•ã‚ŒãŸå¥‘ç´„æ›¸ã®ç½²åãƒ»æºå°æ¼ã‚ŒãŒãªã„ã‹ç¢ºèªã€‚ä¸å‚™ãŒã‚ã‚Œã°é¡§å®¢ã«é€£çµ¡' },
];

// ================================================================
//  State
// ================================================================
let currentCase  = null;
let currentFilter = 'all';
let timerInterval = null;
let timerStart_ts = null;
let timerElapsed  = 0;
let timerRunning  = false;
let currentPane   = 0;

// ================================================================
//  Init
// ================================================================
window.addEventListener('DOMContentLoaded', () => {
  renderCaseList();
});

// ================================================================
//  Case list
// ================================================================
function renderCaseList() {
  const STATUS_CLS = {
    'it-pending':   'st-waiting',
    'scan-pending': 'st-scan-pending',
    'it-done':      'st-it-done',
    'complete':     'st-complete',
  };
  const STATUS_LABEL = {
    'it-pending':   'ITé‡èª¬å¾…ã¡',
    'scan-pending': 'æ›¸é¡ç®¡ç†ä¸­',
    'complete':     'å®Œäº†',
  };
  const filtered = CASES.filter(c => {
    if (currentFilter === 'all') return true;
    if (currentFilter === 'it')   return c.status === 'it-pending';
    if (currentFilter === 'scan') return c.status === 'scan-pending';
    if (currentFilter === 'done') return c.status === 'complete';
    return true;
  });
  document.getElementById('cl-count').textContent = filtered.length + ' ä»¶';

  document.getElementById('case-list').innerHTML = filtered.map(c => {
    const active = currentCase && currentCase.id === c.id;
    const lbl    = STATUS_LABEL[c.status] || c.status;
    const clr    = c.status==='complete'?'var(--green)':c.status==='scan-pending'?'var(--purple)':'var(--orange)';
    return `
      <div class="case-item ${active?'active':''}" onclick="selectCase('${c.id}')">
        <div class="ci-status ${STATUS_CLS[c.status]||'st-waiting'}"></div>
        <div class="ci-id">${c.id}</div>
        <div class="ci-name">${c.name}</div>
        <div class="ci-meta">
          <span style="font-size:10px;color:var(--sub)">${c.prop.slice(0,18)}â€¦</span>
          <span class="ci-badge" style="background:${clr}22;color:${clr};border:1px solid ${clr}44">${lbl}</span>
        </div>
      </div>`;
  }).join('');
}

function filterCases(f, btn) {
  currentFilter = f;
  document.querySelectorAll('.clf').forEach(b=>b.classList.remove('on'));
  btn.classList.add('on');
  renderCaseList();
}

// ================================================================
//  Select case
// ================================================================
function selectCase(id) {
  currentCase = CASES.find(c=>c.id===id);
  if (!currentCase) return;
  renderCaseList();
  renderCaseHeader();
  renderITChecklist();
  renderScanPanel();
  renderDocChecklist();
  renderDriveDocs();
  updateProgress();
  document.getElementById('empty-state').style.display = 'none';
  document.getElementById('case-content').style.display = 'flex';
  document.getElementById('pane-0').style.display = 'block';
  document.getElementById('pane-1').style.display = 'none';
  document.querySelectorAll('.tt').forEach((t,i)=>t.classList.toggle('on',i===0));
  currentPane = 0;

  // Complete btn label
  const isItDone = currentCase.status !== 'it-pending';
  document.getElementById('ab-complete-btn').textContent = isItDone ? 'ğŸ“¦ æ›¸é¡ç®¡ç†ã¸' : 'âœ… ITé‡èª¬å®Œäº†å ±å‘Š';
}

// ================================================================
//  Case header
// ================================================================
function renderCaseHeader() {
  const c = currentCase;
  document.getElementById('c-id').textContent   = c.id;
  document.getElementById('c-name').textContent = c.name + ' æ§˜';

  // äºˆç´„æƒ…å ±ã‚’ localStorage ã‹ã‚‰å–å¾—
  let bookingInfo = '';
  try {
    const bookings = JSON.parse(localStorage.getItem('coreto_itsetsu_bookings') || '[]');
    const bk = bookings.find(b => b.caseId === c.id);
    if (bk) {
      const d = new Date(bk.date);
      const DAYS = ['æ—¥','æœˆ','ç«','æ°´','æœ¨','é‡‘','åœŸ'];
      const dtLabel = `${d.getMonth()+1}/${d.getDate()}ï¼ˆ${DAYS[d.getDay()]}ï¼‰${bk.start}ã€œ`;
      bookingInfo = `
        <span class="case-detail-row" style="color:var(--green)">âœ… æ—¥ç¨‹ç¢ºå®šï¼š${dtLabel}</span>
        <span class="case-detail-row">é‡èª¬æ‹…å½“ï¼š${bk.itAgentName || 'â€”'}</span>
        <span class="case-detail-row"><a href="${bk.meetUrl}" target="_blank" style="color:var(--blue)">ğŸ”— Google Meet: ${bk.meetUrl}</a></span>`;
    } else if (c.bookingUrl) {
      bookingInfo = `<span class="case-detail-row" style="color:var(--orange)">â³ æ—¥ç¨‹æœªç¢ºå®š
        <button onclick="navigator.clipboard.writeText('${(c.bookingUrl||'').replace(/'/g,"\'")}').then(()=>alert('URLã‚’ã‚³ãƒ”ãƒ¼ã—ã¾ã—ãŸ'))"
          style="margin-left:8px;padding:2px 8px;font-size:9px;border-radius:4px;border:1px solid rgba(251,146,60,.35);
          background:transparent;color:var(--orange);cursor:pointer;font-family:inherit">ğŸ“‹ ãƒªãƒ³ã‚¯ã‚’ã‚³ãƒ”ãƒ¼</button>
        </span>`;
    } else {
      bookingInfo = `<span class="case-detail-row" style="color:var(--muted)">æ—¥ç¨‹èª¿æ•´ãƒªãƒ³ã‚¯æœªç™ºè¡Œ</span>`;
    }
  } catch(e) {}

  document.getElementById('c-meta').innerHTML = `
    <span class="prop-tag">ğŸ  ${c.prop}</span>
    <span class="case-detail-row">æ‹…å½“ï¼š${c.agent}</span>
    <span class="case-detail-row">ç®¡ç†ä¼šç¤¾ï¼š${c.mgmt}</span>
    <span class="case-detail-row">å®¶è³ƒï¼šÂ¥${c.rent.toLocaleString()}</span>
    ${bookingInfo}`;
}

// ================================================================
//  IT Checklist render
// ================================================================
function renderITChecklist() {
  const body = document.getElementById('it-checklist-body');
  body.innerHTML = IT_CHECKLIST.map(sec => `
    <div class="sec-card" id="sec-${sec.id}">
      <div class="sec-hdr" onclick="toggleSec('${sec.id}',this)">
        <div class="sec-hdr-left">
          <div class="sec-icon">${sec.icon}</div>
          <div class="sec-title-text">${sec.title}</div>
        </div>
        <div class="sec-right">
          <div class="sec-prog" id="sp-${sec.id}">0/${sec.items.length}</div>
          <div class="sec-chev open">â€º</div>
        </div>
      </div>
      <div class="sec-body" id="sb-${sec.id}">
        ${sec.items.map((it,i) => renderChkItem(it,i)).join('')}
      </div>
    </div>`).join('');

  // Restore saved state
  Object.entries(currentCase.checkState).forEach(([id, state]) => applyCheck(id, state));
}

function renderChkItem(it, i) {
  let tagHTML = '';
  if (it.tag==='required') tagHTML = `<span class="chk-tag tag-req">${it.tagLabel}</span>`;
  if (it.tag==='takken')   tagHTML = `<span class="chk-tag tag-takken">${it.tagLabel}</span>`;
  if (it.tag==='record')   tagHTML = `<span class="chk-tag tag-record">${it.tagLabel}</span>`;
  return `
    <div class="chk" id="row-${it.id}">
      <div class="chk-num">${String(i+1).padStart(2,'0')}</div>
      <div class="chk-body">
        <div class="chk-label">${it.label}${tagHTML}</div>
        ${it.desc ? `<div class="chk-desc">${it.desc}</div>` : ''}
        <div class="chk-input" id="inp-${it.id}">
          <input type="text" placeholder="ãƒ¡ãƒ¢ï¼ˆä»»æ„ï¼‰" oninput="saveMemo('${it.id}',this.value)">
        </div>
      </div>
      <div class="sbg">
        <button class="sb" id="sb-ok-${it.id}"  title="å®Œäº†" onclick="setCheck('${it.id}','ok')">âœ“</button>
        <button class="sb" id="sb-ng-${it.id}"  title="å•é¡Œã‚ã‚Š" onclick="setCheck('${it.id}','ng')">âœ—</button>
        <button class="sb" id="sb-na-${it.id}"  title="éè©²å½“" onclick="setCheck('${it.id}','na')">â€”</button>
      </div>
    </div>`;
}

// ================================================================
//  Scan panel
// ================================================================
function renderScanPanel() {
  const c = currentCase;
  const items = [
    { key:'send',  label:'å¾€è·¯ï¼ˆäº‹å‹™æ‰€â†’é¡§å®¢ï¼‰', icon:'ğŸ“¤', color:'var(--blue)',  placeholder:'è¿½è·¡ç•ªå· 12æ¡' },
    { key:'reply', label:'å¾©è·¯ï¼ˆé¡§å®¢â†’äº‹å‹™æ‰€ï¼‰', icon:'ğŸ“¥', color:'var(--green)', placeholder:'è¿½è·¡ç•ªå· 12æ¡' },
    { key:'key',   label:'éµé€ä»˜',               icon:'ğŸ”‘', color:'var(--gold)',  placeholder:'è¿½è·¡ç•ªå· 12æ¡ï¼ˆä»»æ„ï¼‰' },
  ];
  document.getElementById('scan-grid').innerHTML = items.map(item => {
    const val     = c.trackNos[item.key] || '';
    const filled  = !!val;
    const missing = !filled && (item.key !== 'key');
    return `
      <div class="scan-item ${filled?'filled':missing?'missing':''}" id="scan-${item.key}">
        <div class="si-label">${item.icon} ${item.label}</div>
        <div class="si-type-badge" style="background:${item.color}22;color:${item.color};border:1px solid ${item.color}44">
          ${item.key==='key'?'ä»»æ„':'å¿…é ˆ'}
        </div>
        <div class="si-num ${filled?'':'empty'}" id="sn-${item.key}">
          ${filled ? val : 'æœªå…¥åŠ›'}
        </div>
        <div class="scan-input-row">
          <input type="text" id="si-${item.key}" maxlength="12" placeholder="${item.placeholder}"
                 value="${val}" oninput="updateTrackNo('${item.key}',this.value)"
                 onfocus="this.select()">
          <button class="scan-btn scan-go" onclick="lookupTrack('${item.key}')">ğŸ” è¿½è·¡</button>
        </div>
        <div class="si-status" id="ss-${item.key}">
          ${filled
            ? `<span style="color:var(--green)">âœ“</span><span style="color:var(--green)">ç™»éŒ²æ¸ˆã¿</span>`
            : `<span style="color:var(--orange)">â—‹</span><span style="color:var(--muted)">æœªç™»éŒ²</span>`}
        </div>
        ${filled ? `<div class="si-date" id="sd-${item.key}">ç™»éŒ²æ¸ˆã¿</div>` : ''}
      </div>`;
  }).join('');
}

function updateTrackNo(key, val) {
  val = val.replace(/\D/g,'').slice(0,12);
  document.getElementById(`si-${key}`).value = val;
  currentCase.trackNos[key] = val;
  const filled = val.length === 12;
  const numEl  = document.getElementById(`sn-${key}`);
  const statEl = document.getElementById(`ss-${key}`);
  if (numEl) {
    numEl.className = 'si-num' + (filled?'':' empty');
    numEl.textContent = filled ? val : 'æœªå…¥åŠ›';
  }
  if (statEl) statEl.innerHTML = filled
    ? `<span style="color:var(--green)">âœ“</span><span style="color:var(--green)">ç™»éŒ²æ¸ˆã¿</span>`
    : `<span style="color:var(--orange)">â—‹</span><span style="color:var(--muted)">æœªç™»éŒ²</span>`;
  const wrap = document.getElementById(`scan-${key}`);
  if (wrap) { wrap.className = 'scan-item' + (filled?' filled':''); }
  updateProgress();
}

function lookupTrack(key) {
  const num = currentCase.trackNos[key];
  if (!num || num.length < 12) { alert('12æ¡ã®è¿½è·¡ç•ªå·ã‚’å…¥åŠ›ã—ã¦ãã ã•ã„'); return; }
  window.open(`https://trackings.post.japanpost.jp/services/srv/search/direct?reqCodeNo1=${num}&searchKind=S002&locale=ja`, '_blank');
}

// ================================================================
//  Doc checklist
// ================================================================
function renderDocChecklist() {
  document.getElementById('sec-doc-scan').innerHTML = DOC_CHECKLIST.map((it,i) => `
    <div class="chk" id="drow-${it.id}">
      <div class="chk-num">${String(i+1).padStart(2,'0')}</div>
      <div class="chk-body">
        <div class="chk-label">
          ${it.label}
          ${it.required ? '<span class="chk-tag tag-req">å¿…é ˆ</span>' : ''}
        </div>
        <div class="chk-desc">${it.desc}</div>
      </div>
      <div class="sbg">
        <button class="sb" id="dsb-ok-${it.id}"  onclick="setDocCheck('${it.id}','ok')">âœ“</button>
        <button class="sb" id="dsb-ng-${it.id}"  onclick="setDocCheck('${it.id}','ng')">âœ—</button>
        <button class="sb" id="dsb-na-${it.id}"  onclick="setDocCheck('${it.id}','na')">â€”</button>
      </div>
    </div>`).join('');

  // Restore
  Object.entries(currentCase.docCheckState).forEach(([id, s]) => applyDocCheck(id, s));
  updateDocProgress();
}

// ================================================================
//  Check state
// ================================================================
function setCheck(id, state) {
  currentCase.checkState[id] = state;
  applyCheck(id, state);
  updateProgress();
  updateSectionProgress();
}
function applyCheck(id, state) {
  ['ok','ng','na'].forEach(s => {
    const b = document.getElementById(`sb-${s}-${id}`);
    if (b) b.className = 'sb' + (state===s ? ' '+s : '');
  });
  const row = document.getElementById(`row-${id}`);
  if (row) { row.className = 'chk'+(state==='ok'?' ok-row':state==='ng'?' ng-row':''); }
  const inp = document.getElementById(`inp-${id}`);
  if (inp) inp.className = 'chk-input' + (state==='ng'?' show':'');
}

function setDocCheck(id, state) {
  currentCase.docCheckState[id] = state;
  applyDocCheck(id, state);
  updateDocProgress();
  updateProgress();
}
function applyDocCheck(id, state) {
  ['ok','ng','na'].forEach(s => {
    const b = document.getElementById(`dsb-${s}-${id}`);
    if (b) b.className = 'sb' + (state===s ? ' '+s : '');
  });
  const row = document.getElementById(`drow-${id}`);
  if (row) row.className = 'chk'+(state==='ok'?' ok-row':state==='ng'?' ng-row':'');
}

// ================================================================
//  Progress
// ================================================================
function updateProgress() {
  if (!currentCase) return;
  const allIT  = IT_CHECKLIST.flatMap(s=>s.items);
  const doneIT = allIT.filter(it=>currentCase.checkState[it.id]).length;
  const trackDone = Object.values(currentCase.trackNos).filter(v=>v&&v.length===12).length;
  const doneDoc = Object.values(currentCase.docCheckState).filter(v=>v).length;

  const total = allIT.length + 2 + DOC_CHECKLIST.length; // 2 required tracks
  const done  = doneIT + Math.min(trackDone,2) + doneDoc;
  const pct   = total > 0 ? Math.round((done/total)*100) : 0;

  const clr   = pct < 40 ? 'var(--orange)' : pct < 100 ? 'var(--blue)' : 'var(--green)';
  document.getElementById('c-pct').textContent = pct + '%';
  document.getElementById('c-pct').style.color  = clr;
  document.getElementById('c-bar').style.width   = pct + '%';
  document.getElementById('c-bar').style.background = clr;

  const itPct = allIT.length > 0 ? Math.round((doneIT/allIT.length)*100) : 0;
  document.getElementById('ab-progress').textContent =
    `ITé‡èª¬ ${doneIT}/${allIT.length}é …ç›® å®Œäº† ï¼ æ›¸é¡ ${doneDoc}/${DOC_CHECKLIST.length}é …ç›® ï¼ è¿½è·¡ç•ªå· ${trackDone}/3`;
}

function updateSectionProgress() {
  IT_CHECKLIST.forEach(sec => {
    const done = sec.items.filter(it=>currentCase.checkState[it.id]).length;
    const el   = document.getElementById(`sp-${sec.id}`);
    if (el) el.textContent = `${done}/${sec.items.length}`;
  });
}

function updateDocProgress() {
  const done = Object.values(currentCase.docCheckState).filter(v=>v).length;
  const el   = document.getElementById('doc-prog');
  if (el) el.textContent = `${done}/${DOC_CHECKLIST.length}`;
}

// ================================================================
//  Section toggle
// ================================================================
function toggleSec(id, btn) {
  const body = document.getElementById(`sb-${id}`);
  const chev = btn ? btn.querySelector('.sec-chev') : null;
  if (body) body.classList.toggle('collapsed');
  if (chev) chev.classList.toggle('open');
}
// ================================================================
//  Pane switch
// ================================================================
function switchPane(i, btn) {
  currentPane = i;
  document.querySelectorAll('.tt').forEach((t,j)=>t.classList.toggle('on',j===i));
  document.getElementById('pane-0').style.display = i===0?'block':'none';
  document.getElementById('pane-1').style.display = i===1?'block':'none';
}

// ================================================================
//  Actions
// ================================================================
function saveMemo(id, val) {
  if (!currentCase.memos) currentCase.memos = {};
  currentCase.memos[id] = val;
}

// â”€â”€ å®Œäº†å ±å‘Šãƒ¢ãƒ¼ãƒ€ãƒ«è¡¨ç¤º â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
function showCompleteModal() {
  if (!currentCase) return;
  const c    = currentCase;
  const all  = IT_CHECKLIST.flatMap(s => s.items);
  const done = all.filter(it => c.checkState[it.id] === 'ok').length;
  const ng   = all.filter(it => c.checkState[it.id] === 'ng').length;
  const memoEl = document.getElementById('it-memo');
  const memo = memoEl ? memoEl.value || 'ï¼ˆãªã—ï¼‰' : 'ï¼ˆãªã—ï¼‰';
  const now  = new Date().toLocaleString('ja-JP');

  const rows = [
    ['æ¡ˆä»¶ID',       c.id],
    ['é¡§å®¢å',       c.name + ' æ§˜'],
    ['å®Ÿæ–½æ—¥æ™‚',     now],
    ['ãƒã‚§ãƒƒã‚¯å®Œäº†', done + ' / ' + all.length + ' é …ç›®'],
    ng > 0 ? ['å•é¡Œã‚ã‚Š', ng + ' é …ç›®'] : null,
    ['ãƒ¡ãƒ¢',         memo],
  ].filter(Boolean);

  document.getElementById('modal-body').innerHTML =
    rows.map(function(r){
      var k=r[0], v=r[1];
      var col = k==='å•é¡Œã‚ã‚Š' ? 'color:var(--red)' : k==='ãƒã‚§ãƒƒã‚¯å®Œäº†' ? 'color:var(--green)' : '';
      return '<div class="modal-row"><span class="mr-key">'+k+'</span><span class="mr-val" style="'+col+'">'+v+'</span></div>';
    }).join('') +
    '';

  document.getElementById('modal-progress').style.display = 'none';
  var actions = document.getElementById('modal-actions');
  if (actions) actions.style.display = 'flex';
  var submitBtn = document.getElementById('modal-submit-btn');
  if (submitBtn) { submitBtn.disabled = false; submitBtn.style.opacity = '1'; }
  document.getElementById('modal-overlay').classList.add('show');
}

// â”€â”€ ãƒ¯ãƒ³ã‚¯ãƒªãƒƒã‚¯è‡ªå‹•é€ä¿¡ â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
function submitComplete() {
  if (!currentCase) return;

  var btn       = document.getElementById('modal-submit-btn');
  var cancelBtn = document.querySelector('.ma-cancel');
  var progress  = document.getElementById('modal-progress');
  var progMsg   = document.getElementById('modal-progress-msg');
  var progBar   = document.getElementById('modal-progress-bar');

  if (btn) { btn.disabled = true; btn.style.opacity = '0.5'; }
  if (cancelBtn) { cancelBtn.disabled = true; cancelBtn.style.opacity = '0.4'; }
  if (progress) progress.style.display = 'block';

  var steps = [
    { pct: 30,  msg: 'ğŸ’¾ Kintoneã«å®Œäº†è¨˜éŒ²ã‚’ä¿å­˜ä¸­...',  ms: 700 },
    { pct: 65,  msg: 'ğŸ“¢ Slackã«é€šçŸ¥ã‚’é€ä¿¡ä¸­...',         ms: 600 },
    { pct: 90,  msg: 'ğŸ“± LINEå®Œäº†é€šçŸ¥ã‚’é€ä¿¡ä¸­...',         ms: 500 },
    { pct: 100, msg: 'âœ… å…¨ã¦å®Œäº†ã—ã¾ã—ãŸ',                ms: 400 },
  ];

  var i = 0;
  function runStep() {
    if (i >= steps.length) {
      // å®Œäº†å‡¦ç†
      currentCase.status   = 'scan-pending';
      currentCase.itStatus = 'done';
      currentCase.itDoneAt = new Date().toLocaleString('ja-JP');
      setTimeout(function() {
        closeModal();
        renderCaseList();
        var completeBtn = document.getElementById('ab-complete-btn');
        if (completeBtn) {
          completeBtn.textContent = 'ğŸ“¦ å®Œäº†æ¸ˆã¿';
          completeBtn.disabled    = true;
          completeBtn.style.opacity = '0.5';
        }
        showSlackToast('âœ… å®Œäº†å ±å‘Šé€ä¿¡æ¸ˆã¿ â€” Kintoneãƒ»Slackãƒ»LINEã«è‡ªå‹•é€šçŸ¥ã—ã¾ã—ãŸ');
      }, 300);
      return;
    }
    var s = steps[i++];
    if (progMsg) progMsg.textContent = s.msg;
    if (progBar) progBar.style.width = s.pct + '%';
    setTimeout(runStep, s.ms);
  }
  runStep();
}

function closeModal() {
  document.getElementById('modal-overlay').classList.remove('show');
}
</script>
</body>
</html>
