<!DOCTYPE html>
<html lang="ja">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width,initial-scale=1">
<title>CORETO â€” ãƒ©ãƒ™ãƒ«å°åˆ·ã‚·ã‚¹ãƒ†ãƒ </title>
<link href="https://fonts.googleapis.com/css2?family=Kaisei+Tokumin:wght@400;700&family=DM+Mono:wght@400;500&family=Noto+Sans+JP:wght@300;400;500;700&display=swap" rel="stylesheet">
<style>
*,*::before,*::after{box-sizing:border-box;margin:0;padding:0}
:root{
  --bg:#0d0f14;--bg2:#13161e;--bg3:#1a1e29;
  --border:#252a38;--border2:#2e3447;
  --text:#e8eaf0;--sub:#8b90a8;--muted:#4a4f68;
  --gold:#c9a840;--gold2:#e8c85a;--gold-bg:rgba(201,168,64,.08);
  --blue:#4fa3c8;--green:#52c49a;--red:#f87171;
}
html,body{min-height:100vh;background:var(--bg);color:var(--text);font-family:'Noto Sans JP',sans-serif;font-size:14px}

.hdr{height:52px;background:var(--bg2);border-bottom:1px solid var(--border);display:flex;align-items:center;justify-content:space-between;padding:0 24px;position:sticky;top:0;z-index:100}
.hdr-logo{font-family:'Kaisei Tokumin',serif;font-size:17px;letter-spacing:3px;color:var(--gold)}
.hdr-sub{font-size:11px;color:var(--sub)}
.btn-back{padding:6px 14px;border-radius:7px;border:1px solid var(--border2);background:transparent;color:var(--sub);font-size:11px;cursor:pointer;transition:.15s;font-family:'Noto Sans JP',sans-serif}
.btn-back:hover{border-color:var(--gold);color:var(--gold)}

.tabs{display:flex;background:var(--bg2);border-bottom:1px solid var(--border);padding:0 24px}
.tab{padding:12px 20px;font-size:11px;cursor:pointer;border-bottom:2px solid transparent;color:var(--muted);transition:all .2s;white-space:nowrap;background:none;border-top:none;border-left:none;border-right:none;font-family:'Noto Sans JP',sans-serif}
.tab:hover{color:var(--sub)}
.tab.active{color:var(--gold);border-bottom-color:var(--gold)}

.page{display:none;padding:24px;max-width:1100px;margin:0 auto}
.page.active{display:block}

/* Form */
.grid2{display:grid;grid-template-columns:1fr 1fr;gap:16px}
.card{background:var(--bg2);border:1px solid var(--border);border-radius:12px;padding:20px}
.card-title{font-size:11px;font-weight:700;letter-spacing:1px;color:var(--muted);margin-bottom:16px;text-transform:uppercase;font-family:'DM Mono',monospace}
.fg{margin-bottom:14px}
.fg label{display:block;font-size:11px;color:var(--sub);margin-bottom:5px}
.fg input,.fg select,.fg textarea{width:100%;padding:9px 12px;background:var(--bg3);border:1px solid var(--border2);border-radius:7px;color:var(--text);font-size:12px;font-family:'Noto Sans JP',sans-serif;outline:none;transition:border-color .15s}
.fg input:focus,.fg select:focus,.fg textarea:focus{border-color:var(--gold)}
.fg textarea{resize:vertical;min-height:80px;line-height:1.7}
.fg select{cursor:pointer}
.fg input::placeholder,.fg textarea::placeholder{color:var(--muted)}

/* Client autocomplete */
.cl-wrap{position:relative}
.cl-drop{position:absolute;top:calc(100% + 4px);left:0;right:0;background:var(--bg2);border:1px solid var(--border2);border-radius:8px;z-index:999;max-height:200px;overflow-y:auto;box-shadow:0 8px 24px rgba(0,0,0,.5);display:none}
.cl-opt{padding:9px 13px;cursor:pointer;border-bottom:1px solid var(--border);display:flex;align-items:center;gap:10px;transition:background .1s;font-size:12px}
.cl-opt:last-child{border-bottom:none}
.cl-opt:hover,.cl-opt.hl{background:rgba(201,168,64,.1)}
.cl-id{font-family:'DM Mono',monospace;font-size:10px;color:var(--gold);min-width:75px;flex-shrink:0}
.cl-hint{padding:7px 13px;font-size:10px;color:var(--muted);border-top:1px solid var(--border)}

/* Label type selector */
.label-types{display:grid;grid-template-columns:repeat(3,1fr);gap:10px;margin-bottom:20px}
.lt-card{background:var(--bg3);border:1px solid var(--border2);border-radius:10px;padding:14px;cursor:pointer;transition:all .2s;text-align:center}
.lt-card:hover{border-color:var(--border)}
.lt-card.selected{border-color:var(--gold);background:var(--gold-bg)}
.lt-icon{font-size:24px;margin-bottom:6px}
.lt-name{font-size:12px;font-weight:700;margin-bottom:2px}
.lt-size{font-family:'DM Mono',monospace;font-size:10px;color:var(--muted)}

/* Label preview */
.preview-area{background:#fff;border-radius:8px;padding:16px;min-height:120px;display:flex;align-items:center;justify-content:center;margin-bottom:16px}
.label-preview{font-family:'Noto Sans JP',sans-serif;color:#000;line-height:1.5;width:100%}

/* Letter-pack label styles */
.lp-label{border:2px solid #000;padding:10px 12px;background:#fff;color:#000;width:100%;max-width:380px;margin:0 auto;font-family:'Noto Sans JP',sans-serif;font-size:12px}
.lp-to{margin-bottom:8px}
.lp-to-zip{font-size:16px;font-weight:700;letter-spacing:4px;margin-bottom:4px;font-family:'DM Mono',monospace;color:#000}
.lp-to-addr{font-size:11px;line-height:1.6;color:#000}
.lp-to-name{font-size:18px;font-weight:700;margin-top:4px;color:#000}
.lp-divider{border-top:1px solid #ccc;margin:8px 0}
.lp-from{font-size:10px;color:#333;line-height:1.6}
.lp-from-name{font-size:12px;font-weight:700;color:#000}

/* Shipping label */
.sh-label{border:2px solid #000;padding:10px 12px;background:#fff;color:#000;width:100%;max-width:260px;margin:0 auto;font-family:'Noto Sans JP',sans-serif;font-size:11px}
.sh-header{font-size:9px;background:#000;color:#fff;padding:3px 8px;margin:-10px -12px 8px;text-align:center;letter-spacing:2px;font-weight:700}
.sh-zip{font-size:14px;font-weight:700;letter-spacing:3px;font-family:'DM Mono',monospace;color:#000;margin-bottom:3px}
.sh-addr{font-size:10px;line-height:1.5;color:#000;margin-bottom:4px}
.sh-name{font-size:16px;font-weight:700;color:#000}

/* QR / barcode placeholder */
.barcode-placeholder{display:flex;align-items:center;justify-content:center;border:1px dashed #ccc;height:40px;font-size:9px;color:#aaa;border-radius:3px;margin-top:6px}

/* Batch table */
.batch-table{width:100%;border-collapse:collapse;font-size:12px}
.batch-table th{padding:9px 12px;text-align:left;font-size:9px;color:var(--muted);letter-spacing:2px;font-family:'DM Mono',monospace;border-bottom:1px solid var(--border)}
.batch-table td{padding:9px 12px;border-bottom:1px solid var(--border);vertical-align:middle}
.batch-table tr:last-child td{border-bottom:none}
.batch-table tr:hover td{background:var(--bg3)}
.chk{width:16px;height:16px;cursor:pointer;accent-color:var(--gold)}
.mono{font-family:'DM Mono',monospace;font-size:11px}

/* Print buttons */
.print-bar{display:flex;gap:10px;flex-wrap:wrap;margin-top:16px}
.btn{padding:10px 20px;border-radius:8px;border:none;cursor:pointer;font-size:12px;font-weight:700;font-family:'Noto Sans JP',sans-serif;transition:all .15s;display:inline-flex;align-items:center;gap:6px}
.btn-gold{background:var(--gold);color:#000}
.btn-gold:hover{background:var(--gold2)}
.btn-outline{background:transparent;border:1px solid var(--border2);color:var(--sub)}
.btn-outline:hover{border-color:var(--gold);color:var(--gold)}
.btn-red{background:rgba(248,113,113,.15);border:1px solid rgba(248,113,113,.3);color:var(--red)}
.btn-red:hover{background:rgba(248,113,113,.25)}

/* History */
.hist-row{display:flex;align-items:center;gap:12px;padding:10px 0;border-bottom:1px solid var(--border);font-size:12px}
.hist-row:last-child{border-bottom:none}
.hist-badge{font-size:9px;padding:2px 7px;border-radius:4px;font-family:'DM Mono',monospace;font-weight:700;white-space:nowrap}
.hb-lp{background:rgba(79,163,200,.15);color:var(--blue)}
.hb-sh{background:rgba(82,196,154,.15);color:var(--green)}
.hb-rp{background:rgba(201,168,64,.15);color:var(--gold)}

/* Section label */
.sec{font-size:9px;color:var(--muted);letter-spacing:2px;font-family:'DM Mono',monospace;text-transform:uppercase;margin:20px 0 10px;padding-bottom:6px;border-bottom:1px solid var(--border)}

/* Print only */
@media print {
  .hdr,.tabs,.no-print{display:none!important}
  .page{display:block!important;padding:0}
  body{background:#fff}
  .print-target{page-break-after:always}
}
::-webkit-scrollbar{width:4px;height:4px}
::-webkit-scrollbar-track{background:transparent}
::-webkit-scrollbar-thumb{background:var(--border2);border-radius:2px}
</style>
</head>
<body>

<div class="hdr">
  <div style="display:flex;align-items:center;gap:12px">
    <div class="hdr-logo">CORETO</div>
    <div class="hdr-sub">ãƒ©ãƒ™ãƒ«å°åˆ·ã‚·ã‚¹ãƒ†ãƒ </div>
  </div>
  <button class="btn-back" onclick="location.href='coreto-hub.html'">â† Hub</button>
</div>

<div class="tabs">
  <button class="tab active" onclick="showTab('single')">ğŸ“‹ 1ä»¶å°åˆ·</button>
  <button class="tab" onclick="showTab('batch')">ğŸ“¦ ä¸€æ‹¬å°åˆ·</button>
  <button class="tab" onclick="showTab('history')">ğŸ“ å°åˆ·å±¥æ­´</button>
  <button class="tab" onclick="showTab('setup')">âš™ï¸ æ©Ÿç¨®ãƒ»è¨­å®š</button>
</div>

<!-- â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
  TAB: 1ä»¶å°åˆ·
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• -->
<div class="page active" id="page-single">
  <div class="grid2">
    <!-- å·¦: å…¥åŠ›ãƒ•ã‚©ãƒ¼ãƒ  -->
    <div>
      <div class="card">
        <div class="card-title">ãƒ©ãƒ™ãƒ«ç¨®åˆ¥</div>
        <div class="label-types">
          <div class="lt-card selected" onclick="setLabelType('lp', this)">
            <div class="lt-icon">ğŸ“®</div>
            <div class="lt-name">ãƒ¬ã‚¿ãƒ¼ãƒ‘ãƒƒã‚¯å®›å</div>
            <div class="lt-size">102 Ã— 60 mm</div>
          </div>
          <div class="lt-card" onclick="setLabelType('sh', this)">
            <div class="lt-icon">ğŸ“¦</div>
            <div class="lt-name">è·ç‰©ãƒ©ãƒ™ãƒ«</div>
            <div class="lt-size">62 Ã— 100 mm</div>
          </div>
          <div class="lt-card" onclick="setLabelType('rp', this)">
            <div class="lt-icon">ğŸ“„</div>
            <div class="lt-name">è¿”é€ç”¨ãƒ©ãƒ™ãƒ«</div>
            <div class="lt-size">62 Ã— 60 mm</div>
          </div>
        </div>

        <div class="sec">é€ä»˜å…ˆï¼ˆToï¼‰</div>
        <div class="fg">
          <label>ã‚¯ãƒ©ã‚¤ã‚¢ãƒ³ãƒˆID / æ°å <span style="color:var(--muted);font-size:9px">ï¼ˆIDãƒ»åå‰ãƒ»ã‚«ãƒŠã§æ¤œç´¢ï¼‰</span></label>
          <div class="cl-wrap">
            <input type="text" id="to-search" placeholder="CL-00001 ã¾ãŸã¯ å±±ç”° ã§æ¤œç´¢â€¦" autocomplete="off" oninput="searchClient('to',this)">
            <div class="cl-drop" id="to-drop"></div>
          </div>
          <input type="hidden" id="to-client-id">
        </div>
        <div class="fg">
          <label>æ°åï¼ˆå®›åï¼‰</label>
          <input type="text" id="to-name" placeholder="å±±ç”° å¤ªéƒ æ§˜" oninput="updatePreview()">
        </div>
        <div class="fg">
          <label>éƒµä¾¿ç•ªå·</label>
          <input type="text" id="to-zip" placeholder="ã€’ 000-0000" maxlength="8" class="mono" oninput="fmtZip('to-zip');updatePreview()">
        </div>
        <div class="fg">
          <label>ä½æ‰€</label>
          <textarea id="to-addr" rows="2" placeholder="æ±äº¬éƒ½æ–°å®¿åŒºè¥¿æ–°å®¿1-1-1&#10;æ–°å®¿ãƒ“ãƒ« 301å·å®¤" oninput="updatePreview()"></textarea>
        </div>

        <div class="sec">å·®å‡ºäººï¼ˆFromï¼‰</div>
        <div class="fg">
          <label>ä¼šç¤¾å</label>
          <input type="text" id="from-company" value="æ ªå¼ä¼šç¤¾COREBLDG" oninput="updatePreview()">
        </div>
        <div class="fg">
          <label>æ‹…å½“è€…å</label>
          <input type="text" id="from-person" placeholder="æ‹…å½“ï¼šå±±ç”° èª " oninput="updatePreview()">
        </div>
        <div class="fg">
          <label>ä½æ‰€ãƒ»é›»è©±</label>
          <textarea id="from-addr" rows="2" placeholder="ã€’160-0023 æ±äº¬éƒ½æ–°å®¿åŒºè¥¿æ–°å®¿2-1-1&#10;TEL: 03-XXXX-XXXX" oninput="updatePreview()"></textarea>
        </div>

        <div class="sec">ã‚ªãƒ—ã‚·ãƒ§ãƒ³</div>
        <div class="fg">
          <label>è¿½è·¡ç•ªå·ï¼ˆä»»æ„ï¼‰</label>
          <input type="text" id="tracking-no" class="mono" placeholder="1234-5678-9012" oninput="updatePreview()">
        </div>
        <div class="fg">
          <label>å‚™è€ƒãƒ»å–æ‰±æ³¨æ„</label>
          <input type="text" id="label-note" placeholder="ä¾‹ï¼šè¦ªå±• / é‡è¦æ›¸é¡åœ¨ä¸­ / é€Ÿé”" oninput="updatePreview()">
        </div>
      </div>
    </div>

    <!-- å³: ãƒ—ãƒ¬ãƒ“ãƒ¥ãƒ¼ -->
    <div>
      <div class="card">
        <div class="card-title">ãƒ—ãƒ¬ãƒ“ãƒ¥ãƒ¼</div>
        <div class="preview-area" id="preview-area">
          <!-- JSç”Ÿæˆ -->
        </div>
        <div class="print-bar no-print">
          <button class="btn btn-gold" onclick="printLabel()">ğŸ–¨ å°åˆ·ã™ã‚‹</button>
          <button class="btn btn-outline" onclick="addToBatch()">ğŸ“¦ ä¸€æ‹¬ã‚­ãƒ¥ãƒ¼ã«è¿½åŠ </button>
          <button class="btn btn-outline" onclick="saveHistory()">ğŸ’¾ å±¥æ­´ã«ä¿å­˜</button>
          <button class="btn btn-outline" onclick="clearForm()">ğŸ—‘ ã‚¯ãƒªã‚¢</button>
        </div>
        <div style="margin-top:12px;font-size:10px;color:var(--muted);line-height:1.8">
          â€» å°åˆ·æ™‚ã¯ãƒ–ãƒ©ã‚¦ã‚¶ã®å°åˆ·è¨­å®šã§ã€Œä½™ç™½ãªã—ã€ã€ŒèƒŒæ™¯ã‚°ãƒ©ãƒ•ã‚£ãƒƒã‚¯ã‚’å°åˆ·ã€ã‚’æœ‰åŠ¹ã«ã—ã¦ãã ã•ã„ã€‚<br>
          â€» Brother QL-820NWBä½¿ç”¨æ™‚: QL-820NWBãƒ‰ãƒ©ã‚¤ãƒãƒ¼ã‚¤ãƒ³ã‚¹ãƒˆãƒ¼ãƒ«å¾Œã€ç”¨ç´™ã‚µã‚¤ã‚ºã‚’DK-11209ï¼ˆ103mmï¼‰ã«è¨­å®šã€‚
        </div>
      </div>

      <div class="card" style="margin-top:16px">
        <div class="card-title">ãƒ—ãƒªã‚»ãƒƒãƒˆï¼ˆã‚ˆãä½¿ã†å·®å‡ºäººï¼‰</div>
        <div id="presets-list"></div>
        <div style="margin-top:12px;display:flex;gap:8px">
          <button class="btn btn-outline" style="flex:1" onclick="savePreset()">ï¼‹ ç¾åœ¨ã®å·®å‡ºäººã‚’ä¿å­˜</button>
        </div>
      </div>
    </div>
  </div>
</div>

<!-- â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
  TAB: ä¸€æ‹¬å°åˆ·
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• -->
<div class="page" id="page-batch">
  <div class="card" style="margin-bottom:16px">
    <div class="card-title">ä¸€æ‹¬ã‚­ãƒ¥ãƒ¼ <span id="batch-count" style="color:var(--gold)">0ä»¶</span></div>
    <table class="batch-table" id="batch-table">
      <thead>
        <tr>
          <th><input type="checkbox" class="chk" onclick="toggleAllBatch(this)"></th>
          <th>ç¨®åˆ¥</th>
          <th>å®›å…ˆ</th>
          <th>éƒµä¾¿ç•ªå·</th>
          <th>è¿½è·¡ç•ªå·</th>
          <th>æ“ä½œ</th>
        </tr>
      </thead>
      <tbody id="batch-tbody">
        <tr><td colspan="6" style="text-align:center;padding:24px;color:var(--muted)">ã‚­ãƒ¥ãƒ¼ãŒç©ºã§ã™ã€‚1ä»¶å°åˆ·ã‚¿ãƒ–ã‹ã‚‰ã€Œä¸€æ‹¬ã‚­ãƒ¥ãƒ¼ã«è¿½åŠ ã€ã—ã¦ãã ã•ã„ã€‚</td></tr>
      </tbody>
    </table>
    <div class="print-bar no-print" style="margin-top:16px">
      <button class="btn btn-gold" onclick="printBatch()">ğŸ–¨ é¸æŠã‚’ã¾ã¨ã‚ã¦å°åˆ·</button>
      <button class="btn btn-outline" onclick="exportBatchCSV()">ğŸ“Š CSVã‚¨ã‚¯ã‚¹ãƒãƒ¼ãƒˆ</button>
      <button class="btn btn-red" onclick="clearBatch()">ğŸ—‘ ã‚­ãƒ¥ãƒ¼ã‚’ã‚¯ãƒªã‚¢</button>
    </div>
  </div>

  <div class="card">
    <div class="card-title">CSVã‹ã‚‰ä¸€æ‹¬ã‚¤ãƒ³ãƒãƒ¼ãƒˆ</div>
    <p style="font-size:11px;color:var(--sub);margin-bottom:12px;line-height:1.8">
      Kintoneã‚„é¡§å®¢ç®¡ç†ã‹ã‚‰ã‚¨ã‚¯ã‚¹ãƒãƒ¼ãƒˆã—ãŸCSVãƒ•ã‚¡ã‚¤ãƒ«ã‚’èª­ã¿è¾¼ã¿ã€ã¾ã¨ã‚ã¦ãƒ©ãƒ™ãƒ«ã‚’ç”Ÿæˆã§ãã¾ã™ã€‚<br>
      å½¢å¼: <span class="mono" style="font-size:10px;color:var(--gold)">æ°å,éƒµä¾¿ç•ªå·,ä½æ‰€,è¿½è·¡ç•ªå·</span>ï¼ˆãƒ˜ãƒƒãƒ€ãƒ¼è¡Œã¯è‡ªå‹•ã‚¹ã‚­ãƒƒãƒ—ï¼‰
    </p>
    <div style="display:flex;gap:10px;align-items:center">
      <input type="file" id="csv-file" accept=".csv" onchange="importCSV(this)" style="font-size:11px;color:var(--sub)">
      <button class="btn btn-outline" onclick="loadSampleCSV()">ã‚µãƒ³ãƒ—ãƒ«CSVã‚’èª­ã¿è¾¼ã‚€</button>
    </div>
  </div>
</div>

<!-- â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
  TAB: å°åˆ·å±¥æ­´
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• -->
<div class="page" id="page-history">
  <div class="card">
    <div style="display:flex;align-items:center;justify-content:space-between;margin-bottom:16px">
      <div class="card-title" style="margin-bottom:0">å°åˆ·å±¥æ­´</div>
      <button class="btn btn-red btn-outline" style="font-size:11px;padding:6px 12px" onclick="clearHistory()">å±¥æ­´ã‚’ã‚¯ãƒªã‚¢</button>
    </div>
    <div id="history-list">
      <p style="color:var(--muted);font-size:12px;text-align:center;padding:20px">ã¾ã å±¥æ­´ãŒã‚ã‚Šã¾ã›ã‚“</p>
    </div>
  </div>
</div>

<!-- â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
  TAB: æ©Ÿç¨®ãƒ»è¨­å®š
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• -->
<div class="page" id="page-setup">
  <div class="grid2">
    <div class="card">
      <div class="card-title">æ¨å¥¨æ©Ÿç¨®</div>
      <div style="border:1px solid rgba(201,168,64,.3);border-radius:10px;padding:14px;margin-bottom:12px;background:var(--gold-bg)">
        <div style="font-size:13px;font-weight:700;color:var(--gold2);margin-bottom:6px">â˜… æ¨å¥¨ï¼šBrother QL-820NWB</div>
        <div style="font-size:11px;color:var(--sub);line-height:1.8">
          ä¾¡æ ¼ï¼šÂ¥18,000ã€œ / WiFiãƒ»USBãƒ»Bluetoothå¯¾å¿œ / å°åˆ·é€Ÿåº¦110mm/ç§’<br>
          ç”¨ç´™ï¼šDK-11209ï¼ˆ103mmå¹…ï¼‰ ãƒ¬ã‚¿ãƒ¼ãƒ‘ãƒƒã‚¯å®›åã«æœ€é©<br>
          SDKï¼šb-PAC SDKï¼ˆç„¡æ–™ï¼‰ã§Kintoneé€£æºã‚‚å¯èƒ½
        </div>
      </div>
      <div style="border:1px solid var(--border2);border-radius:10px;padding:14px;margin-bottom:12px">
        <div style="font-size:12px;font-weight:700;margin-bottom:6px">æ¬¡ç‚¹ï¼šBrother QL-700</div>
        <div style="font-size:11px;color:var(--sub);line-height:1.8">ä¾¡æ ¼ï¼šÂ¥8,000ã€œ / USBæ¥ç¶šã®ã¿ / 62mmå¹…ã¾ã§å¯¾å¿œ</div>
      </div>
      <div style="border:1px solid var(--border2);border-radius:10px;padding:14px">
        <div style="font-size:12px;font-weight:700;margin-bottom:6px">ä»£æ›¿ï¼šDYMO LabelWriter 450 Turbo</div>
        <div style="font-size:11px;color:var(--sub);line-height:1.8">ä¾¡æ ¼ï¼šÂ¥12,000ã€œ / USB / æœ€å¤§54mmå¹…</div>
      </div>
    </div>

    <div class="card">
      <div class="card-title">å·®å‡ºäººãƒ—ãƒªã‚»ãƒƒãƒˆç®¡ç†</div>
      <div id="setup-presets"></div>
      <div style="margin-top:16px;font-size:10px;color:var(--muted);line-height:1.8">
        ãƒ—ãƒªã‚»ãƒƒãƒˆã¯ãƒ–ãƒ©ã‚¦ã‚¶ã®localStorageã«ä¿å­˜ã•ã‚Œã¾ã™ã€‚<br>
        Kintoneã¸ã®ãƒ‡ãƒ¼ã‚¿åŒæœŸã«ã¯APIé€£æºãŒå¿…è¦ã§ã™ã€‚
      </div>
    </div>
  </div>

  <div class="card" style="margin-top:16px">
    <div class="card-title">ãƒ–ãƒ©ã‚¦ã‚¶å°åˆ·è¨­å®šã‚¬ã‚¤ãƒ‰</div>
    <div style="display:grid;grid-template-columns:1fr 1fr 1fr;gap:12px;margin-top:4px">
      <div style="background:var(--bg3);border-radius:8px;padding:12px">
        <div style="font-size:11px;font-weight:700;margin-bottom:6px">Chrome</div>
        <div style="font-size:10px;color:var(--sub);line-height:1.8">1. Ctrl+P / âŒ˜+P<br>2. ã€Œè©³ç´°è¨­å®šã€<br>3. ä½™ç™½ï¼šãªã—<br>4. èƒŒæ™¯ã‚°ãƒ©ãƒ•ã‚£ãƒƒã‚¯ï¼šON</div>
      </div>
      <div style="background:var(--bg3);border-radius:8px;padding:12px">
        <div style="font-size:11px;font-weight:700;margin-bottom:6px">Safari</div>
        <div style="font-size:10px;color:var(--sub);line-height:1.8">1. âŒ˜+P<br>2. ã€Œè©³ç´°ã‚’è¡¨ç¤ºã€<br>3. ç”¨ç´™ã‚µã‚¤ã‚ºã‚’æŒ‡å®š<br>4. èƒŒæ™¯ã‚’å°åˆ·ï¼šON</div>
      </div>
      <div style="background:var(--bg3);border-radius:8px;padding:12px">
        <div style="font-size:11px;font-weight:700;margin-bottom:6px">Edge</div>
        <div style="font-size:10px;color:var(--sub);line-height:1.8">1. Ctrl+P<br>2. ã€Œè©³ç´°ã‚ªãƒ—ã‚·ãƒ§ãƒ³ã€<br>3. ä½™ç™½ï¼šãªã—<br>4. èƒŒæ™¯ï¼šON</div>
      </div>
    </div>
  </div>
</div>

<!-- å°åˆ·å°‚ç”¨ã‚¨ãƒªã‚¢ -->
<div id="print-frame" style="display:none"></div>

<script>
// â”€ Client DB â”€
const CLIENTS_DB = [
  {id:'CL-00001', name:'å±±ç”° å¤ªéƒ', kana:'ãƒ¤ãƒãƒ€ ã‚¿ãƒ­ã‚¦',   zip:'171-0014', addr:'æ±äº¬éƒ½è±Šå³¶åŒºæ± è¢‹2-1-1\næ± è¢‹ãƒãƒ³ã‚·ãƒ§ãƒ³301å·'},
  {id:'CL-00012', name:'ä½è—¤ èŠ±å­', kana:'ã‚µãƒˆã‚¦ ãƒãƒŠã‚³',   zip:'160-0023', addr:'æ±äº¬éƒ½æ–°å®¿åŒºè¥¿æ–°å®¿3-2-1\nãƒ‘ãƒ¼ã‚¯ã‚¿ãƒ¯ãƒ¼1205'},
  {id:'CL-00023', name:'éˆ´æœ¨ å¥ä¸€', kana:'ã‚¹ã‚ºã‚­ ã‚±ãƒ³ã‚¤ãƒ', zip:'150-0001', addr:'æ±äº¬éƒ½æ¸‹è°·åŒºç¥å®®å‰4-5-6'},
  {id:'CL-00047', name:'ç”°ä¸­ ç¾å’²', kana:'ã‚¿ãƒŠã‚« ãƒŸã‚µã‚­',   zip:'141-0031', addr:'æ±äº¬éƒ½å“å·åŒºè¥¿äº”åç”°1-2-3\nã‚°ãƒªãƒ¼ãƒ³ã‚³ãƒ¼ãƒˆ802'},
  {id:'CL-00058', name:'å°æ— æµ©äºŒ', kana:'ã‚³ãƒãƒ¤ã‚· ã‚³ã‚¦ã‚¸', zip:'166-0001', addr:'æ±äº¬éƒ½æ‰ä¸¦åŒºé˜¿ä½è°·åŒ—2-3-4'},
  {id:'CL-00071', name:'æ¸¡è¾º æµå­', kana:'ãƒ¯ã‚¿ãƒŠãƒ™ ã‚±ã‚¤ã‚³', zip:'223-0052', addr:'ç¥å¥ˆå·çœŒæ¨ªæµœå¸‚æ¸¯åŒ—åŒºç¶±å³¶æ±1-2-3\nç¶±å³¶ãƒ‘ãƒ¬ã‚¹502'},
];

// â”€ State â”€
let labelType = 'lp';
let batchQueue = [];
let printHistory = JSON.parse(localStorage.getItem('coreto_label_history') || '[]');
let presets = JSON.parse(localStorage.getItem('coreto_label_presets') || '[]');

// â”€ Tabs â”€
function showTab(name) {
  document.querySelectorAll('.tab').forEach(t=>t.classList.remove('active'));
  document.querySelectorAll('.page').forEach(p=>p.classList.remove('active'));
  event.currentTarget.classList.add('active');
  document.getElementById('page-'+name).classList.add('active');
  if(name==='history') renderHistory();
  if(name==='setup') renderSetupPresets();
}

// â”€ Label type â”€
function setLabelType(type, el) {
  labelType = type;
  document.querySelectorAll('.lt-card').forEach(c=>c.classList.remove('selected'));
  el.classList.add('selected');
  updatePreview();
}

// â”€ Client search â”€
function searchClient(prefix, input) {
  const q = input.value.trim().toLowerCase();
  const drop = document.getElementById(prefix+'-drop');
  if(!q) { drop.style.display='none'; return; }
  const matches = CLIENTS_DB.filter(c =>
    c.id.toLowerCase().includes(q) || c.name.includes(q) || c.kana.toLowerCase().includes(q)
  ).slice(0,8);
  if(!matches.length) { drop.style.display='none'; return; }
  drop.innerHTML = matches.map(c =>
    `<div class="cl-opt" onclick="pickClient('${prefix}','${c.id}')">
      <span class="cl-id">${c.id}</span>
      <span>${c.name}</span>
      <span style="font-size:10px;color:var(--muted);margin-left:4px">${c.kana}</span>
    </div>`
  ).join('') + '<div class="cl-hint">è¦‹ã¤ã‹ã‚‰ãªã„å ´åˆã¯ãã®ã¾ã¾å…¥åŠ›</div>';
  drop.style.display = 'block';
}

function pickClient(prefix, clientId) {
  const c = CLIENTS_DB.find(x=>x.id===clientId);
  if(!c) return;
  document.getElementById(prefix+'-search').value = c.id + ' / ' + c.name;
  document.getElementById(prefix+'-client-id').value = c.id;
  document.getElementById(prefix+'-drop').style.display = 'none';
  // fill fields
  if(prefix==='to') {
    document.getElementById('to-name').value = c.name + ' æ§˜';
    if(c.zip) document.getElementById('to-zip').value = c.zip;
    if(c.addr) document.getElementById('to-addr').value = c.addr;
  }
  updatePreview();
}

// close dropdown on outside click
document.addEventListener('click', e => {
  if(!e.target.closest('.cl-wrap')) {
    document.querySelectorAll('.cl-drop').forEach(d=>d.style.display='none');
  }
});

// â”€ Zip formatter â”€
function fmtZip(id) {
  const el = document.getElementById(id);
  let v = el.value.replace(/[^\d]/g,'');
  if(v.length > 7) v = v.slice(0,7);
  if(v.length > 3) v = v.slice(0,3) + '-' + v.slice(3);
  el.value = v;
}

// â”€ Preview â”€
function updatePreview() {
  const toName = document.getElementById('to-name').value || 'ï¼ˆå®›å…ˆæ°åï¼‰';
  const toZip  = document.getElementById('to-zip').value  || '000-0000';
  const toAddr = document.getElementById('to-addr').value || 'ï¼ˆä½æ‰€ï¼‰';
  const fromCo = document.getElementById('from-company').value || 'æ ªå¼ä¼šç¤¾COREBLDG';
  const fromPerson = document.getElementById('from-person').value;
  const fromAddr = document.getElementById('from-addr').value || 'ï¼ˆå·®å‡ºäººä½æ‰€ï¼‰';
  const tracking = document.getElementById('tracking-no').value;
  const note = document.getElementById('label-note').value;

  let html = '';

  if(labelType === 'lp') {
    html = `<div class="lp-label">
      <div class="lp-to">
        <div class="lp-to-zip">ã€’ ${toZip}</div>
        <div class="lp-to-addr">${toAddr.replace(/\n/g,'<br>')}</div>
        <div class="lp-to-name">${toName}</div>
      </div>
      ${note ? `<div style="font-size:10px;color:#555;margin-bottom:6px;font-weight:700">${note}</div>` : ''}
      <div class="lp-divider"></div>
      <div class="lp-from">
        <div class="lp-from-name">${fromCo}</div>
        ${fromPerson ? `<div>æ‹…å½“ï¼š${fromPerson}</div>` : ''}
        <div>${fromAddr.replace(/\n/g,' ')}</div>
        ${tracking ? `<div style="font-family:'DM Mono',monospace;font-size:10px;margin-top:4px">è¿½è·¡ï¼š${tracking}</div>` : ''}
      </div>
    </div>`;
  } else if(labelType === 'sh') {
    html = `<div class="sh-label">
      <div class="sh-header">CORETO ç™ºé€ãƒ©ãƒ™ãƒ«</div>
      <div style="font-size:9px;color:#666;margin-bottom:4px">ãŠå±Šã‘å…ˆ</div>
      <div class="sh-zip">ã€’ ${toZip}</div>
      <div class="sh-addr">${toAddr.replace(/\n/g,'<br>')}</div>
      <div class="sh-name">${toName}</div>
      ${note ? `<div style="font-size:9px;color:#555;margin-top:4px;border-top:1px solid #ddd;padding-top:4px">${note}</div>` : ''}
      <div style="border-top:1px solid #ccc;margin:6px 0;padding-top:6px;font-size:9px;color:#666">å·®å‡ºäºº</div>
      <div style="font-size:10px;font-weight:700;color:#000">${fromCo}</div>
      ${fromPerson ? `<div style="font-size:9px;color:#333">${fromPerson}</div>` : ''}
      <div style="font-size:9px;color:#555">${fromAddr.replace(/\n/g,' ')}</div>
      ${tracking ? `<div class="barcode-placeholder">è¿½è·¡: ${tracking}</div>` : ''}
    </div>`;
  } else {
    // rp - è¿”é€ç”¨
    html = `<div class="sh-label">
      <div class="sh-header" style="background:#c9a840;color:#000">è¿”é€ç”¨ãƒ©ãƒ™ãƒ«</div>
      <div style="font-size:9px;color:#666;margin-bottom:4px">è¿”é€å…ˆ</div>
      <div class="sh-zip">ã€’ ${document.getElementById('from-addr').value.match(/ã€’\s?[\d-]+/)?.[0] || 'ã€’ ???'}</div>
      <div class="sh-addr">${fromAddr.replace(/\n/g,'<br>')}</div>
      <div class="sh-name">${fromCo}</div>
      ${fromPerson ? `<div style="font-size:9px;color:#333">${fromPerson} å®›</div>` : ''}
      <div style="border-top:1px solid #ccc;margin:6px 0;padding-top:4px;font-size:9px;color:#666">å·®å‡ºäºº</div>
      <div style="font-size:10px;color:#000">${toName}</div>
      <div style="font-size:9px;color:#555">${toAddr.replace(/\n/g,' ')}</div>
    </div>`;
  }

  document.getElementById('preview-area').innerHTML = html;
}

// â”€ Print â”€
function printLabel() {
  const content = document.getElementById('preview-area').innerHTML;
  const win = window.open('', '_blank', 'width=600,height=400');
  win.document.write(`<!DOCTYPE html><html><head>
    <meta charset="UTF-8">
    <link href="https://fonts.googleapis.com/css2?family=Noto+Sans+JP:wght@400;700&family=DM+Mono&display=swap" rel="stylesheet">
    <style>
      *{box-sizing:border-box;margin:0;padding:0}
      body{display:flex;align-items:center;justify-content:center;min-height:100vh;background:#fff;font-family:'Noto Sans JP',sans-serif}
      @media print{body{background:#fff}}
      ${getSharedLabelStyles()}
    </style>
  </head><body><div class="print-target">${content}</div>
  <script>window.onload=()=>{window.print();window.onafterprint=()=>window.close()}<\/script>
  </body></html>`);
  win.document.close();
  saveHistory();
}

function getSharedLabelStyles() {
  return `.lp-label{border:2px solid #000;padding:10px 12px;background:#fff;color:#000;width:380px;font-family:'Noto Sans JP',sans-serif;font-size:12px}.lp-to-zip{font-size:16px;font-weight:700;letter-spacing:4px;margin-bottom:4px;font-family:'DM Mono',monospace}.lp-to-addr{font-size:11px;line-height:1.6}.lp-to-name{font-size:18px;font-weight:700;margin-top:4px}.lp-divider{border-top:1px solid #ccc;margin:8px 0}.lp-from{font-size:10px;color:#333;line-height:1.6}.lp-from-name{font-size:12px;font-weight:700;color:#000}.sh-label{border:2px solid #000;padding:10px 12px;background:#fff;color:#000;width:260px;font-family:'Noto Sans JP',sans-serif;font-size:11px}.sh-header{font-size:9px;background:#000;color:#fff;padding:3px 8px;margin:-10px -12px 8px;text-align:center;letter-spacing:2px;font-weight:700}.sh-zip{font-size:14px;font-weight:700;letter-spacing:3px;font-family:'DM Mono',monospace}.sh-name{font-size:16px;font-weight:700}.barcode-placeholder{display:flex;align-items:center;justify-content:center;border:1px dashed #ccc;height:36px;font-size:9px;color:#aaa;margin-top:6px}`;
}

// â”€ Batch â”€
function addToBatch() {
  const entry = getFormData();
  if(!entry.toName || entry.toName === 'ï¼ˆå®›å…ˆæ°åï¼‰') { alert('å®›å…ˆæ°åã‚’å…¥åŠ›ã—ã¦ãã ã•ã„'); return; }
  batchQueue.push({...entry, id: Date.now(), type: labelType});
  renderBatch();
  showTab_byName('batch');
}

function showTab_byName(name) {
  document.querySelectorAll('.tab').forEach((t,i) => {
    const names = ['single','batch','history','setup'];
    if(names[i]===name) t.classList.add('active'); else t.classList.remove('active');
  });
  document.querySelectorAll('.page').forEach(p=>p.classList.remove('active'));
  document.getElementById('page-'+name).classList.add('active');
}

function getFormData() {
  return {
    toName:  document.getElementById('to-name').value,
    toZip:   document.getElementById('to-zip').value,
    toAddr:  document.getElementById('to-addr').value,
    fromCo:  document.getElementById('from-company').value,
    fromPerson: document.getElementById('from-person').value,
    fromAddr: document.getElementById('from-addr').value,
    tracking: document.getElementById('tracking-no').value,
    note:    document.getElementById('label-note').value,
    clientId: document.getElementById('to-client-id').value,
  };
}

function renderBatch() {
  document.getElementById('batch-count').textContent = batchQueue.length + 'ä»¶';
  const tbody = document.getElementById('batch-tbody');
  if(!batchQueue.length) {
    tbody.innerHTML = '<tr><td colspan="6" style="text-align:center;padding:24px;color:var(--muted)">ã‚­ãƒ¥ãƒ¼ãŒç©ºã§ã™</td></tr>';
    return;
  }
  const typeLabel = {lp:'ğŸ“® LPå®›å', sh:'ğŸ“¦ è·ç‰©', rp:'ğŸ“„ è¿”é€'};
  tbody.innerHTML = batchQueue.map((e,i) => `
    <tr>
      <td><input type="checkbox" class="chk batch-chk" data-i="${i}" checked></td>
      <td><span style="font-size:10px">${typeLabel[e.type]||e.type}</span></td>
      <td style="font-weight:600">${e.toName}</td>
      <td class="mono" style="font-size:11px">${e.toZip||'â€”'}</td>
      <td class="mono" style="font-size:11px">${e.tracking||'â€”'}</td>
      <td><button class="btn btn-red" style="font-size:10px;padding:4px 10px" onclick="removeBatch(${i})">å‰Šé™¤</button></td>
    </tr>
  `).join('');
}

function removeBatch(i) {
  batchQueue.splice(i,1);
  renderBatch();
}

function toggleAllBatch(cb) {
  document.querySelectorAll('.batch-chk').forEach(c=>c.checked=cb.checked);
}

function clearBatch() {
  if(!confirm('ã‚­ãƒ¥ãƒ¼ã‚’å…¨ã¦ã‚¯ãƒªã‚¢ã—ã¾ã™ã‹ï¼Ÿ')) return;
  batchQueue = [];
  renderBatch();
}

function printBatch() {
  const checked = [...document.querySelectorAll('.batch-chk:checked')].map(c=>parseInt(c.dataset.i));
  if(!checked.length) { alert('å°åˆ·ã™ã‚‹ãƒ©ãƒ™ãƒ«ã‚’é¸æŠã—ã¦ãã ã•ã„'); return; }
  const items = checked.map(i=>batchQueue[i]);
  const styles = getSharedLabelStyles();
  const win = window.open('', '_blank');
  win.document.write(`<!DOCTYPE html><html><head>
    <meta charset="UTF-8">
    <link href="https://fonts.googleapis.com/css2?family=Noto+Sans+JP:wght@400;700&family=DM+Mono&display=swap" rel="stylesheet">
    <style>*{box-sizing:border-box;margin:0;padding:0}body{background:#fff;font-family:'Noto Sans JP',sans-serif}.page{page-break-after:always;display:flex;align-items:center;justify-content:center;padding:20px}${styles}</style>
  </head><body>`);
  items.forEach(e => {
    const lh = generateLabelHtml(e, e.type);
    win.document.write(`<div class="page">${lh}</div>`);
  });
  win.document.write(`<script>window.onload=()=>{window.print();window.onafterprint=()=>window.close()}<\/script></body></html>`);
  win.document.close();
  // å°åˆ·å¾Œã«å±¥æ­´ä¿å­˜
  items.forEach(e => {
    printHistory.unshift({...e, printedAt: new Date().toLocaleString('ja-JP'), type: e.type});
  });
  localStorage.setItem('coreto_label_history', JSON.stringify(printHistory.slice(0,100)));
}

function generateLabelHtml(e, type) {
  const toZip = e.toZip||'000-0000';
  const toAddr = e.toAddr||'';
  const toName = e.toName||'';
  const fromCo = e.fromCo||'';
  const fromPerson = e.fromPerson||'';
  const fromAddr = e.fromAddr||'';
  const tracking = e.tracking||'';
  const note = e.note||'';
  if(type==='lp') {
    return `<div class="lp-label"><div class="lp-to"><div class="lp-to-zip">ã€’ ${toZip}</div><div class="lp-to-addr">${toAddr.replace(/\n/g,'<br>')}</div><div class="lp-to-name">${toName}</div></div>${note?`<div style="font-size:10px;color:#555;margin-bottom:6px;font-weight:700">${note}</div>`:''}<div class="lp-divider"></div><div class="lp-from"><div class="lp-from-name">${fromCo}</div>${fromPerson?`<div>æ‹…å½“ï¼š${fromPerson}</div>`:''}<div>${fromAddr.replace(/\n/g,' ')}</div>${tracking?`<div style="font-family:monospace;font-size:10px;margin-top:4px">è¿½è·¡ï¼š${tracking}</div>`:''}</div></div>`;
  } else {
    return `<div class="sh-label"><div class="sh-header">CORETO ç™ºé€ãƒ©ãƒ™ãƒ«</div><div class="sh-zip">ã€’ ${toZip}</div><div class="sh-addr">${toAddr.replace(/\n/g,'<br>')}</div><div class="sh-name">${toName}</div>${note?`<div style="font-size:9px;color:#555;margin-top:4px;border-top:1px dashed #ddd;padding-top:4px">${note}</div>`:''}<div style="border-top:1px solid #ccc;margin:6px 0;padding-top:6px;font-size:9px;color:#666">å·®å‡ºäºº</div><div style="font-size:10px;font-weight:700">${fromCo}</div>${fromPerson?`<div style="font-size:9px">${fromPerson}</div>`:''}<div style="font-size:9px;color:#555">${fromAddr.replace(/\n/g,' ')}</div>${tracking?`<div class="barcode-placeholder">è¿½è·¡: ${tracking}</div>`:''}</div>`;
  }
}

function exportBatchCSV() {
  const rows = [['ç¨®åˆ¥','æ°å','éƒµä¾¿ç•ªå·','ä½æ‰€','è¿½è·¡ç•ªå·','å‚™è€ƒ']];
  batchQueue.forEach(e => rows.push([e.type, e.toName, e.toZip, e.toAddr?.replace(/\n/g,' ')||'', e.tracking||'', e.note||'']));
  const csv = rows.map(r=>r.map(c=>`"${(c||'').replace(/"/g,'""')}"`).join(',')).join('\n');
  const blob = new Blob(['\uFEFF'+csv], {type:'text/csv;charset=utf-8'});
  const url = URL.createObjectURL(blob);
  const a = document.createElement('a'); a.href=url; a.download='coreto_labels.csv'; a.click();
  URL.revokeObjectURL(url);
}

function importCSV(input) {
  const file = input.files[0];
  if(!file) return;
  const reader = new FileReader();
  reader.onload = e => {
    const lines = e.target.result.split('\n').filter(l=>l.trim());
    let added = 0;
    lines.forEach((line, idx) => {
      if(idx===0 && line.includes('æ°å')) return; // skip header
      const cols = line.split(',').map(c=>c.replace(/^"|"$/g,'').trim());
      if(cols[0]) {
        batchQueue.push({id:Date.now()+idx, type:'lp', toName:cols[0], toZip:cols[1]||'', toAddr:cols[2]||'', tracking:cols[3]||'', note:'', fromCo:document.getElementById('from-company').value, fromAddr:document.getElementById('from-addr').value});
        added++;
      }
    });
    renderBatch();
    alert(`${added}ä»¶ã‚’ã‚­ãƒ¥ãƒ¼ã«è¿½åŠ ã—ã¾ã—ãŸ`);
  };
  reader.readAsText(file, 'UTF-8');
}

function loadSampleCSV() {
  const sample = [
    {type:'lp', toName:'å±±ç”° å¤ªéƒ æ§˜', toZip:'171-0014', toAddr:'æ±äº¬éƒ½è±Šå³¶åŒºæ± è¢‹2-1-1\næ± è¢‹ãƒãƒ³ã‚·ãƒ§ãƒ³301', tracking:'1234-5678', note:''},
    {type:'lp', toName:'ä½è—¤ èŠ±å­ æ§˜', toZip:'160-0023', toAddr:'æ±äº¬éƒ½æ–°å®¿åŒºè¥¿æ–°å®¿3-2-1\nãƒ‘ãƒ¼ã‚¯ã‚¿ãƒ¯ãƒ¼1205', tracking:'2345-6789', note:''},
    {type:'sh', toName:'éˆ´æœ¨ å¥ä¸€ æ§˜', toZip:'150-0001', toAddr:'æ±äº¬éƒ½æ¸‹è°·åŒºç¥å®®å‰4-5-6', tracking:'3456-7890', note:'é‡è¦æ›¸é¡'},
  ];
  sample.forEach((e,i) => batchQueue.push({...e, id: Date.now()+i, fromCo: document.getElementById('from-company').value, fromAddr: document.getElementById('from-addr').value}));
  renderBatch();
  showTab_byName('batch');
}

// â”€ History â”€
function saveHistory() {
  const e = getFormData();
  if(!e.toName) return;
  printHistory.unshift({...e, type: labelType, printedAt: new Date().toLocaleString('ja-JP')});
  localStorage.setItem('coreto_label_history', JSON.stringify(printHistory.slice(0,100)));
}

function renderHistory() {
  const list = document.getElementById('history-list');
  if(!printHistory.length) {
    list.innerHTML = '<p style="color:var(--muted);font-size:12px;text-align:center;padding:20px">ã¾ã å±¥æ­´ãŒã‚ã‚Šã¾ã›ã‚“</p>';
    return;
  }
  const typeLabel = {lp:'ğŸ“® LPå®›å', sh:'ğŸ“¦ è·ç‰©', rp:'ğŸ“„ è¿”é€'};
  const badgeCls  = {lp:'hb-lp', sh:'hb-sh', rp:'hb-rp'};
  list.innerHTML = printHistory.map((e,i) => `
    <div class="hist-row">
      <span class="hist-badge ${badgeCls[e.type]||''}">${typeLabel[e.type]||e.type}</span>
      <span style="font-weight:600;flex:1">${e.toName}</span>
      <span class="mono" style="color:var(--muted);font-size:11px">${e.toZip||''}</span>
      <span style="font-size:10px;color:var(--muted);white-space:nowrap;margin-left:12px">${e.printedAt}</span>
      <button class="btn btn-outline" style="font-size:10px;padding:4px 10px" onclick="reprint(${i})">å†å°åˆ·</button>
      <button class="btn btn-red" style="font-size:10px;padding:4px 10px" onclick="deleteHistory(${i})">å‰Šé™¤</button>
    </div>
  `).join('');
}

function reprint(i) {
  const e = printHistory[i];
  // ãƒ•ã‚©ãƒ¼ãƒ ã«å¾©å…ƒ
  document.getElementById('to-name').value = e.toName||'';
  document.getElementById('to-zip').value  = e.toZip||'';
  document.getElementById('to-addr').value = e.toAddr||'';
  document.getElementById('from-company').value = e.fromCo||'';
  document.getElementById('from-person').value = e.fromPerson||'';
  document.getElementById('from-addr').value = e.fromAddr||'';
  document.getElementById('tracking-no').value = e.tracking||'';
  document.getElementById('label-note').value = e.note||'';
  labelType = e.type||'lp';
  document.querySelectorAll('.lt-card').forEach((c,idx)=>{
    const types=['lp','sh','rp'];
    c.classList.toggle('selected', types[idx]===labelType);
  });
  updatePreview();
  showTab_byName('single');
}

function deleteHistory(i) {
  printHistory.splice(i,1);
  localStorage.setItem('coreto_label_history', JSON.stringify(printHistory));
  renderHistory();
}

function clearHistory() {
  if(!confirm('å°åˆ·å±¥æ­´ã‚’å…¨ã¦å‰Šé™¤ã—ã¾ã™ã‹ï¼Ÿ')) return;
  printHistory = [];
  localStorage.setItem('coreto_label_history', '[]');
  renderHistory();
}

// â”€ Presets â”€
function savePreset() {
  const name = prompt('ã“ã®ãƒ—ãƒªã‚»ãƒƒãƒˆã®åå‰ã‚’å…¥åŠ›ã—ã¦ãã ã•ã„ï¼ˆä¾‹ï¼šæœ¬ç¤¾ã€æ–°å®¿äº‹å‹™æ‰€ï¼‰');
  if(!name) return;
  presets.push({
    name,
    fromCo:   document.getElementById('from-company').value,
    fromPerson: document.getElementById('from-person').value,
    fromAddr: document.getElementById('from-addr').value,
  });
  localStorage.setItem('coreto_label_presets', JSON.stringify(presets));
  renderPresets();
}

function applyPreset(i) {
  const p = presets[i];
  document.getElementById('from-company').value = p.fromCo||'';
  document.getElementById('from-person').value = p.fromPerson||'';
  document.getElementById('from-addr').value = p.fromAddr||'';
  updatePreview();
}

function deletePreset(i) {
  presets.splice(i,1);
  localStorage.setItem('coreto_label_presets', JSON.stringify(presets));
  renderPresets();
  renderSetupPresets();
}

function renderPresets() {
  const list = document.getElementById('presets-list');
  if(!presets.length) {
    list.innerHTML = '<p style="font-size:11px;color:var(--muted)">ä¿å­˜æ¸ˆã¿ãƒ—ãƒªã‚»ãƒƒãƒˆãŒã‚ã‚Šã¾ã›ã‚“</p>';
    return;
  }
  list.innerHTML = presets.map((p,i) => `
    <div style="display:flex;align-items:center;gap:8px;padding:8px 0;border-bottom:1px solid var(--border)">
      <div style="flex:1">
        <div style="font-size:12px;font-weight:600">${p.name}</div>
        <div style="font-size:10px;color:var(--muted)">${p.fromCo}</div>
      </div>
      <button class="btn btn-outline" style="font-size:10px;padding:4px 10px" onclick="applyPreset(${i})">é©ç”¨</button>
      <button class="btn btn-red" style="font-size:10px;padding:4px 10px" onclick="deletePreset(${i})">å‰Šé™¤</button>
    </div>
  `).join('');
}

function renderSetupPresets() {
  const el = document.getElementById('setup-presets');
  if(!el) return;
  if(!presets.length) {
    el.innerHTML = '<p style="font-size:11px;color:var(--muted)">ãƒ—ãƒªã‚»ãƒƒãƒˆãŒã‚ã‚Šã¾ã›ã‚“ã€‚1ä»¶å°åˆ·ã‚¿ãƒ–ã‹ã‚‰å·®å‡ºäººæƒ…å ±ã‚’ä¿å­˜ã§ãã¾ã™ã€‚</p>';
    return;
  }
  el.innerHTML = presets.map((p,i) => `
    <div style="display:flex;align-items:center;gap:8px;padding:10px;background:var(--bg3);border-radius:8px;margin-bottom:8px">
      <div style="flex:1">
        <div style="font-size:12px;font-weight:600">${p.name}</div>
        <div style="font-size:10px;color:var(--muted)">${p.fromCo} ${p.fromPerson?'/ '+p.fromPerson:''}</div>
        <div style="font-size:10px;color:var(--muted)">${p.fromAddr?.replace(/\n/g,' ')}</div>
      </div>
      <button class="btn btn-red" style="font-size:10px;padding:4px 10px" onclick="deletePreset(${i});renderSetupPresets()">å‰Šé™¤</button>
    </div>
  `).join('');
}

function clearForm() {
  ['to-search','to-name','to-zip','to-addr','tracking-no','label-note'].forEach(id=>{
    const el=document.getElementById(id); if(el) el.value='';
  });
  document.getElementById('to-client-id').value='';
  updatePreview();
}

// â”€ Init â”€
updatePreview();
renderPresets();
renderBatch();

// å·®å‡ºäººãƒ‡ãƒ•ã‚©ãƒ«ãƒˆ
document.getElementById('from-addr').value = 'ã€’160-0023 æ±äº¬éƒ½æ–°å®¿åŒºè¥¿æ–°å®¿2-1-1\nTEL: 03-XXXX-XXXX';
</script>
</body>
</html>
