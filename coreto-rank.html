<!DOCTYPE html>
<html lang="ja">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>CORETO ãƒ©ãƒ³ã‚¯ãƒ€ãƒƒã‚·ãƒ¥ãƒœãƒ¼ãƒ‰</title>
<style>
@import url('https://fonts.googleapis.com/css2?family=Noto+Sans+JP:wght@300;400;500;700&family=DM+Mono:wght@400;500&family=Syne:wght@700;800&display=swap');
*{box-sizing:border-box;margin:0;padding:0}
:root{
  --bg:#07090f;--card:#0f1119;--card2:#141720;--border:#1e2235;--border2:#252a3d;
  --gold:#c9a84c;--gold-l:#e8c96a;--gold-dim:#7a5f22;
  --blue:#4f9cf9;--green:#34d399;--red:#f87171;--orange:#fb923c;--purple:#a78bfa;
  --teal:#2dd4bf;--muted:#4a5270;--sub:#7a849e;--text:#e2e6f3;
  --bronze:#cd7f32;--bronze-bg:rgba(205,127,50,.12);--bronze-bd:rgba(205,127,50,.3);
  --silver:#c0c0c0;--silver-bg:rgba(192,192,192,.1);--silver-bd:rgba(192,192,192,.25);
  --gold-bg:rgba(201,168,76,.12);--gold-bd:rgba(201,168,76,.3);
  --plat:#a78bfa;--plat-bg:rgba(167,139,250,.12);--plat-bd:rgba(167,139,250,.3);
}
body{font-family:'Noto Sans JP',sans-serif;background:var(--bg);color:var(--text);min-height:100vh}

/* â”€ Header â”€ */
.header{display:flex;align-items:center;justify-content:space-between;padding:0 28px;height:54px;
  border-bottom:1px solid var(--border);background:rgba(7,9,15,.9);backdrop-filter:blur(12px);
  position:sticky;top:0;z-index:100}
.logo{font-family:'Syne',sans-serif;font-size:18px;font-weight:800;color:var(--gold);letter-spacing:3px}
.hdr-right{display:flex;align-items:center;gap:14px}
.hdr-name{font-size:13px;font-weight:700}
.hdr-id{font-family:'DM Mono',monospace;font-size:10px;color:var(--muted)}

/* â”€ Body â”€ */
.body{max-width:1280px;margin:0 auto;padding:24px 28px 60px}

/* â”€ Rank Hero â”€ */
.rank-hero{border-radius:20px;padding:32px 36px;margin-bottom:24px;
  overflow:hidden;border:1px solid;position:relative}
.rank-hero::after{content:'';position:absolute;inset:0;pointer-events:none;
  background:radial-gradient(ellipse 60% 80% at 100% 50%,var(--hero-glow,transparent),transparent)}
.rank-hero.bronze{border-color:var(--bronze-bd);background:linear-gradient(135deg,rgba(205,127,50,.08),rgba(7,9,15,0));--hero-glow:rgba(205,127,50,.06)}
.rank-hero.silver{border-color:var(--silver-bd);background:linear-gradient(135deg,rgba(192,192,192,.07),rgba(7,9,15,0));--hero-glow:rgba(192,192,192,.05)}
.rank-hero.gold{border-color:var(--gold-bd);background:linear-gradient(135deg,rgba(201,168,76,.1),rgba(7,9,15,0));--hero-glow:rgba(201,168,76,.08)}
.rank-hero.platinum{border-color:var(--plat-bd);background:linear-gradient(135deg,rgba(167,139,250,.1),rgba(7,9,15,0));--hero-glow:rgba(167,139,250,.08)}
.hero-bg-txt{position:absolute;right:-16px;top:-24px;font-family:'Syne',sans-serif;
  font-size:140px;font-weight:800;opacity:.04;pointer-events:none;line-height:1;user-select:none}

.hero-grid{display:grid;grid-template-columns:auto 1fr auto;gap:32px;align-items:center;position:relative;z-index:1}

/* rank emblem */
.emblem-wrap{display:flex;flex-direction:column;align-items:center;gap:8px}
.emblem{width:84px;height:84px;border-radius:50%;display:flex;align-items:center;
  justify-content:center;font-size:38px;border:2px solid;position:relative}
.emblem.bronze{background:var(--bronze-bg);border-color:var(--bronze-bd)}
.emblem.silver{background:var(--silver-bg);border-color:var(--silver-bd)}
.emblem.gold{background:var(--gold-bg);border-color:var(--gold-bd)}
.emblem.platinum{background:var(--plat-bg);border-color:var(--plat-bd)}
.emblem-label{font-family:'Syne',sans-serif;font-size:12px;font-weight:800;letter-spacing:3px}
.emblem-label.bronze{color:var(--bronze)}
.emblem-label.silver{color:var(--silver)}
.emblem-label.gold{color:var(--gold)}
.emblem-label.platinum{color:var(--plat)}
.perm-badge{font-size:9px;padding:2px 7px;border-radius:3px;font-weight:700;letter-spacing:.5px}
.perm-1yr{background:rgba(52,211,153,.12);color:var(--green);border:1px solid rgba(52,211,153,.25)}
.perm-forever{background:rgba(201,168,76,.15);color:var(--gold);border:1px solid var(--gold-dim)}

/* hero center */
.hero-name{font-size:26px;font-weight:700;margin-bottom:4px}
.hero-sub{font-family:'DM Mono',monospace;font-size:11px;color:var(--muted);margin-bottom:16px}
.hero-stats{display:flex;gap:28px;flex-wrap:wrap}
.hstat{display:flex;flex-direction:column;gap:3px}
.hstat-val{font-family:'DM Mono',monospace;font-size:20px;font-weight:500;line-height:1}
.hstat-label{font-size:9px;color:var(--muted);letter-spacing:.5px}
.hdiv{width:1px;background:var(--border2);align-self:stretch}

/* hero right: points this month */
.pts-box{background:rgba(0,0,0,.3);border:1px solid var(--border2);border-radius:16px;
  padding:18px 20px;min-width:230px}
.pts-title{font-size:9px;color:var(--muted);letter-spacing:2px;text-transform:uppercase;margin-bottom:14px}
.pts-total{display:flex;align-items:baseline;gap:8px;margin-bottom:14px}
.pts-total-val{font-family:'DM Mono',monospace;font-size:40px;font-weight:500;color:var(--gold);line-height:1}
.pts-total-unit{font-size:11px;color:var(--sub)}
.pts-breakdown{display:flex;flex-direction:column;gap:7px}
.pb-row{display:flex;align-items:center;gap-6px;font-size:11px}
.pb-icon{font-size:13px;width:20px;flex-shrink:0}
.pb-label{color:var(--sub);flex:1}
.pb-val{font-family:'DM Mono',monospace;color:var(--text);font-weight:600;min-width:40px;text-align:right}
.pb-bar{height:3px;border-radius:2px;margin-top:3px;transition:width .5s}

/* â”€ Point gauge â”€ */
.pt-gauge-wrap{margin-top:16px;padding-top:14px;border-top:1px solid var(--border2)}
.gauge-track{position:relative;height:10px;background:var(--border2);border-radius:5px;overflow:visible;margin:8px 0}
.gauge-fill{height:100%;border-radius:5px;transition:width .6s cubic-bezier(.4,0,.2,1);position:relative}
.gauge-marks{display:flex;justify-content:space-between;position:relative;margin-top:4px}
.gauge-mark{font-size:9px;color:var(--muted);font-family:'DM Mono',monospace}
.gauge-needle{position:absolute;top:-5px;width:2px;height:20px;border-radius:1px;background:white;
  transform:translateX(-50%);transition:left .6s cubic-bezier(.4,0,.2,1);z-index:2}
.gauge-zones{display:flex;gap:0;margin-top:3px}
.gz{flex:1;text-align:center;font-size:8px;padding:2px 0;border-radius:2px;font-weight:700}

/* â”€ Tabs â”€ */
.tabs{display:flex;gap:2px;border-bottom:1px solid var(--border);margin-bottom:20px}
.tab{padding:9px 18px;font-size:11px;font-weight:600;cursor:pointer;color:var(--muted);
  border-bottom:2px solid transparent;transition:all .15s;letter-spacing:.5px;white-space:nowrap}
.tab.on{color:var(--gold);border-bottom-color:var(--gold)}
.tab:hover:not(.on){color:var(--sub)}
.tp{display:none}.tp.on{display:block}

/* â”€ Grid â”€ */
.g2{display:grid;grid-template-columns:1fr 1fr;gap:16px;margin-bottom:16px}
.g3{display:grid;grid-template-columns:repeat(3,1fr);gap:16px;margin-bottom:16px}

/* â”€ Card â”€ */
.card{background:var(--card);border:1px solid var(--border);border-radius:14px;padding:20px}
.card-t{font-size:9px;color:var(--muted);letter-spacing:2px;text-transform:uppercase;
  margin-bottom:16px;display:flex;align-items:center;gap:8px}
.card-t::before{content:'';width:3px;height:12px;background:var(--gold);border-radius:2px}

/* â”€ Rank road â”€ */
.rank-road{display:grid;grid-template-columns:repeat(4,1fr);gap:6px}
.rr-node{background:var(--card2);border-radius:12px;padding:14px;text-align:center;
  border:1px solid var(--border2);position:relative;transition:all .2s}
.rr-node.current{border-color:var(--node-color,var(--gold));box-shadow:0 0 0 3px var(--node-glow,rgba(201,168,76,.1))}
.rr-icon{font-size:28px;margin-bottom:6px}
.rr-name{font-size:11px;font-weight:800;letter-spacing:2px;margin-bottom:4px}
.rr-pts{font-family:'DM Mono',monospace;font-size:11px;color:var(--sub);margin-bottom:6px}
.rr-rate-re{font-size:10px;margin-bottom:1px}
.rr-rate-hr{font-size:10px;margin-bottom:4px}
.rr-fee{font-size:9px;color:var(--muted)}
.rr-mentor{font-size:9px;color:var(--green);margin-top:3px}
.cur-chip{position:absolute;top:-9px;left:50%;transform:translateX(-50%);
  background:var(--gold);color:#0a0c10;font-size:8px;font-weight:800;
  padding:2px 8px;border-radius:4px;white-space:nowrap}
.rr-node.locked{opacity:.35}
.rr-node.achieved{border-color:rgba(52,211,153,.3)}

/* â”€ Stability tracker â”€ */
.stability-card{padding:0;overflow:hidden}
.stab-hd{padding:18px 20px 14px;border-bottom:1px solid var(--border)}
.stab-grid{display:grid;grid-template-columns:1fr 1fr;gap:0}
.stab-col{padding:16px 20px}
.stab-col:first-child{border-right:1px solid var(--border)}
.stab-col-title{font-size:9px;color:var(--muted);letter-spacing:1.5px;text-transform:uppercase;margin-bottom:12px}
.stab-progress{display:flex;align-items:center;gap:10px;margin-bottom:10px}
.stab-num{font-family:'DM Mono',monospace;font-size:28px;font-weight:500;line-height:1}
.stab-denom{font-size:12px;color:var(--sub);margin-top:2px}
.stab-bar{flex:1;background:var(--border2);height:6px;border-radius:3px;overflow:hidden}
.stab-bar-fill{height:100%;border-radius:3px;transition:width .6s}
.stab-label{font-size:11px;color:var(--sub);line-height:1.7}
.stab-reward{font-size:10px;color:var(--green);margin-top:6px;font-weight:600}

/* â”€ Month history table â”€ */
.month-table{width:100%;border-collapse:collapse;font-size:11px}
.month-table th{padding:7px 10px;font-size:9px;color:var(--muted);font-weight:600;
  border-bottom:1px solid var(--border);text-align:left;white-space:nowrap}
.month-table td{padding:8px 10px;border-bottom:1px solid rgba(30,34,53,.5);vertical-align:middle}
.month-table tr:last-child td{border:none}
.month-table tr.cur td{background:rgba(79,156,249,.05)}
.mono{font-family:'DM Mono',monospace}
.rank-chip{display:inline-flex;padding:2px 8px;border-radius:4px;font-size:9px;font-weight:800;letter-spacing:1px}
.rc-bronze{background:var(--bronze-bg);color:var(--bronze);border:1px solid var(--bronze-bd)}
.rc-silver{background:var(--silver-bg);color:var(--silver);border:1px solid var(--silver-bd)}
.rc-gold{background:var(--gold-bg);color:var(--gold);border:1px solid var(--gold-bd)}
.rc-platinum{background:var(--plat-bg);color:var(--plat);border:1px solid var(--plat-bd)}

/* â”€ Mentor â”€ */
.mentor-row{display:flex;align-items:center;gap:12px;background:var(--card2);
  border-radius:10px;padding:12px 14px;margin-bottom:8px}
.m-avatar{width:38px;height:38px;border-radius:50%;display:flex;align-items:center;
  justify-content:center;font-size:18px;flex-shrink:0}
.m-info{flex:1}
.m-name{font-size:12px;font-weight:700}
.m-rank-badge{display:inline-block;font-size:8px;font-weight:800;padding:1px 6px;
  border-radius:3px;margin-top:2px;letter-spacing:1px}
.m-right{text-align:right}
.m-reward{font-family:'DM Mono',monospace;font-size:13px;color:var(--green);font-weight:600}
.m-pts{font-size:10px;color:var(--muted);margin-top:2px}

/* â”€ Simulator â”€ */
.sim-rb{padding:6px 14px;border-radius:7px;font-size:11px;font-weight:700;margin-right:5px;margin-bottom:5px;
  border:1px solid var(--border2);background:transparent;color:var(--muted);
  cursor:pointer;font-family:'Noto Sans JP',sans-serif;transition:all .15s;display:inline-block}
.sim-rb.on{background:rgba(201,168,76,.12);border-color:var(--gold-dim);color:var(--gold)}
.rt-row{display:flex;justify-content:space-between;align-items:center;
  padding:7px 0;border-bottom:1px solid rgba(30,34,53,.6);font-size:12px}
.rt-row:last-child{border:none;padding-top:10px;font-weight:700}
.rt-key{color:var(--sub)}
.rt-val{font-family:'DM Mono',monospace}
.rt-minus{color:var(--red)}

/* â”€ Compare grid â”€ */
.cmp-grid{display:grid;grid-template-columns:repeat(4,1fr);gap:6px;margin-top:12px}
.cmp-cell{background:var(--card2);border-radius:9px;padding:12px;text-align:center;
  border:1px solid var(--border2)}
.cmp-cell.cur{border-color:var(--gold-bd);background:var(--gold-bg)}

/* â”€ Misc â”€ */
.alert-box{border-radius:9px;padding:10px 14px;font-size:11px;line-height:1.8;margin-bottom:12px}
.ab-info{background:rgba(79,156,249,.06);border:1px solid rgba(79,156,249,.2);color:var(--blue)}
.ab-warn{background:rgba(251,146,60,.06);border:1px solid rgba(251,146,60,.2);color:var(--orange)}
.ab-ok{background:rgba(52,211,153,.06);border:1px solid rgba(52,211,153,.2);color:var(--green)}
.tag{display:inline-block;font-size:9px;padding:1px 6px;border-radius:3px;font-weight:700}

::-webkit-scrollbar{width:4px}::-webkit-scrollbar-thumb{background:var(--border2);border-radius:2px}

/* â”€â”€ ç´¹ä»‹ãƒªãƒ³ã‚¯ãƒ¢ãƒ¼ãƒ€ãƒ« â”€â”€ */
#ref-modal-overlay{display:none;position:fixed;inset:0;background:rgba(0,0,0,.65);z-index:9000;align-items:center;justify-content:center}
#ref-modal-overlay.open{display:flex}
#ref-modal{background:var(--card);border:1px solid var(--border2);border-radius:16px;padding:0;width:min(460px,92vw);overflow:hidden}
.ref-mhdr{padding:16px 20px;border-bottom:1px solid var(--border);display:flex;align-items:center;justify-content:space-between}
.ref-mhdr-t{font-family:'Syne',sans-serif;font-size:14px;font-weight:800;color:var(--gold)}
.ref-mbody{padding:20px}
.ref-url{background:var(--card2);border:1px solid var(--border2);border-radius:8px;padding:10px 12px;font-family:'DM Mono',monospace;font-size:11px;color:var(--sub);word-break:break-all;margin:10px 0;min-height:36px}
.ref-copy-btn{width:100%;padding:10px;border-radius:8px;border:none;cursor:pointer;font-family:inherit;font-size:13px;font-weight:700;background:var(--gold);color:#0a0c10;margin-top:4px}
.ref-copy-btn:hover{opacity:.9}

/* â”€â”€ ç´¹ä»‹ãƒªãƒ³ã‚¯ å·¦ãƒ•ãƒ­ãƒ¼ãƒ†ã‚£ãƒ³ã‚°ãƒœã‚¿ãƒ³ â”€â”€ */
#ref-float-btn {
  position: fixed;
  left: 0;
  top: 50%;
  transform: translateY(-50%) translateX(-100%) rotate(-90deg);
  transform-origin: right bottom;
  z-index: 8000;
  background: rgba(201,168,76,.18);
  border: 1px solid rgba(201,168,76,.4);
  border-bottom: none;
  border-radius: 8px 8px 0 0;
  color: var(--gold);
  padding: 6px 16px;
  font-size: 11px;
  font-weight: 700;
  font-family: inherit;
  cursor: pointer;
  white-space: nowrap;
  letter-spacing: .5px;
  transition: background .15s;
}
#ref-float-btn:hover { background: rgba(201,168,76,.32); }
</style>
</head>
<body>

<div class="header">
  <div style="display:flex;align-items:center;gap:12px">
    <div class="logo">CORETO</div>
    <div style="width:1px;height:18px;background:var(--border2)"></div>
    <div style="font-size:10px;color:var(--muted);letter-spacing:1px">ãƒ©ãƒ³ã‚¯ãƒ€ãƒƒã‚·ãƒ¥ãƒœãƒ¼ãƒ‰</div>
  </div>
  <div class="hdr-right">
    <div>
      <div class="hdr-name" id="hdr-name">â€”</div>
      <div class="hdr-id" id="hdr-id">â€”</div>
    </div>
    <button onclick="history.back()"
      style="font-size:10px;padding:5px 12px;border-radius:6px;border:1px solid var(--border2);
      background:transparent;color:var(--muted);cursor:pointer;font-family:'Noto Sans JP',sans-serif">
      â† æˆ»ã‚‹
    </button>
  </div>
</div>

<div class="body">

<!-- â‘  Rank Hero -->
<div class="rank-hero" id="rank-hero">
  <div class="hero-bg-txt" id="hero-bg-txt"></div>
  <div class="hero-grid">

    <!-- å·¦ï¼šãƒ©ãƒ³ã‚¯ -->
    <div class="emblem-wrap">
      <div class="emblem" id="emblem"></div>
      <div class="emblem-label" id="emblem-label"></div>
      <div id="perm-badge"></div>
    </div>

    <!-- ä¸­ï¼šåŸºæœ¬æƒ…å ± -->
    <div>
      <div class="hero-name" id="hero-name">â€”</div>
      <div class="hero-sub" id="hero-sub">â€”</div>
      <div class="hero-stats">
        <div class="hstat">
          <div class="hstat-val" id="hs-rate" style="color:var(--gold)">â€”</div>
          <div class="hstat-label">å ±é…¬ç‡ï¼ˆä¸å‹•ç”£ï¼‰</div>
        </div>
        <div class="hdiv"></div>
        <div class="hstat">
          <div class="hstat-val" id="hs-rate-hr">â€”</div>
          <div class="hstat-label">å ±é…¬ç‡ï¼ˆäººæï¼‰</div>
        </div>
        <div class="hdiv"></div>
        <div class="hstat">
          <div class="hstat-val" id="hs-mentor-rate" style="color:var(--green)">â€”</div>
          <div class="hstat-label">ãƒ¡ãƒ³ã‚¿ãƒ¼å ±é…¬ç‡</div>
        </div>
        <div class="hdiv"></div>
        <div class="hstat">
          <div class="hstat-val" id="hs-fee">â€”</div>
          <div class="hstat-label">æœˆä¼šè²»</div>
        </div>
        <div class="hdiv"></div>
        <div class="hstat">
          <div class="hstat-val" id="hs-cum-pts">â€”</div>
          <div class="hstat-label">ç´¯è¨ˆæˆç´„ä»¶æ•°</div>
        </div>
      </div>
    </div>

    <!-- å³ï¼šä»Šæœˆãƒã‚¤ãƒ³ãƒˆ -->
    <div class="pts-box">
      <div class="pts-title">ä»Šæœˆã®ãƒã‚¤ãƒ³ãƒˆ</div>
      <div class="pts-total">
        <div class="pts-total-val" id="pts-total">â€”</div>
        <div class="pts-total-unit">pt</div>
      </div>
      <div class="pts-breakdown" id="pts-breakdown"></div>

      <!-- ã‚²ãƒ¼ã‚¸ -->
      <div class="pt-gauge-wrap">
        <div style="font-size:9px;color:var(--muted);margin-bottom:6px">ãƒ©ãƒ³ã‚¯å¸¯</div>
        <div class="gauge-track">
          <div class="gauge-fill" id="gauge-fill"></div>
          <div class="gauge-needle" id="gauge-needle"></div>
        </div>
        <div class="gauge-marks">
          <span class="gauge-mark">0</span>
          <span class="gauge-mark">10</span>
          <span class="gauge-mark">20</span>
          <span class="gauge-mark">30</span>
          <span class="gauge-mark">40+</span>
        </div>
        <div class="gauge-zones" style="margin-top:4px;gap:4px">
          <div class="gz" style="background:var(--bronze-bg);color:var(--bronze);flex:10">Bronze<br><span style="font-size:7px;font-weight:400">ã€œ9</span></div>
          <div class="gz" style="background:var(--silver-bg);color:var(--silver);flex:10">Silver<br><span style="font-size:7px;font-weight:400">10ã€œ19</span></div>
          <div class="gz" style="background:var(--gold-bg);color:var(--gold);flex:10">Gold<br><span style="font-size:7px;font-weight:400">20ã€œ29</span></div>
          <div class="gz" style="background:var(--plat-bg);color:var(--plat);flex:10">Platinum<br><span style="font-size:7px;font-weight:400">30+</span></div>
        </div>
        <div style="font-size:10px;margin-top:8px" id="gauge-label"></div>
      </div>
    </div>
  </div>
</div><!-- /rank-hero -->

<!-- Tabs -->
<div class="tabs">
  <div class="tab on" onclick="switchTab(0,this)">ğŸ“Š ã‚µãƒãƒªãƒ¼</div>
  <div class="tab" onclick="switchTab(1,this)">ğŸ“… æœˆæ¬¡ãƒã‚¤ãƒ³ãƒˆå±¥æ­´</div>
  <div class="tab" onclick="switchTab(2,this)">ğŸ”’ ãƒ©ãƒ³ã‚¯ä¿è¨¼</div>
  <div class="tab" onclick="switchTab(3,this)">ğŸ“ ãƒ¡ãƒ³ã‚¿ãƒ¼</div>
  <div class="tab" onclick="switchTab(4,this)">ğŸ’° ã‚·ãƒŸãƒ¥ãƒ¬ãƒ¼ã‚¿ãƒ¼</div>
</div>

<!-- â”€ TAB 0: ã‚µãƒãƒªãƒ¼ â”€ -->
<div class="tp on" id="tp-0">
  <div class="g2">
    <!-- ãƒ©ãƒ³ã‚¯ãƒ­ãƒ¼ãƒ‰ -->
    <div class="card" style="grid-column:span 2">
      <div class="card-t">ãƒ©ãƒ³ã‚¯ãƒ­ãƒ¼ãƒ‰ ï¼ ãƒã‚¤ãƒ³ãƒˆåˆ¶</div>
      <div class="rank-road" id="rank-road"></div>
      <div class="alert-box ab-info" style="margin-top:14px;margin-bottom:0">
        ğŸ“Œ <strong>ãƒã‚¤ãƒ³ãƒˆè¨ˆç®—ï¼š</strong>
        ä»²ä»‹æ‰‹æ•°æ–™ <strong>Â¥10ä¸‡ã”ã¨ï¼‹1pt</strong>ã€€æ¡ˆä»¶å®Œé‚ <strong>1ä»¶ï¼‹1pt</strong>ã€€ãƒ¡ãƒ³ã‚¿ãƒ¼å ±é…¬ <strong>Â¥5,000ã”ã¨ï¼‹1pt</strong>
        ã€€ï½œã€€åˆ¤å®šï¼š<strong>æœˆæœ«</strong>ã€€â†’ã€€ç¿Œæœˆãƒ©ãƒ³ã‚¯ç¢ºå®š
      </div>
    </div>
  </div>

  <div class="g3">
    <!-- ä»Šæœˆå®Ÿç¸¾ -->
    <div class="card">
      <div class="card-t">ä»Šæœˆã®å®Ÿç¸¾</div>
      <div style="display:flex;flex-direction:column;gap:10px" id="cur-stats"></div>
    </div>
    <!-- ç›´è¿‘6ãƒ¶æœˆ -->
    <div class="card" style="grid-column:span 2">
      <div class="card-t">ç›´è¿‘6ãƒ¶æœˆã®ãƒã‚¤ãƒ³ãƒˆæ¨ç§»</div>
      <div id="mini-bars"></div>
    </div>
  </div>
</div>

<!-- â”€ TAB 1: æœˆæ¬¡å±¥æ­´ â”€ -->
<div class="tp" id="tp-1">
  <div class="card">
    <div class="card-t">æœˆæ¬¡ãƒã‚¤ãƒ³ãƒˆå±¥æ­´ï¼ˆç›´è¿‘12ãƒ¶æœˆï¼‰</div>
    <div class="alert-box ab-info" style="margin-bottom:14px">
      ğŸ’¡ æ‰‹æ•°æ–™ãƒã‚¤ãƒ³ãƒˆï¼æ‰‹æ•°æ–™åˆè¨ˆ Ã· Â¥10ä¸‡ï¼ˆåˆ‡ã‚Šæ¨ã¦ï¼‰ã€€æ¡ˆä»¶ãƒã‚¤ãƒ³ãƒˆï¼å®Œé‚ä»¶æ•°ã€€ãƒ¡ãƒ³ã‚¿ãƒ¼ãƒã‚¤ãƒ³ãƒˆï¼ãƒ¡ãƒ³ã‚¿ãƒ¼å ±é…¬ Ã· Â¥5,000ï¼ˆåˆ‡ã‚Šæ¨ã¦ï¼‰
    </div>
    <div style="overflow-x:auto">
      <table class="month-table" id="history-table"></table>
    </div>
  </div>
</div>

<!-- â”€ TAB 2: ãƒ©ãƒ³ã‚¯ä¿è¨¼ â”€ -->
<div class="tp" id="tp-2">
  <div class="g2">
    <div class="card stability-card">
      <div class="stab-hd">
        <div class="card-t" style="margin-bottom:4px">ãƒ©ãƒ³ã‚¯ä¿è¨¼ã‚·ã‚¹ãƒ†ãƒ </div>
        <div style="font-size:11px;color:var(--sub);line-height:1.7">
          åŒãƒ©ãƒ³ã‚¯ä»¥ä¸Šã‚’ç¶™ç¶šç¶­æŒã™ã‚‹ã“ã¨ã§æ®µéšçš„ãªä¿è¨¼ãŒä»˜ä¸ã•ã‚Œã¾ã™<br>
          <span style="color:var(--green);font-weight:600">6ãƒ¶æœˆç¶™ç¶š</span> â†’ 1å¹´é–“ãƒ©ãƒ³ã‚¯ä¿è¨¼ã€€ï¼ã€€
          <span style="color:var(--gold);font-weight:600">3å¹´ç¶™ç¶š</span> â†’ <strong style="color:var(--gold)">Lifetimeä¼šå“¡ï¼ˆæ°¸ä¹…ä¿è¨¼ï¼‰</strong>
        </div>
      </div>
      <div class="stab-grid">
        <div class="stab-col">
          <div class="stab-col-title">ğŸ“… 6ãƒ¶æœˆç¶™ç¶šé”æˆ</div>
          <div style="font-size:10px;color:var(--green);font-weight:600;margin-bottom:10px">â†’ ç¾åœ¨ãƒ©ãƒ³ã‚¯ã‚’<strong>1å¹´é–“ä¿è¨¼</strong></div>
          <div class="stab-progress">
            <div>
              <div class="stab-num" id="stab-6m-cur" style="color:var(--green)">â€”</div>
              <div class="stab-denom">/ 6ãƒ¶æœˆ</div>
            </div>
            <div style="flex:1">
              <div class="stab-bar"><div class="stab-bar-fill" id="stab-6m-bar" style="background:var(--green)"></div></div>
            </div>
          </div>
          <div class="stab-label" id="stab-6m-label">â€”</div>
          <div class="stab-reward" id="stab-6m-reward"></div>
        </div>
        <div class="stab-col">
          <div class="stab-col-title">ğŸ† 3å¹´ç¶™ç¶šé”æˆ</div>
          <div style="font-size:10px;color:var(--gold);font-weight:600;margin-bottom:10px">â†’ <strong>Lifetimeä¼šå“¡ï¼ˆæ°¸ä¹…ä¿è¨¼ï¼‰</strong></div>
          <div class="stab-progress">
            <div>
              <div class="stab-num" id="stab-3y-cur" style="color:var(--gold)">â€”</div>
              <div class="stab-denom">/ 36ãƒ¶æœˆ</div>
            </div>
            <div style="flex:1">
              <div class="stab-bar"><div class="stab-bar-fill" id="stab-3y-bar" style="background:var(--gold)"></div></div>
            </div>
          </div>
          <div class="stab-label" id="stab-3y-label">â€”</div>
          <div class="stab-reward" id="stab-3y-reward"></div>
        </div>
      </div>
    </div>

    <div class="card">
      <div class="card-t">ä¿è¨¼ãƒ«ãƒ¼ãƒ«ã®è©³ç´°</div>
      <div style="display:flex;flex-direction:column;gap:10px;font-size:11px">
        <div style="background:var(--card2);border-radius:9px;padding:13px;border-left:2px solid var(--green)">
          <div style="font-weight:700;color:var(--green);margin-bottom:5px">ğŸ“… 6ãƒ¶æœˆç¶™ç¶šé”æˆ</div>
          <div style="color:var(--sub);line-height:1.9">
            åŒãƒ©ãƒ³ã‚¯ä»¥ä¸Šã‚’6ãƒ¶æœˆé€£ç¶šã§ç¶­æŒã™ã‚‹ã¨<br>
            é”æˆã—ãŸç¿Œæœˆã‹ã‚‰ <strong style="color:var(--text)">1å¹´é–“</strong> ãã®ãƒ©ãƒ³ã‚¯ãŒä¿è¨¼ã•ã‚Œã¾ã™ã€‚<br>
            ä¿è¨¼æœŸé–“ä¸­ã¯ãƒã‚¤ãƒ³ãƒˆãŒä¸‹å›ã£ã¦ã‚‚ãƒ©ãƒ³ã‚¯ã‚’ç¶­æŒã€‚
          </div>
        </div>
        <div style="background:var(--card2);border-radius:9px;padding:13px;border-left:2px solid var(--gold)">
          <div style="font-weight:700;color:var(--gold);margin-bottom:5px">ğŸ† 3å¹´ç¶™ç¶šé”æˆ</div>
          <div style="color:var(--sub);line-height:1.9">
            åŒãƒ©ãƒ³ã‚¯ä»¥ä¸Šã‚’36ãƒ¶æœˆé€£ç¶šã§ç¶­æŒã™ã‚‹ã¨<br>
            <strong style="color:var(--gold)">æ°¸ä¹…ã«ãã®ãƒ©ãƒ³ã‚¯ãŒä¿è¨¼</strong> ã•ã‚Œã¾ã™ã€‚<br>
            ãƒã‚¤ãƒ³ãƒˆã«é–¢ã‚ã‚‰ãšã€ãƒ©ãƒ³ã‚¯ã¯å¤‰å‹•ã—ã¾ã›ã‚“ã€‚
          </div>
        </div>
        <div style="background:var(--card2);border-radius:9px;padding:13px">
          <div style="font-weight:700;margin-bottom:5px">ğŸ“ ä¿è¨¼ã®ä¸Šä½äº’æ›</div>
          <div style="color:var(--sub);line-height:1.9">
            Goldã§1å¹´ä¿è¨¼å–å¾—å¾Œã«Platinumã‚’é”æˆã—ãŸå ´åˆã€<br>
            Platinumç¶™ç¶šã®ã‚«ã‚¦ãƒ³ãƒˆãŒæ–°ãŸã«ã‚¹ã‚¿ãƒ¼ãƒˆã—ã¾ã™ã€‚<br>
            ä¸Šä½ãƒ©ãƒ³ã‚¯ã‚’é”æˆã™ã‚‹ã»ã©ä¿è¨¼ã‚‚å¼·å›ºã«ãªã‚Šã¾ã™ã€‚
          </div>
        </div>
      </div>
    </div>
  </div>

  <div class="card">
    <div class="card-t">ãƒ©ãƒ³ã‚¯ä¿è¨¼ æœˆåˆ¥å±¥æ­´</div>
    <div style="overflow-x:auto">
      <table class="month-table" id="stab-table"></table>
    </div>
  </div>
</div>

<!-- â”€ TAB 3: ãƒ¡ãƒ³ã‚¿ãƒ¼ â”€ -->
<div class="tp" id="tp-3">
  <div class="g2">
    <div class="card">
      <div class="card-t">è‚²æˆã‚¨ãƒ¼ã‚¸ã‚§ãƒ³ãƒˆä¸€è¦§</div>
      <div id="mentor-list"></div>
      <div style="margin-top:12px;padding:12px 14px;background:var(--card2);
                  border-radius:9px;font-size:10px;color:var(--sub)">
        âœ… ãƒ¡ãƒ³ã‚¿ãƒ¼ç™»éŒ²ã¯æœ¬éƒ¨ã¸ç”³è«‹ã€‚è‚²æˆã‚¨ãƒ¼ã‚¸ã‚§ãƒ³ãƒˆã®æˆç´„ã”ã¨ã«ãƒ¡ãƒ³ã‚¿ãƒ¼å ±é…¬ãŒä»˜ä¸ã•ã‚Œã€<br>
        å ±é…¬Ã·Â¥5,000ã®ãƒã‚¤ãƒ³ãƒˆãŒ <strong style="color:var(--text)">ã‚ãªãŸã®ãƒã‚¤ãƒ³ãƒˆã«åŠ ç®—</strong> ã•ã‚Œã¾ã™ã€‚
      </div>
    </div>
    <div class="card">
      <div class="card-t">ãƒ¡ãƒ³ã‚¿ãƒ¼å ±é…¬ç‡ï¼ˆãƒ©ãƒ³ã‚¯åˆ¥ï¼‰</div>
      <div style="display:flex;flex-direction:column;gap:8px" id="mentor-rate-table"></div>
      <div style="margin-top:14px;padding:12px 14px;background:var(--card2);
                  border-radius:9px;font-size:11px;color:var(--sub)">
        <div style="font-weight:700;color:var(--text);margin-bottom:5px">è¨ˆç®—ä¾‹ï¼ˆGold / 7%ã®å ´åˆï¼‰</div>
        è‚²æˆã‚¨ãƒ¼ã‚¸ã‚§ãƒ³ãƒˆã®ä»²ä»‹æ‰‹æ•°æ–™ <span style="color:var(--text)">Â¥300,000</span><br>
        â†’ ãƒ¡ãƒ³ã‚¿ãƒ¼å ±é…¬ï¼šÂ¥300,000 Ã— <span style="color:var(--green);font-weight:700">7% = Â¥21,000</span><br>
        â†’ ãƒã‚¤ãƒ³ãƒˆåŠ ç®—ï¼šÂ¥21,000 Ã· Â¥5,000 = <span style="color:var(--gold);font-weight:700">4pt</span>
      </div>
    </div>
  </div>
</div>

<!-- â”€ TAB 4: ã‚·ãƒŸãƒ¥ãƒ¬ãƒ¼ã‚¿ãƒ¼ â”€ -->
<div class="tp" id="tp-4">
  <div class="g2">
    <div class="card">
      <div class="card-t">ãƒã‚¤ãƒ³ãƒˆï¼†å ±é…¬ã‚·ãƒŸãƒ¥ãƒ¬ãƒ¼ã‚¿ãƒ¼</div>

      <div style="margin-bottom:14px">
        <div style="font-size:11px;color:var(--sub);margin-bottom:7px">ã‚·ãƒŸãƒ¥ãƒ¬ãƒ¼ã‚·ãƒ§ãƒ³å¯¾è±¡ãƒ©ãƒ³ã‚¯</div>
        <div id="sim-rank-btns" style="display:flex;flex-wrap:wrap;gap:4px"></div>
      </div>

      <div style="margin-bottom:12px">
        <label style="font-size:11px;color:var(--sub);display:block;margin-bottom:5px">æœˆã®æˆç´„ä»¶æ•°</label>
        <input type="number" id="sim-cases" value="5" min="0" max="30" oninput="updateSim()"
          style="width:100%;background:#0a0c14;border:1px solid var(--border2);border-radius:8px;
          padding:9px 12px;color:var(--text);font-size:14px;font-family:'DM Mono',monospace">
      </div>
      <div style="margin-bottom:12px">
        <label style="font-size:11px;color:var(--sub);display:block;margin-bottom:5px">
          é€šå¸¸æ¡ˆä»¶ æ‰‹æ•°æ–™<span style="color:var(--blue);font-size:10px;margin-left:6px">10ä¸‡å††â†’1pt</span>
        </label>
        <input type="number" id="sim-fee" value="1500000" min="0" oninput="updateSim()"
          style="width:100%;background:#0a0c14;border:1px solid var(--border2);border-radius:8px;
          padding:9px 12px;color:var(--text);font-size:14px;font-family:'DM Mono',monospace">
      </div>
      <div style="margin-bottom:12px">
        <label style="font-size:11px;color:var(--sub);display:block;margin-bottom:5px">
          ãƒ‘ãƒ¼ãƒˆãƒŠãƒ¼æ¡ˆä»¶ æ‰‹æ•°æ–™<span style="color:var(--orange);font-size:10px;margin-left:6px">10ä¸‡å††â†’0.5ptï¼ˆPTã¨æŠ˜åŠï¼‰</span>
        </label>
        <input type="number" id="sim-fee-pt" value="0" min="0" oninput="updateSim()"
          style="width:100%;background:#0a0c14;border:1px solid rgba(251,146,60,.25);border-radius:8px;
          padding:9px 12px;color:var(--text);font-size:14px;font-family:'DM Mono',monospace">
      </div>
      <div style="margin-bottom:12px">
        <label style="font-size:11px;color:var(--sub);display:block;margin-bottom:5px">
          ãƒ¡ãƒ³ã‚¿ãƒ¼å ±é…¬åˆè¨ˆ<span style="color:var(--muted);font-size:10px;margin-left:6px">Â¥5,000ã”ã¨ã«0.5pt</span>
        </label>
        <input type="number" id="sim-mentor" value="0" min="0" oninput="updateSim()"
          style="width:100%;background:#0a0c14;border:1px solid var(--border2);border-radius:8px;
          padding:9px 12px;color:var(--text);font-size:14px;font-family:'DM Mono',monospace">
      </div>
      <div style="margin-bottom:14px;display:flex;gap:8px;align-items:center">
        <input type="checkbox" id="sim-sanmei" onchange="updateSim()" style="width:16px;height:16px">
        <label for="sim-sanmei" style="font-size:11px;color:var(--sub);cursor:pointer">ä¸‰ç‚ºå–å¼•ã‚’å«ã‚€ï¼ˆå ±é…¬ç‡ âˆ’15%ï¼‰</label>
      </div>
    </div>

    <div class="card">
      <div class="card-t">ã‚·ãƒŸãƒ¥ãƒ¬ãƒ¼ã‚·ãƒ§ãƒ³çµæœ</div>

      <!-- ãƒã‚¤ãƒ³ãƒˆçµæœ -->
      <div style="background:var(--card2);border-radius:12px;padding:16px;margin-bottom:14px">
        <div style="font-size:9px;color:var(--muted);letter-spacing:1px;margin-bottom:10px">ä»Šæœˆã®ãƒã‚¤ãƒ³ãƒˆå†…è¨³</div>
        <div id="sim-pt-breakdown" style="display:flex;flex-direction:column;gap:6px;margin-bottom:12px"></div>
        <div style="display:flex;align-items:baseline;gap:8px;padding-top:10px;border-top:1px solid var(--border2)">
          <div id="sim-pt-total" style="font-family:'DM Mono',monospace;font-size:32px;color:var(--gold);font-weight:500">â€”</div>
          <div style="font-size:12px;color:var(--sub)">pt â†’ æ¥æœˆãƒ©ãƒ³ã‚¯ï¼š<strong id="sim-next-rank" style="color:var(--text)">â€”</strong></div>
        </div>
      </div>

      <!-- å ±é…¬çµæœ -->
      <div style="font-size:9px;color:var(--muted);letter-spacing:1px;margin-bottom:8px">å ±é…¬è¨ˆç®—</div>
      <div id="sim-reward-breakdown"></div>

      <!-- 4ãƒ©ãƒ³ã‚¯æ¯”è¼ƒ -->
      <div style="font-size:9px;color:var(--muted);letter-spacing:1px;margin:14px 0 8px">ãƒ©ãƒ³ã‚¯åˆ¥ æ‰‹å–ã‚Šæ¯”è¼ƒ</div>
      <div class="cmp-grid" id="sim-compare"></div>
    </div>
  </div>
</div>

</div><!-- /body -->
<script>
// ================================================================
//  Config & Data
// ================================================================
const _S = (()=>{try{return JSON.parse(sessionStorage.getItem('coreto_session')||'null')}catch{return null}})();

const AGENT = {
  id:   (_S&&_S.agId)    || '10012',
  name: (_S&&_S.name)    || 'å±±ç”° èª ',
  rank: (_S&&_S.rankKey) || 'gold',
  type: (_S&&_S.type)    || 're',
};

// ãƒ©ãƒ³ã‚¯å®šç¾©
const RANKS = {
  bronze:  { label:'BRONZE',  icon:'ğŸ¥‰', color:'var(--bronze)', bg:'var(--bronze-bg)', bd:'var(--bronze-bd)',
             rateRE:.65, rateHR:.45, fee:980,  mentorRate:.05, ptsMin:0,  ptsMax:9  },
  silver:  { label:'SILVER',  icon:'ğŸ¥ˆ', color:'var(--silver)', bg:'var(--silver-bg)', bd:'var(--silver-bd)',
             rateRE:.675,rateHR:.475,fee:490,  mentorRate:.06, ptsMin:10, ptsMax:19 },
  gold:    { label:'GOLD',    icon:'ğŸ¥‡', color:'var(--gold)',   bg:'var(--gold-bg)',   bd:'var(--gold-bd)',
             rateRE:.70, rateHR:.50, fee:0,    mentorRate:.07, ptsMin:20, ptsMax:29 },
  platinum:{ label:'PLATINUM',icon:'ğŸ’', color:'var(--plat)',  bg:'var(--plat-bg)',   bd:'var(--plat-bd)',
             rateRE:.75, rateHR:.55, fee:0,    mentorRate:.08, ptsMin:30, ptsMax:999},
};
const RANK_ORDER = ['bronze','silver','gold','platinum'];
const yen = v=>'Â¥'+Math.round(v).toLocaleString();

// ãƒã‚¤ãƒ³ãƒˆè¨ˆç®—é–¢æ•°
// feePT: ãƒ‘ãƒ¼ãƒˆãƒŠãƒ¼æ¡ˆä»¶ã®æ‰‹æ•°æ–™ï¼ˆ10ä¸‡â†’0.5ptï¼‰
// fee:   é€šå¸¸æ¡ˆä»¶ã®æ‰‹æ•°æ–™ï¼ˆ10ä¸‡â†’1ptï¼‰
// mentorReward: ãƒ¡ãƒ³ã‚¿ãƒ¼å ±é…¬ï¼ˆ5000å††â†’0.5ptï¼‰
// å…¨äº‹æ¥­ç¨®ãƒ»å…¨æ¡ˆä»¶ã‚¿ã‚¤ãƒ—ã®ãƒã‚¤ãƒ³ãƒˆã¯åˆç®—
function calcPoints(cases, fee, mentorReward, feePT) {
  feePT = feePT || 0;
  const feeP_normal = Math.floor(fee   / 100000);          // é€šå¸¸: 1pt/10ä¸‡
  const feeP_pt     = Math.floor(feePT / 100000) * 0.5;    // PTæ¡ˆä»¶: 0.5pt/10ä¸‡
  const feeP        = feeP_normal + feeP_pt;
  const caseP       = cases;
  const mentorP     = Math.floor(mentorReward / 5000) * 0.5; // 0.5pt/5000å††
  const total       = feeP + caseP + mentorP;
  return { feeP, feeP_normal, feeP_pt, caseP, mentorP, total };
}

function rankFromPts(pts) {
  if (pts >= 30) return 'platinum';
  if (pts >= 20) return 'gold';
  if (pts >= 10) return 'silver';
  return 'bronze';
}

// â”€ æœˆæ¬¡ãƒ‡ãƒ¢ãƒ‡ãƒ¼ã‚¿ï¼ˆç›´è¿‘12ãƒ¶æœˆï¼‰â”€
const HISTORY = [
  { label:'2025/03', cases:3, fee: 900000, mentorRw:0 },
  { label:'2025/04', cases:4, fee:1200000, mentorRw:0 },
  { label:'2025/05', cases:4, fee:1100000, mentorRw:0 },
  { label:'2025/06', cases:2, fee: 600000, mentorRw:0 },
  { label:'2025/07', cases:5, fee:1500000, mentorRw:15000 },
  { label:'2025/08', cases:4, fee:1200000, mentorRw:21000 },
  { label:'2025/09', cases:4, fee:1300000, mentorRw:21000 },
  { label:'2025/10', cases:5, fee:1600000, mentorRw:21000 },
  { label:'2025/11', cases:4, fee:1200000, mentorRw:21000 },
  { label:'2025/12', cases:5, fee:1500000, mentorRw:21000 },
  { label:'2026/01', cases:5, fee:1550000, mentorRw:21000 },
  { label:'2026/02', cases:7, fee:1850000, mentorRw:33000, current:true },
];
// ãƒã‚¤ãƒ³ãƒˆä»˜ä¸
HISTORY.forEach(m => { m.pts = calcPoints(m.cases, m.fee, m.mentorRw, m.feePT||0); m.rank = rankFromPts(m.pts.total); });

// è‚²æˆã‚¨ãƒ¼ã‚¸ã‚§ãƒ³ãƒˆ
const MENTEES = [
  { id:'10041', name:'æ¸¡è¾º éš†', emoji:'ğŸ¥‰', rank:'bronze', curMonthDeals:2, curMonthFee:330000 },
];

// ================================================================
//  Init
// ================================================================
window.addEventListener('DOMContentLoaded', ()=>{
  document.getElementById('hdr-name').textContent = AGENT.name;
  document.getElementById('hdr-id').textContent   = AGENT.id;
  renderHero();
  renderRankRoad();
  renderCurStats();
  renderMiniBars();
  renderHistoryTable();
  renderStabilityTracker();
  renderStabTable();
  renderMentors();
  renderMentorRateTable();
  initSimulator();
  updateSim();
});

// ================================================================
//  Hero
// ================================================================
function renderHero() {
  const r   = RANKS[AGENT.rank];
  const cur = HISTORY[HISTORY.length-1];
  const pts = cur.pts.total;
  const hero= document.getElementById('rank-hero');

  hero.className = 'rank-hero ' + AGENT.rank;
  document.getElementById('hero-bg-txt').textContent = r.label;

  const emb = document.getElementById('emblem');
  emb.className   = 'emblem ' + AGENT.rank;
  emb.textContent = r.icon;
  const el = document.getElementById('emblem-label');
  el.className   = 'emblem-label ' + AGENT.rank;
  el.textContent = r.label;

  // ä¿è¨¼ãƒãƒƒã‚¸ï¼ˆãƒ‡ãƒ¢ï¼š6ãƒ¶æœˆé”æˆæ¸ˆã¿ = 1å¹´ä¿è¨¼ä¸­ï¼‰
  const stab6m = calcStability();
  document.getElementById('perm-badge').innerHTML = stab6m.achieved1yr
    ? `<div class="perm-badge perm-1yr">ğŸ”’ 1å¹´ä¿è¨¼ä¸­</div>`
    : stab6m.achievedForever
    ? `<div class="perm-badge perm-forever">â™¾ Lifetimeä¼šå“¡</div>` : '';

  document.getElementById('hero-name').textContent = AGENT.name;
  document.getElementById('hero-sub').textContent  = AGENT.id + ' ï½œ ' + (AGENT.type==='re'?'ä¸å‹•ç”£ã‚¨ãƒ¼ã‚¸ã‚§ãƒ³ãƒˆ':AGENT.type==='hr'?'äººæã‚¨ãƒ¼ã‚¸ã‚§ãƒ³ãƒˆ':'ãƒ‘ãƒ¼ãƒˆãƒŠãƒ¼');

  document.getElementById('hs-rate').textContent        = Math.round(r.rateRE*100) + '%';
  document.getElementById('hs-rate-hr').textContent     = Math.round(r.rateHR*100) + '%';
  document.getElementById('hs-mentor-rate').textContent = Math.round(r.mentorRate*100) + '%';
  document.getElementById('hs-fee').textContent         = r.fee ? yen(r.fee) : 'Â¥0ï¼ˆç„¡æ–™ï¼‰';
  document.getElementById('hs-cum-pts').textContent     = HISTORY.reduce((s,m)=>s+m.cases,0) + 'ä»¶';

  // Points breakdown
  const pb = cur.pts;
  const items = [
    { icon:'ğŸ ', label:`æ¡ˆä»¶å®Œé‚ ${cur.cases}ä»¶`, val:pb.caseP, clr:'var(--blue)' },
    { icon:'ğŸ’°', label:`æ‰‹æ•°æ–™ ${yen(cur.fee)}`, val:pb.feeP, clr:'var(--gold)' },
    { icon:'ğŸ“', label:`ãƒ¡ãƒ³ã‚¿ãƒ¼å ±é…¬ ${yen(cur.mentorRw)}`, val:pb.mentorP, clr:'var(--green)' },
  ];
  document.getElementById('pts-breakdown').innerHTML = items.map(it=>
    `<div class="pb-row" style="gap:6px">
      <span class="pb-icon">${it.icon}</span>
      <span class="pb-label">${it.label}</span>
      <span class="pb-val" style="color:${it.clr}">+${it.val}pt</span>
    </div>`).join('');
  document.getElementById('pts-total').textContent = pts;

  // Gauge (max display = 40 for 100%)
  const maxG = 40;
  const pct  = Math.min(100, Math.round(pts/maxG*100));
  document.getElementById('gauge-fill').style.width      = pct+'%';
  document.getElementById('gauge-fill').style.background = r.color;
  document.getElementById('gauge-needle').style.left     = pct+'%';
  document.getElementById('gauge-needle').style.background = r.color;

  const nextPts  = r.ptsMax < 999 ? r.ptsMax + 1 : null;
  const toNext   = nextPts ? nextPts - pts : 0;
  const nextRank = RANK_ORDER[RANK_ORDER.indexOf(AGENT.rank)+1];
  document.getElementById('gauge-label').innerHTML = nextRank
    ? `<span style="color:${r.color};font-weight:700">${pts}pt</span>ã€€<span style="color:var(--muted)">â†’ ${RANKS[nextRank].label}ã¾ã§ã‚ã¨ <strong style="color:${RANKS[nextRank].color}">${toNext}pt</strong></span>`
    : `<span style="color:var(--plat);font-weight:700">æœ€é«˜ãƒ©ãƒ³ã‚¯é”æˆä¸­ ğŸ‰</span>`;
}

// ================================================================
//  Rank Road
// ================================================================
function renderRankRoad() {
  const curIdx = RANK_ORDER.indexOf(AGENT.rank);
  document.getElementById('rank-road').innerHTML = RANK_ORDER.map((rk,i)=>{
    const r  = RANKS[rk];
    const isCur = i === curIdx;
    const achieved = i < curIdx;
    const locked   = i > curIdx;
    const cls = isCur ? 'current' : achieved ? 'achieved' : 'locked';
    return `<div class="rr-node ${cls}" style="--node-color:${r.color};--node-glow:${r.bg}">
      ${isCur ? `<div class="cur-chip">NOW</div>` : ''}
      <div class="rr-icon">${r.icon}</div>
      <div class="rr-name" style="color:${(!locked)?r.color:'var(--muted)'}">${r.label}</div>
      <div class="rr-pts" style="color:${(!locked)?'var(--sub)':'var(--border2)'}">
        ${r.ptsMin===0 ? 'ã€œ9pt' : r.ptsMax < 999 ? r.ptsMin+'ã€œ'+r.ptsMax+'pt' : r.ptsMin+'ptä»¥ä¸Š'}
      </div>
      <div class="rr-rate-re" style="color:${!locked?'var(--text)':'var(--border2)'}">ä¸å‹•ç”£ï¼š${Math.round(r.rateRE*100)}%</div>
      <div class="rr-rate-hr" style="color:${!locked?'var(--sub)':'var(--border2)'}">äººæï¼š${Math.round(r.rateHR*100)}%</div>
      <div class="rr-fee" style="color:${!locked?'var(--muted)':'var(--border2)'}">æœˆä¼šè²»ï¼š${r.fee?'Â¥'+r.fee:'ç„¡æ–™'}</div>
      <div class="rr-mentor" style="color:${!locked?'var(--green)':'var(--border2)'}">ãƒ¡ãƒ³ã‚¿ãƒ¼ï¼š${Math.round(r.mentorRate*100)}%</div>
    </div>`;
  }).join('');
}

// ================================================================
//  Current stats
// ================================================================
function renderCurStats() {
  const m = HISTORY[HISTORY.length-1];
  const r = RANKS[AGENT.rank];
  const items = [
    { label:'ä»Šæœˆãƒã‚¤ãƒ³ãƒˆ', val: m.pts.total + 'pt', sub:'å†…è¨³ â†’ æ¡ˆä»¶'+m.pts.caseP+' / æ‰‹æ•°æ–™'+m.pts.feeP+' / ãƒ¡ãƒ³ã‚¿ãƒ¼'+m.pts.mentorP, clr:'var(--gold)' },
    { label:'æ¥æœˆç¢ºå®šãƒ©ãƒ³ã‚¯', val: RANKS[m.rank].icon+' '+RANKS[m.rank].label, sub:'æœˆæœ«åˆ¤å®šã§ç¿Œæœˆã‹ã‚‰é©ç”¨', clr:RANKS[m.rank].color },
    { label:'ä»Šæœˆæˆç´„ä»¶æ•°', val: m.cases + 'ä»¶', sub:'æ‰‹æ•°æ–™åˆè¨ˆï¼š'+yen(m.fee), clr:'var(--blue)' },
    { label:'ä»Šæœˆãƒ¡ãƒ³ã‚¿ãƒ¼å ±é…¬', val: yen(m.mentorRw), sub: '+'+m.pts.mentorP+'pt åŠ ç®—', clr:'var(--green)' },
  ];
  document.getElementById('cur-stats').innerHTML = items.map(it=>`
    <div style="background:var(--card2);border-radius:9px;padding:11px 13px;
      border-left:2px solid ${it.clr}">
      <div style="font-size:10px;color:var(--muted);margin-bottom:3px">${it.label}</div>
      <div style="font-size:15px;font-weight:700;color:${it.clr}">${it.val}</div>
      <div style="font-size:10px;color:var(--sub);margin-top:2px">${it.sub}</div>
    </div>`).join('');
}

// ================================================================
//  Mini bars (ç›´è¿‘6ãƒ¶æœˆ)
// ================================================================
function renderMiniBars() {
  const last6 = HISTORY.slice(-6);
  const maxP  = Math.max(...last6.map(m=>m.pts.total), 35);
  const zones = [{pts:30,clr:'var(--plat)'},{pts:20,clr:'var(--gold)'},{pts:10,clr:'var(--silver)'}];

  document.getElementById('mini-bars').innerHTML = `
    <div style="display:grid;grid-template-columns:repeat(6,1fr);gap:8px;align-items:end;height:140px;position:relative">
      ${last6.map(m=>{
        const h  = Math.round(m.pts.total/maxP*120);
        const r  = RANKS[m.rank];
        return `<div style="display:flex;flex-direction:column;align-items:center;gap:4px;justify-content:flex-end;height:140px">
          <div style="font-family:'DM Mono',monospace;font-size:11px;color:${r.color};font-weight:700">${m.pts.total}pt</div>
          <div style="width:100%;height:${h}px;border-radius:4px 4px 0 0;
            background:${r.color};opacity:${m.current?1:.7};position:relative;min-height:4px">
            ${m.current?'<div style="position:absolute;top:-18px;left:50%;transform:translateX(-50%);font-size:8px;color:var(--blue);white-space:nowrap;font-weight:700">ä»Šæœˆ</div>':''}
          </div>
          <div style="font-size:9px;color:var(--muted)">${m.label.slice(5)}</div>
          <div style="font-size:8px;font-weight:700;color:${r.color}">${r.icon}</div>
        </div>`;
      }).join('')}
    </div>
    <div style="display:flex;gap:12px;margin-top:12px;font-size:10px">
      ${RANK_ORDER.map(rk=>`<span>${RANKS[rk].icon} ${RANKS[rk].label}ï¼š${RANKS[rk].ptsMin===0?'0ã€œ9':RANKS[rk].ptsMax<999?RANKS[rk].ptsMin+'ã€œ'+RANKS[rk].ptsMax:RANKS[rk].ptsMin+'+'}pt</span>`).join('')}
    </div>`;
}

// ================================================================
//  History table
// ================================================================
function renderHistoryTable() {
  const head = `<thead><tr style="border-bottom:1px solid var(--border)">
    <th style="padding:8px 10px;text-align:left">æœˆ</th>
    <th style="padding:8px 10px;text-align:center">æˆç´„ä»¶æ•°</th>
    <th style="padding:8px 10px;text-align:right">æ‰‹æ•°æ–™åˆè¨ˆ</th>
    <th style="padding:8px 10px;text-align:center">æ‰‹æ•°æ–™pt</th>
    <th style="padding:8px 10px;text-align:center">æ¡ˆä»¶pt</th>
    <th style="padding:8px 10px;text-align:right">ãƒ¡ãƒ³ã‚¿ãƒ¼å ±é…¬</th>
    <th style="padding:8px 10px;text-align:center">ãƒ¡ãƒ³ã‚¿ãƒ¼pt</th>
    <th style="padding:8px 10px;text-align:center;color:var(--gold)">åˆè¨ˆpt</th>
    <th style="padding:8px 10px;text-align:center">ç¿Œæœˆãƒ©ãƒ³ã‚¯</th>
  </tr></thead>`;

  const rows = HISTORY.map(m=>{
    const rc = 'rc-'+m.rank;
    const r  = RANKS[m.rank];
    const cur = m.current;
    return `<tr class="${cur?'cur':''}" style="border-bottom:1px solid rgba(30,34,53,.5)">
      <td class="mono" style="padding:8px 10px;color:${cur?'var(--blue)':'var(--sub)'};font-size:11px">
        ${m.label}${cur?' â—€ ä»Šæœˆ':''}
      </td>
      <td class="mono" style="padding:8px 10px;text-align:center">${m.cases}</td>
      <td class="mono" style="padding:8px 10px;text-align:right;font-size:11px">${yen(m.fee)}</td>
      <td class="mono" style="padding:8px 10px;text-align:center;color:var(--gold);font-weight:700">+${m.pts.feeP}</td>
      <td class="mono" style="padding:8px 10px;text-align:center;color:var(--blue);font-weight:700">+${m.pts.caseP}</td>
      <td class="mono" style="padding:8px 10px;text-align:right;font-size:11px;color:var(--green)">${m.mentorRw?yen(m.mentorRw):'â€”'}</td>
      <td class="mono" style="padding:8px 10px;text-align:center;color:var(--green);font-weight:700">${m.pts.mentorP?'+'+m.pts.mentorP:'â€”'}</td>
      <td class="mono" style="padding:8px 10px;text-align:center;font-size:15px;font-weight:700;color:${r.color}">${m.pts.total}</td>
      <td style="padding:8px 10px;text-align:center">
        <span class="rank-chip ${rc}">${r.icon} ${r.label}</span>
      </td>
    </tr>`;
  }).join('');

  document.getElementById('history-table').innerHTML = head + `<tbody>${rows}</tbody>`;
}

// ================================================================
//  Stability
// ================================================================
function calcStability() {
  // ç¾åœ¨ãƒ©ãƒ³ã‚¯ä»¥ä¸Šã§é€£ç¶šã—ã¦ã„ã‚‹æœˆæ•°ã‚’æ•°ãˆã‚‹
  const curRankIdx = RANK_ORDER.indexOf(AGENT.rank);
  let streak = 0;
  for (let i = HISTORY.length-1; i >= 0; i--) {
    if (RANK_ORDER.indexOf(HISTORY[i].rank) >= curRankIdx) streak++;
    else break;
  }
  return {
    streak,
    achieved1yr:    streak >= 6  && streak < 36,
    achievedForever: streak >= 36,
    to1yr:   Math.max(0, 6  - streak),
    toForever: Math.max(0, 36 - streak),
  };
}

function renderStabilityTracker() {
  const s = calcStability();
  const r = RANKS[AGENT.rank];

  // 6ãƒ¶æœˆ
  document.getElementById('stab-6m-cur').textContent = Math.min(s.streak, 6);
  document.getElementById('stab-6m-bar').style.width = Math.min(100, Math.round(s.streak/6*100))+'%';
  document.getElementById('stab-6m-label').innerHTML = s.achieved1yr || s.achievedForever
    ? `âœ… 6ãƒ¶æœˆé”æˆæ¸ˆã¿ã€‚<strong style="color:var(--green)">${r.label}ãƒ©ãƒ³ã‚¯ã‚’1å¹´é–“ä¿è¨¼ä¸­</strong>`
    : `ã‚ã¨ <strong>${s.to1yr}ãƒ¶æœˆ</strong> ã§${r.label}ãƒ©ãƒ³ã‚¯ãŒ1å¹´é–“ä¿è¨¼ã•ã‚Œã¾ã™`;
  document.getElementById('stab-6m-reward').textContent = s.achieved1yr ? 'ğŸ”’ ä¿è¨¼æœŸé–“ä¸­ï¼šãƒã‚¤ãƒ³ãƒˆãŒä¸‹å›ã£ã¦ã‚‚ç¶­æŒ' : '';

  // 3å¹´
  document.getElementById('stab-3y-cur').textContent = Math.min(s.streak, 36);
  document.getElementById('stab-3y-bar').style.width = Math.min(100, Math.round(s.streak/36*100))+'%';
  document.getElementById('stab-3y-label').innerHTML = s.achievedForever
    ? `âœ… <strong style="color:var(--gold)">Lifetimeä¼šå“¡é”æˆï¼</strong> ${r.label}ãƒ©ãƒ³ã‚¯ãŒæ°¸ä¹…ä¿è¨¼`
    : `ã‚ã¨ <strong>${s.toForever}ãƒ¶æœˆ</strong> ã§${r.label}ãƒ©ãƒ³ã‚¯ãŒæ°¸ä¹…ä¿è¨¼ã•ã‚Œã¾ã™`;
  document.getElementById('stab-3y-reward').innerHTML = s.achievedForever ? 'â™¾ <strong>Lifetimeä¼šå“¡</strong>ï¼šãƒã‚¤ãƒ³ãƒˆã«ã‚ˆã‚‹ãƒ©ãƒ³ã‚¯å¤‰å‹•ãªã—ï¼ˆæ°¸ä¹…ä¿è¨¼ï¼‰' : '';
}

function renderStabTable() {
  const curRankIdx = RANK_ORDER.indexOf(AGENT.rank);
  const head = `<thead><tr style="border-bottom:1px solid var(--border)">
    <th style="padding:8px 10px;text-align:left">æœˆ</th>
    <th style="padding:8px 10px;text-align:center">ãƒ©ãƒ³ã‚¯</th>
    <th style="padding:8px 10px;text-align:center">é€£ç¶šç¶™ç¶šæœˆæ•°</th>
    <th style="padding:8px 10px;text-align:center">6ãƒ¶æœˆä¿è¨¼</th>
    <th style="padding:8px 10px;text-align:center">36ãƒ¶æœˆæ°¸ä¹…ä¿è¨¼</th>
  </tr></thead>`;

  let streak = 0;
  const rows = HISTORY.map((m,i) => {
    if (RANK_ORDER.indexOf(m.rank) >= curRankIdx) streak++;
    else streak = 0;
    const has1yr  = streak >= 6;
    const hasPerm = streak >= 36;
    const r = RANKS[m.rank];
    return `<tr class="${m.current?'cur':''}" style="border-bottom:1px solid rgba(30,34,53,.5)">
      <td class="mono" style="padding:8px 10px;color:${m.current?'var(--blue)':'var(--sub)'};font-size:11px">
        ${m.label}${m.current?' â—€ ä»Šæœˆ':''}
      </td>
      <td style="padding:8px 10px;text-align:center">
        <span class="rank-chip rc-${m.rank}">${r.icon} ${r.label}</span>
      </td>
      <td class="mono" style="padding:8px 10px;text-align:center;color:var(--gold);font-weight:700">${streak}ãƒ¶æœˆ</td>
      <td style="padding:8px 10px;text-align:center;font-size:12px">${has1yr?'<span style="color:var(--green)">ğŸ”’ ä¿è¨¼ä¸­</span>':'<span style="color:var(--muted)">â€”</span>'}</td>
      <td style="padding:8px 10px;text-align:center;font-size:12px">${hasPerm?'<span style="color:var(--gold)">â™¾ æ°¸ä¹…</span>':'<span style="color:var(--muted)">â€”</span>'}</td>
    </tr>`;
  }).join('');

  document.getElementById('stab-table').innerHTML = head + `<tbody>${rows}</tbody>`;
}

// ================================================================
//  Mentors
// ================================================================
function renderMentors() {
  const r = RANKS[AGENT.rank];
  document.getElementById('mentor-list').innerHTML = MENTEES.length
    ? MENTEES.map(m => {
        const reward = Math.floor(m.curMonthFee * r.mentorRate);
        const pts    = Math.floor(reward / 5000);
        return `<div class="mentor-row">
          <div class="m-avatar" style="background:var(--bronze-bg);border:1px solid var(--bronze-bd)">${m.emoji}</div>
          <div class="m-info">
            <div class="m-name">${m.name}</div>
            <span class="m-rank-badge" style="background:var(--bronze-bg);color:var(--bronze);border:1px solid var(--bronze-bd)">
              ${RANKS[m.rank].label}
            </span>
          </div>
          <div class="m-right">
            <div class="m-reward">+${yen(reward)}</div>
            <div class="m-pts">ä»Šæœˆï¼š${m.curMonthDeals}ä»¶ â†’ +${pts}ptåŠ ç®—</div>
          </div>
        </div>`;
      }).join('')
    : `<div style="text-align:center;padding:24px;color:var(--muted);font-size:12px">
        è‚²æˆä¸­ã®ã‚¨ãƒ¼ã‚¸ã‚§ãƒ³ãƒˆã¯ã¾ã ã„ã¾ã›ã‚“<br>
        <span style="font-size:10px">æœ¬éƒ¨ã¸ãƒ¡ãƒ³ã‚¿ãƒ¼ç™»éŒ²ã‚’ç”³è«‹ã—ã¦ãã ã•ã„</span>
       </div>`;
}

function renderMentorRateTable() {
  document.getElementById('mentor-rate-table').innerHTML = RANK_ORDER.map(rk=>{
    const r      = RANKS[rk];
    const isCur  = rk === AGENT.rank;
    return `<div style="display:flex;align-items:center;gap:12px;padding:10px 13px;
      background:${isCur?r.bg:'var(--card2)'};border-radius:9px;
      border:1px solid ${isCur?r.bd:'var(--border2)'}">
      <div style="font-size:20px">${r.icon}</div>
      <div style="flex:1">
        <div style="font-size:11px;font-weight:700;color:${r.color}">${r.label}</div>
        <div style="font-size:10px;color:var(--muted)">${r.ptsMin===0?'0ã€œ9pt':r.ptsMax<999?r.ptsMin+'ã€œ'+r.ptsMax+'pt':r.ptsMin+'pt+'}</div>
      </div>
      <div style="font-family:'DM Mono',monospace;font-size:18px;font-weight:600;color:var(--green)">
        ${Math.round(r.mentorRate*100)}%
      </div>
      ${isCur?'<div style="font-size:9px;font-weight:800;color:var(--gold);background:rgba(201,168,76,.15);padding:2px 7px;border-radius:3px">ç¾åœ¨</div>':''}
    </div>`;
  }).join('');
}

// ================================================================
//  Simulator
// ================================================================
let simRank = AGENT.rank;

function initSimulator() {
  document.getElementById('sim-rank-btns').innerHTML = RANK_ORDER.map(rk=>{
    const r = RANKS[rk];
    return `<button class="sim-rb ${rk===simRank?'on':''}"
      onclick="simSetRank('${rk}',this)">${r.icon} ${r.label}</button>`;
  }).join('');
}

function simSetRank(rk, btn) {
  simRank = rk;
  document.querySelectorAll('#sim-rank-btns .sim-rb').forEach(b=>b.classList.remove('on'));
  btn.classList.add('on');
  updateSim();
}

function updateSim() {
  const cases   = parseInt(document.getElementById('sim-cases').value)||0;
  const fee     = parseFloat(document.getElementById('sim-fee').value)||0;
  const feePT   = parseFloat(document.getElementById('sim-fee-pt').value)||0;
  const mentorR = parseFloat(document.getElementById('sim-mentor').value)||0;
  const sanmei  = document.getElementById('sim-sanmei').checked;

  const pts     = calcPoints(cases, fee, mentorR, feePT); // å…¨äº‹æ¥­ãƒ»å…¨æ¡ˆä»¶ã‚¿ã‚¤ãƒ—åˆç®—
  const nextRk  = rankFromPts(pts.total);
  const nextR   = RANKS[nextRk];

  // Points breakdown
  const feePTLocal = parseFloat(document.getElementById('sim-fee-pt').value)||0;
  const feeLabel = feePT>0
    ? `é€šå¸¸${yen(fee)}â†’${pts.feeP_normal}pt ï¼‹ PT${yen(feePT)}â†’${pts.feeP_pt}pt`
    : `${yen(fee)} Ã· Â¥10ä¸‡`;
  document.getElementById('sim-pt-breakdown').innerHTML = [
    { icon:'ğŸ ', label:'æ¡ˆä»¶å®Œé‚ '+cases+'ä»¶', pts: pts.caseP, clr:'var(--blue)' },
    { icon:'ğŸ’°', label:'æ‰‹æ•°æ–™ '+feeLabel, pts: pts.feeP, clr:'var(--gold)' },
    { icon:'ğŸ“', label:'ãƒ¡ãƒ³ã‚¿ãƒ¼å ±é…¬ '+yen(mentorR)+' Ã· Â¥5,000 Ã— 0.5', pts: pts.mentorP, clr:'var(--green)' },
  ].map(it=>`
    <div style="display:flex;align-items:center;gap:8px;font-size:11px">
      <span style="font-size:13px">${it.icon}</span>
      <span style="flex:1;color:var(--sub)">${it.label}</span>
      <span style="font-family:'DM Mono',monospace;color:${it.clr};font-weight:700">+${it.pts}pt</span>
    </div>`).join('');

  document.getElementById('sim-pt-total').textContent    = pts.total;
  document.getElementById('sim-pt-total').style.color    = nextR.color;
  document.getElementById('sim-next-rank').textContent   = nextR.icon + ' ' + nextR.label;
  document.getElementById('sim-next-rank').style.color   = nextR.color;

  // Reward calc for simRank
  const r      = RANKS[simRank];
  let baseRate = AGENT.type==='hr' ? r.rateHR : r.rateRE;
  if (sanmei) baseRate -= 0.15;
  const T1=5e6,T2=10e6;
  let gross = fee<=T1 ? fee*baseRate
    : fee<=T2 ? T1*baseRate+(fee-T1)*(baseRate+.05)
    : T1*baseRate+(T2-T1)*(baseRate+.05)+(fee-T2)*(baseRate+.10);
  gross = Math.floor(gross);
  const M = 1e6;
  const tax = gross<=M ? Math.floor(gross*.1021) : Math.floor(M*.1021+(gross-M)*.2042);
  const net = gross - tax - r.fee;

  document.getElementById('sim-reward-breakdown').innerHTML = [
    {k:'ç·æ‰‹æ•°æ–™é¡', v:yen(fee)},
    {k:`å ±é…¬ç‡ï¼ˆ${r.label}${sanmei?' ä¸‰ç‚º':''}ï¼‰`, v: Math.round(baseRate*100)+'%'},
    {k:'å ±é…¬é¡ï¼ˆç¨æŠœï¼‰', v:yen(gross)},
    {k:'æºæ³‰å¾´å', v:'âˆ’'+yen(tax), minus:true},
    {k:'æœˆä¼šè²»', v:r.fee?'âˆ’'+yen(r.fee):'Â¥0', minus:r.fee>0},
    {k:'ãƒ¡ãƒ³ã‚¿ãƒ¼å ±é…¬', v:'+'+yen(mentorR), plus:true},
    {k:'æ‰‹å–ã‚Šåˆè¨ˆï¼ˆæ¨å®šï¼‰', v:yen(net+mentorR), total:true},
  ].map(row=>`
    <div class="rt-row">
      <div class="rt-key">${row.k}</div>
      <div class="rt-val ${row.minus?'rt-minus':''}" style="${row.total?'color:var(--gold);font-size:15px':''}${row.plus?';color:var(--green)':''}">
        ${row.v}
      </div>
    </div>`).join('');

  // 4-rank compare
  document.getElementById('sim-compare').innerHTML = RANK_ORDER.map(rk=>{
    const rc     = RANKS[rk];
    let br       = AGENT.type==='hr' ? rc.rateHR : rc.rateRE;
    if (sanmei) br -= 0.15;
    let g = fee<=T1?fee*br:fee<=T2?T1*br+(fee-T1)*(br+.05):T1*br+(T2-T1)*(br+.05)+(fee-T2)*(br+.10);
    g = Math.floor(g);
    const t = g<=M?Math.floor(g*.1021):Math.floor(M*.1021+(g-M)*.2042);
    const n = g - t - rc.fee + mentorR;
    const isCur = rk === simRank;
    return `<div class="cmp-cell ${isCur?'cur':''}">
      <div style="font-size:20px;margin-bottom:4px">${rc.icon}</div>
      <div style="font-size:9px;font-weight:800;color:${rc.color};letter-spacing:1px;margin-bottom:4px">${rc.label}</div>
      <div style="font-family:'DM Mono',monospace;font-size:12px;font-weight:600">${yen(n)}</div>
      <div style="font-size:9px;color:var(--muted);margin-top:2px">${Math.round(br*100)}%</div>
      ${isCur?'<div style="font-size:8px;color:var(--gold);margin-top:4px;font-weight:700">é¸æŠä¸­</div>':''}
    </div>`;
  }).join('');
}

// ================================================================
//  Tab switch
// ================================================================
function switchTab(i, el) {
  document.querySelectorAll('.tab').forEach((t,j)=>t.classList.toggle('on',j===i));
  document.querySelectorAll('.tp').forEach((p,j)=>p.classList.toggle('on',j===i));
}

// â”€â”€ ç´¹ä»‹ãƒªãƒ³ã‚¯ãƒ¢ãƒ¼ãƒ€ãƒ« â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
var _refCurrentCode = '';
function openRefModal() {
  var overlay = document.getElementById('ref-modal-overlay');
  var selector = document.getElementById('ref-code-selector');
  var isExec = (typeof session !== 'undefined' && session && session.hqRole === 'exec')
            || (typeof CURRENT_USER !== 'undefined' && CURRENT_USER && CURRENT_USER.hqRole === 'exec');
  var agentId = (typeof session !== 'undefined' && session && session.userId) ? session.userId
              : (typeof ME !== 'undefined' && ME && ME.id) ? ME.id
              : (typeof AGENT !== 'undefined' && AGENT && AGENT.id) ? AGENT.id : '10012';
  if (isExec) {
    var SPECIAL = ['FOUNDER2026','WELCOME2026','GOLD_START','HR_PRO75'];
    var opts = SPECIAL.map(function(c){ return '<option value="'+c+'">â­ '+c+'</option>'; }).join('');
    selector.innerHTML =
      '<div style="margin-bottom:12px"><div style="font-size:10px;color:var(--sub);font-weight:600;margin-bottom:5px">ã‚³ãƒ¼ãƒ‰ç¨®åˆ¥</div>'
      +'<select id="ref-code-select" onchange="updateRefLink()" style="width:100%;padding:8px 10px;background:var(--card2);border:1px solid var(--border2);border-radius:8px;color:var(--text);font-size:12px;font-family:inherit">'
      +'<option value="'+agentId+'">è‡ªåˆ†ã®IDï¼ˆ'+agentId+'ï¼‰</option>'
      +'<optgroup label="â”€â”€ ç‰¹åˆ¥ã‚³ãƒ¼ãƒ‰ â”€â”€">'+opts+'</optgroup>'
      +'</select></div>';
    _refCurrentCode = agentId;
  } else {
    selector.innerHTML =
      '<div style="display:flex;align-items:center;gap:8px;margin-bottom:12px;padding:8px 12px;background:rgba(201,168,76,.06);border:1px solid rgba(201,168,76,.2);border-radius:8px">'
      +'<span style="font-size:11px;color:var(--muted)">ç´¹ä»‹ã‚³ãƒ¼ãƒ‰ï¼š</span>'
      +'<span style="font-family:\'DM Mono\',monospace;font-size:13px;font-weight:700;color:var(--gold)">'+agentId+'</span>'
      +'</div>';
    _refCurrentCode = agentId;
  }
  updateRefLink();
  overlay.classList.add('open');
}
function updateRefLink() {
  var sel = document.getElementById('ref-code-select');
  if (sel) _refCurrentCode = sel.value;
  var base = location.origin + location.pathname.replace(/[^/]*$/, '') + 'coreto-agent-signup.html';
  var url = base + '?ref=' + encodeURIComponent(_refCurrentCode);
  document.getElementById('ref-url-display').textContent = url;
}
function closeRefModal() {
  document.getElementById('ref-modal-overlay').classList.remove('open');
}
function copyRefLink() {
  var url = document.getElementById('ref-url-display').textContent;
  navigator.clipboard.writeText(url).then(function() {
    var btn = document.querySelector('.ref-copy-btn');
    btn.textContent = 'âœ… ã‚³ãƒ”ãƒ¼ã—ã¾ã—ãŸ';
    setTimeout(function(){ btn.textContent = 'ğŸ“‹ ã‚³ãƒ”ãƒ¼'; }, 2000);
  }).catch(function() {
    var ta = document.createElement('textarea');
    ta.value = url; document.body.appendChild(ta); ta.select();
    document.execCommand('copy'); document.body.removeChild(ta);
  });
}
</script>

<div id="ref-modal-overlay" onclick="if(event.target===this)closeRefModal()">
  <div id="ref-modal">
    <div class="ref-mhdr">
      <div class="ref-mhdr-t">ğŸ”— ç´¹ä»‹ãƒªãƒ³ã‚¯ç™ºè¡Œ</div>
      <button onclick="closeRefModal()" style="background:none;border:none;color:var(--muted);font-size:20px;cursor:pointer;line-height:1">Ã—</button>
    </div>
    <div class="ref-mbody">
      <div style="font-size:11px;color:var(--sub);margin-bottom:14px;line-height:1.8">ã“ã®ãƒªãƒ³ã‚¯ã‹ã‚‰å…¥ä¼šã™ã‚‹ã¨ç´¹ä»‹ã‚³ãƒ¼ãƒ‰ãŒè‡ªå‹•å…¥åŠ›ã•ã‚Œã¾ã™ã€‚</div>
      <div id="ref-code-selector"></div>
      <div style="font-size:10px;color:var(--muted);margin-bottom:4px;font-weight:600;letter-spacing:.5px">ç™ºè¡Œãƒªãƒ³ã‚¯</div>
      <div class="ref-url" id="ref-url-display">â€”</div>
      <button class="ref-copy-btn" onclick="copyRefLink()">ğŸ“‹ ã‚³ãƒ”ãƒ¼</button>
    </div>
  </div>
</div>

<button id="ref-float-btn" onclick="openRefModal()">ğŸ”— ç´¹ä»‹ãƒªãƒ³ã‚¯ç™ºè¡Œ</button>
</body>
</html>
