<!DOCTYPE html>
<html lang="ja">
<head>
  <!-- â”€â”€ Content Security Policy (XSSè»½æ¸›) â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
       å¤‰æ›´æ™‚: ä½¿ç”¨ã™ã‚‹å¤–éƒ¨ã‚µãƒ¼ãƒ“ã‚¹ã®ã‚ªãƒªã‚¸ãƒ³ã‚’è¿½åŠ ã—ã¦ãã ã•ã„
       Kintoneè¿½åŠ æ™‚: connect-src ã« *.cybozu.com ã‚’è¿½åŠ 
  â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ -->
  <meta http-equiv="Content-Security-Policy" content="
    default-src 'self';
    script-src 'self' 'unsafe-inline'
      https://cdnjs.cloudflare.com
      https://js.stripe.com
      https://cdn-cgi/scripts;
    style-src 'self' 'unsafe-inline'
      https://fonts.googleapis.com;
    font-src 'self'
      https://fonts.gstatic.com;
    img-src 'self' data: blob:;
    connect-src 'self'
      https://hooks.slack.com
      https://hooks.zapier.com
      https://api.stripe.com
      https://js.stripe.com
      https://www.houjin-bangou.nta.go.jp
      https://www.retio.or.jp;
    frame-src 'none';
    object-src 'none';
    base-uri 'self';
  ">

<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>CORETO â€” IDæ¡ç•ªç®¡ç†</title>
<style>
@import url('https://fonts.googleapis.com/css2?family=Noto+Sans+JP:wght@300;400;500;700&family=DM+Mono:wght@400;500&family=Syne:wght@700;800&display=swap');
*{box-sizing:border-box;margin:0;padding:0}
:root{
  --bg:#07090f;--card:#0f1119;--card2:#141720;--border:#1e2235;--border2:#252a3d;
  --gold:#c9a84c;--gold-dim:#7a5f22;--gold-bg:rgba(201,168,76,.07);
  --blue:#4f9cf9;--green:#34d399;--red:#f87171;--orange:#fb923c;--purple:#a78bfa;--teal:#2dd4bf;
  --muted:#4a5270;--sub:#7a849e;--text:#e2e6f3;
}
html,body{height:100%;font-family:'Noto Sans JP',sans-serif;background:var(--bg);color:var(--text)}
.header{display:flex;align-items:center;justify-content:space-between;padding:0 26px;height:54px;
  border-bottom:1px solid var(--border);background:rgba(7,9,15,.95);position:sticky;top:0;z-index:100}
.logo{font-family:'Syne',sans-serif;font-size:17px;font-weight:800;color:var(--gold);letter-spacing:3px}
.body{max-width:1100px;margin:0 auto;padding:28px 28px 80px}
.sec-title{font-family:'Syne',sans-serif;font-size:17px;font-weight:800;margin-bottom:4px}
.sec-sub{font-size:11px;color:var(--sub);margin-bottom:24px}
.card{background:var(--card);border:1px solid var(--border);border-radius:14px;margin-bottom:16px}
.card-hdr{padding:14px 20px;border-bottom:1px solid var(--border);
  display:flex;align-items:center;justify-content:space-between}
.ch-title{font-size:9px;color:var(--muted);letter-spacing:2px;text-transform:uppercase;
  display:flex;align-items:center;gap:8px}
.ch-title::before{content:'';width:3px;height:11px;border-radius:2px;background:var(--gold)}
.card-body{padding:20px}
.g2{display:grid;grid-template-columns:1fr 1fr;gap:16px}
.g4{display:grid;grid-template-columns:repeat(4,1fr);gap:12px}

/* ID Generator Card */
.id-gen-card{background:var(--card);border:1px solid var(--border);border-radius:13px;padding:18px;
  position:relative;overflow:hidden;cursor:pointer;transition:all .18s}
.id-gen-card:hover{border-color:var(--border2);transform:translateY(-2px)}
.id-gen-card::before{content:'';position:absolute;top:0;left:0;right:0;height:2px}
.igc-hq::before{background:linear-gradient(90deg,transparent,var(--gold),transparent)}
.igc-re::before{background:linear-gradient(90deg,transparent,var(--blue),transparent)}
.igc-hr::before{background:linear-gradient(90deg,transparent,var(--green),transparent)}
.igc-pt::before{background:linear-gradient(90deg,transparent,var(--purple),transparent)}
.igc-type{font-size:9px;color:var(--muted);letter-spacing:1.5px;text-transform:uppercase;margin-bottom:10px}
.igc-range{font-family:'DM Mono',monospace;font-size:11px;color:var(--sub);margin-bottom:14px}
.igc-preview{font-family:'DM Mono',monospace;font-size:28px;font-weight:700;
  letter-spacing:4px;margin-bottom:12px;min-height:38px;transition:all .3s}
.igc-btn{padding:8px 16px;border-radius:8px;font-size:11px;font-weight:700;cursor:pointer;
  border:none;font-family:'Noto Sans JP',sans-serif;transition:all .15s;width:100%;
  display:flex;align-items:center;justify-content:center;gap:6px}

/* Case ID card */
.case-id-display{font-family:'DM Mono',monospace;font-size:22px;font-weight:700;
  letter-spacing:3px;padding:16px 20px;background:var(--card2);border:1px solid var(--border);
  border-radius:10px;margin-bottom:12px;display:flex;align-items:center;justify-content:space-between}
.cid-copy{font-size:18px;cursor:pointer;opacity:.5;transition:opacity .15s}
.cid-copy:hover{opacity:1}

/* History table */
.tbl{width:100%;border-collapse:collapse}
.tbl th{padding:8px 14px;font-size:9px;color:var(--muted);font-weight:700;
  letter-spacing:.5px;text-transform:uppercase;border-bottom:1px solid var(--border);
  background:var(--card2);text-align:left}
.tbl td{padding:10px 14px;border-bottom:1px solid rgba(30,34,53,.5);font-size:12px;vertical-align:middle}
.tbl tr:last-child td{border:none}
.mono{font-family:'DM Mono',monospace}

/* Pills */
.pill{display:inline-flex;align-items:center;padding:3px 9px;border-radius:6px;font-size:9px;font-weight:700}
.pill-gold{background:rgba(201,168,76,.13);color:var(--gold);border:1px solid var(--gold-dim)}
.pill-blue{background:rgba(79,156,249,.12);color:var(--blue);border:1px solid rgba(79,156,249,.25)}
.pill-green{background:rgba(52,211,153,.12);color:var(--green);border:1px solid rgba(52,211,153,.25)}
.pill-purple{background:rgba(167,139,250,.12);color:var(--purple);border:1px solid rgba(167,139,250,.25)}
.pill-muted{background:rgba(74,82,112,.15);color:var(--sub);border:1px solid var(--border2)}
.pill-teal{background:rgba(45,212,191,.1);color:var(--teal);border:1px solid rgba(45,212,191,.25)}

/* Spin animation */
@keyframes spin-in{0%{transform:scale(.8) translateY(6px);opacity:0}100%{transform:scale(1) translateY(0);opacity:1}}
.id-spin{animation:spin-in .25s cubic-bezier(.34,1.56,.64,1)}

/* Alert */
.alert-info{background:rgba(79,156,249,.07);border:1px solid rgba(79,156,249,.2);
  border-radius:10px;padding:12px 16px;font-size:11px;margin-bottom:16px;line-height:1.8;color:var(--sub)}

/* Btn */
.btn{padding:8px 16px;border-radius:9px;font-size:11px;font-weight:700;cursor:pointer;
  font-family:'Noto Sans JP',sans-serif;transition:all .15s;border:none;
  display:inline-flex;align-items:center;gap:6px}
.btn-ghost{background:transparent;border:1px solid var(--border2);color:var(--sub)}
.btn-ghost:hover{color:var(--text);border-color:var(--sub)}
.btn-sm{padding:5px 12px;font-size:10px;border-radius:7px}

::-webkit-scrollbar{width:4px}::-webkit-scrollbar-thumb{background:var(--border2);border-radius:2px}
</style>
</head>
<body>

<div class="header">
  <div style="display:flex;align-items:center;gap:12px">
    <div class="logo">CORETO</div>
    <div style="width:1px;height:18px;background:var(--border2)"></div>
    <div style="font-size:10px;color:var(--muted);letter-spacing:1px">IDæ¡ç•ªç®¡ç†</div>
  </div>
  <button onclick="window.location.href='coreto-hub.html'"
    style="font-size:10px;padding:5px 12px;border-radius:6px;border:1px solid var(--border2);
    background:transparent;color:var(--muted);cursor:pointer;font-family:'Noto Sans JP',sans-serif">
    â† ãƒ›ãƒ¼ãƒ ã«æˆ»ã‚‹
  </button>
</div>

<div class="body">
  <div class="sec-title">IDæ¡ç•ªç®¡ç†ã‚·ã‚¹ãƒ†ãƒ </div>
  <div class="sec-sub">ä¼šå“¡IDãƒ»æ¡ˆä»¶IDã¯ã™ã¹ã¦ãƒ©ãƒ³ãƒ€ãƒ æ¡ç•ªã€‚é€£ç•ªã§ã¯ãªã„ãŸã‚æ¨æ¸¬ãƒ»ã‚¹ã‚­ãƒ£ãƒ³ãŒä¸å¯èƒ½ã§ã™ã€‚</div>

  <div class="alert-info">
    ğŸ” <strong>ã‚»ã‚­ãƒ¥ãƒªãƒ†ã‚£è¨­è¨ˆ</strong><br>
    ä¼šå“¡IDã¯ç¯„å›²å†…ã‹ã‚‰ãƒ©ãƒ³ãƒ€ãƒ é¸æŠã®ãŸã‚å¤–éƒ¨ã‹ã‚‰ã®æ¨æ¸¬ãŒå›°é›£ã§ã™ã€‚æ¡ˆä»¶IDã¯è‹±æ•°å­—6æ–‡å­—ã®ãƒ©ãƒ³ãƒ€ãƒ æ–‡å­—åˆ—ï¼ˆ36^6 = ç´„21å„„é€šã‚Šï¼‰ã‚’ä½¿ç”¨ã—ã¾ã™ã€‚
    è¡çªæ¤œçŸ¥ãƒ­ã‚¸ãƒƒã‚¯ã«ã‚ˆã‚Šã€ç™ºè¡Œæ¸ˆã¿IDã¨é‡è¤‡ã—ãŸå ´åˆã¯è‡ªå‹•ã§å†æ¡ç•ªã—ã¾ã™ã€‚æœ¬ç•ªã§ã¯Kintoneã®IDãƒ†ãƒ¼ãƒ–ãƒ«ã¨ç…§åˆã—ã¾ã™ã€‚
  </div>

  <!-- â”€â”€ ä¼šå“¡ID Generator â”€â”€ -->
  <div class="sec-title" style="font-size:14px;margin-bottom:14px">ä¼šå“¡ID æ¡ç•ª</div>
  <div class="g4" style="margin-bottom:24px">
    <!-- HQ exec (æ‰‹å‹•æŒ‡å®š) -->
    <div class="id-gen-card igc-hq">
      <div class="igc-type">ğŸ¢ HQ çµ±æ‹¬ï¼ˆexecï¼‰</div>
      <div class="igc-range">ç¯„å›²ï¼š00001 ã€œ 00199 <span style="font-size:8px;opacity:.6">æ‰‹å‹•æŒ‡å®š</span></div>
      <input type="number" id="exec-id-input" min="1" max="199"
        placeholder="1ã€œ199"
        style="width:100%;margin:8px 0 6px;padding:8px 10px;background:var(--bg2);border:1px solid var(--gold-dim);border-radius:7px;color:var(--gold);font-family:'DM Mono',monospace;font-size:16px;text-align:center;outline:none"
        oninput="previewExecId(this.value)">
      <div class="igc-preview" id="exec-id-preview" style="color:var(--gold);margin-top:0">â€”</div>
      <button class="igc-btn" style="background:var(--gold-bg);border:1px solid var(--gold-dim);color:var(--gold)"
              onclick="confirmExecId()">
        âœ… ã“ã®IDã‚’æ¡ç•ª
      </button>
      <div style="font-size:9px;color:var(--muted);margin-top:8px;text-align:center">
        exec IDã¯çµŒå–¶é™£ãŒç•ªå·ã‚’æŒ‡å®šã—ã¦ç™ºè¡Œã—ã¾ã™
      </div>
    </div>
    <!-- HQ staff/manager (ãƒ©ãƒ³ãƒ€ãƒ ) -->
    <div class="id-gen-card igc-hq" style="border-color:var(--border2)">
      <div class="igc-type">ğŸ¢ HQ ã‚¹ã‚¿ãƒƒãƒ•ï¼ãƒãƒãƒ¼ã‚¸ãƒ£ãƒ¼</div>
      <div class="igc-range">ç¯„å›²ï¼š00200 ã€œ 09999 <span style="font-size:8px;opacity:.6">ãƒ©ãƒ³ãƒ€ãƒ æ¡ç•ª</span></div>
      <div class="igc-preview" id="hq-id-preview" style="color:var(--gold)">â€”</div>
      <button class="igc-btn" style="background:var(--gold-bg);border:1px solid var(--gold-dim);color:var(--gold)"
              onclick="generateMemberId('hq')">
        ğŸ² æ¡ç•ªã™ã‚‹
      </button>
      <div style="font-size:9px;color:var(--muted);margin-top:8px;text-align:center">
        ä½¿ç”¨æ¸ˆã¿: <span id="hq-used">3</span> / 9800
      </div>
    </div>
    <!-- RE -->
    <div class="id-gen-card igc-re">
      <div class="igc-type">ğŸ  ä¸å‹•ç”£ã‚¨ãƒ¼ã‚¸ã‚§ãƒ³ãƒˆ</div>
      <div class="igc-range">ç¯„å›²ï¼š10001 ã€œ 19999</div>
      <div class="igc-preview" id="re-id-preview" style="color:var(--blue)">â€”</div>
      <button class="igc-btn" style="background:rgba(79,156,249,.1);border:1px solid rgba(79,156,249,.25);color:var(--blue)"
              onclick="generateMemberId('re')">
        ğŸ² æ¡ç•ªã™ã‚‹
      </button>
      <div style="font-size:9px;color:var(--muted);margin-top:8px;text-align:center">
        ä½¿ç”¨æ¸ˆã¿: <span id="re-used">4</span> / 9999
      </div>
    </div>
    <!-- HR -->
    <div class="id-gen-card igc-hr">
      <div class="igc-type">ğŸ‘¥ äººæç´¹ä»‹ã‚¨ãƒ¼ã‚¸ã‚§ãƒ³ãƒˆ</div>
      <div class="igc-range">ç¯„å›²ï¼š20001 ã€œ 29999</div>
      <div class="igc-preview" id="hr-id-preview" style="color:var(--green)">â€”</div>
      <button class="igc-btn" style="background:rgba(52,211,153,.08);border:1px solid rgba(52,211,153,.2);color:var(--green)"
              onclick="generateMemberId('hr')">
        ğŸ² æ¡ç•ªã™ã‚‹
      </button>
      <div style="font-size:9px;color:var(--muted);margin-top:8px;text-align:center">
        ä½¿ç”¨æ¸ˆã¿: <span id="hr-used">1</span> / 9999
      </div>
    </div>
    <!-- PT -->
    <div class="id-gen-card igc-pt">
      <div class="igc-type">ğŸ¤ ãƒ‘ãƒ¼ãƒˆãƒŠãƒ¼</div>
      <div class="igc-range">ç¯„å›²ï¼š30001 ã€œ 39999</div>
      <div class="igc-preview" id="pt-id-preview" style="color:var(--purple)">â€”</div>
      <button class="igc-btn" style="background:rgba(167,139,250,.1);border:1px solid rgba(167,139,250,.25);color:var(--purple)"
              onclick="generateMemberId('pt')">
        ğŸ² æ¡ç•ªã™ã‚‹
      </button>
      <div style="font-size:9px;color:var(--muted);margin-top:8px;text-align:center">
        ä½¿ç”¨æ¸ˆã¿: <span id="pt-used">1</span> / 9999
      </div>
    </div>
  </div>

  <!-- â”€â”€ æ¡ˆä»¶ID Generator â”€â”€ -->
  <div class="g2" style="align-items:start;margin-bottom:24px">
    <div class="card">
      <div class="card-hdr">
        <div class="ch-title">æ¡ˆä»¶ID æ¡ç•ª</div>
        <span style="font-size:10px;color:var(--muted)">å½¢å¼: {ç¨®åˆ¥1æ–‡å­—}{6æ¡}ã€€ä¾‹: R047391</span>
      </div>
      <div class="card-body">
        <div style="font-size:11px;color:var(--sub);margin-bottom:16px;line-height:1.9">
          è‹±å¤§æ–‡å­—ï¼ˆIãƒ»Oé™¤ãï¼‰ï¼‹æ•°å­—ï¼ˆ0ãƒ»1é™¤ãï¼‰ã®6æ–‡å­—ãƒ©ãƒ³ãƒ€ãƒ æ–‡å­—åˆ—ã€‚<br>
          <strong style="color:var(--text)">çµ„ã¿åˆã‚ã›æ•°ï¼šç´„21å„„é€šã‚Š</strong>ï¼ˆé‡è¤‡ãƒã‚§ãƒƒã‚¯ä»˜ãï¼‰
        </div>

        <div style="font-size:10px;color:var(--sub);margin-bottom:8px">æ¡ˆä»¶ç¨®åˆ¥ <span style="font-size:9px;color:var(--muted)">ï¼ˆé ­æ–‡å­—ãŒå¤‰ã‚ã‚Šã¾ã™ï¼‰</span></div>
        <div style="display:flex;gap:8px;margin-bottom:10px;flex-wrap:wrap">
          <button class="btn btn-ghost btn-sm ctype-btn" id="ct-rent"
                  onclick="selCaseType('rent',this)">
            ğŸ  è³ƒè²¸ä»²ä»‹ <span class="mono" style="font-size:10px;margin-left:4px;color:var(--blue)">R-</span>
          </button>
          <button class="btn btn-ghost btn-sm ctype-btn" id="ct-sale"
                  onclick="selCaseType('sale',this)">
            ğŸ¢ å£²è²· <span class="mono" style="font-size:10px;margin-left:4px;color:var(--gold)">S-</span>
          </button>
          <button class="btn btn-ghost btn-sm ctype-btn" id="ct-hr"
                  onclick="selCaseType('hr',this)">
            ğŸ‘¥ äººæç´¹ä»‹ <span class="mono" style="font-size:10px;margin-left:4px;color:var(--green)">H-</span>
          </button>
        </div>
        <div style="font-size:9px;color:var(--muted);margin-bottom:14px;line-height:1.8;
                    padding:8px 10px;background:rgba(255,255,255,.02);border-radius:8px;border:1px solid var(--border)">
          æ•°å­—6æ¡ãŒæ¯æ¸‡ã—ãŸã‚‰è‡ªå‹•ã§è‹±æ•°å­—6æ¡ã«åˆ‡ã‚Šæ›¿ã‚ã‚Šã¾ã™<br>
          æ•°å­—æ®µéšï¼š<span class="mono" style="color:var(--text)">R000000</span> ã€œ <span class="mono" style="color:var(--text)">R999999</span>ï¼ˆ100ä¸‡é€šã‚Šï¼‰<br>
          è‹±æ•°å­—æ®µéšï¼š<span class="mono" style="color:var(--text)">RA3K7M2</span>â€¦ï¼ˆç´„10å„„é€šã‚Šè¿½åŠ ï¼‰
        </div>

        <div class="case-id-display" id="case-id-display">
          <span style="color:var(--muted)">â€” ç¨®åˆ¥ã‚’é¸ã‚“ã§æ¡ç•ª â€”</span>
          <span class="cid-copy" id="cid-copy-btn" style="display:none" onclick="copyCaseId()">ğŸ“‹</span>
        </div>
        <div id="cid-mode-label" style="font-size:9px;color:var(--muted);margin-bottom:12px;display:none">
          ç¾åœ¨ï¼š<span id="cid-mode-text"></span>
        </div>

        <div style="display:flex;gap:8px">
          <button class="igc-btn" id="gen-case-btn"
                  style="flex:1;background:var(--gold-bg);border:1px solid var(--gold-dim);
                  color:var(--gold);padding:11px;border-radius:9px;font-weight:700;font-size:12px"
                  onclick="genCaseId()" disabled>
            ğŸ² æ¡ˆä»¶IDã‚’æ¡ç•ªã™ã‚‹
          </button>
          <button class="btn btn-ghost" onclick="confirmCaseId()" id="confirm-case-btn" style="display:none">
            âœ… ç¢ºå®š
          </button>
        </div>
        <div style="font-size:10px;color:var(--muted);margin-top:10px;line-height:1.8">
          æ¡ç•ªå¾Œã€Œç¢ºå®šã€ã‚’æŠ¼ã™ã¨Kintoneã«ç™»éŒ²ã•ã‚Œã¾ã™ã€‚<br>
          ç¢ºå®šå‰ã¯IDã¯äºˆç´„ã•ã‚Œã¾ã›ã‚“ã€‚
        </div>
      </div>
    </div>

    <!-- Algorithm detail -->
    <div class="card">
      <div class="card-hdr"><div class="ch-title">æ¡ç•ªã‚¢ãƒ«ã‚´ãƒªã‚ºãƒ </div></div>
      <div class="card-body">
        <div style="font-size:11px;color:var(--sub);line-height:1;margin-bottom:16px">
          <pre style="background:#090b13;border:1px solid var(--border2);border-radius:9px;
               padding:14px;font-family:'DM Mono',monospace;font-size:10px;color:var(--text);
               line-height:1.7;overflow-x:auto">// ä¼šå“¡IDæ¡ç•ª
function generateMemberId(type) {
  const ranges = {
    hq: [1, 9999],
    re: [10001, 19999],
    hr: [20001, 29999],
    pt: [30001, 39999],
  };
  const [min, max] = ranges[type];
  let id, attempts = 0;
  do {
    id = Math.floor(
      Math.random() * (max - min + 1) + min
    );
    attempts++;
    // è¡çªæ¤œçŸ¥ï¼ˆæœ¬ç•ª: Kintone APIã§ç¢ºèªï¼‰
  } while (issuedIds.has(id) && attempts < 100);
  issuedIds.add(id);
  return id.toString().padStart(5, '0');
}

// æ¡ˆä»¶IDæ¡ç•ªï¼ˆæ®µéšçš„ï¼‰
// æ®µéš1: PREFIX + æ•°å­—6æ¡ (000000-999999, 100ä¸‡é€šã‚Š)
// æ®µéš2: PREFIX + è‹±æ•°å­—6æ¡ (æ¯æ¸‡å¾Œ)
function genCaseIdInternal(prefix) {
  const year = new Date().getFullYear();
  const nums = issuedCaseNums.get(prefix) || new Set();
  let suffix, attempts = 0;
  // æ®µéš1: æ•°å­—ã®ã¿
  const numExhausted = nums.size >= 1000000;
  if (!numExhausted) {
    do {
      suffix = String(Math.floor(Math.random()*1000000)).padStart(6,'0');
      attempts++;
    } while (nums.has(suffix) && attempts < 2000);
    if (!nums.has(suffix)) {
      nums.add(suffix);
      issuedCaseNums.set(prefix, nums);
      return { id: `${prefix}${suffix}`, mode:'æ•°å­—æ®µéš' };
    }
  }
  // æ®µéš2: è‹±æ•°å­— (Iãƒ»Oãƒ»0ãƒ»1é™¤ã)
  const chars = 'ABCDEFGHJKLMNPQRSTUVWXYZ23456789';
  const alphas = issuedCaseAlpha.get(prefix) || new Set();
  do {
    suffix = Array.from({length:6},
      ()=>chars[Math.floor(Math.random()*chars.length)]).join('');
    attempts++;
  } while (alphas.has(suffix) && attempts < 5000);
  alphas.add(suffix);
  issuedCaseAlpha.set(prefix, alphas);
  return { id: `${prefix}${suffix}`, mode:'è‹±æ•°å­—æ®µéšï¼ˆæ•°å­—æ¯æ¸‡å¾Œï¼‰' };
}</pre>
        </div>
        <div style="font-size:10px;color:var(--muted);line-height:1.9">
          âœ… è¡çªæ¤œçŸ¥ï¼šç™ºè¡Œæ¸ˆã¿IDã¨é‡è¤‡ã—ãŸå ´åˆã¯è‡ªå‹•ã§å†æ¡ç•ªï¼ˆæœ€å¤§100å›ï¼‰<br>
          âœ… æ¨æ¸¬ä¸å¯ï¼šé€£ç•ªã§ãªã„ãŸã‚ã‚¹ã‚­ãƒ£ãƒ‹ãƒ³ã‚°æ”»æ’ƒã«è€æ€§<br>
          âœ… è¦–èªæ€§ï¼šç´›ã‚‰ã‚ã—ã„æ–‡å­—ï¼ˆI/O/0/1ï¼‰ã‚’é™¤å¤–<br>
          âœ… æœ¬ç•ªé€£æºï¼šKintone ã®ç™ºè¡Œæ¸ˆã¿IDãƒ†ãƒ¼ãƒ–ãƒ«ã¨ç…§åˆ
        </div>
      </div>
    </div>
  </div>

  <!-- â”€â”€ ç™ºè¡Œå±¥æ­´ â”€â”€ -->
  <div class="card">
    <div class="card-hdr">
      <div class="ch-title">æœ€è¿‘ã®ç™ºè¡Œå±¥æ­´</div>
      <button class="btn btn-ghost btn-sm">ğŸ“¥ CSVãƒ€ã‚¦ãƒ³ãƒ­ãƒ¼ãƒ‰</button>
    </div>
    <div style="overflow-x:auto">
      <table class="tbl">
        <thead><tr>
          <th>ç™ºè¡ŒID</th><th>ç¨®åˆ¥</th><th>ç™ºè¡Œæ—¥æ™‚</th><th>æ‹…å½“HQ</th><th>å¯¾è±¡è€…</th><th>æ¡ç•ªå›æ•°</th><th>ã‚¹ãƒ†ãƒ¼ã‚¿ã‚¹</th>
        </tr></thead>
        <tbody id="issue-history">
          <tr>
            <td class="mono" style="color:var(--blue);font-weight:700">10012</td>
            <td><span class="pill pill-blue">RE AG</span></td>
            <td class="mono" style="font-size:10px">2026/01/15 10:32</td>
            <td style="font-size:11px">HQ çµ±æ‹¬ï¼ˆ00001ï¼‰</td>
            <td style="font-size:11px">å±±ç”° èª </td>
            <td class="mono" style="font-size:11px;color:var(--muted)">1å›ç›®</td>
            <td><span class="pill pill-green">ç™ºè¡Œæ¸ˆã¿ãƒ»KYCå®Œäº†</span></td>
          </tr>
          <tr>
            <td class="mono" style="color:var(--green);font-weight:700">20005</td>
            <td><span class="pill pill-green">HR AG</span></td>
            <td class="mono" style="font-size:10px">2026/01/28 14:05</td>
            <td style="font-size:11px">HQ çµ±æ‹¬ï¼ˆ00001ï¼‰</td>
            <td style="font-size:11px">ç”°ä¸­ ç¾ç©‚</td>
            <td class="mono" style="font-size:11px;color:var(--muted)">1å›ç›®</td>
            <td><span class="pill pill-green">ç™ºè¡Œæ¸ˆã¿ãƒ»KYCå®Œäº†</span></td>
          </tr>
          <tr>
            <td class="mono" style="color:var(--purple);font-weight:700">30007</td>
            <td><span class="pill pill-purple">PT</span></td>
            <td class="mono" style="font-size:10px">2026/02/03 09:18</td>
            <td style="font-size:11px">HQ ã‚¹ã‚¿ãƒƒãƒ•ï¼ˆ00003ï¼‰</td>
            <td style="font-size:11px">ä½è—¤ ç¾å’²</td>
            <td class="mono" style="font-size:11px;color:var(--muted)">1å›ç›®</td>
            <td><span class="pill pill-green">ç™ºè¡Œæ¸ˆã¿ãƒ»KYCå®Œäº†</span></td>
          </tr>
          <tr>
            <td class="mono" style="color:var(--blue);font-weight:700">R047391</td>
            <td><span class="pill pill-blue">ğŸ  è³ƒè²¸ä»²ä»‹</span></td>
            <td class="mono" style="font-size:10px">2026/02/12 11:44</td>
            <td style="font-size:11px">å±±ç”° èª ï¼ˆ10012ï¼‰</td>
            <td style="font-size:11px">ç”°ä¸­ é›„ä»‹ï¼ˆè³ƒè²¸ï¼‰</td>
            <td class="mono" style="font-size:11px;color:var(--muted)">æ•°å­—æ®µéš 1å›ç›®</td>
            <td><span class="pill pill-green">é€²è¡Œä¸­</span></td>
          </tr>
          <tr>
            <td class="mono" style="color:var(--gold);font-weight:700">S819204</td>
            <td><span class="pill pill-gold">ğŸ¢ å£²è²·</span></td>
            <td class="mono" style="font-size:10px">2026/02/14 09:30</td>
            <td style="font-size:11px">ä½è—¤ èŠ±å­ï¼ˆ10008ï¼‰</td>
            <td style="font-size:11px">å‰ç”° å¤§è¼”ï¼ˆå£²è²·ï¼‰</td>
            <td class="mono" style="font-size:11px;color:var(--muted)">æ•°å­—æ®µéš 1å›ç›®</td>
            <td><span class="pill pill-green">é€²è¡Œä¸­</span></td>
          </tr>
          <tr>
            <td class="mono" style="color:var(--green);font-weight:700">H334521</td>
            <td><span class="pill pill-green">ğŸ‘¥ äººæç´¹ä»‹</span></td>
            <td class="mono" style="font-size:10px">2026/02/16 15:20</td>
            <td style="font-size:11px">ç”°ä¸­ ç¾ç©‚ï¼ˆ20005ï¼‰</td>
            <td style="font-size:11px">å¤§æ‰‹ITä¼æ¥­ï¼ˆHRï¼‰</td>
            <td class="mono" style="font-size:11px;color:var(--muted)">æ•°å­—æ®µéš 1å›ç›®</td>
            <td><span class="pill pill-green">é€²è¡Œä¸­</span></td>
          </tr>
        </tbody>
      </table>
    </div>
  </div>
</div>

<script src="db.js"></script>
<script>

  // â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
  //  CORETO èªè¨¼ã‚¬ãƒ¼ãƒ‰ v2 â€” HQå°‚ç”¨ + ã‚»ãƒƒã‚·ãƒ§ãƒ³æ•´åˆæ€§ãƒã‚§ãƒƒã‚¯ä»˜ã
  // â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
  (function() {
    var s;
    try { s = JSON.parse(sessionStorage.getItem('coreto_session') || 'null'); } catch(e) { s = null; }
    if (!s || !s.userId || !s.type) {
      sessionStorage.setItem('coreto_redirect', window.location.href);
      window.location.replace('coreto-login.html');
      return;
    }
    if (!s.sessionToken || s.sessionToken.length !== 64) {
      sessionStorage.removeItem('coreto_session');
      window.location.replace('coreto-login.html');
      return;
    }
    var loginAt = new Date(s.loginAt).getTime();
    if (isNaN(loginAt) || (Date.now() - loginAt) > 28800000) {
      sessionStorage.removeItem('coreto_session');
      alert('ã‚»ãƒƒã‚·ãƒ§ãƒ³ã®æœ‰åŠ¹æœŸé™ãŒåˆ‡ã‚Œã¾ã—ãŸã€‚å†åº¦ãƒ­ã‚°ã‚¤ãƒ³ã—ã¦ãã ã•ã„ã€‚');
      window.location.replace('coreto-login.html');
      return;
    }
    if (s.type !== 'hq') {
      window.location.replace('coreto-hub.html');
      return;
    }
    window._SESSION = s;
  })();
  // â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•


// â”€â”€ Issued ID sets (demo: pre-filled with known IDs) â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
const issuedMemberIds = new Set([1,2,3, 10008,10012,10023,10041, 20005, 30007]);
const issuedCaseIds   = new Set(['X7K3M1','P9W4R2','A3R7Z6','K9T2M5']);

const RANGES = { hq:[200,9999], hq_exec:[1,199], re:[10001,19999], hr:[20001,29999], pt:[30001,39999] };
const COLORS  = { hq:'var(--gold)', re:'var(--blue)', hr:'var(--green)', pt:'var(--purple)' };
const CHARS   = 'ABCDEFGHJKLMNPQRSTUVWXYZ23456789';
const YEAR    = new Date().getFullYear();

let currentCaseId   = null;
let selectedCaseType = 're';
let lastGeneratedMemberIds = {};

// â”€â”€ Member ID generation â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
function generateMemberId(type) {
  const [min, max] = RANGES[type];
  let id, attempts = 0;
  do {
    id = Math.floor(Math.random() * (max - min + 1) + min);
    attempts++;
  } while (issuedMemberIds.has(id) && attempts < 200);

  const formatted = id.toString().padStart(5, '0');
  lastGeneratedMemberIds[type] = id;

  const el = document.getElementById(type+'-id-preview');
  el.textContent = formatted;
  el.style.color  = COLORS[type];
  el.classList.remove('id-spin');
  void el.offsetWidth; // reflow
  el.classList.add('id-spin');

  // Update used count display (demo only increments visually)
  const usedEl = document.getElementById(type+'-used');
  usedEl.textContent = parseInt(usedEl.textContent)+1;

  // Add to history
  addToHistory(formatted, type);

  return formatted;
}

// â”€â”€ exec ID: æ‰‹å‹•æŒ‡å®šï¼ˆ00001â€“00199ï¼‰â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
function previewExecId(val) {
  const n = parseInt(val);
  const el = document.getElementById('exec-id-preview');
  if (!val || isNaN(n) || n < 1 || n > 199) {
    el.textContent = 'â€”';
    return;
  }
  const formatted = n.toString().padStart(5, '0');
  el.textContent = issuedMemberIds.has(n) ? formatted + 'ï¼ˆä½¿ç”¨æ¸ˆï¼‰' : formatted;
  el.style.color = issuedMemberIds.has(n) ? 'var(--red)' : 'var(--gold)';
}

function confirmExecId() {
  const val = parseInt(document.getElementById('exec-id-input').value);
  const el = document.getElementById('exec-id-preview');
  if (isNaN(val) || val < 1 || val > 199) {
    el.textContent = '1ã€œ199ã®ç•ªå·ã‚’å…¥åŠ›ã—ã¦ãã ã•ã„';
    el.style.color = 'var(--red)';
    return;
  }
  if (issuedMemberIds.has(val)) {
    el.textContent = 'ç•ªå· ' + val.toString().padStart(5,'0') + ' ã¯ã™ã§ã«ä½¿ç”¨æ¸ˆã¿ã§ã™';
    el.style.color = 'var(--red)';
    return;
  }
  const formatted = val.toString().padStart(5, '0');
  issuedMemberIds.add(val);
  el.textContent = formatted;
  el.style.color = 'var(--gold)';
  el.classList.remove('id-spin');
  void el.offsetWidth;
  el.classList.add('id-spin');
  addToHistory(formatted, 'hq_exec');
  document.getElementById('exec-id-input').value = '';
}


// â”€â”€ Case ID generation â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
let currentCasePrefix = null;
const prefixMap = {
  rent: { prefix:'R', color:'var(--blue)',  label:'è³ƒè²¸ä»²ä»‹' },
  sale: { prefix:'S', color:'var(--gold)',  label:'å£²è²·' },
  hr:   { prefix:'H', color:'var(--green)', label:'äººæç´¹ä»‹' },
};

function selCaseType(type, btn) {
  currentCasePrefix = type;
  document.querySelectorAll('.ctype-btn').forEach(b=>{
    b.style.borderColor=''; b.style.color=''; b.style.background='';
  });
  const {color} = prefixMap[type];
  btn.style.borderColor = color;
  btn.style.color        = color;
  btn.style.background   = color.replace(')',', .08)').replace('var(--','rgba(').replace(')','');
  // safer approach:
  const bgMap={rent:'rgba(79,156,249,.08)',sale:'rgba(201,168,76,.08)',hr:'rgba(52,211,153,.08)'};
  btn.style.background = bgMap[type];
  document.getElementById('gen-case-btn').disabled = false;
  currentCaseId = null;
  document.getElementById('confirm-case-btn').style.display = 'none';
}

function genCaseId() {
  if (!currentCasePrefix) return;
  const {prefix, color, label} = prefixMap[currentCasePrefix];
  const result = genCaseIdInternal(prefix);
  currentCaseId = result.id;

  const display = document.getElementById('case-id-display');
  display.innerHTML = `<span style="color:${color};font-size:18px;font-weight:700;letter-spacing:2px">${currentCaseId}</span>
    <span class="cid-copy" onclick="copyCaseId()">ğŸ“‹</span>`;

  const modeEl = document.getElementById('cid-mode-label');
  const modeText = document.getElementById('cid-mode-text');
  modeEl.style.display = 'block';
  modeText.textContent = `${label}ï¼ˆ${prefix}ï¼‰ / ${result.mode}`;
  modeText.style.color = color;

  document.getElementById('confirm-case-btn').style.display = 'inline-flex';
  display.style.animation='none'; void display.offsetWidth;
  display.style.animation='spin-in .25s ease';
}

function copyCaseId() {
  if (!currentCaseId) return;
  navigator.clipboard.writeText(currentCaseId)
    .then(()=>{ alert('âœ… ã‚³ãƒ”ãƒ¼ã—ã¾ã—ãŸï¼š'+currentCaseId); })
    .catch(()=>{ prompt('IDã‚’ã‚³ãƒ”ãƒ¼ã—ã¦ãã ã•ã„ï¼š', currentCaseId); });
}

function confirmCaseId() {
  if (!currentCaseId) return;
  addToHistory(currentCaseId, 'case');
  document.getElementById('confirm-case-btn').style.display = 'none';
  alert(`âœ… æ¡ˆä»¶IDã€Œ${currentCaseId}ã€ã‚’Kintoneã«ç™»éŒ²ã—ã¾ã—ãŸã€‚\n\nè³ƒè²¸ä»²ä»‹=R / å£²è²·=S / äººæç´¹ä»‹=H`);
  currentCaseId = null;
}

// â”€â”€ History â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
function addToHistory(id, type) {
  const tbody = document.getElementById('issue-history');
  const row   = document.createElement('tr');
  const now   = new Date().toLocaleString('ja-JP',{year:'numeric',month:'2-digit',day:'2-digit',hour:'2-digit',minute:'2-digit'});
  const pillMap = {
    hq:   ['pill-gold',  'HQ æœ¬éƒ¨'],
    re:   ['pill-blue',  'RE AG'],
    hr:   ['pill-green', 'HR AG'],
    pt:   ['pill-purple','PT'],
    case: ['pill-teal',  'æ¡ˆä»¶ID'],
  };
  const [pc, label] = pillMap[type] || ['pill-muted','ä¸æ˜'];
  const col = {hq:'var(--gold)',re:'var(--blue)',hr:'var(--green)',pt:'var(--purple)',case:'var(--teal)'}[type];
  row.innerHTML = `
    <td class="mono" style="color:${col};font-weight:700">${id}</td>
    <td><span class="pill ${pc}">${label}</span></td>
    <td class="mono" style="font-size:10px">${now}</td>
    <td style="font-size:11px">HQ çµ±æ‹¬ï¼ˆ00001ï¼‰</td>
    <td style="font-size:11px">â€”</td>
    <td class="mono" style="font-size:11px;color:var(--muted)">ä»Šå›</td>
    <td><span class="pill pill-blue">ç™ºè¡Œæ¸ˆã¿ï¼ˆæœªç¢ºå®šï¼‰</span></td>`;
  tbody.insertBefore(row, tbody.firstChild);
}
</script>
</body>
</html>
