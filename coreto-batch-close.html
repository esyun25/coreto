<!DOCTYPE html>
<html lang="ja">
<head>
  <!-- â”€â”€ Content Security Policy (XSSè»½æ¸›) â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
       å¤‰æ›´æ™‚: ä½¿ç”¨ã™ã‚‹å¤–éƒ¨ã‚µãƒ¼ãƒ“ã‚¹ã®ã‚ªãƒªã‚¸ãƒ³ã‚’è¿½åŠ ã—ã¦ãã ã•ã„
       Kintoneè¿½åŠ æ™‚: connect-src ã« *.cybozu.com ã‚’è¿½åŠ 
  â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ -->
  <meta http-equiv="Content-Security-Policy" content="
    default-src 'self';
    script-src 'self' 'unsafe-inline'
      https://cdnjs.cloudflare.com
      https://js.stripe.com
      https://cdn-cgi/scripts;
    style-src 'self' 'unsafe-inline'
      https://fonts.googleapis.com;
    font-src 'self'
      https://fonts.gstatic.com;
    img-src 'self' data: blob:;
    connect-src 'self'
      https://hooks.slack.com
      https://hooks.zapier.com
      https://api.stripe.com
      https://js.stripe.com
      https://www.houjin-bangou.nta.go.jp
      https://www.retio.or.jp;
    frame-src 'none';
    object-src 'none';
    base-uri 'self';
  ">

<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>CORETO æˆç´„å ±å‘Šãƒ»æŒ¯è¾¼ãƒãƒƒãƒç®¡ç†</title>
<style>
@import url('https://fonts.googleapis.com/css2?family=Noto+Sans+JP:wght@300;400;500;700&family=DM+Mono:wght@400;500&family=Syne:wght@700;800&display=swap');
*{box-sizing:border-box;margin:0;padding:0}
:root{
  --bg:#07090f;--card:#0f1119;--card2:#141720;--border:#1e2235;--border2:#252a3d;
  --gold:#c9a84c;--gold-l:#e8c96a;--gold-dim:#7a5f22;--gold-glow:rgba(201,168,76,.12);
  --blue:#4f9cf9;--green:#34d399;--red:#f87171;--orange:#fb923c;--purple:#a78bfa;
  --muted:#4a5270;--sub:#7a849e;--text:#e2e6f3;
}
body{font-family:'Noto Sans JP',sans-serif;background:var(--bg);color:var(--text);min-height:100vh;
  background-image:radial-gradient(ellipse 60% 40% at 80% 10%,rgba(201,168,76,.05) 0%,transparent 60%)}

/* â”€â”€ ãƒ˜ãƒƒãƒ€ãƒ¼ â”€â”€ */
.header{display:flex;align-items:center;justify-content:space-between;padding:0 32px;height:56px;
  border-bottom:1px solid var(--border);background:rgba(7,9,15,.8);backdrop-filter:blur(12px);
  position:sticky;top:0;z-index:100}
.logo{font-family:'Syne',sans-serif;font-size:19px;font-weight:800;color:var(--gold);letter-spacing:3px}
.header-right{display:flex;align-items:center;gap:12px}
.hdr-agent{font-size:12px;font-weight:600}
.hdr-id{font-family:'DM Mono',monospace;font-size:10px;color:var(--muted)}

/* â”€â”€ ã‚¿ãƒ– â”€â”€ */
.tabs{display:flex;padding:0 32px;background:rgba(7,9,15,.6);border-bottom:1px solid var(--border);gap:2px}
.tab{padding:12px 20px;font-size:11px;font-weight:600;cursor:pointer;border-bottom:2px solid transparent;
  color:var(--muted);transition:all .2s;letter-spacing:.5px;white-space:nowrap}
.tab.on{color:var(--gold);border-bottom-color:var(--gold)}
.tab:hover:not(.on){color:var(--sub)}
.tab-dot{display:inline-block;width:6px;height:6px;border-radius:50%;background:var(--red);
  margin-left:6px;vertical-align:middle;animation:pulse 2s infinite}
@keyframes pulse{0%,100%{opacity:1}50%{opacity:.4}}

/* â”€â”€ ãƒšãƒ¼ã‚¸ â”€â”€ */
.page{display:none;padding:24px 32px;max-width:1400px;margin:0 auto}.page.on{display:block}

/* â”€â”€ ã‚°ãƒªãƒƒãƒ‰ â”€â”€ */
.two-col{display:grid;grid-template-columns:460px 1fr;gap:20px;align-items:start}
.two-col-eq{display:grid;grid-template-columns:1fr 1fr;gap:12px}
.three-col{display:grid;grid-template-columns:1fr 1fr 1fr;gap:10px}

/* â”€â”€ ãƒ‘ãƒãƒ« â”€â”€ */
.panel{background:var(--card);border:1px solid var(--border);border-radius:14px;padding:22px;margin-bottom:16px}
.panel-hd{display:flex;align-items:center;justify-content:space-between;margin-bottom:18px}
.panel-title{font-family:'Syne',sans-serif;font-size:12px;font-weight:700;color:var(--gold);
  letter-spacing:2px;text-transform:uppercase;display:flex;align-items:center;gap:8px}
.panel-title::before{content:'';width:3px;height:14px;background:var(--gold);border-radius:2px;flex-shrink:0}
.panel-sub{font-size:10px;color:var(--muted)}

/* â”€â”€ ãƒ•ã‚©ãƒ¼ãƒ  â”€â”€ */
.s-label{font-size:9px;color:var(--muted);letter-spacing:2px;text-transform:uppercase;
  padding:10px 0 7px;border-bottom:1px solid var(--border);margin-bottom:10px;margin-top:18px;
  display:flex;align-items:center;gap:8px}
.s-label:first-child{margin-top:0}
.auto-tag{font-size:8px;color:var(--blue);background:rgba(79,156,249,.1);
  border:1px solid rgba(79,156,249,.2);border-radius:3px;padding:1px 5px;
  letter-spacing:.5px;font-weight:700;white-space:nowrap}
.fg{margin-bottom:10px}
.fg label{font-size:11px;color:var(--sub);display:block;margin-bottom:4px}
.req{color:var(--red);margin-left:2px;font-size:9px}
.hint{color:var(--muted);font-size:9px;margin-left:6px}
input,select,textarea{width:100%;background:#0a0c14;border:1px solid var(--border2);border-radius:8px;
  padding:9px 12px;color:var(--text);font-size:13px;font-family:'Noto Sans JP',sans-serif;
  transition:border-color .15s,box-shadow .15s;-webkit-appearance:none}
input:focus,select:focus,textarea:focus{outline:none;border-color:var(--gold);
  box-shadow:0 0 0 3px rgba(201,168,76,.08)}
input[type=date]{color-scheme:dark}
/* è‡ªå‹•å…¥åŠ›ãƒ•ã‚£ãƒ¼ãƒ«ãƒ‰ã®ã‚¹ã‚¿ã‚¤ãƒ« */
.auto-filled{background:#0c0e18;border-color:rgba(79,156,249,.25);color:var(--text)}
.auto-filled:focus{border-color:var(--gold)}
textarea{resize:vertical;min-height:72px}
.mono{font-family:'DM Mono',monospace!important}
.err-msg{font-size:10px;color:var(--red);margin-top:3px;display:none}
.err-msg.show{display:block}

/* â”€â”€ ãƒˆã‚°ãƒ«ãƒœã‚¿ãƒ³ â”€â”€ */
.tg-group{display:flex;gap:6px;flex-wrap:wrap;margin-top:4px}
.tg{padding:6px 13px;border-radius:7px;font-size:11px;cursor:pointer;border:1px solid var(--border2);
  background:transparent;color:var(--muted);font-family:'Noto Sans JP',sans-serif;
  transition:all .15s;white-space:nowrap}
.tg.on{background:rgba(201,168,76,.12);border-color:var(--gold-dim);color:var(--gold);font-weight:700}
.tg.on.bl{background:rgba(79,156,249,.12);border-color:rgba(79,156,249,.4);color:var(--blue)}
.tg.on.gr{background:rgba(52,211,153,.12);border-color:rgba(52,211,153,.4);color:var(--green)}

/* â”€â”€ ãƒœã‚¿ãƒ³ â”€â”€ */
.btn{padding:10px 18px;border-radius:9px;font-size:12px;font-weight:700;cursor:pointer;border:none;
  font-family:'Noto Sans JP',sans-serif;transition:all .2s;letter-spacing:.5px}
.btn-gold{background:linear-gradient(135deg,var(--gold),#a8872f);color:#0a0c10}
.btn-gold:hover{background:linear-gradient(135deg,var(--gold-l),var(--gold));transform:translateY(-1px)}
.btn-blue{background:rgba(79,156,249,.15);color:var(--blue);border:1px solid rgba(79,156,249,.3)}
.btn-blue:hover{background:rgba(79,156,249,.25)}
.btn-green{background:rgba(52,211,153,.15);color:var(--green);border:1px solid rgba(52,211,153,.3)}
.btn-green:hover{background:rgba(52,211,153,.25)}
.btn-muted{background:transparent;color:var(--muted);border:1px solid var(--border2)}
.btn-muted:hover{color:var(--text)}
.btn-full{width:100%;padding:13px;font-size:13px;margin-top:8px}
.btn-sm{padding:5px 10px;font-size:10px;border-radius:6px}

/* â”€â”€ æ¡ˆä»¶IDã‚¨ãƒªã‚¢ â”€â”€ */
.case-id-wrap{display:flex;gap:8px;align-items:stretch}
.case-id-wrap input{flex:1;font-size:15px;font-family:'DM Mono',monospace;letter-spacing:2px}
.case-id-wrap .btn{flex-shrink:0;align-self:center}

/* â”€â”€ æ¡ˆä»¶ãƒ—ãƒ¬ãƒ“ãƒ¥ãƒ¼ã‚«ãƒ¼ãƒ‰ â”€â”€ */
.case-preview{background:rgba(79,156,249,.04);border:1px solid rgba(79,156,249,.2);
  border-radius:10px;padding:14px;margin-top:10px;display:none}
.cp-prop{font-size:14px;font-weight:700;margin-bottom:6px}
.cp-row{display:flex;justify-content:space-between;font-size:11px;padding:3px 0;
  border-bottom:1px solid rgba(30,34,53,.6)}
.cp-row:last-child{border:none}
.cp-key{color:var(--muted)}
.cp-val{color:var(--text);font-weight:600;font-family:'DM Mono',monospace;font-size:11px}

/* â”€â”€ ãƒ—ãƒ¬ãƒ¼ã‚¹ãƒ›ãƒ«ãƒ€ãƒ¼ â”€â”€ */
.placeholder-box{text-align:center;padding:40px 24px;color:var(--muted)}
.placeholder-box .ph-icon{font-size:36px;margin-bottom:14px}
.placeholder-box .ph-title{font-size:13px;font-weight:700;color:var(--sub);margin-bottom:6px}
.placeholder-box .ph-desc{font-size:11px;line-height:1.9}

/* â”€â”€ è«‹æ±‚ã‚«ãƒ¼ãƒ‰ â”€â”€ */
.billing-card{background:var(--card2);border:1px solid var(--border2);border-radius:10px;
  padding:14px;margin-bottom:10px;position:relative}
.billing-card-num{position:absolute;top:-8px;left:14px;background:var(--gold);color:#0a0c10;
  font-size:9px;font-weight:800;padding:1px 7px;border-radius:4px;font-family:'DM Mono',monospace}
.billing-card.optional .billing-card-num{background:var(--muted)}
.remove-btn{position:absolute;top:10px;right:10px;width:22px;height:22px;border-radius:50%;
  background:rgba(248,113,113,.15);border:1px solid rgba(248,113,113,.25);color:var(--red);
  cursor:pointer;font-size:11px;display:flex;align-items:center;justify-content:center}

/* â”€â”€ ãƒãƒªãƒ‡ãƒ¼ã‚·ãƒ§ãƒ³ â”€â”€ */
.validation-box{background:var(--card2);border-radius:10px;padding:14px;margin-top:12px}
.val-row{display:flex;align-items:center;gap:8px;padding:5px 0;font-size:11px}
.val-icon{width:16px;height:16px;border-radius:50%;display:flex;align-items:center;justify-content:center;font-size:9px;flex-shrink:0}
.vi-ok{background:rgba(52,211,153,.2);color:var(--green)}
.vi-err{background:rgba(248,113,113,.2);color:var(--red)}
.vi-warn{background:rgba(251,146,60,.2);color:var(--orange)}
.vi-wait{background:var(--border2);color:var(--muted)}

/* â”€â”€ å ±é…¬ãƒ—ãƒ¬ãƒ“ãƒ¥ãƒ¼ â”€â”€ */
.reward-hero{background:linear-gradient(135deg,rgba(201,168,76,.08),rgba(201,168,76,.02));
  border:1px solid rgba(201,168,76,.2);border-radius:12px;padding:18px;margin:12px 0}
.rh-label{font-size:10px;color:var(--muted);margin-bottom:4px}
.rh-val{font-family:'DM Mono',monospace;font-size:32px;font-weight:500;color:var(--gold)}
.rh-note{font-size:10px;color:var(--sub);margin-top:6px;line-height:1.7}
.bk-row{display:flex;justify-content:space-between;align-items:center;padding:6px 0;
  border-bottom:1px solid rgba(30,34,53,.8);font-size:12px}
.bk-row:last-child{border-bottom:none}
.bk-val{font-family:'DM Mono',monospace;font-size:12px}
.bk-total{font-weight:700;font-size:13px;padding-top:8px!important}
.bk-total .bk-val{color:var(--gold);font-size:15px}
.minus{color:var(--red)}

/* â”€â”€ æœˆæ¬¡ãƒãƒƒãƒ â”€â”€ */
.timeline-bar{display:flex;align-items:stretch;gap:0;margin-bottom:20px;overflow:hidden;border-radius:10px;border:1px solid var(--border)}
.tl-step{flex:1;padding:10px 8px;text-align:center}
.tl-step.done{background:rgba(52,211,153,.08)}
.tl-step.active{background:rgba(201,168,76,.1);border-left:2px solid var(--gold);border-right:2px solid var(--gold)}
.tl-step.future{background:rgba(30,34,53,.3)}
.tl-day{font-family:'DM Mono',monospace;font-size:16px;font-weight:700;margin-bottom:2px}
.tl-label{font-size:9px;color:var(--muted)}
.tl-step.done .tl-day{color:var(--green)}
.tl-step.active .tl-day{color:var(--gold)}
.tl-step.future .tl-day{color:var(--muted)}

.stats-grid{display:grid;grid-template-columns:repeat(4,1fr);gap:10px;margin-bottom:16px}
.stat-card{background:var(--card);border:1px solid var(--border);border-radius:10px;padding:14px}
.stat-num{font-family:'DM Mono',monospace;font-size:26px;font-weight:500;line-height:1}
.stat-lbl{font-size:10px;color:var(--muted);margin-top:5px}
.stat-sub{font-size:11px;color:var(--sub);margin-top:4px;font-family:'DM Mono',monospace}

.check-grid{display:grid;grid-template-columns:1fr 1fr;gap:8px;margin:10px 0}
.check-item{background:var(--card2);border-radius:9px;padding:10px 13px;display:flex;align-items:center;gap:10px;font-size:11px}
.chk-icon{width:22px;height:22px;border-radius:50%;display:flex;align-items:center;justify-content:center;font-size:11px;flex-shrink:0}
.chk-ok{background:rgba(52,211,153,.15);color:var(--green)}
.chk-ng{background:rgba(248,113,113,.15);color:var(--red)}
.chk-name{font-weight:600}
.chk-note{font-size:10px;color:var(--muted);margin-top:1px}

.payout-table{width:100%;border-collapse:collapse;font-size:12px}
.payout-table th{padding:9px 12px;font-size:10px;color:var(--muted);font-weight:600;
  border-bottom:1px solid var(--border);text-align:left;white-space:nowrap}
.payout-table td{padding:9px 12px;border-bottom:1px solid rgba(30,34,53,.6);vertical-align:middle}
.payout-table tr:hover td{background:rgba(255,255,255,.015)}
.payout-table tr.has-error td{background:rgba(248,113,113,.04)}
.payout-table tr.is-instant td{background:rgba(251,146,60,.04)}

.ag-info{display:flex;flex-direction:column}
.ag-name{font-weight:700;font-size:13px}
.ag-id{font-family:'DM Mono',monospace;font-size:10px;color:var(--muted)}
.ag-rank{display:inline-block;font-size:9px;padding:1px 6px;border-radius:3px;font-weight:700;margin-top:2px}
.rank-g{background:rgba(201,168,76,.15);color:var(--gold)}
.rank-p{background:rgba(167,139,250,.15);color:var(--purple)}
.rank-s{background:rgba(160,160,160,.15);color:#c0c0c0}
.rank-b{background:rgba(180,120,60,.15);color:#cd7f32}

.amount-col{font-family:'DM Mono',monospace;font-size:13px;font-weight:600}
.amount-col.main{color:var(--gold);font-size:14px}

.flag{display:inline-flex;padding:2px 6px;border-radius:4px;font-size:9px;font-weight:700}
.flag-instant{background:rgba(251,146,60,.15);color:var(--orange)}
.flag-hold{background:rgba(248,113,113,.15);color:var(--red)}
.flag-ok{background:rgba(52,211,153,.1);color:var(--green)}
.flag-hr{background:rgba(79,156,249,.15);color:var(--blue)}

.ap-step{background:var(--card2);border:1px solid var(--border2);border-radius:10px;padding:14px;
  display:flex;align-items:center;gap:14px;margin-bottom:10px}
.ap-step.done{border-color:rgba(52,211,153,.3);background:rgba(52,211,153,.04)}
.ap-step.active{border-color:rgba(201,168,76,.3);background:rgba(201,168,76,.04)}
.ap-step.future{opacity:.5}
.ap-num{width:28px;height:28px;border-radius:50%;display:flex;align-items:center;justify-content:center;
  font-family:'DM Mono',monospace;font-size:11px;font-weight:700;flex-shrink:0}
.ap-num-done{background:var(--green);color:#0a0c14}
.ap-num-active{background:var(--gold);color:#0a0c14}
.ap-num-future{background:var(--border2);color:var(--muted)}
.ap-content{flex:1}
.ap-title{font-size:12px;font-weight:700;margin-bottom:2px}
.ap-note{font-size:10px;color:var(--muted)}
.ap-date{font-family:'DM Mono',monospace;font-size:10px;color:var(--sub)}

.alert{border-radius:10px;padding:11px 14px;font-size:11px;line-height:1.8;margin-bottom:14px}
.ao{background:rgba(251,146,60,.06);border:1px solid rgba(251,146,60,.2);color:var(--orange)}
.ag{background:rgba(52,211,153,.06);border:1px solid rgba(52,211,153,.2);color:var(--green)}
.ab{background:rgba(79,156,249,.06);border:1px solid rgba(79,156,249,.2);color:var(--blue)}
.ar{background:rgba(248,113,113,.06);border:1px solid rgba(248,113,113,.2);color:var(--red)}

.badge{display:inline-flex;align-items:center;padding:2px 7px;border-radius:4px;font-size:9px;font-weight:700}
.month-badge{background:rgba(201,168,76,.12);border:1px solid var(--gold-dim);color:var(--gold);
  font-family:'DM Mono',monospace;font-size:11px;padding:4px 12px;border-radius:4px;font-weight:700}
.deadline-chip{font-size:10px;color:var(--orange);display:flex;align-items:center;gap:5px}
.hidden{display:none!important}
::-webkit-scrollbar{width:4px}::-webkit-scrollbar-thumb{background:var(--border2);border-radius:2px}

/* â”€â”€ ç´¹ä»‹ãƒªãƒ³ã‚¯ãƒ¢ãƒ¼ãƒ€ãƒ« â”€â”€ */
#ref-modal-overlay{display:none;position:fixed;inset:0;background:rgba(0,0,0,.65);z-index:9000;align-items:center;justify-content:center}
#ref-modal-overlay.open{display:flex}
#ref-modal{background:var(--card);border:1px solid var(--border2);border-radius:16px;padding:0;width:min(460px,92vw);overflow:hidden}
.ref-mhdr{padding:16px 20px;border-bottom:1px solid var(--border);display:flex;align-items:center;justify-content:space-between}
.ref-mhdr-t{font-family:'Syne',sans-serif;font-size:14px;font-weight:800;color:var(--gold)}
.ref-mbody{padding:20px}
.ref-url{background:var(--card2);border:1px solid var(--border2);border-radius:8px;padding:10px 12px;font-family:'DM Mono',monospace;font-size:11px;color:var(--sub);word-break:break-all;margin:10px 0;min-height:36px}
.ref-copy-btn{width:100%;padding:10px;border-radius:8px;border:none;cursor:pointer;font-family:inherit;font-size:13px;font-weight:700;background:var(--gold);color:#0a0c10;margin-top:4px}
.ref-copy-btn:hover{opacity:.9}

/* â”€â”€ ç´¹ä»‹ãƒªãƒ³ã‚¯ å·¦ãƒ•ãƒ­ãƒ¼ãƒ†ã‚£ãƒ³ã‚°ãƒœã‚¿ãƒ³ â”€â”€ */
#ref-float-btn {
  position: fixed;
  left: 0;
  top: 50%;
  transform: translateY(-50%) translateX(-100%) rotate(-90deg);
  transform-origin: right bottom;
  z-index: 8000;
  background: rgba(201,168,76,.18);
  border: 1px solid rgba(201,168,76,.4);
  border-bottom: none;
  border-radius: 8px 8px 0 0;
  color: var(--gold);
  padding: 6px 16px;
  font-size: 11px;
  font-weight: 700;
  font-family: inherit;
  cursor: pointer;
  white-space: nowrap;
  letter-spacing: .5px;
  transition: background .15s;
}
#ref-float-btn:hover { background: rgba(201,168,76,.32); }
</style>
</head>
<body>

<div class="header">
  <div style="display:flex;align-items:center;gap:12px">
    <div class="logo">CORETO</div>
    <div style="width:1px;height:20px;background:var(--border2)">
  </div>
    <div style="font-size:10px;color:var(--muted);letter-spacing:1px">æˆç´„å ±å‘Š &amp; æŒ¯è¾¼ãƒãƒƒãƒç®¡ç†</div>
  </div>
  <div class="header-right">
    <div class="month-badge">2026å¹´2æœˆåˆ†</div>
    <div class="deadline-chip">â° æ‰¿èªæœŸé™ï¼š2æœˆ10æ—¥</div>
    <div style="margin-left:8px">
      <div class="hdr-agent" id="hdr-name">â€”</div>
      <div class="hdr-id" id="hdr-id">â€”</div>
    </div>
    <button onclick="(function(){var _s=JSON.parse(sessionStorage.getItem('coreto_session')||'null');window.location.href=(_s&&_s.type==='hq')?'coreto-hub.html':'coreto-agent-mypage.html';})()"
            style="font-size:10px;padding:4px 10px;border-radius:6px;border:1px solid var(--border2);background:transparent;color:var(--muted);cursor:pointer;font-family:'Noto Sans JP',sans-serif">
      â† ãƒã‚¤ãƒšãƒ¼ã‚¸
    </button>
  </div>
</div>

<div class="tabs">
  <div class="tab on" id="tab-0" onclick="switchTab(0)">ğŸ¯ æˆç´„å ±å‘Šï¼ˆ/closeï¼‰</div>
  <div class="tab" id="tab-1" onclick="switchTab(1)">ğŸ“Š æœˆæ¬¡ãƒãƒƒãƒç®¡ç† <span class="tab-dot"></span></div>
</div>

<!-- â•â• TAB 0: æˆç´„å ±å‘Š â•â• -->
<div class="page on" id="page-0">
<div class="two-col">

<!-- å·¦ï¼šãƒ•ã‚©ãƒ¼ãƒ  -->
<div>
<div class="panel">
  <div class="panel-hd">
    <div class="panel-title">æˆç´„å ±å‘Šãƒ•ã‚©ãƒ¼ãƒ </div>
    <div class="panel-sub">å…¨é¡å…¥é‡‘ç¢ºèªå¾Œã«é€ä¿¡</div>
  </div>

  <!-- ã‚¨ãƒ¼ã‚¸ã‚§ãƒ³ãƒˆï¼ˆã‚»ãƒƒã‚·ãƒ§ãƒ³è‡ªå‹•ï¼‰ -->
  <div class="s-label">æ‹…å½“ã‚¨ãƒ¼ã‚¸ã‚§ãƒ³ãƒˆ</div>
  <div id="agent-session-card" style="background:linear-gradient(135deg,rgba(201,168,76,.08),rgba(201,168,76,.02));border:1px solid rgba(201,168,76,.25);border-radius:12px;padding:14px;margin-bottom:4px">
    <div style="display:flex;align-items:center;gap:14px">
      <div id="ase-avatar" style="width:44px;height:44px;border-radius:50%;background:linear-gradient(135deg,var(--gold-dim),rgba(201,168,76,.2));display:flex;align-items:center;justify-content:center;font-size:20px;flex-shrink:0;border:1.5px solid rgba(201,168,76,.3)">ğŸ‘¤</div>
      <div style="flex:1">
        <div id="ase-name" style="font-size:16px;font-weight:700">èª­ã¿è¾¼ã¿ä¸­...</div>
        <div style="display:flex;gap:8px;align-items:center;margin-top:4px">
          <span id="ase-id" style="font-family:'DM Mono',monospace;font-size:11px;color:var(--muted)">â€”</span>
          <span id="ase-rank" style="font-size:10px;padding:2px 8px;border-radius:4px;font-weight:700"></span>
        </div>
      </div>
      <div style="text-align:right">
        <div style="font-size:10px;color:var(--muted)">å ±é…¬ç‡</div>
        <div id="ase-rate" style="font-family:'DM Mono',monospace;font-size:20px;color:var(--gold);font-weight:700">â€”</div>
      </div>
    </div>
  </div>
  <input type="hidden" id="ag-select" value="">

  <!-- æ¡ˆä»¶ID -->
  <div class="s-label" style="margin-top:16px">æ¡ˆä»¶ID <span style="font-size:9px;color:var(--gold);margin-left:4px;font-weight:700">å…¥åŠ›ã™ã‚‹ã¨å…¨é …ç›®ã‚’è‡ªå‹•å¼•ç”¨</span></div>
  <div class="case-id-wrap">
    <input type="text" id="case-id" class="mono" placeholder="0234"
           style="font-size:15px;letter-spacing:1px"
           oninput="onCaseIdChange(this.value)"
           onkeydown="if(event.key==='Enter')loadCase()">
    <button class="btn btn-blue" onclick="loadCase()">ğŸ” èª­ã¿è¾¼ã‚€</button>
  </div>

  <!-- æ¡ˆä»¶ãƒ—ãƒ¬ãƒ“ãƒ¥ãƒ¼ -->
  <div class="case-preview" id="case-preview"></div>

  <!-- ãƒ•ã‚©ãƒ¼ãƒ æœ¬ä½“ï¼ˆæ¡ˆä»¶èª­ã¿è¾¼ã¿å¾Œã«è¡¨ç¤ºï¼‰ -->
  <div id="case-form" class="hidden">

    <!-- äº‹æ¥­ç¨®åˆ¥ãƒ»å–å¼•å½¢æ…‹ -->
    <div class="s-label">äº‹æ¥­ç¨®åˆ¥ãƒ»å–å¼•å½¢æ…‹ <span class="auto-tag">æ¡ˆä»¶ã‹ã‚‰è‡ªå‹•å…¥åŠ›</span></div>
    <div class="fg">
      <div class="tg-group" id="g-biz">
        <button class="tg on bl" data-v="re-rent" onclick="tog('g-biz',this);updateFields()">ğŸ  è³ƒè²¸ä»²ä»‹</button>
        <button class="tg" data-v="re-sale" onclick="tog('g-biz',this);updateFields()">ğŸ¢ å£²è²·ä»²ä»‹</button>
        <button class="tg" data-v="hr" onclick="tog('g-biz',this);updateFields()">ğŸ‘¥ äººæç´¹ä»‹</button>
      </div>
    </div>
    <div id="sec-sanmei" class="fg" style="margin-top:0">
      <div class="tg-group" id="g-deal">
        <button class="tg on" data-v="normal" onclick="tog('g-deal',this);calcReward()">é€šå¸¸ä»²ä»‹</button>
        <button class="tg" data-v="sanmei" onclick="tog('g-deal',this);calcReward()">ä¸‰ç‚º</button>
      </div>
    </div>

    <!-- æ¡ˆä»¶ã‚¿ã‚¤ãƒ— -->
    <div class="s-label">æ¡ˆä»¶ã‚¿ã‚¤ãƒ— <span class="auto-tag">æ¡ˆä»¶ã‹ã‚‰è‡ªå‹•å…¥åŠ›</span></div>
    <div class="fg">
      <div class="tg-group" id="g-case-type">
        <button class="tg on" data-v="self" onclick="tog('g-case-type',this);togglePartner();calcReward()">è‡ªå·±é–‹æ‹“</button>
        <button class="tg" data-v="pt" onclick="tog('g-case-type',this);togglePartner();calcReward()">ãƒ‘ãƒ¼ãƒˆãƒŠãƒ¼ç´¹ä»‹</button>
      </div>
    </div>
    <div id="sec-partner" class="hidden two-col-eq">
      <div class="fg"><label>ãƒ‘ãƒ¼ãƒˆãƒŠãƒ¼å</label><input type="text" id="pt-name" class="auto-filled" oninput="calcReward()"></div>
      <div class="fg"><label>ãƒ‘ãƒ¼ãƒˆãƒŠãƒ¼ID</label><input type="text" id="pt-id" class="mono auto-filled" oninput="calcReward()"></div>
    </div>

    <!-- è«‹æ±‚é …ç›®ï¼ˆè«‹æ±‚æ›¸ã‹ã‚‰è‡ªå‹•å¼•ç”¨ï¼‰ -->
    <div id="sec-re-billing">
      <div class="s-label">è«‹æ±‚é …ç›® <span class="auto-tag">è«‹æ±‚æ›¸ã‹ã‚‰è‡ªå‹•å¼•ç”¨</span></div>
      <div id="billing-items"></div>
      <button class="btn btn-muted btn-sm" id="add-bill-btn" onclick="addBillingItem()" style="margin-top:4px">ï¼‹ é …ç›®ã‚’è¿½åŠ </button>
      <div class="validation-box" id="val-box" style="margin-top:10px">
        <div class="val-row"><div class="val-icon vi-wait" id="vi-1">â€”</div><span id="val-1">è«‹æ±‚é¡ã‚’ç¢ºèªä¸­</span></div>
        <div class="val-row"><div class="val-icon vi-wait" id="vi-2">â€”</div><span id="val-2">ä»²ä»‹æ‰‹æ•°æ–™ â‰¤ å®¶è³ƒÃ—1.1</span></div>
        <div class="val-row"><div class="val-icon vi-wait" id="vi-3">â€”</div><span id="val-3">åˆè¨ˆ â‰¥ å®¶è³ƒÃ—1.0</span></div>
      </div>
      <div id="sec-low-reason" class="fg hidden">
        <label>æ‰‹æ•°æ–™ãŒä½ã„ç†ç”±<span class="req">*</span><span class="hint">20æ–‡å­—ä»¥ä¸Š</span></label>
        <textarea id="low-reason" oninput="checkReason()"></textarea>
        <div class="err-msg" id="reason-err">20æ–‡å­—ä»¥ä¸Šå…¥åŠ›ã—ã¦ãã ã•ã„</div>
      </div>
    </div>
    <input type="hidden" id="rent-amount" value="0">

    <!-- äººæç´¹ä»‹ -->
    <div id="sec-hr-billing" class="hidden">
      <div class="s-label">äººæç´¹ä»‹ è©³ç´° <span class="auto-tag">æ¡ˆä»¶ã‹ã‚‰è‡ªå‹•å…¥åŠ›</span></div>
      <div class="two-col-eq">
        <div class="fg"><label>ç´¹ä»‹å…ˆä¼æ¥­å</label><input type="text" id="hr-company" class="auto-filled" oninput="calcReward()"></div>
        <div class="fg"><label>å…¥ç¤¾äºˆå®šæ—¥</label><input type="date" id="hr-join" class="mono auto-filled" onchange="calcReward()"></div>
      </div>
      <div class="two-col-eq">
        <div class="fg"><label>ç·æ‰‹æ•°æ–™ï¼ˆç¨è¾¼ï¼‰</label><input type="number" id="hr-fee" class="mono auto-filled" oninput="calcReward()"></div>
        <div class="fg"><label>è¿”æˆ»æœŸé–“</label>
          <select id="hr-ref" onchange="calcReward()">
            <option value="3">3ãƒ¶æœˆ</option><option value="6">6ãƒ¶æœˆ</option>
          </select>
        </div>
      </div>
    </div>

    <!-- å…¨é¡å…¥é‡‘ç¢ºèªæ—¥ -->
    <div class="s-label">å…¨é¡å…¥é‡‘ç¢ºèªæ—¥<span class="req" style="margin-left:4px">*</span></div>
    <div class="two-col-eq">
      <div class="fg">
        <label>å…¥é‡‘ç¢ºèªæ—¥ <span class="hint">æŒ¯è¾¼æ—¥ã®åŸºæº–</span></label>
        <input type="date" id="fullpay-date" class="mono auto-filled" onchange="calcReward()">
      </div>
      <div class="fg">
        <label>æŒ¯è¾¼äºˆå®šæ—¥ï¼ˆè‡ªå‹•è¨ˆç®—ï¼‰</label>
        <input type="text" id="pay25-display" class="mono" readonly
               style="background:#060810;color:var(--gold);border-color:var(--gold-dim)">
      </div>
    </div>

    <!-- å—ã‘æ¸¡ã—æ–¹æ³• -->
    <div id="sec-re-delivery">
      <div class="s-label">å—æ¸¡æ–¹æ³• <span class="auto-tag">æ¡ˆä»¶ã‹ã‚‰è‡ªå‹•å…¥åŠ›</span></div>
      <div class="two-col-eq">
        <div class="fg"><label>å¥‘ç´„æ›¸ã®å—æ¸¡</label>
          <select id="contract-delivery" class="auto-filled">
            <option>éƒµé€ï¼ˆã‚¨ãƒ¼ã‚¸ã‚§ãƒ³ãƒˆã®ä½æ‰€ã¸ï¼‰</option>
            <option>éƒµé€ï¼ˆé¡§å®¢ã®ä½æ‰€ã¸ï¼‰</option>
            <option>ã‚¨ãƒ¼ã‚¸ã‚§ãƒ³ãƒˆãŒå–ã‚Šã«æ¥ã‚‹</option>
            <option>é¡§å®¢ãŒå–ã‚Šã«æ¥ã‚‹</option>
          </select>
        </div>
        <div class="fg"><label>éµã®å—æ¸¡</label>
          <select id="key-delivery" class="auto-filled">
            <option>éƒµé€ï¼ˆã‚¨ãƒ¼ã‚¸ã‚§ãƒ³ãƒˆã®ä½æ‰€ã¸ï¼‰</option>
            <option>éƒµé€ï¼ˆé¡§å®¢ã®ä½æ‰€ã¸ï¼‰</option>
            <option>ã‚¨ãƒ¼ã‚¸ã‚§ãƒ³ãƒˆãŒå–ã‚Šã«æ¥ã‚‹</option>
            <option>é¡§å®¢ãŒå–ã‚Šã«æ¥ã‚‹</option>
            <option>å¥‘ç´„æ›¸ã¨åŒæ™‚</option>
          </select>
        </div>
      </div>

      <!-- è³ƒè²¸ã®ã¿ï¼šè³ƒç™ºæ—¥ + ITé‡èª¬ -->
      <div class="two-col-eq" id="sec-rent-dates">
        <div class="fg">
          <label>è³ƒç™ºæ—¥ï¼ˆå…¥å±…æ—¥ï¼‰<span class="req">*</span> <span class="hint">ãƒã‚¤ãƒ³ãƒˆåˆ¤å®šåŸºæº–æ—¥</span></label>
          <input type="date" id="chinkaku-date" class="mono" onchange="calcReward()">
        </div>
        <div class="fg"><label>ITé‡èª¬ã®äºˆç´„</label>
          <div class="tg-group" id="g-itsuju">
            <button class="tg on" data-v="later" onclick="tog('g-itsuju',this)">åˆ°ç€å¾Œã«äºˆç´„</button>
            <button class="tg" data-v="skip" onclick="tog('g-itsuju',this)">ä»Šã¯äºˆç´„ã—ãªã„</button>
          </div>
        </div>
      </div>

      <!-- å£²è²·ã®ã¿ï¼šæ±ºæ¸ˆæ—¥ -->
      <div class="two-col-eq hidden" id="sec-sale-dates">
        <div class="fg">
          <label>æ±ºæ¸ˆæ—¥ <span class="req">*</span> <span class="hint">ãƒã‚¤ãƒ³ãƒˆåˆ¤å®šåŸºæº–æ—¥</span></label>
          <input type="date" id="settlement-date" class="mono" onchange="calcReward()">
        </div>
        <div class="fg">
          <label>å¼•æ¸¡æ—¥</label>
          <input type="date" id="handover-date" class="mono auto-filled">
        </div>
      </div>
    </div>

    <!-- ç®¡ç†ä¼šç¤¾ -->
    <div class="s-label">ç®¡ç†ä¼šç¤¾ <span class="auto-tag">è‡ªå‹•å…¥åŠ›</span></div>
    <div class="fg"><input type="text" id="mgmt-co" class="auto-filled" placeholder="ç®¡ç†ä¼šç¤¾å"></div>

    <!-- å‚™è€ƒ -->
    <div class="s-label">å‚™è€ƒ <span style="color:var(--muted);font-size:9px;font-weight:400">è‡ªç”±è¨˜å…¥</span></div>
    <div class="fg"><textarea id="memo" placeholder="ç‰¹è¨˜äº‹é …ãƒ»ç¢ºèªäº‹é …ãªã©" style="min-height:80px"></textarea></div>

    <button class="btn btn-gold btn-full" onclick="submitClose()">ğŸ¯ æˆç´„å ±å‘Šã‚’é€ä¿¡</button>
  </div><!-- /case-form -->

  <!-- æœªå…¥åŠ›ãƒ—ãƒ¬ãƒ¼ã‚¹ãƒ›ãƒ«ãƒ€ãƒ¼ -->
  <div id="no-case-placeholder" class="placeholder-box">
    <div class="ph-icon">ğŸ“‹</div>
    <div class="ph-title">æ¡ˆä»¶IDã‚’å…¥åŠ›ã—ã¦ãã ã•ã„</div>
    <div class="ph-desc">
      æ¡ˆä»¶IDã‚’å…¥åŠ›ã™ã‚‹ã¨ã€<br>
      äº‹æ¥­ç¨®åˆ¥ãƒ»è«‹æ±‚é …ç›®ãƒ»å—æ¸¡æ–¹æ³•ãƒ»<br>
      å…¥å±…äºˆå®šæ—¥ãªã©ãŒè‡ªå‹•ã§å¼•ç”¨ã•ã‚Œã¾ã™
    </div>
  </div>
</div><!-- /panel -->
</div><!-- /å·¦ -->

<!-- å³ï¼šå ±é…¬ãƒ—ãƒ¬ãƒ“ãƒ¥ãƒ¼ -->
<div>
  <div class="panel">
    <div class="panel-hd">
      <div class="panel-title">å ±é…¬è¨ˆç®—ãƒ—ãƒ¬ãƒ“ãƒ¥ãƒ¼</div>
      <div id="ag-rank-badge" class="badge" style="background:rgba(201,168,76,.15);color:var(--gold)">â€”</div>
    </div>
    <div class="reward-hero">
      <div class="rh-label">æŒ¯è¾¼é¡ï¼ˆæ‰‹å–ã‚Šï¼‰</div>
      <div class="rh-val" id="rh-val">Â¥0</div>
      <div class="rh-note" id="rh-note">æ¡ˆä»¶IDã‚’å…¥åŠ›ã™ã‚‹ã¨è¨ˆç®—ã•ã‚Œã¾ã™</div>
    </div>
    <div id="reward-breakdown">
      <div class="bk-row"><div>ç·è«‹æ±‚é¡</div><div class="bk-val" id="bk-fee">â€”</div></div>
      <div class="bk-row"><div>å ±é…¬ç‡ <span id="bk-rate-label" style="font-size:10px;color:var(--muted)"></span></div><div class="bk-val" id="bk-rate">â€”</div></div>
      <div class="bk-row"><div>å ±é…¬é¡ï¼ˆç¨æŠœï¼‰</div><div class="bk-val" id="bk-gross">â€”</div></div>
      <div class="bk-row"><div class="minus">æºæ³‰å¾´å</div><div class="bk-val minus" id="bk-tax">â€”</div></div>
      <div class="bk-row"><div class="minus">æœˆä¼šè²»</div><div class="bk-val minus" id="bk-fee2">â€”</div></div>
      <div class="bk-row bk-total"><div>æŒ¯è¾¼é¡</div><div class="bk-val" id="bk-total">â€”</div></div>
    </div>
    <div id="sec-hr-sched" class="hidden" style="margin-top:14px">
      <div style="font-size:10px;color:var(--muted);margin-bottom:8px">äººæç´¹ä»‹ 2å›æ‰•ã„ã‚¹ã‚±ã‚¸ãƒ¥ãƒ¼ãƒ«</div>
      <div class="two-col-eq" id="hr-sched-cards"></div>
    </div>
    <div id="pay-timeline" style="margin-top:14px;display:none">
      <div style="font-size:10px;color:var(--muted);margin-bottom:8px">â–¶ æŒ¯è¾¼ã‚¹ã‚±ã‚¸ãƒ¥ãƒ¼ãƒ«</div>
      <div id="timeline-content"></div>
    </div>
  </div>

  <div class="panel">
    <div class="panel-title" style="margin-bottom:14px">é€ä¿¡å¾Œã®è‡ªå‹•å‡¦ç†ãƒ•ãƒ­ãƒ¼</div>
    <div>
      <div class="ap-step done"><div class="ap-num ap-num-done">âœ“</div><div class="ap-content"><div class="ap-title">å…¥é‡‘ç¢ºèª â†’ å—ä»˜</div><div class="ap-note">å…¨é¡å…¥é‡‘ç¢ºèªå¾Œã®ã¿é€ä¿¡å¯</div></div></div>
      <div class="ap-step done"><div class="ap-num ap-num-done">âœ“</div><div class="ap-content"><div class="ap-title">å ±é…¬è¨ˆç®—ãƒ»Kintoneç™»éŒ²</div><div class="ap-note">å³æ™‚è‡ªå‹•å‡¦ç†</div></div></div>
      <div class="ap-step active"><div class="ap-num ap-num-active">3</div><div class="ap-content"><div class="ap-title">æœˆæœ«ç· ã‚ â†’ 8é …ç›®è‡ªå‹•ãƒã‚§ãƒƒã‚¯</div><div class="ap-note">ç¿Œæœˆ1æ—¥ã«è‡ªå‹•å®Ÿè¡Œ</div></div><div class="ap-date">ç¿Œæœˆ1æ—¥</div></div>
      <div class="ap-step future"><div class="ap-num ap-num-future">4</div><div class="ap-content"><div class="ap-title">æœ¬éƒ¨æœ€çµ‚æ‰¿èª</div></div><div class="ap-date">ã€œ10æ—¥</div></div>
      <div class="ap-step future"><div class="ap-num ap-num-future">5</div><div class="ap-content"><div class="ap-title">æ”¯æ‰•æ˜ç´°æ›¸ è‡ªå‹•ç™ºè¡Œ</div></div><div class="ap-date">15æ—¥</div></div>
      <div class="ap-step future"><div class="ap-num ap-num-future">6</div><div class="ap-content"><div class="ap-title">GMOéŠ€è¡Œ è‡ªå‹•æŒ¯è¾¼</div></div><div class="ap-date">25æ—¥</div></div>
    </div>
  </div>
</div><!-- /å³ -->

</div><!-- /two-col -->
</div><!-- /page-0 -->

<!-- â•â• TAB 1: æœˆæ¬¡ãƒãƒƒãƒç®¡ç† â•â• -->
<div class="page" id="page-1">
  <div class="timeline-bar">
    <div class="tl-step done"><div class="tl-day">æœˆæœ«</div><div class="tl-label">æœˆæœ«ç· ã‚</div></div>
    <div class="tl-step active"><div class="tl-day">1ã€œ10æ—¥</div><div class="tl-label">â–¶ æ‰¿èªãƒ•ã‚§ãƒ¼ã‚º</div></div>
    <div class="tl-step future"><div class="tl-day">15æ—¥</div><div class="tl-label">æ˜ç´°ç™ºè¡Œ</div></div>
    <div class="tl-step future"><div class="tl-day">20æ—¥</div><div class="tl-label">æŒ¯è¾¼ãƒ‡ãƒ¼ã‚¿</div></div>
    <div class="tl-step future"><div class="tl-day">25æ—¥</div><div class="tl-label">æŒ¯è¾¼å®Ÿè¡Œ</div></div>
  </div>
  <div class="stats-grid">
    <div class="stat-card"><div class="stat-num" style="color:var(--blue)">12</div><div class="stat-lbl">ä»Šæœˆã®æˆç´„ä»¶æ•°</div><div class="stat-sub">RE:9 / HR:3</div></div>
    <div class="stat-card"><div class="stat-num" style="color:var(--gold)">Â¥4,200,000</div><div class="stat-lbl">æŒ¯è¾¼ç·é¡ï¼ˆæ‰‹å–ã‚Šï¼‰</div><div class="stat-sub">æºæ³‰å‰ï¼šÂ¥4,680,000</div></div>
    <div class="stat-card"><div class="stat-num" style="color:var(--red)">2</div><div class="stat-lbl">ãƒã‚§ãƒƒã‚¯ã‚¨ãƒ©ãƒ¼</div><div class="stat-sub">è¦å¯¾å¿œã‚ã‚Š</div></div>
    <div class="stat-card"><div class="stat-num" style="color:var(--green)">8</div><div class="stat-lbl">æ‰¿èªæ¸ˆã¿ã‚¨ãƒ¼ã‚¸ã‚§ãƒ³ãƒˆ</div><div class="stat-sub">æ®‹ã‚Šï¼š4å</div></div>
  </div>

  <div class="panel">
    <div class="panel-hd"><div class="panel-title">æ‰¿èªå‰ 8é …ç›®è‡ªå‹•ãƒã‚§ãƒƒã‚¯çµæœ</div><div style="font-size:10px;color:var(--muted)">å®Ÿè¡Œæ—¥ï¼š2026-02-01 00:00</div></div>
    <div class="alert ar">âš ï¸ 2é …ç›®ã§ã‚¨ãƒ©ãƒ¼ã‚’æ¤œå‡ºã—ã¾ã—ãŸã€‚ä¸‹è¨˜ã‚’ç¢ºèªã—ã¦ãã ã•ã„ã€‚</div>
    <div class="check-grid">
      <div class="check-item"><div class="chk-icon chk-ok">âœ“</div><div><div class="chk-name">â‘  å…¨é¡å…¥é‡‘ç¢ºèª</div><div class="chk-note">å…¨12ä»¶ å…¥é‡‘ç¢ºèªæ¸ˆã¿</div></div></div>
      <div class="check-item"><div class="chk-icon chk-ng">âœ—</div><div><div class="chk-name">â‘¡ å ±é…¬ç‡ã®å¦¥å½“æ€§</div><div class="chk-note" style="color:var(--red)">10041ï¼šãƒ©ãƒ³ã‚¯ã¨å ±é…¬ç‡ãŒä¸ä¸€è‡´</div></div></div>
      <div class="check-item"><div class="chk-icon chk-ok">âœ“</div><div><div class="chk-name">â‘¢ å ±é…¬é¡ã®ç•°å¸¸å€¤</div><div class="chk-note">å…¨ä»¶ æ­£å¸¸ç¯„å›²å†…</div></div></div>
      <div class="check-item"><div class="chk-icon chk-ok">âœ“</div><div><div class="chk-name">â‘£ æºæ³‰å¾´åã®æ­£ç¢ºæ€§</div><div class="chk-note">å…¨ä»¶ è¨ˆç®—æ­£ç¢º</div></div></div>
      <div class="check-item"><div class="chk-icon chk-ok">âœ“</div><div><div class="chk-name">â‘¤ é‡è¤‡æˆç´„ãƒã‚§ãƒƒã‚¯</div><div class="chk-note">é‡è¤‡ãªã—</div></div></div>
      <div class="check-item"><div class="chk-icon chk-ok">âœ“</div><div><div class="chk-name">â‘¥ æˆç´„æ—¥ã®å¦¥å½“æ€§</div><div class="chk-note">å…¨ä»¶ æ­£å¸¸æ—¥ä»˜</div></div></div>
      <div class="check-item"><div class="chk-icon chk-ng">âœ—</div><div><div class="chk-name">â‘¦ ç•°å¸¸ãªæˆç´„æ•°</div><div class="chk-note" style="color:var(--red)">10012ï¼šä»Šæœˆ7ä»¶ï¼ˆé€šå¸¸ã®2å€è¶…ï¼‰</div></div></div>
      <div class="check-item"><div class="chk-icon chk-ok">âœ“</div><div><div class="chk-name">â‘§ æŒ¯è¾¼å…ˆå£åº§ç¢ºèª</div><div class="chk-note">å…¨å£åº§ ç™»éŒ²æ¸ˆã¿ãƒ»æœ‰åŠ¹</div></div></div>
    </div>
  </div>

  <div class="panel">
    <div class="panel-hd">
      <div class="panel-title">ã‚¨ãƒ¼ã‚¸ã‚§ãƒ³ãƒˆåˆ¥ æŒ¯è¾¼ä¸€è¦§</div>
      <div style="display:flex;gap:8px">
        <button class="btn btn-green btn-sm" onclick="approveAll()">âœ… ã‚¨ãƒ©ãƒ¼ãªã—å…¨å“¡ã‚’æ‰¿èª</button>
        <button class="btn btn-blue btn-sm" onclick="exportCSV()">â¬‡ï¸ GMOæŒ¯è¾¼CSVã‚¨ã‚¯ã‚¹ãƒãƒ¼ãƒˆ</button>
      </div>
    </div>
    <div style="overflow-x:auto">
      <table class="payout-table">
        <thead><tr>
          <th>ã‚¨ãƒ¼ã‚¸ã‚§ãƒ³ãƒˆ</th><th>æˆç´„ä»¶æ•°</th><th>å ±é…¬é¡ï¼ˆç¨æŠœï¼‰</th>
          <th>æºæ³‰å¾´å</th><th>æœˆä¼šè²»</th><th>æŒ¯è¾¼é¡</th>
          <th>ãƒ•ãƒ©ã‚°</th><th>ã‚¹ãƒ†ãƒ¼ã‚¿ã‚¹</th><th>æ“ä½œ</th>
        </tr></thead>
        <tbody id="payout-tbody"></tbody>
      </table>
    </div>
    <div style="display:flex;justify-content:flex-end;margin-top:14px;padding-top:12px;border-top:1px solid var(--border)">
      <div style="text-align:right">
        <div style="font-size:10px;color:var(--muted);margin-bottom:4px">æŒ¯è¾¼ç·é¡</div>
        <div style="font-family:'DM Mono',monospace;font-size:24px;color:var(--gold);font-weight:700">Â¥4,187,450</div>
        <div style="font-size:10px;color:var(--muted);margin-top:2px">æºæ³‰å¾´åç´ä»˜é¡ï¼šÂ¥492,550ã€€ä¼šè²»åå…¥ï¼šÂ¥4,900</div>
      </div>
    </div>
  </div>

  <div class="panel">
    <div class="panel-title" style="margin-bottom:14px">æŒ¯è¾¼å®Ÿè¡Œï¼ˆç¿Œæœˆ25æ—¥ï¼‰</div>
    <div class="alert ao">âš ï¸ å…¨å“¡æ‰¿èªå®Œäº†å¾Œã«æŒ¯è¾¼å®Ÿè¡ŒãŒå¯èƒ½ã«ãªã‚Šã¾ã™ã€‚ã‚¨ãƒ©ãƒ¼2ä»¶ãŒæ®‹ã£ã¦ã„ã¾ã™ã€‚</div>
    <div>
      <div class="ap-step done"><div class="ap-num ap-num-done">âœ“</div><div class="ap-content"><div class="ap-title">æœˆæœ«ç· ã‚å®Œäº†</div></div><div class="ap-date">1/31</div></div>
      <div class="ap-step active"><div class="ap-num ap-num-active">â–¶</div><div class="ap-content"><div class="ap-title">ã‚¨ãƒ©ãƒ¼å¯¾å¿œ â†’ å…¨å“¡æ‰¿èª</div><div class="ap-note">â‘¡10041 å ±é…¬ç‡ä¿®æ­£ã€€â‘¦10012 ç¢ºèª</div></div><div class="ap-date">ã€œ2/10</div></div>
      <div class="ap-step future"><div class="ap-num ap-num-future">3</div><div class="ap-content"><div class="ap-title">æ”¯æ‰•æ˜ç´°æ›¸ è‡ªå‹•ç™ºè¡Œ</div></div><div class="ap-date">2/15</div></div>
      <div class="ap-step future"><div class="ap-num ap-num-future">4</div><div class="ap-content"><div class="ap-title">GMOæŒ¯è¾¼ãƒ‡ãƒ¼ã‚¿ ä½œæˆ</div></div><div class="ap-date">2/20</div></div>
      <div class="ap-step future"><div class="ap-num ap-num-future">5</div><div class="ap-content"><div class="ap-title">æŒ¯è¾¼å®Ÿè¡Œ â†’ å®Œäº†é€šçŸ¥</div></div><div class="ap-date">2/25</div></div>
    </div>
    <button class="btn btn-muted btn-full" disabled style="margin-top:14px;opacity:.5;cursor:not-allowed">
      ğŸ”’ æŒ¯è¾¼å®Ÿè¡Œï¼ˆå…¨å“¡æ‰¿èªå¾Œã«è§£é™¤ï¼‰
    </button>
  </div>
</div><!-- /page-1 -->

<script>
// â•â• AUTH GUARD (HQå°‚ç”¨ãƒšãƒ¼ã‚¸) â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
(function() {
  var s = null;
  try { s = JSON.parse(sessionStorage.getItem('coreto_session') || 'null'); } catch(e) {}
  if (!s || !s.userId || !s.sessionToken || s.sessionToken.length !== 64) { sessionStorage.removeItem('coreto_session'); location.replace('coreto-login.html'); return; }
  var _la = new Date(s.loginAt).getTime();
  if (isNaN(_la) || (Date.now() - _la) > 28800000) { sessionStorage.removeItem('coreto_session'); alert('ã‚»ãƒƒã‚·ãƒ§ãƒ³ã®æœ‰åŠ¹æœŸé™ãŒåˆ‡ã‚Œã¾ã—ãŸã€‚'); location.replace('coreto-login.html'); return; }
  if (s.type !== 'hq') { location.replace('coreto-agent-mypage.html'); return; }
  window._SESSION = s;
})();

// ================================================================
//  ã‚»ãƒƒã‚·ãƒ§ãƒ³
// ================================================================
const _S = (function(){
  try{ return JSON.parse(sessionStorage.getItem('coreto_session')||'null'); }catch(e){return null;}
})();

const RANK_RATE = {
  re:{ gold:.70, platinum:.75, silver:.675, bronze:.65 },
  hr:{ gold:.50, platinum:.55, silver:.475, bronze:.45 },
};
const RANK_CSS = {
  gold:'background:rgba(201,168,76,.2);color:#c9a84c',
  platinum:'background:rgba(167,139,250,.2);color:#a78bfa',
  silver:'background:rgba(160,160,160,.15);color:#c0c0c0',
  bronze:'background:rgba(180,120,60,.15);color:#cd7f32',
  pt:'background:rgba(52,211,153,.15);color:#34d399',
};
const AVATAR = {re:'ğŸ ',hr:'ğŸ‘¥',pt:'ğŸ¤'};

// â”€â”€ ã‚»ãƒƒã‚·ãƒ§ãƒ³UIåˆæœŸåŒ– â”€â”€
function initSessionUI() {
  if (!_S) return;
  const agType = _S.type || 're';
  document.getElementById('ag-select').value = _S.agId;
  document.getElementById('ase-name').textContent  = _S.name;
  document.getElementById('ase-id').textContent    = _S.agId;
  document.getElementById('ase-avatar').textContent = AVATAR[agType] || 'ğŸ‘¤';
  document.getElementById('hdr-name').textContent  = _S.name;
  document.getElementById('hdr-id').textContent    = _S.agId;

  const rb = document.getElementById('ase-rank');
  rb.textContent = _S.rank;
  rb.setAttribute('style', (RANK_CSS[_S.rankKey]||'') + ';padding:2px 8px;border-radius:4px;font-size:10px;font-weight:700');

  const rateMap = RANK_RATE[agType] || RANK_RATE.re;
  const rate = rateMap[_S.rankKey] || 0;
  document.getElementById('ase-rate').textContent = rate ? Math.round(rate*100)+'%' : 'â€”';
  document.getElementById('ag-rank-badge').textContent = _S.rank + (rate ? ' '+Math.round(rate*100)+'%' : '');
}

// ================================================================
//  æ¡ˆä»¶ãƒã‚¹ã‚¿ãƒ‡ãƒ¼ã‚¿ï¼ˆæœ¬ç•ªã¯Kintone APIã‹ã‚‰å–å¾—ï¼‰
// ================================================================
const CASE_DB = {
  // assignedTo: ãƒ­ã‚°ã‚¤ãƒ³ã‚¨ãƒ¼ã‚¸ã‚§ãƒ³ãƒˆIDã¨ç…§åˆã—ã¦ã‚¢ã‚¯ã‚»ã‚¹åˆ¶å¾¡
  '0234': {
    assignedTo:'10012',  // å±±ç”° èª 
    prop:'æ± è¢‹ãƒãƒ³ã‚·ãƒ§ãƒ³ 101å·å®¤', customer:'å±±ç”°å¤ªéƒ',
    biz:'re-rent', deal:'normal', caseType:'self',
    mgmt:'ã‚½ãƒ•ã‚£ã‚¢ã‚¹ã‚¿ãƒƒãƒ•æ ªå¼ä¼šç¤¾', rent:100000,
    moveIn:'2026-03-01',
    contractDelivery:0,
    keyDelivery:4,
    billing:[
      { name:'ä»²ä»‹æ‰‹æ•°æ–™', amount:110000, target:'é¡§å®¢',   deadline:'2026-02-28' },
      { name:'åºƒå‘Šæ–™ï¼ˆADï¼‰', amount:55000, target:'ç®¡ç†ä¼šç¤¾', deadline:'2026-02-28' },
    ],
    fullpayDate:'2026-02-14',
    invNo:'0234-INV-001',
  },
  '0228': {
    assignedTo:'10012',  // å±±ç”° èª ï¼ˆãƒ‡ãƒ¢ï¼šåŒã‚¨ãƒ¼ã‚¸ã‚§ãƒ³ãƒˆï¼‰
    prop:'æ–°å®¿ã‚¢ãƒ‘ãƒ¼ãƒˆ 201å·å®¤', customer:'ä½è—¤èŠ±å­',
    biz:'re-rent', deal:'normal', caseType:'pt',
    mgmt:'ä¸‰è±åœ°æ‰€ãƒªã‚¢ãƒ«ã‚¨ã‚¹ãƒ†ãƒ¼ãƒˆã‚µãƒ¼ãƒ“ã‚¹', rent:85000,
    moveIn:'2026-03-15',
    contractDelivery:1,
    keyDelivery:1,
    ptName:'ç”°ä¸­ èª ', ptId:'30003',
    billing:[
      { name:'ä»²ä»‹æ‰‹æ•°æ–™', amount:93500, target:'é¡§å®¢',   deadline:'2026-02-20' },
    ],
    fullpayDate:'2026-02-12',
    invNo:'0228-INV-001',
  },
  '0220': {
    assignedTo:'10012',
    prop:'æ¸‹è°·åŒºãƒãƒ³ã‚·ãƒ§ãƒ³ 3LDK', customer:'éˆ´æœ¨ä¸€éƒ',
    biz:'re-sale', deal:'sanmei', caseType:'self',
    mgmt:'æ±æ€¥ãƒªãƒãƒ–ãƒ«æ ªå¼ä¼šç¤¾', rent:0,
    moveIn:'2026-04-01',
    contractDelivery:2,
    keyDelivery:2,
    billing:[
      { name:'ä»²ä»‹æ‰‹æ•°æ–™', amount:2178000, target:'é¡§å®¢',   deadline:'2026-03-01' },
      { name:'æ¥­å‹™å§”è¨—æ–™', amount:500000,  target:'ç®¡ç†ä¼šç¤¾', deadline:'2026-03-01' },
    ],
    fullpayDate:'2026-02-18',
    invNo:'0220-INV-001',
  },
  '0231': {
    assignedTo:'20005',  // ç”°ä¸­ ç¾ç©‚
    prop:'ITã‚¨ãƒ³ã‚¸ãƒ‹ã‚¢ è»¢è·æ”¯æ´', customer:'é«˜æ©‹å¥äºŒ',
    biz:'hr', deal:'normal', caseType:'self',
    mgmt:'', rent:0,
    moveIn:'',
    hrCompany:'æ ªå¼ä¼šç¤¾ãƒ†ã‚¯ãƒã‚½ãƒªãƒ¥ãƒ¼ã‚·ãƒ§ãƒ³',
    hrJoin:'2026-03-01', hrFee:1500000, hrRef:3,
    billing:[], fullpayDate:'2026-02-15',
    invNo:'0231-INV-001',
  },
};

// ================================================================
//  æ¡ˆä»¶IDå…¥åŠ› â†’ èª­ã¿è¾¼ã¿
// ================================================================
function onCaseIdChange(val) {
  // ã‚¨ãƒ³ã‚¿ãƒ¼ã§èª­ã¿è¾¼ã¿ã§ãã‚‹ã‚ˆã†ã«ã‚¹ã‚¿ã‚¤ãƒ«ãƒ’ãƒ³ãƒˆ
  const btn = document.querySelector('.case-id-wrap .btn');
  btn.style.opacity = val.length >= 8 ? '1' : '0.5';
}

function loadCase() {
  const caseId  = document.getElementById('case-id').value.trim().toUpperCase();
  const myAgId  = (_S && _S.agId) || '';
  if (!caseId) { alert('æ¡ˆä»¶IDã‚’å…¥åŠ›ã—ã¦ãã ã•ã„'); return; }

  const data = CASE_DB[caseId];
  const ph   = document.getElementById('no-case-placeholder');

  // â”€â”€ ã‚»ã‚­ãƒ¥ãƒªãƒ†ã‚£ãƒã‚§ãƒƒã‚¯ï¼šæœ¬äººæ¡ˆä»¶ã®ã¿è¨±å¯ â”€â”€
  // å­˜åœ¨ã—ãªã„æ¡ˆä»¶ã¨ä»–ã‚¨ãƒ¼ã‚¸ã‚§ãƒ³ãƒˆã®æ¡ˆä»¶ã¯åŒä¸€ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸ã§è¿”ã™
  // ï¼ˆã©ã¡ã‚‰ã‹ã‚’åŒºåˆ¥ã™ã‚‹ã¨IDã®å­˜åœ¨ç¢ºèªã«æ‚ªç”¨ã•ã‚Œã‚‹ãŸã‚ï¼‰
  const authorized = data && (data.assignedTo === myAgId);
  if (!authorized) {
    document.getElementById('case-preview').style.display = 'none';
    document.getElementById('case-form').classList.add('hidden');
    ph.classList.remove('hidden');
    ph.innerHTML = `
      <div class="ph-icon">ğŸ”’</div>
      <div class="ph-title">æ¡ˆä»¶ãŒè¦‹ã¤ã‹ã‚Šã¾ã›ã‚“</div>
      <div class="ph-desc">ã€Œ${caseId}ã€ã¯å­˜åœ¨ã—ãªã„ã‹ã€<br>æ‹…å½“æ¡ˆä»¶ã§ã¯ã‚ã‚Šã¾ã›ã‚“</div>`;
    // ã‚»ã‚­ãƒ¥ãƒªãƒ†ã‚£ãƒ­ã‚°ï¼ˆæœ¬ç•ªã¯ã‚µãƒ¼ãƒãƒ¼ã‚µã‚¤ãƒ‰ã¸é€ä¿¡ï¼‰
    console.warn('[CORETO Security] Unauthorized case access attempt:', { caseId, myAgId, ts: new Date().toISOString() });
    return;
  }

  // ãƒ—ãƒ¬ãƒ“ãƒ¥ãƒ¼ã‚«ãƒ¼ãƒ‰è¡¨ç¤º
  const isHR = data.biz === 'hr';
  const preview = document.getElementById('case-preview');
  preview.style.display = 'block';
  const bizLabel = {
    're-rent':'ğŸ  è³ƒè²¸ä»²ä»‹', 're-sale':'ğŸ¢ å£²è²·ä»²ä»‹', 'hr':'ğŸ‘¥ äººæç´¹ä»‹'
  }[data.biz] || data.biz;
  const totalBilling = isHR
    ? (data.hrFee || 0)
    : data.billing.reduce((s,b) => s+b.amount, 0);

  preview.innerHTML = `
    <div style="font-size:14px;font-weight:700;margin-bottom:8px;color:var(--text)">
      ğŸ“‹ ${data.prop}
    </div>
    <div class="cp-row"><span class="cp-key">é¡§å®¢</span><span class="cp-val" style="font-family:'Noto Sans JP',sans-serif">${data.customer}</span></div>
    <div class="cp-row"><span class="cp-key">äº‹æ¥­ç¨®åˆ¥</span><span class="cp-val" style="font-family:'Noto Sans JP',sans-serif">${bizLabel}${data.deal==='sanmei'?' / ä¸‰ç‚º':''}</span></div>
    <div class="cp-row"><span class="cp-key">ç®¡ç†ä¼šç¤¾</span><span class="cp-val" style="font-family:'Noto Sans JP',sans-serif">${data.mgmt||'â€”'}</span></div>
    <div class="cp-row"><span class="cp-key">è«‹æ±‚ç·é¡</span><span class="cp-val">Â¥${totalBilling.toLocaleString()}</span></div>
    <div class="cp-row"><span class="cp-key">è«‹æ±‚æ›¸ç•ªå·</span><span class="cp-val">${data.invNo}</span></div>
    ${data.moveIn ? `<div class="cp-row"><span class="cp-key">å…¥å±…äºˆå®šæ—¥</span><span class="cp-val">${data.moveIn}</span></div>` : ''}`;

  // ãƒ•ã‚©ãƒ¼ãƒ ã«è‡ªå‹•å…¥åŠ›
  fillCaseForm(caseId, data);
}

// ================================================================
//  ãƒ•ã‚©ãƒ¼ãƒ è‡ªå‹•å…¥åŠ›
// ================================================================
const CONTRACT_DELIVERY_OPTIONS = [
  'éƒµé€ï¼ˆã‚¨ãƒ¼ã‚¸ã‚§ãƒ³ãƒˆã®ä½æ‰€ã¸ï¼‰','éƒµé€ï¼ˆé¡§å®¢ã®ä½æ‰€ã¸ï¼‰',
  'ã‚¨ãƒ¼ã‚¸ã‚§ãƒ³ãƒˆãŒå–ã‚Šã«æ¥ã‚‹','é¡§å®¢ãŒå–ã‚Šã«æ¥ã‚‹'
];
const KEY_DELIVERY_OPTIONS = [
  'éƒµé€ï¼ˆã‚¨ãƒ¼ã‚¸ã‚§ãƒ³ãƒˆã®ä½æ‰€ã¸ï¼‰','éƒµé€ï¼ˆé¡§å®¢ã®ä½æ‰€ã¸ï¼‰',
  'ã‚¨ãƒ¼ã‚¸ã‚§ãƒ³ãƒˆãŒå–ã‚Šã«æ¥ã‚‹','é¡§å®¢ãŒå–ã‚Šã«æ¥ã‚‹','å¥‘ç´„æ›¸ã¨åŒæ™‚'
];

function fillCaseForm(caseId, data) {
  const isHR = data.biz === 'hr';

  // 1. äº‹æ¥­ç¨®åˆ¥
  document.querySelectorAll('#g-biz .tg').forEach(b => {
    b.classList.toggle('on', b.dataset.v === data.biz);
    b.classList.toggle('bl', b.dataset.v === data.biz);
  });
  updateFields();

  // 2. å–å¼•å½¢æ…‹
  document.querySelectorAll('#g-deal .tg').forEach(b => {
    b.classList.toggle('on', b.dataset.v === data.deal);
  });

  // 3. æ¡ˆä»¶ã‚¿ã‚¤ãƒ—
  document.querySelectorAll('#g-case-type .tg').forEach(b => {
    b.classList.toggle('on', b.dataset.v === data.caseType);
  });
  togglePartner();

  // 4. ãƒ‘ãƒ¼ãƒˆãƒŠãƒ¼æƒ…å ±
  if (data.caseType === 'pt') {
    setVal('pt-name', data.ptName || '');
    setVal('pt-id', data.ptId || '');
  }

  // 5. è«‹æ±‚é …ç›®ï¼ˆè«‹æ±‚æ›¸ã‹ã‚‰å¼•ç”¨ï¼‰
  if (!isHR) {
    buildBillingItems(data.billing);
    setHiddenVal('rent-amount', data.rent || 0);
    validateBilling();
  }

  // 6. ç®¡ç†ä¼šç¤¾
  setVal('mgmt-co', data.mgmt || '');

  // 7. å…¨é¡å…¥é‡‘ç¢ºèªæ—¥
  setVal('fullpay-date', data.fullpayDate || '');
  calcReward();

  // 8. å—ã‘æ¸¡ã—æ–¹æ³•ãƒ»å…¥å±…æ—¥ï¼ˆä¸å‹•ç”£ã®ã¿ï¼‰
  if (!isHR) {
    setSelectIdx('contract-delivery', data.contractDelivery || 0);
    setSelectIdx('key-delivery', data.keyDelivery || 0);
    setVal('move-in-date', data.moveIn || '');
  }

  // 9. äººæç´¹ä»‹ãƒ•ã‚£ãƒ¼ãƒ«ãƒ‰
  if (isHR) {
    setVal('hr-company', data.hrCompany || '');
    setVal('hr-join', data.hrJoin || '');
    setVal('hr-fee', data.hrFee || '');
    if (data.hrRef) {
      document.getElementById('hr-ref').value = String(data.hrRef);
    }
  }

  // ãƒ•ã‚©ãƒ¼ãƒ ã‚’è¡¨ç¤º
  document.getElementById('case-form').classList.remove('hidden');
  document.getElementById('no-case-placeholder').classList.add('hidden');
}

function setVal(id, val) {
  const el = document.getElementById(id);
  if (el) el.value = val;
}
function setHiddenVal(id, val) {
  const el = document.getElementById(id);
  if (el) el.value = val;
}
function setSelectIdx(id, idx) {
  const el = document.getElementById(id);
  if (el) el.selectedIndex = idx;
}

// â”€â”€ è«‹æ±‚é …ç›®ã‚«ãƒ¼ãƒ‰ã‚’å‹•çš„ã«ç”Ÿæˆ â”€â”€
function buildBillingItems(billing) {
  const container = document.getElementById('billing-items');
  container.innerHTML = '';
  billCount = billing.length;

  billing.forEach((b, i) => {
    const card = document.createElement('div');
    card.className = 'billing-card' + (i > 0 ? ' optional' : '');
    card.id = 'bill-' + i;
    card.innerHTML = `
      <div class="billing-card-num">${i === 0 ? 'å¿…é ˆ' : 'ä»»æ„'} #${i+1}</div>
      ${i > 0 ? '<button class="remove-btn" onclick="removeBill(this)">Ã—</button>' : ''}
      <div class="three-col" style="margin-top:6px">
        <div class="fg"><label>é …ç›®å</label>
          <select class="auto-filled" onchange="calcReward()">
            <option ${b.name==='ä»²ä»‹æ‰‹æ•°æ–™'?'selected':''}>ä»²ä»‹æ‰‹æ•°æ–™</option>
            <option ${b.name==='æ¥­å‹™å§”è¨—æ–™'?'selected':''}>æ¥­å‹™å§”è¨—æ–™</option>
            <option ${b.name.includes('åºƒå‘Š')?'selected':''}>åºƒå‘Šæ–™ï¼ˆADï¼‰</option>
            <option ${b.name==='ãã®ä»–'?'selected':''}>ãã®ä»–</option>
          </select>
        </div>
        <div class="fg"><label>é‡‘é¡ï¼ˆç¨è¾¼ï¼‰</label>
          <input type="number" class="mono auto-filled bill-amount" value="${b.amount}" oninput="calcReward();validateBilling()">
        </div>
        <div class="fg"><label>è«‹æ±‚å…ˆ</label>
          <select class="bill-target auto-filled">
            <option ${b.target==='é¡§å®¢'?'selected':''}>é¡§å®¢</option>
            <option ${b.target==='ç®¡ç†ä¼šç¤¾'?'selected':''}>ç®¡ç†ä¼šç¤¾</option>
          </select>
        </div>
      </div>
      <div class="fg"><label>å…¥é‡‘æœŸé™</label>
        <input type="date" class="mono auto-filled bill-deadline" value="${b.deadline||''}">
      </div>`;
    container.appendChild(card);
  });
}

let billCount = 1;
function addBillingItem() {
  if (billCount >= 5) return;
  billCount++;
  const div = document.createElement('div');
  div.className = 'billing-card optional';
  div.innerHTML = `
    <div class="billing-card-num">ä»»æ„ #${billCount}</div>
    <button class="remove-btn" onclick="removeBill(this)">Ã—</button>
    <div class="three-col" style="margin-top:6px">
      <div class="fg"><label>é …ç›®å</label>
        <select onchange="calcReward()">
          <option>åºƒå‘Šæ–™ï¼ˆADï¼‰</option><option>ä»²ä»‹æ‰‹æ•°æ–™</option>
          <option>æ¥­å‹™å§”è¨—æ–™</option><option>ãã®ä»–</option>
        </select>
      </div>
      <div class="fg"><label>é‡‘é¡ï¼ˆç¨è¾¼ï¼‰</label>
        <input type="number" class="mono bill-amount" placeholder="0" oninput="calcReward();validateBilling()">
      </div>
      <div class="fg"><label>è«‹æ±‚å…ˆ</label>
        <select class="bill-target"><option>é¡§å®¢</option><option>ç®¡ç†ä¼šç¤¾</option></select>
      </div>
    </div>
    <div class="fg"><label>å…¥é‡‘æœŸé™</label>
      <input type="date" class="mono bill-deadline">
    </div>`;
  document.getElementById('billing-items').appendChild(div);
}
function removeBill(btn) {
  btn.closest('.billing-card').remove();
  billCount--;
  calcReward();
  validateBilling();
}

// ================================================================
//  ãƒ˜ãƒ«ãƒ‘ãƒ¼
// ================================================================
function switchTab(i) {
  document.querySelectorAll('.tab').forEach((t,j) => t.classList.toggle('on', i===j));
  document.querySelectorAll('.page').forEach((p,j) => p.classList.toggle('on', i===j));
  if (i===1) renderPayoutTable();
}
function tog(gid, btn) {
  document.querySelectorAll('#'+gid+' .tg').forEach(b => b.classList.remove('on','bl','gr'));
  btn.classList.add('on');
  calcReward();
}
function gv(gid) {
  const a = document.querySelector('#'+gid+' .tg.on');
  return a ? a.dataset.v : null;
}
function updateFields() {
  const biz    = gv('g-biz') || 're-rent';
  const isHR   = biz === 'hr';
  const isRent = biz === 're-rent';
  const isSale = biz === 're-sale';
  document.getElementById('sec-sanmei').classList.toggle('hidden', isHR);
  document.getElementById('sec-re-billing').classList.toggle('hidden', isHR);
  document.getElementById('sec-hr-billing').classList.toggle('hidden', !isHR);
  document.getElementById('sec-re-delivery').classList.toggle('hidden', isHR);
  document.getElementById('sec-hr-sched').classList.toggle('hidden', !isHR);
  // è³ƒç™ºæ—¥ï¼ˆè³ƒè²¸ã®ã¿ï¼‰ / æ±ºæ¸ˆæ—¥ï¼ˆå£²è²·ã®ã¿ï¼‰
  const rentDates = document.getElementById('sec-rent-dates');
  const saleDates = document.getElementById('sec-sale-dates');
  if (rentDates) rentDates.classList.toggle('hidden', !isRent);
  if (saleDates) saleDates.classList.toggle('hidden', !isSale);
  calcReward();
}
function togglePartner() {
  const t = gv('g-case-type');
  document.getElementById('sec-partner').classList.toggle('hidden', t !== 'pt');
}
function checkReason() {
  const r = document.getElementById('low-reason').value;
  document.getElementById('reason-err').classList.toggle('show', r.length < 20);
}

// â”€â”€ ãƒãƒªãƒ‡ãƒ¼ã‚·ãƒ§ãƒ³ â”€â”€
function validateBilling() {
  const rent = parseFloat(document.getElementById('rent-amount').value) || 0;
  if (rent <= 0) return;
  const fees = Array.from(document.querySelectorAll('.bill-amount')).map(a => parseFloat(a.value)||0);
  const chukai = fees[0] || 0;
  const total  = fees.reduce((a,b) => a+b, 0);
  const v1 = document.getElementById('vi-1'), t1 = document.getElementById('val-1');
  const v2 = document.getElementById('vi-2'), t2 = document.getElementById('val-2');
  const v3 = document.getElementById('vi-3'), t3 = document.getElementById('val-3');
  v1.className='val-icon vi-ok'; t1.textContent=`å®¶è³ƒï¼šÂ¥${rent.toLocaleString()}ã€€ç·è«‹æ±‚ï¼šÂ¥${total.toLocaleString()}`;
  if (chukai > rent*1.1) { v2.className='val-icon vi-err'; t2.textContent=`âš ï¸ ä»²ä»‹æ‰‹æ•°æ–™ Â¥${chukai.toLocaleString()} > å®¶è³ƒÃ—1.1 Â¥${Math.round(rent*1.1).toLocaleString()}ï¼ˆã‚¨ãƒ©ãƒ¼ï¼‰`; }
  else { v2.className='val-icon vi-ok'; t2.textContent=`ä»²ä»‹æ‰‹æ•°æ–™ Â¥${chukai.toLocaleString()} â‰¤ å®¶è³ƒÃ—1.1 OK`; }
  if (total > 0 && total < rent*1.0) {
    v3.className='val-icon vi-warn'; t3.textContent=`âš ï¸ åˆè¨ˆ Â¥${total.toLocaleString()} < å®¶è³ƒÃ—1.0ï¼ˆç†ç”±å…¥åŠ›å¿…é ˆï¼‰`;
    document.getElementById('sec-low-reason').classList.remove('hidden');
  } else {
    v3.className='val-icon vi-ok'; t3.textContent=`åˆè¨ˆ Â¥${total.toLocaleString()} â‰¥ å®¶è³ƒÃ—1.0 OK`;
    document.getElementById('sec-low-reason').classList.add('hidden');
  }
}

// â”€â”€ æ—¥ä»˜ãƒ¦ãƒ¼ãƒ†ã‚£ãƒªãƒ†ã‚£ â”€â”€
function addMonth(d) { const r=new Date(d); r.setMonth(r.getMonth()+1); r.setDate(25); return r; }
function fmtDate(d) { return `${d.getFullYear()}å¹´${d.getMonth()+1}æœˆ${d.getDate()}æ—¥`; }

// â”€â”€ å ±é…¬è¨ˆç®— â”€â”€
function calcReward() {
  const agId    = document.getElementById('ag-select').value || (_S&&_S.agId) || '';
  const agType  = (_S&&_S.type) || 're';
  const biz     = gv('g-biz')       || 're-rent';
  const deal    = gv('g-deal')      || 'normal';
  const caseType = gv('g-case-type') || 'self';
  const isHR    = biz === 'hr';
  const isSanmei = deal === 'sanmei';
  const isPT    = caseType === 'pt';

  let fee = 0;
  if (isHR) {
    fee = parseFloat(document.getElementById('hr-fee').value) || 0;
  } else {
    document.querySelectorAll('.bill-amount').forEach(a => { fee += parseFloat(a.value)||0; });
  }

  const fullpay = document.getElementById('fullpay-date').value;
  if (fullpay) {
    const d = new Date(fullpay);
    const pay25 = addMonth(d);
    document.getElementById('pay25-display').value = fmtDate(pay25);
    document.getElementById('pay-timeline').style.display = '';
    renderTimeline(d, pay25);
  }

  if (!agId || fee <= 0) {
    document.getElementById('rh-val').textContent  = 'Â¥0';
    document.getElementById('rh-note').textContent = 'æ¡ˆä»¶IDã‚’å…¥åŠ›ã™ã‚‹ã¨è¨ˆç®—ã•ã‚Œã¾ã™';
    return;
  }

  const rateTable = RANK_RATE[isHR?'hr':'re'] || RANK_RATE.re;
  let baseRate = rateTable[(_S&&_S.rankKey)||'gold'] || 0;
  if (isPT)    baseRate = 0.25;
  if (isSanmei && !isHR) baseRate -= 0.15;

  let gross = 0;
  const T1=5e6, T2=10e6;
  if (fee<=T1)      gross = fee*baseRate;
  else if (fee<=T2) gross = T1*baseRate + (fee-T1)*(baseRate+.05);
  else              gross = T1*baseRate + (T2-T1)*(baseRate+.05) + (fee-T2)*(baseRate+.10);
  gross = Math.floor(gross);

  const M=1e6;
  const tax = isPT ? 0 : gross<=M ? Math.floor(gross*.1021) : Math.floor(M*.1021+(gross-M)*.2042);

  const feeMap = { gold:0, platinum:0, silver:490, bronze:980, pt:0 };
  const monthFee = isPT ? 0 : (feeMap[(_S&&_S.rankKey)||'gold'] || 0);
  const net = gross - tax - monthFee;

  const yen = v => v==null ? 'â€”' : 'Â¥'+Math.round(v).toLocaleString();
  const rankLabel = (_S&&_S.rank)||'â€”';

  document.getElementById('rh-val').textContent  = yen(net);
  document.getElementById('rh-note').textContent = `${_S?_S.name:agId}ï¼ˆ${rankLabel}ï¼‰ã€€è«‹æ±‚ï¼š${yen(fee)}ã€€å ±é…¬ç‡ï¼š${Math.round(baseRate*100)}%${isSanmei?'ï¼ˆä¸‰ç‚ºï¼‰':''}`;
  document.getElementById('bk-fee').textContent   = yen(fee);
  document.getElementById('bk-rate').textContent  = Math.round(baseRate*100)+'%';
  document.getElementById('bk-rate-label').textContent = isSanmei ? 'ä¸‰ç‚ºè£œæ­£å¾Œ' : '';
  document.getElementById('bk-gross').textContent = yen(gross);
  document.getElementById('bk-tax').textContent   = 'âˆ’'+yen(tax);
  document.getElementById('bk-fee2').textContent  = monthFee ? 'âˆ’'+yen(monthFee) : 'Â¥0';
  document.getElementById('bk-total').textContent = yen(net);

  if (isHR) {
    const joinV = document.getElementById('hr-join').value;
    const ref   = parseInt(document.getElementById('hr-ref').value)||3;
    const p1=Math.floor(net*.5), p2=net-p1;
    let d1='å…¥ç¤¾ç¿Œæœˆ25æ—¥', d2=`å…¥ç¤¾${ref}ãƒ¶æœˆå¾Œç¿Œæœˆ25æ—¥`;
    if (joinV) {
      const j=new Date(joinV);
      const m1=new Date(j); m1.setMonth(m1.getMonth()+1); m1.setDate(25);
      const m2=new Date(j); m2.setMonth(m2.getMonth()+ref); m2.setDate(25);
      d1=fmtDate(m1); d2=fmtDate(m2);
    }
    document.getElementById('hr-sched-cards').innerHTML = `
      <div style="background:var(--card2);border:1px solid var(--border2);border-radius:10px;padding:14px">
        <div style="font-size:10px;color:var(--muted);margin-bottom:4px">ç¬¬1å›ï¼ˆ50%ï¼‰</div>
        <div style="font-family:'DM Mono',monospace;font-size:18px;color:var(--gold)">${yen(p1)}</div>
        <div style="font-size:10px;color:var(--sub);margin-top:4px">${d1}</div>
      </div>
      <div style="background:var(--card2);border:1px solid var(--border2);border-radius:10px;padding:14px">
        <div style="font-size:10px;color:var(--muted);margin-bottom:4px">ç¬¬2å›ï¼ˆ50%ï¼‰</div>
        <div style="font-family:'DM Mono',monospace;font-size:18px;color:var(--gold)">${yen(p2)}</div>
        <div style="font-size:10px;color:var(--sub);margin-top:4px">${d2}</div>
      </div>`;
  }
}

function renderTimeline(fpDate, pay25) {
  const chk=new Date(fpDate); chk.setMonth(chk.getMonth()+1); chk.setDate(1);
  const mei=new Date(fpDate); mei.setMonth(mei.getMonth()+1); mei.setDate(15);
  const dat=new Date(fpDate); dat.setMonth(dat.getMonth()+1); dat.setDate(20);
  document.getElementById('timeline-content').innerHTML = `
    <div style="display:flex;flex-direction:column;gap:6px;font-size:11px">
      <div style="display:flex;justify-content:space-between;color:var(--green)"><span>âœ… å…¨é¡å…¥é‡‘ç¢ºèª</span><span style="font-family:'DM Mono',monospace">${fmtDate(fpDate)}</span></div>
      <div style="display:flex;justify-content:space-between;color:var(--sub)"><span>ğŸ” 8é …ç›®è‡ªå‹•ãƒã‚§ãƒƒã‚¯</span><span style="font-family:'DM Mono',monospace">${fmtDate(chk)}</span></div>
      <div style="display:flex;justify-content:space-between;color:var(--sub)"><span>ğŸ“„ æ”¯æ‰•æ˜ç´°æ›¸ç™ºè¡Œ</span><span style="font-family:'DM Mono',monospace">${fmtDate(mei)}</span></div>
      <div style="display:flex;justify-content:space-between;color:var(--sub)"><span>ğŸ“Š æŒ¯è¾¼ãƒ‡ãƒ¼ã‚¿ä½œæˆ</span><span style="font-family:'DM Mono',monospace">${fmtDate(dat)}</span></div>
      <div style="display:flex;justify-content:space-between;color:var(--gold);font-weight:700"><span>ğŸ¦ GMOéŠ€è¡ŒæŒ¯è¾¼</span><span style="font-family:'DM Mono',monospace">${fmtDate(pay25)}</span></div>
    </div>`;
}

// â”€â”€ é€ä¿¡ â”€â”€
function submitClose() {
  const agId    = (_S&&_S.agId) || document.getElementById('ag-select').value || '';
  const agName  = (_S&&_S.name) || agId;
  const caseId  = document.getElementById('case-id').value.trim();
  const fullpay = document.getElementById('fullpay-date').value;

  if (!agId)    { alert('ãƒ­ã‚°ã‚¤ãƒ³æƒ…å ±ã‚’å–å¾—ã§ãã¾ã›ã‚“ã€‚ãƒã‚¤ãƒšãƒ¼ã‚¸ã‹ã‚‰ãƒ­ã‚°ã‚¤ãƒ³ã—ç›´ã—ã¦ãã ã•ã„'); return; }
  if (!caseId)  { alert('æ¡ˆä»¶IDã‚’å…¥åŠ›ã—ã¦ãã ã•ã„'); return; }
  if (!fullpay) { alert('å…¨é¡å…¥é‡‘ç¢ºèªæ—¥ã‚’å…¥åŠ›ã—ã¦ãã ã•ã„'); return; }

  const biz = gv('g-biz')||'re-rent';
  if (biz !== 'hr') {
    const fees = Array.from(document.querySelectorAll('.bill-amount')).map(a=>parseFloat(a.value)||0);
    if (!fees[0]) { alert('è«‹æ±‚é‡‘é¡ã‚’å…¥åŠ›ã—ã¦ãã ã•ã„'); return; }
  }
  if (biz !== 'hr') {
    const lr = document.getElementById('sec-low-reason');
    if (lr && !lr.classList.contains('hidden')) {
      if ((document.getElementById('low-reason').value||'').length < 20) {
        alert('æ‰‹æ•°æ–™ãŒä½ã„ç†ç”±ã‚’20æ–‡å­—ä»¥ä¸Šå…¥åŠ›ã—ã¦ãã ã•ã„'); return;
      }
    }
  }

  alert('âœ… æˆç´„å ±å‘Šã‚’å—ä»˜ã‘ã¾ã—ãŸï¼\n\næ‹…å½“ï¼š'+agName+'ï¼ˆ'+agId+'ï¼‰\næ¡ˆä»¶IDï¼š'+caseId+'\nå…¥é‡‘ç¢ºèªæ—¥ï¼š'+fullpay+'\n\nâ–¶ è‡ªå‹•å‡¦ç†ï¼š\n  ãƒ»Kintoneç™»éŒ²\n  ãƒ»#æˆç´„å ±å‘Š ã«é€šçŸ¥\n  ãƒ»ç¿Œæœˆ25æ—¥ã«è‡ªå‹•æŒ¯è¾¼\n\nãŠç–²ã‚Œæ§˜ã§ã—ãŸï¼ğŸ‰');
}

// â”€â”€ æŒ¯è¾¼ãƒãƒƒãƒ â”€â”€
const PAYOUT_DATA = [
  {agId:'10012',name:'å±±ç”° èª ',  rank:'gold',    cases:7,gross:1850000,tax:Math.floor(1000000*.1021+850000*.2042),fee:0,  instant:0,      flags:['warn'],    status:'pending', error:'â‘¦ æˆç´„æ•°ã‚’ç¢ºèª'},
  {agId:'10008',name:'ä½è—¤ èŠ±å­',rank:'platinum', cases:2,gross:980000, tax:Math.floor(980000*.1021),             fee:0,  instant:200000, flags:['instant'], status:'approved',error:''},
  {agId:'20005',name:'ç”°ä¸­ ç¾ç©‚',rank:'gold',    cases:1,gross:750000, tax:Math.floor(750000*.1021),             fee:0,  instant:0,      flags:['hr'],      status:'approved',error:''},
  {agId:'10023',name:'éˆ´æœ¨ å¥å¤ª',rank:'silver',  cases:1,gross:335000, tax:Math.floor(335000*.1021),             fee:490,instant:0,      flags:[],          status:'approved',error:''},
  {agId:'10041',name:'æ¸¡è¾º éš†',  rank:'bronze',  cases:1,gross:211750, tax:Math.floor(211750*.1021),             fee:980,instant:0,      flags:['error'],   status:'pending', error:'â‘¡ å ±é…¬ç‡ã‚’ä¿®æ­£'},
];
const RANK_CLS = {gold:'rank-g',platinum:'rank-p',silver:'rank-s',bronze:'rank-b'};
const yen = v => 'Â¥'+Math.round(v).toLocaleString();

function renderPayoutTable() {
  const tbody = document.getElementById('payout-tbody');
  tbody.innerHTML = PAYOUT_DATA.map(row => {
    const net = row.gross - row.tax - row.fee - row.instant;
    const isErr  = row.flags.includes('error');
    const isWarn = row.flags.includes('warn');
    const isInst = row.flags.includes('instant');
    const rowCls = isErr ? 'has-error' : isInst ? 'is-instant' : '';
    const statusHtml = row.status==='approved'
      ? '<span class="flag flag-ok">âœ… æ‰¿èªæ¸ˆã¿</span>'
      : `<button class="btn btn-${isErr?'muted':'green'} btn-sm" onclick="approveRow('${row.agId}')" ${isErr?'disabled':''}>æ‰¿èª</button>`;
    const flagHtml = row.flags.map(f =>
      f==='warn'    ? '<span class="flag flag-hold">âš ï¸ ç¢ºèªä¸­</span>' :
      f==='error'   ? '<span class="flag flag-hold">ğŸ”´ ã‚¨ãƒ©ãƒ¼</span>' :
      f==='instant' ? '<span class="flag flag-instant">âš¡ å³æ—¥æ‰•è¾¼æ¸ˆ</span>' :
      f==='hr'      ? '<span class="flag flag-hr">ğŸ‘¥ HR 2å›æ‰•ã„</span>' : ''
    ).join('');
    return `<tr class="${rowCls}">
      <td><div class="ag-info">
        <div class="ag-name">${row.name}</div>
        <div class="ag-id">${row.agId}</div>
        <div class="ag-rank ${RANK_CLS[row.rank]||''}">${row.rank.charAt(0).toUpperCase()+row.rank.slice(1)}</div>
      </div></td>
      <td style="text-align:center">${row.cases}</td>
      <td><div class="amount-col">${yen(row.gross)}</div></td>
      <td><div class="amount-col" style="color:var(--muted)">âˆ’${yen(row.tax)}</div></td>
      <td><div class="amount-col" style="color:var(--muted)">${row.fee?'âˆ’'+yen(row.fee):'Â¥0'}</div></td>
      <td><div class="amount-col main">${yen(net)}</div>${isInst?`<div style="font-size:10px;color:var(--muted)">å³æ—¥æ‰•æ¸ˆ âˆ’${yen(row.instant)}</div>`:''}</td>
      <td><div style="display:flex;gap:4px;flex-direction:column">${flagHtml||'<span style="font-size:10px;color:var(--muted)">ãªã—</span>'}${row.error?`<div style="font-size:10px;color:var(--red);margin-top:2px">${row.error}</div>`:''}</div></td>
      <td>${statusHtml}</td>
      <td><button class="btn btn-muted btn-sm">è©³ç´°</button></td>
    </tr>`;
  }).join('');
}
function approveRow(agId) {
  const row = PAYOUT_DATA.find(r => r.agId===agId);
  if (row) { row.status='approved'; renderPayoutTable(); }
}
function approveAll() {
  if (confirm('ã‚¨ãƒ©ãƒ¼ã®ãªã„ã‚¨ãƒ¼ã‚¸ã‚§ãƒ³ãƒˆã‚’å…¨å“¡æ‰¿èªã—ã¾ã™ã‹ï¼Ÿ')) {
    PAYOUT_DATA.filter(r => !r.flags.includes('error') && !r.flags.includes('warn'))
               .forEach(r => r.status='approved');
    renderPayoutTable();
  }
}
function exportCSV() {
  const rows=[['å£åº§åç¾©','éŠ€è¡Œã‚³ãƒ¼ãƒ‰','æ”¯åº—ã‚³ãƒ¼ãƒ‰','å£åº§ç•ªå·','æŒ¯è¾¼é¡']];
  PAYOUT_DATA.forEach(r => rows.push([r.name,'0310','001','XXXXXXX', r.gross-r.tax-r.fee-r.instant]));
  const csv = rows.map(r=>r.join(',')).join('\n');
  const a = document.createElement('a');
  a.href = URL.createObjectURL(new Blob(['\uFEFF'+csv],{type:'text/csv'}));
  a.download = 'CORETO_æŒ¯è¾¼ãƒ‡ãƒ¼ã‚¿_2026å¹´02æœˆ.csv';
  a.click();
}

// â”€â”€ åˆæœŸåŒ– â”€â”€
window.addEventListener('DOMContentLoaded', () => {
  initSessionUI();
  renderPayoutTable();
});

// â”€â”€ ç´¹ä»‹ãƒªãƒ³ã‚¯ãƒ¢ãƒ¼ãƒ€ãƒ« â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
var _refCurrentCode = '';
function openRefModal() {
  var overlay = document.getElementById('ref-modal-overlay');
  var selector = document.getElementById('ref-code-selector');
  var isExec = (typeof session !== 'undefined' && session && session.hqRole === 'exec')
            || (typeof CURRENT_USER !== 'undefined' && CURRENT_USER && CURRENT_USER.hqRole === 'exec');
  var agentId = (typeof session !== 'undefined' && session && session.userId) ? session.userId
              : (typeof ME !== 'undefined' && ME && ME.id) ? ME.id
              : (typeof AGENT !== 'undefined' && AGENT && AGENT.id) ? AGENT.id : '10012';
  if (isExec) {
    var SPECIAL = ['FOUNDER2026','WELCOME2026','GOLD_START','HR_PRO75'];
    var opts = SPECIAL.map(function(c){ return '<option value="'+c+'">â­ '+c+'</option>'; }).join('');
    selector.innerHTML =
      '<div style="margin-bottom:12px"><div style="font-size:10px;color:var(--sub);font-weight:600;margin-bottom:5px">ã‚³ãƒ¼ãƒ‰ç¨®åˆ¥</div>'
      +'<select id="ref-code-select" onchange="updateRefLink()" style="width:100%;padding:8px 10px;background:var(--card2);border:1px solid var(--border2);border-radius:8px;color:var(--text);font-size:12px;font-family:inherit">'
      +'<option value="'+agentId+'">è‡ªåˆ†ã®IDï¼ˆ'+agentId+'ï¼‰</option>'
      +'<optgroup label="â”€â”€ ç‰¹åˆ¥ã‚³ãƒ¼ãƒ‰ â”€â”€">'+opts+'</optgroup>'
      +'</select></div>';
    _refCurrentCode = agentId;
  } else {
    selector.innerHTML =
      '<div style="display:flex;align-items:center;gap:8px;margin-bottom:12px;padding:8px 12px;background:rgba(201,168,76,.06);border:1px solid rgba(201,168,76,.2);border-radius:8px">'
      +'<span style="font-size:11px;color:var(--muted)">ç´¹ä»‹ã‚³ãƒ¼ãƒ‰ï¼š</span>'
      +'<span style="font-family:\'DM Mono\',monospace;font-size:13px;font-weight:700;color:var(--gold)">'+agentId+'</span>'
      +'</div>';
    _refCurrentCode = agentId;
  }
  updateRefLink();
  overlay.classList.add('open');
}
function updateRefLink() {
  var sel = document.getElementById('ref-code-select');
  if (sel) _refCurrentCode = sel.value;
  var base = location.origin + location.pathname.replace(/[^/]*$/, '') + 'coreto-agent-signup.html';
  var url = base + '?ref=' + encodeURIComponent(_refCurrentCode);
  document.getElementById('ref-url-display').textContent = url;
}
function closeRefModal() {
  document.getElementById('ref-modal-overlay').classList.remove('open');
}
function copyRefLink() {
  var url = document.getElementById('ref-url-display').textContent;
  navigator.clipboard.writeText(url).then(function() {
    var btn = document.querySelector('.ref-copy-btn');
    btn.textContent = 'âœ… ã‚³ãƒ”ãƒ¼ã—ã¾ã—ãŸ';
    setTimeout(function(){ btn.textContent = 'ğŸ“‹ ã‚³ãƒ”ãƒ¼'; }, 2000);
  }).catch(function() {
    var ta = document.createElement('textarea');
    ta.value = url; document.body.appendChild(ta); ta.select();
    document.execCommand('copy'); document.body.removeChild(ta);
  });
}
</script>

<div id="ref-modal-overlay" onclick="if(event.target===this)closeRefModal()">
  <div id="ref-modal">
    <div class="ref-mhdr">
      <div class="ref-mhdr-t">ğŸ”— ç´¹ä»‹ãƒªãƒ³ã‚¯ç™ºè¡Œ</div>
      <button onclick="closeRefModal()" style="background:none;border:none;color:var(--muted);font-size:20px;cursor:pointer;line-height:1">Ã—</button>
    </div>
    <div class="ref-mbody">
      <div style="font-size:11px;color:var(--sub);margin-bottom:14px;line-height:1.8">ã“ã®ãƒªãƒ³ã‚¯ã‹ã‚‰å…¥ä¼šã™ã‚‹ã¨ç´¹ä»‹ã‚³ãƒ¼ãƒ‰ãŒè‡ªå‹•å…¥åŠ›ã•ã‚Œã¾ã™ã€‚</div>
      <div id="ref-code-selector"></div>
      <div style="font-size:10px;color:var(--muted);margin-bottom:4px;font-weight:600;letter-spacing:.5px">ç™ºè¡Œãƒªãƒ³ã‚¯</div>
      <div class="ref-url" id="ref-url-display">â€”</div>
      <button class="ref-copy-btn" onclick="copyRefLink()">ğŸ“‹ ã‚³ãƒ”ãƒ¼</button>
    </div>
  </div>
</div>

<button id="ref-float-btn" onclick="openRefModal()">ğŸ”— ç´¹ä»‹ãƒªãƒ³ã‚¯ç™ºè¡Œ</button>
</body>
</html>
