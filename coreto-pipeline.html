<!DOCTYPE html>
<html lang="ja">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>CORETO â€” æ¡ˆä»¶ãƒ‘ã‚¤ãƒ—ãƒ©ã‚¤ãƒ³</title>
<style>
@import url('https://fonts.googleapis.com/css2?family=Noto+Sans+JP:wght@300;400;500;700&family=DM+Mono:wght@400;500&family=Syne:wght@700;800&display=swap');
*{box-sizing:border-box;margin:0;padding:0}
:root{
  --bg:#07090f;--card:#0f1119;--card2:#141720;--border:#1e2235;--border2:#252a3d;
  --gold:#c9a84c;--gold-dim:#7a5f22;
  --blue:#4f9cf9;--green:#34d399;--red:#f87171;--orange:#fb923c;--purple:#a78bfa;
  --teal:#2dd4bf;
  --muted:#4a5270;--sub:#7a849e;--text:#e2e6f3;
}
html,body{height:100%;font-family:'Noto Sans JP',sans-serif;background:var(--bg);color:var(--text);overflow:hidden}
.hdr{height:54px;display:flex;align-items:center;justify-content:space-between;
  padding:0 22px;border-bottom:1px solid var(--border);background:rgba(7,9,15,.95);z-index:50;position:relative}
.logo{font-family:'Syne',sans-serif;font-size:17px;font-weight:800;color:var(--gold);letter-spacing:3px}
.toolbar{display:flex;align-items:center;gap:10px;padding:10px 22px;
  border-bottom:1px solid var(--border);background:var(--card2)}
/* Kanban board */
.board{display:flex;gap:0;height:calc(100vh - 54px - 50px);overflow-x:auto;overflow-y:hidden}
.col{width:280px;flex-shrink:0;display:flex;flex-direction:column;border-right:1px solid var(--border)}
.col:last-child{border-right:none}
.col-hdr{padding:12px 14px;border-bottom:1px solid var(--border);display:flex;align-items:center;justify-content:space-between;flex-shrink:0}
.col-title{font-size:10px;font-weight:700;letter-spacing:1.5px;text-transform:uppercase;display:flex;align-items:center;gap:8px}
.col-dot{width:8px;height:8px;border-radius:50%;flex-shrink:0}
.col-count{font-size:9px;padding:2px 8px;border-radius:10px;font-weight:700}
.col-body{flex:1;overflow-y:auto;padding:10px;display:flex;flex-direction:column;gap:8px}
/* Case card */
.case-card{background:var(--card);border:1px solid var(--border);border-radius:10px;padding:12px;
  cursor:pointer;transition:.15s;position:relative}
.case-card:hover{border-color:var(--border2);background:#11141f;transform:translateY(-1px);box-shadow:0 4px 16px rgba(0,0,0,.3)}
.case-card.dragging{opacity:.5}
.cc-type{font-size:8px;font-weight:700;letter-spacing:1px;margin-bottom:6px;display:flex;align-items:center;gap:6px}
.cc-client{font-size:13px;font-weight:700;margin-bottom:3px;white-space:nowrap;overflow:hidden;text-overflow:ellipsis}
.cc-sub{font-size:10px;color:var(--muted);margin-bottom:8px;white-space:nowrap;overflow:hidden;text-overflow:ellipsis}
.cc-meta{display:flex;align-items:center;justify-content:space-between;margin-top:8px;padding-top:8px;border-top:1px solid var(--border)}
.cc-id{font-family:'DM Mono',monospace;font-size:9px;color:var(--muted)}
.cc-amount{font-family:'DM Mono',monospace;font-size:11px;color:var(--gold);font-weight:700}
.cc-days{font-size:9px;padding:2px 7px;border-radius:5px;font-weight:700}
.cc-agent{font-size:9px;color:var(--sub);margin-top:4px;display:flex;align-items:center;gap:4px}
/* Stale indicator */
.cc-stale{position:absolute;top:8px;right:8px;width:7px;height:7px;border-radius:50%;background:var(--red)}
/* Pills */
.pill{display:inline-flex;align-items:center;gap:4px;padding:2px 8px;border-radius:5px;font-size:9px;font-weight:700}
.btn{padding:7px 14px;border-radius:8px;font-size:11px;font-weight:700;cursor:pointer;
  font-family:'Noto Sans JP',sans-serif;transition:.15s;border:none;display:inline-flex;align-items:center;gap:6px}
.btn-blue{background:linear-gradient(135deg,var(--blue),#3070c0);color:#fff}
.btn-ghost{background:transparent;border:1px solid var(--border2);color:var(--sub)}
.btn-ghost:hover{color:var(--text)}
.btn-sm{padding:4px 10px;font-size:10px;border-radius:6px}
/* Add card button */
.add-card{padding:8px;border:1px dashed var(--border2);border-radius:8px;
  text-align:center;font-size:11px;color:var(--muted);cursor:pointer;transition:.15s}
.add-card:hover{border-color:var(--blue);color:var(--blue);background:rgba(79,156,249,.04)}
/* Detail panel */
.panel{position:fixed;right:0;top:54px;width:400px;height:calc(100vh - 54px);
  background:var(--card);border-left:1px solid var(--border);z-index:100;
  display:none;flex-direction:column;overflow:hidden}
.panel.show{display:flex}
.panel-hdr{padding:16px 20px;border-bottom:1px solid var(--border);display:flex;align-items:center;justify-content:space-between}
.panel-body{flex:1;overflow-y:auto;padding:18px 20px}
.panel-close{background:none;border:none;color:var(--muted);font-size:20px;cursor:pointer}
/* Select move */
.move-btns{display:flex;flex-wrap:wrap;gap:6px;margin-top:10px}
.move-btn{padding:6px 12px;border-radius:7px;font-size:10px;font-weight:700;cursor:pointer;
  border:1px solid var(--border2);background:transparent;color:var(--sub);
  font-family:'Noto Sans JP',sans-serif;transition:.15s}
.move-btn:hover{color:var(--text);border-color:var(--sub)}
.move-btn.cur{border-color:var(--blue);color:var(--blue);background:rgba(79,156,249,.08)}
/* Filter */
.filter-btn{padding:5px 12px;border-radius:7px;font-size:10px;font-weight:700;cursor:pointer;
  border:1px solid var(--border2);background:transparent;color:var(--sub);
  font-family:'Noto Sans JP',sans-serif;transition:.15s}
.filter-btn.on{border-color:var(--blue);color:var(--blue);background:rgba(79,156,249,.08)}
/* Timeline memo */
.memo-item{display:flex;gap:10px;padding-bottom:12px}
.memo-dot{width:8px;height:8px;border-radius:50%;background:var(--border2);flex-shrink:0;margin-top:4px}
.memo-dot.act{background:var(--blue)}
.memo-line{width:1px;background:var(--border2);flex-shrink:0;margin:-4px 3.5px 0;align-self:stretch}
::-webkit-scrollbar{width:4px;height:4px}::-webkit-scrollbar-thumb{background:var(--border2);border-radius:2px}
</style>
</head>
<body>
<div class="hdr">
  <div style="display:flex;align-items:center;gap:12px">
    <div class="logo">CORETO</div>
    <div style="width:1px;height:18px;background:var(--border2)"></div>
    <span style="font-size:10px;color:var(--muted);letter-spacing:1px">æ¡ˆä»¶ãƒ‘ã‚¤ãƒ—ãƒ©ã‚¤ãƒ³</span>
  </div>
  <div style="display:flex;gap:8px;align-items:center">
    <span id="my-name-pill" style="font-size:11px;color:var(--sub)">å±±ç”° èª  / 10012</span>
    <button class="btn btn-blue btn-sm" onclick="openAddCase()">ï¼‹ æ–°è¦æ¡ˆä»¶</button>
    <button class="btn btn-ghost btn-sm" onclick="window.location.href='coreto-hub.html'">ğŸ  ãƒ›ãƒ¼ãƒ </button>
  </div>
</div>

<!-- Toolbar / Filter -->
<div class="toolbar">
  <span style="font-size:10px;color:var(--muted);font-weight:700;letter-spacing:1px">ãƒ•ã‚£ãƒ«ã‚¿ãƒ¼ï¼š</span>
  <button class="filter-btn on" onclick="filter('all',this)">ã™ã¹ã¦</button>
  <button class="filter-btn" onclick="filter('re',this)">ğŸ  è³ƒè²¸ä»²ä»‹</button>
  <button class="filter-btn" onclick="filter('sale',this)">ğŸ¢ å£²è²·</button>
  <button class="filter-btn" onclick="filter('hr',this)">ğŸ‘¥ äººæç´¹ä»‹</button>
  <div style="margin-left:auto;font-size:11px;color:var(--muted)">
    ğŸ”´ = 7æ—¥ä»¥ä¸Šå‹•ããªã—
  </div>
</div>

<!-- Kanban -->
<div class="board" id="board"></div>

<!-- Detail Panel -->
<div class="panel" id="detail-panel">
  <div class="panel-hdr">
    <div>
      <div style="font-family:'DM Mono',monospace;font-size:10px;color:var(--muted)" id="dp-id">â€”</div>
      <div style="font-size:14px;font-weight:800;margin-top:2px" id="dp-name">â€”</div>
    </div>
    <button class="panel-close" onclick="closePanel()">âœ•</button>
  </div>
  <div class="panel-body" id="dp-body"></div>
</div>

<script>
const SESSION_KEY = 'coreto_session';
const s = (() => { try { return JSON.parse(sessionStorage.getItem(SESSION_KEY)||'{}'); } catch(e){return {};} })();
const ME = { id: s.id||'10012', name: s.name||'å±±ç”° èª ', type: s.type||'re' };

const STAGES = [
  { id:'new',      label:'æ–°è¦å•åˆã›',  color:'var(--sub)',    dot:'#4a5270' },
  { id:'naiken',   label:'å†…è¦‹èª¿æ•´ä¸­',  color:'var(--blue)',   dot:'#4f9cf9' },
  { id:'apply',    label:'ç”³è¾¼ãƒ»å¯©æŸ»',  color:'var(--orange)', dot:'#fb923c' },
  { id:'contract', label:'å¥‘ç´„ç· çµä¸­',  color:'var(--gold)',   dot:'#c9a84c' },
  { id:'payment',  label:'å…¥é‡‘å¾…ã¡',    color:'var(--purple)', dot:'#a78bfa' },
  { id:'done',     label:'æˆç´„å®Œäº†',    color:'var(--green)',  dot:'#34d399' },
];

const TYPE_LABEL = { re:'ğŸ  è³ƒè²¸', sale:'ğŸ¢ å£²è²·', hr:'ğŸ‘¥ äººæ' };
const TYPE_COLOR = { re:'var(--blue)', sale:'var(--gold)', hr:'var(--green)' };

let CASES = [
  {id:'R042857',client:'ç”°ä¸­ é›„ä»‹',sub:'æ¸‹è°·åŒº 2LDK æƒ³å®šÂ¥220,000',stage:'naiken', type:'re',amt:220000,agent:'10012',days:3,memo:['2/19 å†…è¦‹å®Ÿæ–½ã€‚å¥½æ„Ÿè§¦ã€‚']},
  {id:'R039102',client:'æœ¨æ‘ å½©é¦™',sub:'å“å·åŒº 1K æƒ³å®šÂ¥85,000',  stage:'apply',   type:'re',amt:85000, agent:'10012',days:1,memo:['2/20 ç”³è¾¼æ›¸é¡å—é ˜ã€‚å®¡æŸ¥ä¸­ã€‚']},
  {id:'S819204',client:'å‰ç”° å¤§è¼”',sub:'ç›®é»’åŒº ä¸€æˆ¸å»ºã¦ 3,200ä¸‡',stage:'contract', type:'sale',amt:3200000,agent:'10008',days:5,memo:['2/15 å¥‘ç´„æ›¸ä½œæˆä¸­ã€‚']},
  {id:'R041003',client:'æ–è—¤ äº®',  sub:'æ–°å®¿åŒº 1LDK æƒ³å®šÂ¥130,000',stage:'new',   type:'re',amt:130000,agent:'10023',days:9,memo:['2/11 å•åˆã›å—ä¿¡ã€‚æœªé€£çµ¡ã€‚'],stale:true},
  {id:'H334521',client:'ITã‚¹ã‚¿ãƒ¼ãƒˆã‚¢ãƒƒãƒ—Aç¤¾',sub:'ã‚¨ãƒ³ã‚¸ãƒ‹ã‚¢ å¹´å700ä¸‡',stage:'apply',type:'hr',amt:700000,agent:'20005',days:2,memo:['2/19 æ›¸é¡é¸è€ƒé€šéã€‚']},
  {id:'R038291',client:'æ¾æœ¬ æµ©äºŒ',sub:'æ¸‹è°·åŒº 2K æƒ³å®šÂ¥170,000',stage:'payment', type:'re',amt:170000,agent:'10012',days:0,memo:['2/21 å…¥é‡‘ç¢ºèªå¾…ã¡ã€‚']},
  {id:'R040011',client:'ä¸­æ‘ ç”±ç¾',sub:'æ¸¯åŒº 1R æƒ³å®šÂ¥95,000',    stage:'done',   type:'re',amt:95000, agent:'10012',days:0,memo:['2/18 æˆç´„ã€‚å ±é…¬ç¢ºå®šæ¸ˆã¿ã€‚']},
  {id:'H335002',client:'å¤§æ‰‹è£½é€ æ¥­Bç¤¾',sub:'å–¶æ¥­è· å¹´å550ä¸‡',   stage:'naiken', type:'hr',amt:550000,agent:'20005',days:4,memo:['2/17 ä¸€æ¬¡é¢æ¥è¨­å®šå®Œäº†ã€‚']},
];

let activeFilter = 'all';
let activeCase = null;

function filter(type, btn) {
  activeFilter = type;
  document.querySelectorAll('.filter-btn').forEach(b=>b.classList.remove('on'));
  btn.classList.add('on');
  renderBoard();
}

function renderBoard() {
  const board = document.getElementById('board');
  const cases = activeFilter === 'all' ? CASES : CASES.filter(c=>c.type===activeFilter);
  board.innerHTML = STAGES.map(stage => {
    const cols = cases.filter(c=>c.stage===stage.id);
    return `
    <div class="col">
      <div class="col-hdr">
        <div class="col-title">
          <div class="col-dot" style="background:${stage.dot}"></div>
          ${stage.label}
        </div>
        <span class="col-count" style="background:${stage.dot}22;color:${stage.color};border:1px solid ${stage.dot}44">${cols.length}</span>
      </div>
      <div class="col-body">
        ${cols.map(c=>renderCard(c)).join('')}
        <div class="add-card" onclick="openAddCase('${stage.id}')">ï¼‹ è¿½åŠ </div>
      </div>
    </div>`;
  }).join('');
}

function renderCard(c) {
  const daysLabel = c.days === 0 ? 'æœ¬æ—¥' : `${c.days}æ—¥å‰`;
  const daysColor = c.days >= 7 ? 'var(--red)' : c.days >= 3 ? 'var(--orange)' : 'var(--muted)';
  const staleIndicator = c.stale ? '<div class="cc-stale" title="7æ—¥ä»¥ä¸Šå‹•ããªã—"></div>' : '';
  const ym = c.type==='hr' ? 'ä¸‡' : 'ä¸‡';
  const amtDisplay = c.amt >= 1000000 ? `Â¥${(c.amt/10000).toFixed(0)}ä¸‡` : `Â¥${(c.amt/10000).toFixed(0)}ä¸‡`;
  return `
  <div class="case-card" onclick="openCase('${c.id}')">
    ${staleIndicator}
    <div class="cc-type" style="color:${TYPE_COLOR[c.type]}">${TYPE_LABEL[c.type] || c.type}</div>
    <div class="cc-client">${c.client}</div>
    <div class="cc-sub">${c.sub}</div>
    <div class="cc-meta">
      <div class="cc-id">${c.id}</div>
      <div class="cc-amount">${amtDisplay}</div>
    </div>
    <div class="cc-agent">ğŸ‘¤ ${c.agent}
      <span style="margin-left:auto;font-size:9px;color:${daysColor}">æ›´æ–° ${daysLabel}</span>
    </div>
  </div>`;
}

function openCase(id) {
  activeCase = CASES.find(c=>c.id===id);
  if (!activeCase) return;
  const c = activeCase;
  const panel = document.getElementById('detail-panel');
  const body = document.getElementById('dp-body');
  document.getElementById('dp-id').textContent = c.id;
  document.getElementById('dp-name').textContent = c.client;
  panel.classList.add('show');

  const stageIdx = STAGES.findIndex(s=>s.id===c.stage);
  body.innerHTML = `
    <div style="margin-bottom:14px">
      <div style="font-size:10px;color:var(--muted);margin-bottom:6px;font-weight:600">ç¾åœ¨ã®ã‚¹ãƒ†ãƒ¼ã‚¸</div>
      <div class="move-btns">
        ${STAGES.map((s,i)=>`<button class="move-btn ${s.id===c.stage?'cur':''}" onclick="moveCase('${c.id}','${s.id}')">${s.label}</button>`).join('')}
      </div>
    </div>

    <div style="display:grid;grid-template-columns:auto 1fr;gap:6px 14px;font-size:12px;margin-bottom:16px;
                padding:12px;background:var(--card2);border-radius:10px">
      <span style="color:var(--muted)">ç¨®åˆ¥</span><span>${TYPE_LABEL[c.type]}</span>
      <span style="color:var(--muted)">é¡§å®¢</span><span style="font-weight:700">${c.client}</span>
      <span style="color:var(--muted)">ç‰©ä»¶/æ¡ˆä»¶</span><span>${c.sub}</span>
      <span style="color:var(--muted)">æƒ³å®šå ±é…¬</span><span style="font-family:'DM Mono';color:var(--gold);font-weight:700">Â¥${c.amt.toLocaleString()}</span>
      <span style="color:var(--muted)">æ‹…å½“è€…</span><span>${c.agent}</span>
      <span style="color:var(--muted)">æœ€çµ‚æ›´æ–°</span><span>${c.days===0?'æœ¬æ—¥':`${c.days}æ—¥å‰`}</span>
    </div>

    <div style="margin-bottom:14px">
      <div style="font-size:10px;color:var(--muted);margin-bottom:8px;font-weight:600">ãƒ¡ãƒ¢ãƒ»æ´»å‹•å±¥æ­´</div>
      <div style="display:flex;flex-direction:column;gap:0" id="memo-list">
        ${(c.memo||[]).map((m,i)=>`
          <div class="memo-item">
            <div style="display:flex;flex-direction:column;align-items:center">
              <div class="memo-dot ${i===0?'act':''}"></div>
              ${i<(c.memo.length-1)?'<div class="memo-line"></div>':''}
            </div>
            <div style="flex:1;font-size:11px;padding-top:1px;line-height:1.6">${m}</div>
          </div>`).join('')}
      </div>
      <div style="display:flex;gap:8px;margin-top:8px">
        <input type="text" id="memo-input" placeholder="æ´»å‹•ãƒ¡ãƒ¢ã‚’è¿½åŠ ..." style="flex:1;background:#090b13;
          border:1px solid var(--border2);border-radius:8px;padding:8px 12px;color:var(--text);
          font-size:11px;font-family:'Noto Sans JP',sans-serif;outline:none"
          onkeydown="if(event.key==='Enter')addMemo('${c.id}')">
        <button class="btn btn-blue btn-sm" onclick="addMemo('${c.id}')">è¿½åŠ </button>
      </div>
    </div>

    <div style="display:flex;gap:8px">
      <button class="btn btn-ghost btn-sm" onclick="window.location.href='coreto-matching.html'">
        ğŸ“‹ æ¡ˆä»¶ãƒœãƒ¼ãƒ‰ã§é–‹ã
      </button>
      ${c.stage==='payment'?`<button class="btn btn-blue btn-sm" onclick="reportClose('${c.id}')">ğŸ¯ æˆç´„å ±å‘Šã¸</button>`:''}
    </div>
  `;
}

function moveCase(id, newStage) {
  const c = CASES.find(c=>c.id===id);
  if (c) { c.stage=newStage; c.days=0; c.stale=false; }
  renderBoard();
  openCase(id);
}

function addMemo(id) {
  const input = document.getElementById('memo-input');
  const text = input.value.trim();
  if (!text) return;
  const c = CASES.find(c=>c.id===id);
  if (c) {
    const now = new Date().toLocaleDateString('ja-JP',{month:'numeric',day:'numeric'});
    c.memo.unshift(now+' '+text);
    c.days = 0; c.stale = false;
  }
  input.value = '';
  renderBoard();
  openCase(id);
}

function closePanel() { document.getElementById('detail-panel').classList.remove('show'); }

function reportClose(id) {
  window.location.href = 'coreto-batch-close.html';
}

function openAddCase(stage) {
  const id = (stage && stage!=='add') ? stage : 'new';
  alert(`æ–°è¦æ¡ˆä»¶è¿½åŠ ï¼ˆã‚¹ãƒ†ãƒ¼ã‚¸ï¼š${STAGES.find(s=>s.id===id)?.label||'æ–°è¦å•åˆã›'}ï¼‰\nâ€»æœ¬ç•ªã§ã¯ãƒ¢ãƒ¼ãƒ€ãƒ«ã§è©³ç´°å…¥åŠ›`);
}

renderBoard();
</script>
</body>
</html>
