<!DOCTYPE html>
<html lang="ja">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width,initial-scale=1">
<title>é‡è¦äº‹é …èª¬æ˜ â€” æ—¥ç¨‹ã®ã”é¸æŠ</title>
<link href="https://fonts.googleapis.com/css2?family=Noto+Sans+JP:wght@300;400;500;700&family=DM+Mono:wght@400;500&family=Syne:wght@700;800&display=swap" rel="stylesheet">
<style>
*{box-sizing:border-box;margin:0;padding:0}
:root{
  --bg:#07090f;--card:#0f1119;--card2:#141720;--border:#1e2235;--border2:#252a3d;
  --gold:#c9a84c;--blue:#4f9cf9;--green:#34d399;--red:#f87171;
  --muted:#4a5270;--sub:#7a849e;--text:#e2e6f3;--teal:#2dd4bf;
}
body{background:var(--bg);color:var(--text);font-family:'Noto Sans JP',sans-serif;font-size:13px;min-height:100vh;display:flex;flex-direction:column;align-items:center;padding:40px 16px 80px}
.brand{text-align:center;margin-bottom:36px}
.brand-logo{font-family:'Syne',sans-serif;font-weight:800;font-size:26px;color:var(--gold);letter-spacing:.12em}
.brand-sub{font-size:11px;color:var(--sub);margin-top:6px;letter-spacing:.08em}
.main-card{width:100%;max-width:640px}
.card-header{background:var(--card);border:1px solid var(--border2);border-radius:16px 16px 0 0;padding:24px 28px}
.card-title{font-family:'Syne',sans-serif;font-weight:800;font-size:18px;line-height:1.3}
.case-meta{margin-top:12px;background:var(--card2);border:1px solid var(--border);border-radius:10px;padding:12px 14px;font-size:11px;line-height:1.9;color:var(--sub)}
.slots-section{background:var(--card);border-left:1px solid var(--border2);border-right:1px solid var(--border2);padding:20px 28px}
.slots-label{font-size:10px;color:var(--muted);letter-spacing:.1em;text-transform:uppercase;margin-bottom:14px}
.slot-item{display:flex;align-items:center;gap:14px;padding:14px 16px;border:1px solid var(--border2);border-radius:10px;cursor:pointer;margin-bottom:10px;transition:all .15s;background:var(--card2)}
.slot-item:hover{border-color:rgba(201,168,76,.5)}
.slot-item.selected{border-color:var(--gold);background:rgba(201,168,76,.08)}
.slot-radio{width:18px;height:18px;border-radius:50%;border:2px solid var(--border2);flex-shrink:0;position:relative;transition:all .15s}
.slot-item.selected .slot-radio{border-color:var(--gold);background:var(--gold)}
.slot-item.selected .slot-radio::after{content:'';position:absolute;top:50%;left:50%;transform:translate(-50%,-50%);width:7px;height:7px;border-radius:50%;background:#07090f}
.slot-md{font-family:'Syne',sans-serif;font-size:18px;font-weight:800;line-height:1;color:var(--text)}
.slot-wd{font-size:10px;color:var(--muted);margin-top:2px}
.slot-time{font-family:'DM Mono',monospace;font-size:18px;color:var(--gold);font-weight:500}
.slot-dur{font-size:10px;color:var(--sub);margin-top:2px}
.slot-agent{margin-left:auto;font-size:11px;color:var(--sub);text-align:right}
.no-slots{text-align:center;padding:40px;color:var(--muted);font-size:12px}
.name-section{background:var(--card);border-left:1px solid var(--border2);border-right:1px solid var(--border2);padding:16px 28px}
.fi label{display:block;font-size:10px;color:var(--sub);letter-spacing:.08em;margin-bottom:6px}
.fi input{width:100%;background:var(--card2);border:1px solid var(--border2);border-radius:8px;padding:10px 12px;color:var(--text);font-family:'Noto Sans JP',sans-serif;font-size:13px}
.fi input:focus{outline:none;border-color:var(--blue)}
.card-footer{background:var(--card);border:1px solid var(--border2);border-radius:0 0 16px 16px;padding:20px 28px}
.btn-confirm{width:100%;padding:14px;border-radius:10px;border:1px solid rgba(201,168,76,.5);background:rgba(201,168,76,.15);color:var(--gold);font-family:'Syne',sans-serif;font-weight:800;font-size:15px;cursor:pointer;letter-spacing:.05em;transition:all .18s}
.btn-confirm:hover:not(:disabled){background:rgba(201,168,76,.25)}
.btn-confirm:disabled{opacity:.35;cursor:not-allowed}
.confirm-card{width:100%;max-width:640px;background:var(--card);border:1px solid rgba(52,211,153,.3);border-radius:16px;padding:36px 32px;text-align:center;display:none}
.confirm-icon{font-size:52px;margin-bottom:16px}
.confirm-title{font-family:'Syne',sans-serif;font-weight:800;font-size:22px;color:var(--green)}
.confirm-detail{margin:20px 0;background:var(--card2);border:1px solid var(--border2);border-radius:10px;padding:16px 20px;text-align:left;font-size:12px;line-height:2;color:var(--sub)}
.meet-box{margin-top:16px;background:rgba(45,212,191,.06);border:1px solid rgba(45,212,191,.25);border-radius:10px;padding:14px 18px;text-align:left}
.meet-label{font-size:10px;color:rgba(45,212,191,.8);letter-spacing:.08em;margin-bottom:6px}
.meet-url{font-family:'DM Mono',monospace;font-size:13px;color:var(--teal);word-break:break-all}
</style>
</head>
<body>
<div class="brand">
  <div class="brand-logo">CORETO</div>
  <div class="brand-sub">ITé‡è¦äº‹é …èª¬æ˜ â€” æ—¥ç¨‹ã®ã”é¸æŠ</div>
</div>

<div class="main-card" id="booking-form">
  <div class="card-header">
    <div class="card-title">é‡è¦äº‹é …èª¬æ˜ã®<br>æ—¥ç¨‹ã‚’ã”é¸æŠãã ã•ã„</div>
    <div class="case-meta" id="case-meta">èª­ã¿è¾¼ã¿ä¸­...</div>
  </div>
  <div class="slots-section">
    <div class="slots-label">ã”å¸Œæœ›ã®æ—¥æ™‚ã‚’é¸æŠã—ã¦ãã ã•ã„</div>
    <div id="slots-list"><div class="no-slots">â³ ç©ºãçŠ¶æ³ã‚’ç¢ºèªä¸­...</div></div>
  </div>
  <div class="name-section">
    <div class="fi">
      <label>ãŠåå‰ï¼ˆç¢ºèªç”¨ï¼‰</label>
      <input type="text" id="client-name-input" placeholder="ä¾‹: ç”°ä¸­ é›„ä»‹">
    </div>
  </div>
  <div class="card-footer">
    <button class="btn-confirm" id="confirm-btn" disabled onclick="confirmBooking()">ã“ã®æ—¥ç¨‹ã§äºˆç´„ã™ã‚‹</button>
    <div style="font-size:10px;color:var(--muted);text-align:center;margin-top:10px">
      é¸æŠå¾Œã€æ‹…å½“ã‚¨ãƒ¼ã‚¸ã‚§ãƒ³ãƒˆãŠã‚ˆã³é‡èª¬æ‹…å½“è€…ã«Google Meetãƒªãƒ³ã‚¯ãŒé€ä»˜ã•ã‚Œã¾ã™
    </div>
  </div>
</div>

<div class="confirm-card" id="confirm-screen">
  <div class="confirm-icon">âœ…</div>
  <div class="confirm-title">äºˆç´„ãŒç¢ºå®šã—ã¾ã—ãŸ</div>
  <div class="confirm-detail" id="confirm-detail"></div>
  <div class="meet-box">
    <div class="meet-label">ğŸ¥ GOOGLE MEET ãƒªãƒ³ã‚¯</div>
    <div class="meet-url" id="meet-url-display">â€”</div>
  </div>
  <div style="font-size:11px;color:var(--muted);margin-top:20px;line-height:1.9">
    æ‹…å½“ã‚¨ãƒ¼ã‚¸ã‚§ãƒ³ãƒˆãŠã‚ˆã³é‡èª¬æ‹…å½“è€…ã«è‡ªå‹•ã§é€šçŸ¥ã•ã‚Œã¾ã™ã€‚<br>
    å½“æ—¥ã¯ã“ã®ãƒªãƒ³ã‚¯ã‹ã‚‰ã”å‚åŠ ãã ã•ã„ã€‚
  </div>
</div>

<script>
const LS_KEY = 'coreto_it_slots';
const params   = new URLSearchParams(location.search);
const caseId   = params.get('caseId') || '';
const clientN  = params.get('client') || '';
const propName = params.get('prop')   || '';
const agentN   = params.get('agent')  || '';

const WD = ['æ—¥','æœˆ','ç«','æ°´','æœ¨','é‡‘','åœŸ'];
function fmtDate(ds) {
  const d = new Date(ds + 'T00:00:00');
  return (d.getMonth()+1) + '/' + d.getDate() + 'ï¼ˆ' + WD[d.getDay()] + 'ï¼‰';
}
function genMeet() {
  const c='abcdefghijklmnopqrstuvwxyz';
  const s=n=>Array.from({length:n},()=>c[Math.floor(Math.random()*c.length)]).join('');
  return 'https://meet.google.com/'+s(3)+'-'+s(4)+'-'+s(3);
}
function loadSlots() { try{return JSON.parse(localStorage.getItem(LS_KEY)||'[]')}catch(e){return[]} }
function saveSlots(s){ localStorage.setItem(LS_KEY,JSON.stringify(s)); }

// æ¡ˆä»¶æƒ…å ±
const meta = document.getElementById('case-meta');
meta.innerHTML = [
  caseId   ? '<div><span style="color:var(--muted)">æ¡ˆä»¶IDï¼š</span><strong>'+caseId+'</strong></div>' : '',
  clientN  ? '<div><span style="color:var(--muted)">ãŠå®¢æ§˜ï¼š</span><strong>'+clientN+'</strong></div>' : '',
  propName ? '<div><span style="color:var(--muted)">ç‰©ä»¶ï¼š</span>'+propName+'</div>' : '',
  agentN   ? '<div><span style="color:var(--muted)">æ‹…å½“ï¼š</span>'+agentN+'</div>' : '',
].filter(Boolean).join('') || '<div style="color:var(--muted)">æ‹…å½“ã‚¨ãƒ¼ã‚¸ã‚§ãƒ³ãƒˆã‹ã‚‰ã”æ¡ˆå†…ãŒã‚ã‚Šã¾ã™</div>';

let selId = null;

function renderSlots() {
  const now = new Date();
  const slots = loadSlots()
    .filter(s => !s.booked && new Date(s.date+'T'+s.time) > now)
    .sort((a,b)=>(a.date+a.time).localeCompare(b.date+b.time));
  const list = document.getElementById('slots-list');
  if (!slots.length) {
    list.innerHTML = '<div class="no-slots">ğŸ˜” ç¾åœ¨ã€ç©ºãæ—¥ç¨‹ãŒã”ã–ã„ã¾ã›ã‚“ã€‚<br>æ‹…å½“ã‚¨ãƒ¼ã‚¸ã‚§ãƒ³ãƒˆã«ã”é€£çµ¡ãã ã•ã„ã€‚</div>';
    return;
  }
  list.innerHTML = slots.map(s => `
    <div class="slot-item" data-id="${s.id}" onclick="selSlot('${s.id}',this)">
      <div class="slot-radio"></div>
      <div><div class="slot-md">${fmtDate(s.date)}</div></div>
      <div>
        <div class="slot-time">${s.time}</div>
        <div class="slot-dur">${s.dur}åˆ†</div>
      </div>
      <div class="slot-agent">${s.agentName||'é‡èª¬æ‹…å½“'}</div>
    </div>`).join('');
}

function selSlot(id, el) {
  selId = id;
  document.querySelectorAll('.slot-item').forEach(e=>e.classList.remove('selected'));
  el.classList.add('selected');
  checkBtn();
}
document.getElementById('client-name-input').addEventListener('input', checkBtn);
function checkBtn() {
  const n = document.getElementById('client-name-input').value.trim();
  document.getElementById('confirm-btn').disabled = !selId || !n;
}

function confirmBooking() {
  const name = document.getElementById('client-name-input').value.trim();
  if (!selId || !name) return;
  const slots = loadSlots();
  const slot = slots.find(s => s.id === selId);
  if (!slot || slot.booked) {
    alert('ã“ã®æ—¥ç¨‹ã¯æ—¢ã«äºˆç´„ã•ã‚Œã¾ã—ãŸã€‚åˆ¥ã®æ—¥ç¨‹ã‚’ã”é¸æŠãã ã•ã„ã€‚');
    selId = null; renderSlots(); return;
  }
  const meetUrl = genMeet();
  slot.booked=true; slot.caseId=caseId; slot.clientName=name;
  slot.meetUrl=meetUrl; slot.bookedAt=new Date().toISOString();
  saveSlots(slots);

  document.getElementById('booking-form').style.display='none';
  const cs = document.getElementById('confirm-screen');
  cs.style.display='block';
  document.getElementById('confirm-detail').innerHTML = [
    '<div><span style="color:var(--muted)">ãŠåå‰ï¼š</span><strong>'+name+'</strong></div>',
    caseId   ? '<div><span style="color:var(--muted)">æ¡ˆä»¶IDï¼š</span>'+caseId+'</div>' : '',
    propName ? '<div><span style="color:var(--muted)">ç‰©ä»¶ï¼š</span>'+propName+'</div>' : '',
    '<div><span style="color:var(--muted)">æ—¥æ™‚ï¼š</span><strong>'+fmtDate(slot.date)+'ã€€'+slot.time+'ï¼ˆ'+slot.dur+'åˆ†ï¼‰</strong></div>',
    '<div><span style="color:var(--muted)">é‡èª¬æ‹…å½“ï¼š</span>'+slot.agentName+'</div>',
  ].filter(Boolean).join('');
  document.getElementById('meet-url-display').textContent = meetUrl;
}

renderSlots();
</script>
</body>
</html>
