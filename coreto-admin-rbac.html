<!DOCTYPE html>
<html lang="ja">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>CORETO ç®¡ç†è€…ãƒãƒ¼ã‚¿ãƒ« â€• æ¨©é™è¨­è¨ˆ</title>
<style>
@import url('https://fonts.googleapis.com/css2?family=Noto+Sans+JP:wght@300;400;500;700&family=DM+Mono:wght@400;500&display=swap');

*{box-sizing:border-box;margin:0;padding:0;}
:root{
  --bg:#0d0f14;--card:#161921;--hover:#1e2230;--border:#252a38;
  --gold:#c9a84c;--gold-l:#e8c96a;--muted:#6b7280;--sub:#9ca3af;
  --green:#22c55e;--blue:#3b82f6;--orange:#f59e0b;--red:#ef4444;--purple:#a855f7;
  /* å½¹è·ã‚«ãƒ©ãƒ¼ */
  --clerk:#64748b;     /* äº‹å‹™å“¡ */
  --staff:#3b82f6;     /* ç¤¾å“¡ */
  --manager:#f59e0b;   /* ç®¡ç†è· */
  --exec:#c9a84c;      /* çµŒå–¶é™£ */
}
body{font-family:'Noto Sans JP',sans-serif;background:var(--bg);color:#e8eaf0;min-height:100vh;}

/* ===== LOGIN ===== */
#login-screen{
  min-height:100vh;display:flex;align-items:center;justify-content:center;
  background:radial-gradient(ellipse at 30% 40%,rgba(201,168,76,0.06) 0%,transparent 60%),var(--bg);
}
.login-box{
  width:360px;background:var(--card);border:1px solid var(--border);
  border-radius:14px;padding:36px;
}
.login-logo{font-family:'DM Mono',monospace;font-size:26px;color:var(--gold);letter-spacing:4px;text-align:center;margin-bottom:4px;}
.login-sub{font-size:11px;color:var(--muted);text-align:center;margin-bottom:28px;}
.login-label{font-size:11px;color:var(--muted);margin-bottom:6px;display:block;}
.login-input{
  width:100%;background:var(--bg);border:1px solid var(--border);
  border-radius:6px;padding:10px 12px;color:#e8eaf0;font-size:13px;
  font-family:'Noto Sans JP',sans-serif;margin-bottom:14px;transition:border-color .15s;
}
.login-input:focus{outline:none;border-color:var(--gold);}
.login-select{
  width:100%;background:var(--bg);border:1px solid var(--border);
  border-radius:6px;padding:10px 12px;color:#e8eaf0;font-size:13px;
  font-family:'Noto Sans JP',sans-serif;margin-bottom:20px;
}
.login-select option{background:var(--card);}
.login-btn{
  width:100%;padding:12px;background:var(--gold);color:#0a0c10;
  border:none;border-radius:8px;font-size:14px;font-weight:700;
  cursor:pointer;font-family:'Noto Sans JP',sans-serif;transition:background .15s;
}
.login-btn:hover{background:var(--gold-l);}
.login-demo-hint{font-size:11px;color:var(--muted);text-align:center;margin-top:16px;line-height:1.7;}

/* ===== MAIN APP ===== */
#main-app{display:none;}

/* ===== SIDEBAR ===== */
.layout{display:flex;height:100vh;overflow:hidden;}
.sidebar{
  width:220px;min-width:220px;background:#0a0c10;
  border-right:1px solid var(--border);display:flex;flex-direction:column;
}
.sidebar-logo{padding:20px;border-bottom:1px solid var(--border);}
.sidebar-logo-mark{font-family:'DM Mono',monospace;font-size:20px;color:var(--gold);letter-spacing:3px;}
.sidebar-logo-sub{font-size:10px;color:var(--muted);margin-top:2px;}

.sidebar-user{
  padding:14px 16px;border-bottom:1px solid var(--border);
  display:flex;align-items:center;gap:10px;
}
.role-avatar{
  width:32px;height:32px;border-radius:50%;
  display:flex;align-items:center;justify-content:center;
  font-size:11px;font-weight:700;flex-shrink:0;
}
.role-name-text{font-size:12px;font-weight:500;}
.role-badge-small{font-size:10px;padding:1px 6px;border-radius:3px;font-weight:600;margin-top:2px;display:inline-block;}

.nav{padding:8px 0;flex:1;overflow-y:auto;}
.nav-item{
  display:flex;align-items:center;gap:10px;
  padding:10px 16px;font-size:12px;color:var(--sub);
  cursor:pointer;transition:all .15s;border-left:2px solid transparent;
  position:relative;
}
.nav-item:hover{color:#e8eaf0;background:var(--hover);}
.nav-item.active{color:var(--gold);background:rgba(201,168,76,0.08);border-left-color:var(--gold);}
.nav-item.locked{color:var(--muted);cursor:not-allowed;}
.nav-item.locked:hover{background:transparent;color:var(--muted);}
.lock-icon{margin-left:auto;font-size:11px;color:var(--muted);}

.nav-section{padding:14px 16px 4px;font-size:10px;color:var(--muted);letter-spacing:1px;text-transform:uppercase;}

.sidebar-bottom{padding:12px 16px;border-top:1px solid var(--border);}
.logout-btn{
  width:100%;padding:8px;background:transparent;border:1px solid var(--border);
  border-radius:5px;color:var(--muted);font-size:12px;cursor:pointer;
  font-family:'Noto Sans JP',sans-serif;transition:all .15s;
}
.logout-btn:hover{border-color:var(--red);color:var(--red);}

/* ===== MAIN CONTENT ===== */
.main{flex:1;overflow-y:auto;display:flex;flex-direction:column;}
.topbar{
  padding:18px 28px;border-bottom:1px solid var(--border);
  display:flex;align-items:center;justify-content:space-between;
  background:var(--bg);position:sticky;top:0;z-index:10;
}
.page-title{font-size:17px;font-weight:700;}
.page-sub{font-size:11px;color:var(--muted);margin-top:2px;}
.content{padding:24px 28px;flex:1;}

/* ===== PERMISSION DENIED ===== */
.permission-denied{
  display:flex;flex-direction:column;align-items:center;justify-content:center;
  min-height:300px;gap:12px;
}
.denied-icon{font-size:48px;}
.denied-title{font-size:18px;font-weight:700;color:var(--muted);}
.denied-sub{font-size:13px;color:var(--muted);text-align:center;line-height:1.7;}

/* ===== CARDS / COMMON ===== */
.card{background:var(--card);border:1px solid var(--border);border-radius:10px;padding:20px;margin-bottom:16px;}
.card-title{font-size:14px;font-weight:700;margin-bottom:14px;}
.grid2{display:grid;grid-template-columns:1fr 1fr;gap:16px;}
.grid4{display:grid;grid-template-columns:repeat(4,1fr);gap:14px;}
.stat-card{background:var(--card);border:1px solid var(--border);border-radius:10px;padding:18px;}
.stat-label{font-size:11px;color:var(--muted);margin-bottom:6px;}
.stat-val{font-family:'DM Mono',monospace;font-size:26px;font-weight:700;}

.s-label{font-size:11px;color:var(--muted);letter-spacing:1.2px;text-transform:uppercase;margin-bottom:12px;margin-top:24px;}

/* ===== TABLE ===== */
table{width:100%;border-collapse:collapse;}
th{text-align:left;font-size:11px;color:var(--muted);padding:8px 12px;border-bottom:1px solid var(--border);letter-spacing:0.5px;}
td{padding:11px 12px;font-size:12px;border-bottom:1px solid rgba(37,42,56,0.5);vertical-align:middle;}
tr:last-child td{border-bottom:none;}

/* ===== PERMISSION MATRIX ===== */
.matrix-table{width:100%;border-collapse:collapse;}
.matrix-table th{text-align:center;font-size:11px;padding:10px 8px;border-bottom:1px solid var(--border);}
.matrix-table th.feature-col{text-align:left;min-width:200px;}
.matrix-table td{padding:10px 8px;text-align:center;border-bottom:1px solid rgba(37,42,56,0.4);font-size:12px;}
.matrix-table td.feature-name{text-align:left;color:var(--sub);}
.matrix-table td.feature-name strong{color:#e8eaf0;display:block;margin-bottom:1px;}
.matrix-table .section-row td{background:rgba(37,42,56,0.4);font-size:11px;color:var(--muted);font-weight:600;letter-spacing:0.5px;padding:6px 12px;}

.perm-ok{color:var(--green);font-size:16px;}
.perm-partial{color:var(--orange);font-size:16px;}
.perm-no{color:var(--muted);font-size:16px;}

/* å½¹è·ãƒ˜ãƒƒãƒ€ãƒ¼ */
.role-th{padding:8px 16px !important;border-radius:6px;display:flex;flex-direction:column;align-items:center;gap:3px;}
.role-th-clerk{background:rgba(100,116,139,0.15);color:var(--clerk);}
.role-th-staff{background:rgba(59,130,246,0.15);color:var(--staff);}
.role-th-manager{background:rgba(245,158,11,0.15);color:var(--manager);}
.role-th-exec{background:rgba(201,168,76,0.15);color:var(--exec);}

/* ===== MASKED DATA ===== */
.masked{
  background:var(--hover);border-radius:3px;
  color:transparent;user-select:none;
  position:relative;filter:blur(4px);
}

/* ===== BUTTONS ===== */
.btn{padding:7px 16px;border-radius:6px;font-size:12px;font-weight:500;cursor:pointer;border:none;font-family:'Noto Sans JP',sans-serif;transition:all .15s;}
.btn-gold{background:var(--gold);color:#0a0c10;}
.btn-gold:hover{background:var(--gold-l);}
.btn-outline{background:transparent;color:var(--sub);border:1px solid var(--border);}
.btn-outline:hover{border-color:var(--gold);color:var(--gold);}
.btn-red{background:transparent;color:var(--red);border:1px solid rgba(239,68,68,0.3);}
.btn-red:hover{background:rgba(239,68,68,0.1);}
.btn-disabled{background:var(--hover);color:var(--muted);cursor:not-allowed;border:1px solid var(--border);}

/* tag */
.tag{display:inline-block;padding:2px 8px;border-radius:4px;font-size:11px;font-weight:500;}
.tag-green{background:rgba(34,197,94,0.15);color:var(--green);}
.tag-blue{background:rgba(59,130,246,0.15);color:var(--blue);}
.tag-orange{background:rgba(245,158,11,0.15);color:var(--orange);}
.tag-gold{background:rgba(201,168,76,0.15);color:var(--gold);}
.tag-red{background:rgba(239,68,68,0.15);color:var(--red);}
.tag-gray{background:rgba(100,116,139,0.15);color:var(--clerk);}

/* æ“ä½œãƒ­ã‚° */
.log-row{display:flex;gap:12px;align-items:flex-start;padding:9px 0;border-bottom:1px solid rgba(37,42,56,0.4);font-size:12px;}
.log-row:last-child{border-bottom:none;}
.log-time{font-family:'DM Mono',monospace;font-size:10px;color:var(--muted);min-width:100px;flex-shrink:0;}
.log-user{min-width:100px;flex-shrink:0;}
.log-action{flex:1;color:var(--sub);}
.log-result-ok{color:var(--green);}
.log-result-deny{color:var(--red);}

/* â”€â”€ ç´¹ä»‹ãƒªãƒ³ã‚¯ãƒ¢ãƒ¼ãƒ€ãƒ« â”€â”€ */
#ref-modal-overlay{display:none;position:fixed;inset:0;background:rgba(0,0,0,.65);z-index:9000;align-items:center;justify-content:center}
#ref-modal-overlay.open{display:flex}
#ref-modal{background:var(--card);border:1px solid var(--border2);border-radius:16px;padding:0;width:min(460px,92vw);overflow:hidden}
.ref-mhdr{padding:16px 20px;border-bottom:1px solid var(--border);display:flex;align-items:center;justify-content:space-between}
.ref-mhdr-t{font-family:'Syne',sans-serif;font-size:14px;font-weight:800;color:var(--gold)}
.ref-mbody{padding:20px}
.ref-url{background:var(--card2);border:1px solid var(--border2);border-radius:8px;padding:10px 12px;font-family:'DM Mono',monospace;font-size:11px;color:var(--sub);word-break:break-all;margin:10px 0;min-height:36px}
.ref-copy-btn{width:100%;padding:10px;border-radius:8px;border:none;cursor:pointer;font-family:inherit;font-size:13px;font-weight:700;background:var(--gold);color:#0a0c10;margin-top:4px}
.ref-copy-btn:hover{opacity:.9}

/* â”€â”€ ç´¹ä»‹ãƒªãƒ³ã‚¯ å·¦ãƒ•ãƒ­ãƒ¼ãƒ†ã‚£ãƒ³ã‚°ãƒœã‚¿ãƒ³ â”€â”€ */
#ref-float-btn {
  position: fixed;
  left: 0;
  top: 50%;
  transform: translateY(-50%) translateX(-100%) rotate(-90deg);
  transform-origin: right bottom;
  z-index: 8000;
  background: rgba(201,168,76,.18);
  border: 1px solid rgba(201,168,76,.4);
  border-bottom: none;
  border-radius: 8px 8px 0 0;
  color: var(--gold);
  padding: 6px 16px;
  font-size: 11px;
  font-weight: 700;
  font-family: inherit;
  cursor: pointer;
  white-space: nowrap;
  letter-spacing: .5px;
  transition: background .15s;
}
#ref-float-btn:hover { background: rgba(201,168,76,.32); }
</style>
</head>
<body>

<!-- ================================================================ -->
<!-- LOGIN SCREEN -->
<!-- ================================================================ -->
<div id="login-screen">
  <div class="login-box">
    <div class="login-logo">CORETO</div>
    <div class="login-sub">æœ¬éƒ¨ç®¡ç†è€…ãƒãƒ¼ã‚¿ãƒ«</div>

    <label class="login-label">ãƒ¡ãƒ¼ãƒ«ã‚¢ãƒ‰ãƒ¬ã‚¹</label>
    <input type="email" class="login-input" placeholder="admin@coreto.jp" id="login-email">

    <label class="login-label">ãƒ‘ã‚¹ãƒ¯ãƒ¼ãƒ‰</label>
    <input type="password" class="login-input" placeholder="â€¢â€¢â€¢â€¢â€¢â€¢â€¢â€¢" id="login-pass">

    <label class="login-label">ãƒ‡ãƒ¢ï¼šå½¹è·ã‚’é¸æŠã—ã¦ãƒ­ã‚°ã‚¤ãƒ³</label>
    <select class="login-select" id="login-role">
      <option value="clerk">ğŸ—‚ äº‹å‹™å“¡</option>
      <option value="staff">ğŸ‘¤ ç¤¾å“¡</option>
      <option value="manager">â­ ç®¡ç†è·</option>
      <option value="exec">ğŸ‘‘ çµŒå–¶é™£</option>
    </select>

    <button class="login-btn" onclick="doLogin()">ãƒ­ã‚°ã‚¤ãƒ³</button>

    <div class="login-demo-hint">
      å½¹è·ã‚’åˆ‡ã‚Šæ›¿ãˆã‚‹ã¨ç”»é¢ã®ãƒ¡ãƒ‹ãƒ¥ãƒ¼ã¨<br>æ“ä½œã§ãã‚‹æ©Ÿèƒ½ãŒå¤‰ã‚ã‚Šã¾ã™
    </div>
  </div>
</div>

<!-- ================================================================ -->
<!-- MAIN APP -->
<!-- ================================================================ -->
<div id="main-app">
  <div class="layout">

    <!-- SIDEBAR -->
    <div class="sidebar">
      <div class="sidebar-logo">
        <div class="sidebar-logo-mark">CORETO</div>
        <div class="sidebar-logo-sub">ç®¡ç†è€…ãƒãƒ¼ã‚¿ãƒ«</div>
      </div>

      <div class="sidebar-user">
        <div class="role-avatar" id="user-avatar"></div>
        <div>
          <div class="role-name-text" id="user-name-display">â€”</div>
          <span class="role-badge-small" id="user-role-badge"></span>
        </div>
      </div>

      <div class="nav" id="sidebar-nav"></div>

      <div class="sidebar-bottom">
        <button class="logout-btn" onclick="doLogout()">ğŸšª ãƒ­ã‚°ã‚¢ã‚¦ãƒˆ</button>
      </div>
    </div>

    <!-- MAIN -->
    <div class="main">
      <div class="topbar">
        <div>
          <div class="page-title" id="page-title-text">ãƒ€ãƒƒã‚·ãƒ¥ãƒœãƒ¼ãƒ‰</div>
          <div class="page-sub" id="page-sub-text">CORETO ç®¡ç†è€…ãƒãƒ¼ã‚¿ãƒ«
  </div>
        </div>
        <div style="display:flex;gap:10px;align-items:center">
          <div style="font-size:11px;color:var(--muted)" id="topbar-role-label"></div>
        </div>
      </div>
      <div class="content" id="main-content"></div>
    </div>
  </div>
</div>

<script>
// â•â• AUTH GUARD (çµŒå–¶é™£å°‚ç”¨) â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
(function() {
  var s = null;
  try { s = JSON.parse(sessionStorage.getItem('coreto_session') || 'null'); } catch(e) {}
  var HQ_LEVEL = { exec: 3, manager: 2, staff: 1 };
  if (!s || s.type !== 'hq' || (HQ_LEVEL[s.hqRole] || 0) < 3) { location.replace('coreto-hub.html'); }
  window._SESSION = s;
})();

// ================================================================
// æ¨©é™å®šç¾©
// ================================================================
const ROLES = {
  clerk: {
    name: 'äº‹å‹™å“¡',
    color: '#64748b',
    badge: { text:'äº‹å‹™å“¡', cls:'tag-gray' },
    avatarBg: 'rgba(100,116,139,0.2)',
    desc: 'ãƒ¬ã‚¿ãƒ¼ãƒ‘ãƒƒã‚¯ç™ºé€ãƒ»ã‚¹ã‚­ãƒ£ãƒ³ãƒ»æ¡ˆä»¶é–²è¦§ã®ã¿',
  },
  staff: {
    name: 'ç¤¾å“¡',
    color: '#3b82f6',
    badge: { text:'ç¤¾å“¡', cls:'tag-blue' },
    avatarBg: 'rgba(59,130,246,0.2)',
    desc: 'æ¡ˆä»¶ç®¡ç†ãƒ»å…¥ä¼šå¯©æŸ»ãƒ»åŸºæœ¬æ“ä½œå…¨èˆ¬',
  },
  manager: {
    name: 'ç®¡ç†è·',
    color: '#f59e0b',
    badge: { text:'ç®¡ç†è·', cls:'tag-orange' },
    avatarBg: 'rgba(245,158,11,0.2)',
    desc: 'ãƒ¡ãƒ³ãƒãƒ¼ç®¡ç†ãƒ»å ±é…¬æ‰¿èªãƒ»å£²ä¸Šé–²è¦§',
  },
  exec: {
    name: 'çµŒå–¶é™£',
    color: '#c9a84c',
    badge: { text:'çµŒå–¶é™£', cls:'tag-gold' },
    avatarBg: 'rgba(201,168,76,0.2)',
    desc: 'å…¨æ©Ÿèƒ½ãƒ»æŒ¯è¾¼å®Ÿè¡Œãƒ»ã‚·ã‚¹ãƒ†ãƒ è¨­å®šãƒ»æ“ä½œãƒ­ã‚°',
  },
};

// ãƒšãƒ¼ã‚¸å®šç¾©ï¼šå„å½¹è·ãŒæŒã¦ã‚‹æ¨©é™
// view: é–²è¦§å¯ã€edit: ç·¨é›†å¯ã€delete: å‰Šé™¤å¯ã€approve: æ‰¿èªå¯ã€execute: å®Ÿè¡Œå¯
const PAGES = [
  {
    id: 'dashboard', icon: 'ğŸ“Š', label: 'ãƒ€ãƒƒã‚·ãƒ¥ãƒœãƒ¼ãƒ‰', section: null,
    perms: { clerk: ['view'], staff: ['view'], manager: ['view'], exec: ['view'] },
  },
  {
    id: 'cases', icon: 'ğŸ“‹', label: 'æ¡ˆä»¶ç®¡ç†', section: 'æ¥­å‹™',
    perms: { clerk: ['view'], staff: ['view','edit'], manager: ['view','edit','delete'], exec: ['view','edit','delete'] },
  },
  {
    id: 'review', icon: 'ğŸ”', label: 'å…¥ä¼šå¯©æŸ»', section: null,
    perms: { clerk: [], staff: ['view','edit','approve'], manager: ['view','edit','approve'], exec: ['view','edit','approve'] },
  },
  {
    id: 'members', icon: 'ğŸ‘¥', label: 'ãƒ¡ãƒ³ãƒãƒ¼ç®¡ç†', section: null,
    perms: { clerk: [], staff: ['view'], manager: ['view','edit'], exec: ['view','edit','delete'] },
  },
  {
    id: 'reward', icon: 'ğŸ’°', label: 'å ±é…¬ç®¡ç†', section: 'è²¡å‹™',
    perms: { clerk: [], staff: [], manager: ['view'], exec: ['view','edit','approve'] },
  },
  {
    id: 'transfer', icon: 'ğŸ¦', label: 'æŒ¯è¾¼å®Ÿè¡Œ', section: null,
    perms: { clerk: [], staff: [], manager: [], exec: ['view','execute'] },
  },
  {
    id: 'sales', icon: 'ğŸ“ˆ', label: 'å£²ä¸Šãƒ»åç›Š', section: null,
    perms: { clerk: ['view'], staff: ['view'], manager: ['view'], exec: ['view'] },
  },
  {
    id: 'scan', icon: 'ğŸ“¡', label: 'ã‚¹ã‚­ãƒ£ãƒ³ãƒ‡ã‚¹ã‚¯', section: 'é‹ç”¨',
    perms: { clerk: ['view','edit'], staff: ['view','edit'], manager: ['view','edit'], exec: ['view','edit'] },
  },
  {
    id: 'letterpack', icon: 'ğŸ“®', label: 'ãƒ¬ã‚¿ãƒ¼ãƒ‘ãƒƒã‚¯è¿½è·¡', section: null,
    perms: { clerk: ['view'], staff: ['view'], manager: ['view'], exec: ['view'] },
  },
  {
    id: 'system', icon: 'âš™ï¸', label: 'ã‚·ã‚¹ãƒ†ãƒ è¨­å®š', section: 'ã‚·ã‚¹ãƒ†ãƒ ',
    perms: { clerk: [], staff: [], manager: [], exec: ['view','edit'] },
  },
  {
    id: 'connect', icon: 'ğŸ”—', label: 'Slack/LINEé€£æº', section: null,
    perms: { clerk: [], staff: [], manager: [], exec: ['view','edit'] },
  },
  {
    id: 'auditlog', icon: 'ğŸ”', label: 'æ“ä½œãƒ­ã‚°', section: null,
    perms: { clerk: [], staff: [], manager: ['view'], exec: ['view'] },
  },
  {
    id: 'matrix', icon: 'ğŸ›¡', label: 'æ¨©é™ãƒãƒˆãƒªã‚¯ã‚¹', section: null,
    perms: { clerk: [], staff: [], manager: ['view'], exec: ['view','edit'] },
  },
  // â”€â”€ æ–°è¦è¿½åŠ ãƒ„ãƒ¼ãƒ« â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
  {
    id: 'screening', icon: 'ğŸ“‹', label: 'æ›¸é¡å¯©æŸ»', section: 'æ¥­å‹™ãƒ„ãƒ¼ãƒ«',
    perms: { clerk: [], staff: ['view','edit'], manager: ['view','edit','approve'], exec: ['view','edit','approve'] },
    url: 'coreto-screening.html',
  },
  {
    id: 'payment-batch', icon: 'ğŸ’´', label: 'æ”¯æ‰•æ˜ç´°ãƒ»æŒ¯è¾¼ãƒãƒƒãƒ', section: null,
    perms: { clerk: [], staff: [], manager: ['view','edit'], exec: ['view','edit','execute'] },
    url: 'coreto-payment.html',
  },
  {
    id: 'codes', icon: 'ğŸ”–', label: 'ç‰¹åˆ¥ç´¹ä»‹ã‚³ãƒ¼ãƒ‰ç®¡ç†', section: null,
    perms: { clerk: [], staff: ['view'], manager: ['view','edit'], exec: ['view','edit','delete'] },
    url: 'coreto-codes.html',
  },
  {
    id: 'early-quit', icon: 'âš ï¸', label: 'æ—©æœŸé€€è·ã‚¢ãƒ©ãƒ¼ãƒˆ', section: null,
    perms: { clerk: [], staff: ['view'], manager: ['view','edit'], exec: ['view','edit'] },
    url: 'coreto-early-quit.html',
  },
  {
    id: 'partner-mgmt', icon: 'ğŸ¤', label: 'ãƒ‘ãƒ¼ãƒˆãƒŠãƒ¼ç®¡ç†', section: null,
    perms: { clerk: [], staff: ['view'], manager: ['view','edit'], exec: ['view','edit'] },
    url: 'coreto-partner.html',
  },
  {
    id: 'rank-mgmt', icon: 'â­', label: 'ãƒ©ãƒ³ã‚¯ç®¡ç†', section: null,
    perms: { clerk: [], staff: ['view'], manager: ['view','edit'], exec: ['view','edit'] },
    url: 'coreto-rank.html',
  },
];

let currentRole = 'staff';
let currentPage = 'dashboard';

// ================================================================
// LOGIN / LOGOUT
// ================================================================
function doLogin() {
  currentRole = document.getElementById('login-role').value;
  document.getElementById('login-screen').style.display = 'none';
  document.getElementById('main-app').style.display = 'block';
  initApp();
  showPage('dashboard');
}

function doLogout() {
  document.getElementById('login-screen').style.display = 'flex';
  document.getElementById('main-app').style.display = 'none';
}

// ================================================================
// APP INIT
// ================================================================
function initApp() {
  const role = ROLES[currentRole];

  // ãƒ¦ãƒ¼ã‚¶ãƒ¼æƒ…å ±
  const avatar = document.getElementById('user-avatar');
  avatar.style.background = role.avatarBg;
  avatar.style.color = role.color;
  avatar.textContent = role.name[0];
  document.getElementById('user-name-display').textContent = 'ç®¡ç†ãƒ¦ãƒ¼ã‚¶ãƒ¼';
  const badge = document.getElementById('user-role-badge');
  badge.textContent = role.name;
  badge.className = 'role-badge-small ' + role.badge.cls;
  document.getElementById('topbar-role-label').textContent = role.name + ' â€• ' + role.desc;

  // ã‚µã‚¤ãƒ‰ãƒãƒ¼
  buildSidebar();
}

function buildSidebar() {
  const nav = document.getElementById('sidebar-nav');
  nav.innerHTML = '';
  let lastSection = null;

  PAGES.forEach(page => {
    const perms = page.perms[currentRole];
    const canView = perms.includes('view');

    if (page.section && page.section !== lastSection) {
      const sec = document.createElement('div');
      sec.className = 'nav-section';
      sec.textContent = page.section;
      nav.appendChild(sec);
      lastSection = page.section;
    }

    const item = document.createElement('div');
    item.className = 'nav-item' + (!canView ? ' locked' : '') + (currentPage === page.id ? ' active' : '');
    item.innerHTML = `
      <span style="width:18px;text-align:center">${page.icon}</span>
      <span>${page.label}</span>
      ${!canView ? '<span class="lock-icon">ğŸ”’</span>' : ''}
    `;
    if (canView) item.onclick = () => showPage(page.id);
    nav.appendChild(item);
  });
}

// ================================================================
// PAGE ROUTING
// ================================================================
function showPage(pageId) {
  const page = PAGES.find(p => p.id === pageId);
  if (!page) return;
  const perms = page.perms[currentRole];
  const canView = perms.includes('view');

  currentPage = pageId;
  buildSidebar();

  document.getElementById('page-title-text').textContent = page.label;
  const content = document.getElementById('main-content');

  if (!canView) {
    content.innerHTML = `
      <div class="permission-denied">
        <div class="denied-icon">ğŸ”’</div>
        <div class="denied-title">ã‚¢ã‚¯ã‚»ã‚¹æ¨©é™ãŒã‚ã‚Šã¾ã›ã‚“</div>
        <div class="denied-sub">ã€Œ${page.label}ã€ã¯ <strong style="color:var(--gold)">${getMinRole(page)}</strong> ä»¥ä¸Šã®æ¨©é™ãŒå¿…è¦ã§ã™ã€‚<br>ç®¡ç†è€…ã«æ¨©é™ä»˜ä¸ã‚’ä¾é ¼ã—ã¦ãã ã•ã„ã€‚</div>
      </div>`;
    return;
  }

  // ãƒšãƒ¼ã‚¸åˆ¥ãƒ¬ãƒ³ãƒ€ãƒªãƒ³ã‚°
  const renderers = {
    dashboard: renderDashboard,
    cases: renderCases,
    review: renderReview,
    members: renderMembers,
    reward: renderReward,
    transfer: renderTransfer,
    sales: renderSales,
    scan: renderScan,
    letterpack: renderLetterpack,
    system: renderSystem,
    connect: renderConnect,
    auditlog: renderAuditlog,
    matrix: renderMatrix,
    // æ–°è¦ãƒ„ãƒ¼ãƒ«ï¼ˆå¤–éƒ¨ãƒ„ãƒ¼ãƒ«ãƒšãƒ¼ã‚¸ã¸èµ·å‹•ï¼‰
    'screening':    (el) => renderToolLauncher(el, page),
    'payment-batch':(el) => renderToolLauncher(el, page),
    'codes':        (el) => renderToolLauncher(el, page),
    'early-quit':   (el) => renderToolLauncher(el, page),
    'partner-mgmt': (el) => renderToolLauncher(el, page),
    'rank-mgmt':    (el) => renderToolLauncher(el, page),
  };
  if (renderers[pageId]) renderers[pageId](content, perms);
  else content.innerHTML = `<div style="color:var(--muted);padding:20px">ï¼ˆå®Ÿè£…äºˆå®šï¼‰</div>`;
}

function getMinRole(page) {
  const order = ['clerk','staff','manager','exec'];
  for (const r of order) {
    if (page.perms[r].includes('view')) return ROLES[r].name;
  }
  return 'çµŒå–¶é™£';
}

function canDo(action) {
  const page = PAGES.find(p => p.id === currentPage);
  return page && page.perms[currentRole].includes(action);
}

// ================================================================
// PAGE RENDERERS
// ================================================================

function renderDashboard(el, perms) {
  const showFinance = ['manager','exec'].includes(currentRole);
  const toolShortcuts = [
    { id:'review',       icon:'ğŸ”', label:'å…¥ä¼šå¯©æŸ»',          color:'var(--blue)',   roles:['staff','manager','exec'] },
    { id:'screening',    icon:'ğŸ“‹', label:'æ›¸é¡å¯©æŸ»',          color:'var(--blue)',   roles:['staff','manager','exec'] },
    { id:'cases',        icon:'ğŸ“', label:'æ¡ˆä»¶ç®¡ç†',          color:'var(--orange)', roles:['clerk','staff','manager','exec'] },
    { id:'payment-batch',icon:'ğŸ’´', label:'æ”¯æ‰•æ˜ç´°ãƒ»æŒ¯è¾¼',    color:'var(--gold)',   roles:['manager','exec'] },
    { id:'codes',        icon:'ğŸ”–', label:'ç´¹ä»‹ã‚³ãƒ¼ãƒ‰ç®¡ç†',    color:'var(--purple)', roles:['staff','manager','exec'] },
    { id:'early-quit',   icon:'âš ï¸', label:'æ—©æœŸé€€è·ã‚¢ãƒ©ãƒ¼ãƒˆ', color:'var(--red)',    roles:['staff','manager','exec'] },
    { id:'partner-mgmt', icon:'ğŸ¤', label:'ãƒ‘ãƒ¼ãƒˆãƒŠãƒ¼ç®¡ç†',   color:'var(--green)',  roles:['staff','manager','exec'] },
    { id:'rank-mgmt',    icon:'â­', label:'ãƒ©ãƒ³ã‚¯ç®¡ç†',        color:'var(--gold)',   roles:['staff','manager','exec'] },
    { id:'scan',         icon:'ğŸ“¡', label:'ã‚¹ã‚­ãƒ£ãƒ³ãƒ‡ã‚¹ã‚¯',    color:'var(--teal)',   roles:['clerk','staff','manager','exec'] },
    { id:'members',      icon:'ğŸ‘¥', label:'ãƒ¡ãƒ³ãƒãƒ¼ç®¡ç†',      color:'var(--sub)',    roles:['staff','manager','exec'] },
    { id:'letterpack',   icon:'ğŸ“®', label:'ãƒ¬ã‚¿ãƒ¼ãƒ‘ãƒƒã‚¯è¿½è·¡',  color:'var(--sub)',    roles:['clerk','staff','manager','exec'] },
    { id:'auditlog',     icon:'ğŸ”', label:'æ“ä½œãƒ­ã‚°',          color:'var(--muted)',  roles:['manager','exec'] },
  ];
  const visibleTools = toolShortcuts.filter(t => t.roles.includes(currentRole));
  el.innerHTML = `
    <div class="grid4" style="margin-bottom:20px">
      <div class="stat-card"><div class="stat-label">æ–°è¦æ¡ˆä»¶</div><div class="stat-val" style="color:var(--blue)">8</div></div>
      <div class="stat-card"><div class="stat-label">é€²è¡Œä¸­</div><div class="stat-val" style="color:var(--orange)">24</div></div>
      <div class="stat-card"><div class="stat-label">ä»Šæœˆæˆç´„</div><div class="stat-val" style="color:var(--green)">31</div></div>
      <div class="stat-card">
        <div class="stat-label">ä»Šæœˆå£²ä¸Š</div>
        <div class="stat-val" style="color:var(--gold)">${showFinance ? 'Â¥4,200,000' : '<span style="filter:blur(6px);user-select:none">Â¥X.XM</span>'}</div>
        ${!showFinance ? '<div style="font-size:10px;color:var(--muted);margin-top:4px">ğŸ”’ ç®¡ç†è·ä»¥ä¸Šã§é–²è¦§å¯</div>' : ''}
      </div>
    </div>
    <div style="display:grid;grid-template-columns:1fr 1fr;gap:16px;margin-bottom:20px">
      <div class="card">
        <div class="card-title">ğŸ“‹ è¦å¯¾å¿œã‚¿ã‚¹ã‚¯</div>
        ${[
          ['å…¥ä¼šå¯©æŸ»å¾…ã¡', '3ä»¶', 'orange', ['staff','manager','exec']],
          ['æ—©æœŸé€€è·ã‚¢ãƒ©ãƒ¼ãƒˆ', '2ä»¶', 'red', ['manager','exec']],
          ['å ±é…¬æ‰¿èªå¾…ã¡', '12ä»¶', 'gold', ['manager','exec']],
          ['ä¸åœ¨æŒæˆ»ã‚Šé€šçŸ¥', '2ä»¶', 'red', ['clerk','staff','manager','exec']],
          ['æŒ¯è¾¼æ‰¿èªå¾…ã¡', '1ä»¶ï¼ˆÂ¥2,300,000ï¼‰', 'red', ['exec']],
        ].map(([label, val, color, roles]) => {
          const show = roles.includes(currentRole);
          return show ? `
          <div style="display:flex;justify-content:space-between;align-items:center;padding:10px 0;border-bottom:1px solid rgba(37,42,56,0.4);cursor:pointer" onclick="showPage('${label.includes('å¯©æŸ»')?'screening':label.includes('é€€è·')?'early-quit':label.includes('å ±é…¬')?'reward':'transfer'}')">
            <span style="font-size:13px">${label}</span>
            <span style="font-family:'DM Mono',monospace;color:var(--${color});font-weight:600">${val}</span>
          </div>` : '';
        }).join('')}
      </div>
      <div class="card">
        <div class="card-title" style="margin-bottom:12px">ğŸ›  ãƒ„ãƒ¼ãƒ«ã‚·ãƒ§ãƒ¼ãƒˆã‚«ãƒƒãƒˆ</div>
        <div style="display:grid;grid-template-columns:repeat(3,1fr);gap:8px">
          ${visibleTools.map(t => `
            <div onclick="showPage('${t.id}')"
                 style="background:rgba(255,255,255,.03);border:1px solid var(--border);border-radius:9px;
                        padding:10px 6px;text-align:center;cursor:pointer;transition:all .15s"
                 onmouseover="this.style.background='rgba(255,255,255,.07)'"
                 onmouseout="this.style.background='rgba(255,255,255,.03)'">
              <div style="font-size:20px;margin-bottom:4px">${t.icon}</div>
              <div style="font-size:9px;color:${t.color};font-weight:700;line-height:1.3">${t.label}</div>
            </div>`).join('')}
        </div>
      </div>
    </div>`;
}

function renderCases(el, perms) {
  const canEdit = perms.includes('edit');
  const canDelete = perms.includes('delete');
  el.innerHTML = `
    <div class="card">
      <div style="display:flex;justify-content:space-between;align-items:center;margin-bottom:16px">
        <div style="font-weight:600">æ¡ˆä»¶ä¸€è¦§</div>
        ${canEdit ? '<button class="btn btn-gold" onclick="showCaseForm()">ï¼‹ æ–°è¦æ¡ˆä»¶ç™»éŒ²</button>' : '<button class="btn btn-disabled">ï¼‹ æ–°è¦æ¡ˆä»¶ ğŸ”’</button>'}
      </div>
      <table>
        <thead><tr><th>ID</th><th>ç¨®åˆ¥</th><th>ã‚¨ãƒªã‚¢</th><th>ç®¡ç†ä¼šç¤¾</th><th>ã‚¹ãƒ†ãƒ¼ã‚¿ã‚¹</th><th>æ‹…å½“AG</th><th>æ“ä½œ</th></tr></thead>
        <tbody>
          ${[
            ['C-003','è³ƒè²¸','æ¸‹è°·åŒºä»£ã€…æœ¨','æ ªå¼ä¼šç¤¾æ¸‹è°·ç®¡ç†','é€²è¡Œä¸­','å±±ç”° èª '],
            ['C-004','å£²è²·','ä¸–ç”°è°·åŒºä¸‰è»’èŒ¶å±‹','æ±æ€¥ãƒªãƒãƒ–ãƒ«ãˆ±','é€²è¡Œä¸­','é«˜æ©‹ æ˜'],
            ['C-005','äººæ','æ–°å®¿åŒºæœ¬ç¤¾','â€”','æ–°è¦','æœªå‰²å½“'],
          ].map(([id,type,area,mgmt,status,agent]) => `
          <tr>
            <td style="font-family:'DM Mono',monospace;color:var(--gold)">${id}</td>
            <td><span class="tag tag-blue">${type}</span></td>
            <td>${area}</td>
            <td style="font-size:11px;color:var(--sub)">${mgmt}</td>
            <td><span class="tag ${status==='é€²è¡Œä¸­'?'tag-orange':'tag-green'}">${status}</span></td>
            <td>${agent}</td>
            <td style="display:flex;gap:6px">
              <button class="btn btn-outline" style="padding:4px 10px;font-size:11px">è©³ç´°</button>
              ${canEdit ? '<button class="btn btn-outline" style="padding:4px 10px;font-size:11px">ç·¨é›†</button>' : '<button class="btn btn-disabled" style="padding:4px 10px;font-size:11px">ç·¨é›†ğŸ”’</button>'}
              ${canDelete ? `<button class="btn btn-red" style="padding:4px 10px;font-size:11px" onclick="openDeleteModal('${id}','${name}')">ã‚¢ã‚«ã‚¦ãƒ³ãƒˆå‰Šé™¤</button>` : ''}
            </td>
          </tr>`).join('')}
        </tbody>
      </table>
    </div>

    <!-- ãƒ¢ãƒ¼ãƒ€ãƒ« -->
    <div id="case-form-modal" style="display:none;position:fixed;inset:0;background:rgba(0,0,0,0.75);z-index:100;overflow-y:auto;padding:40px 20px">
      <div style="max-width:640px;margin:0 auto;background:var(--card);border:1px solid var(--border);border-radius:14px;padding:28px">

        <div style="display:flex;justify-content:space-between;align-items:center;margin-bottom:24px">
          <div>
            <div style="font-size:16px;font-weight:700">æ–°è¦æ¡ˆä»¶ç™»éŒ²</div>
            <div style="font-size:11px;color:var(--muted);margin-top:2px">ï¼Š ã¯å¿…é ˆé …ç›®</div>
          </div>
          <button onclick="hideCaseForm()" style="background:transparent;border:none;color:var(--muted);font-size:22px;cursor:pointer;line-height:1">âœ•</button>
        </div>

        <!-- åŸºæœ¬æƒ…å ± -->
        <div style="font-size:11px;color:var(--muted);letter-spacing:1px;text-transform:uppercase;margin-bottom:10px">åŸºæœ¬æƒ…å ±</div>
        <div style="display:grid;grid-template-columns:1fr 1fr;gap:12px;margin-bottom:22px">
          <div>
            <label style="font-size:11px;color:var(--sub);display:block;margin-bottom:5px">äº‹æ¥­ç¨®åˆ¥ ï¼Š</label>
            <select id="cf-type" onchange="toggleCaseType()" style="width:100%;background:var(--bg);border:1px solid var(--border);border-radius:6px;padding:9px 10px;color:#e8eaf0;font-size:13px;font-family:'Noto Sans JP',sans-serif">
              <option value="">é¸æŠã—ã¦ãã ã•ã„</option>
              <option value="rental">è³ƒè²¸ä»²ä»‹</option>
              <option value="sales">å£²è²·ä»²ä»‹</option>
              <option value="hr">äººæç´¹ä»‹</option>
            </select>
          </div>
          <div>
            <label style="font-size:11px;color:var(--sub);display:block;margin-bottom:5px">ã‚¨ãƒªã‚¢ ï¼Š</label>
            <input id="cf-area" type="text" placeholder="ä¾‹ï¼šæ¸‹è°·åŒºä»£ã€…æœ¨" style="width:100%;background:var(--bg);border:1px solid var(--border);border-radius:6px;padding:9px 10px;color:#e8eaf0;font-size:13px;font-family:'Noto Sans JP',sans-serif">
          </div>
          <div>
            <label style="font-size:11px;color:var(--sub);display:block;margin-bottom:5px">æ‹…å½“ã‚¨ãƒ¼ã‚¸ã‚§ãƒ³ãƒˆ ï¼Š</label>
            <select style="width:100%;background:var(--bg);border:1px solid var(--border);border-radius:6px;padding:9px 10px;color:#e8eaf0;font-size:13px;font-family:'Noto Sans JP',sans-serif">
              <option value="">é¸æŠã—ã¦ãã ã•ã„</option>
              <option>å±±ç”° èª ï¼ˆä¸å‹•ç”£AGï¼‰</option>
              <option>é«˜æ©‹ æ˜ï¼ˆä¸å‹•ç”£AGï¼‰</option>
              <option>ä¸­æ‘ ãƒªã‚«ï¼ˆäººæAGï¼‰</option>
            </select>
          </div>
          <div>
            <label style="font-size:11px;color:var(--sub);display:block;margin-bottom:5px">æ¡ˆä»¶ç™ºç”Ÿæº ï¼Š</label>
            <select style="width:100%;background:var(--bg);border:1px solid var(--border);border-radius:6px;padding:9px 10px;color:#e8eaf0;font-size:13px;font-family:'Noto Sans JP',sans-serif">
              <option value="">é¸æŠã—ã¦ãã ã•ã„</option>
              <option>è‡ªå·±é–‹æ‹“</option>
              <option>ãƒ‘ãƒ¼ãƒˆãƒŠãƒ¼ç´¹ä»‹</option>
              <option>æœ¬éƒ¨ä¾é ¼</option>
            </select>
          </div>
        </div>

        <!-- ç®¡ç†ä¼šç¤¾æƒ…å ±ï¼ˆè³ƒè²¸ãƒ»å£²è²·æ™‚ã®ã¿è¡¨ç¤ºï¼‰ -->
        <div id="mgmt-section" style="display:none">
          <div style="display:flex;align-items:center;gap:8px;margin-bottom:10px">
            <div style="font-size:11px;color:var(--muted);letter-spacing:1px;text-transform:uppercase">ç®¡ç†ä¼šç¤¾æƒ…å ±</div>
            <span style="background:rgba(201,168,76,0.15);color:var(--gold);font-size:10px;font-weight:700;padding:2px 8px;border-radius:3px">ğŸ· å®›åãƒ©ãƒ™ãƒ«è‡ªå‹•ç”Ÿæˆã«ä½¿ç”¨</span>
          </div>

          <div style="background:rgba(201,168,76,0.06);border:1px solid rgba(201,168,76,0.2);border-radius:8px;padding:12px 14px;margin-bottom:14px;font-size:12px;color:var(--sub);line-height:1.8">
            ã“ã“ã§å…¥åŠ›ã—ãŸæƒ…å ±ã¯ <strong style="color:#e8eaf0">Brother QL-820NWB ã§ã®å®›åãƒ©ãƒ™ãƒ«å°åˆ·</strong> ã«è‡ªå‹•ã§ä½¿ç”¨ã•ã‚Œã¾ã™ã€‚<br>
            å…¥åŠ›æ¼ã‚ŒãŒã‚ã‚‹ã¨ãƒ©ãƒ™ãƒ«ãŒç”Ÿæˆã§ããªã„ãŸã‚ <strong style="color:var(--red)">å…¨é …ç›®å¿…é ˆ</strong> ã§ã™ã€‚
          </div>

          <div style="display:grid;grid-template-columns:1fr 1fr;gap:12px;margin-bottom:12px">
            <div style="grid-column:1/-1">
              <label style="font-size:11px;color:var(--sub);display:block;margin-bottom:5px">ç®¡ç†ä¼šç¤¾å ï¼Š <span style="color:var(--red)">å¿…é ˆ</span></label>
              <input id="cf-mgmt-name" type="text" placeholder="ä¾‹ï¼šæ ªå¼ä¼šç¤¾æ¸‹è°·ç®¡ç†" oninput="validateMgmt()" style="width:100%;background:var(--bg);border:1px solid var(--border);border-radius:6px;padding:9px 10px;color:#e8eaf0;font-size:13px;font-family:'Noto Sans JP',sans-serif">
            </div>
            <div>
              <label style="font-size:11px;color:var(--sub);display:block;margin-bottom:5px">éƒµä¾¿ç•ªå· ï¼Š <span style="color:var(--red)">å¿…é ˆ</span></label>
              <input id="cf-mgmt-zip" type="text" placeholder="160-0022" maxlength="8" oninput="fmtZip(this);validateMgmt()" style="width:100%;background:var(--bg);border:1px solid var(--border);border-radius:6px;padding:9px 10px;color:#e8eaf0;font-size:13px;font-family:'DM Mono',monospace">
            </div>
            <div>
              <label style="font-size:11px;color:var(--sub);display:block;margin-bottom:5px">æ‹…å½“éƒ¨ç½²ãƒ»æ‹…å½“è€…åï¼ˆä»»æ„ï¼‰</label>
              <input type="text" placeholder="ä¾‹ï¼šç®¡ç†éƒ¨ éˆ´æœ¨æ§˜" style="width:100%;background:var(--bg);border:1px solid var(--border);border-radius:6px;padding:9px 10px;color:#e8eaf0;font-size:13px;font-family:'Noto Sans JP',sans-serif">
            </div>
            <div style="grid-column:1/-1">
              <label style="font-size:11px;color:var(--sub);display:block;margin-bottom:5px">ä½æ‰€ ï¼Š <span style="color:var(--red)">å¿…é ˆ</span></label>
              <input id="cf-mgmt-addr" type="text" placeholder="ä¾‹ï¼šæ±äº¬éƒ½æ–°å®¿åŒºæ–°å®¿2-3-4 â—‹â—‹ãƒ“ãƒ«5F" oninput="validateMgmt()" style="width:100%;background:var(--bg);border:1px solid var(--border);border-radius:6px;padding:9px 10px;color:#e8eaf0;font-size:13px;font-family:'Noto Sans JP',sans-serif">
            </div>
            <div>
              <label style="font-size:11px;color:var(--sub);display:block;margin-bottom:5px">é›»è©±ç•ªå·ï¼ˆä»»æ„ï¼‰</label>
              <input type="text" placeholder="03-1234-5678" style="width:100%;background:var(--bg);border:1px solid var(--border);border-radius:6px;padding:9px 10px;color:#e8eaf0;font-size:13px;font-family:'DM Mono',monospace">
            </div>
            <div>
              <label style="font-size:11px;color:var(--sub);display:block;margin-bottom:5px">FAXï¼ˆä»»æ„ï¼‰</label>
              <input type="text" placeholder="03-1234-5679" style="width:100%;background:var(--bg);border:1px solid var(--border);border-radius:6px;padding:9px 10px;color:#e8eaf0;font-size:13px;font-family:'DM Mono',monospace">
            </div>
          </div>

          <div id="mgmt-validation" style="display:none;background:rgba(239,68,68,0.08);border:1px solid rgba(239,68,68,0.3);border-radius:6px;padding:10px 12px;font-size:12px;color:var(--red);margin-bottom:12px">
            âš ï¸ ç®¡ç†ä¼šç¤¾åãƒ»éƒµä¾¿ç•ªå·ãƒ»ä½æ‰€ã¯ã™ã¹ã¦å¿…é ˆã§ã™ã€‚
          </div>

          <div style="background:var(--hover);border-radius:6px;padding:9px 12px;font-size:11px;color:var(--sub);margin-bottom:20px">
            ğŸ’¡ åŒã˜ç®¡ç†ä¼šç¤¾ã‚’éå»ã«ç™»éŒ²æ¸ˆã¿ã®å ´åˆã¯ä½æ‰€ãŒè‡ªå‹•è£œå®Œã•ã‚Œã¾ã™ã€‚
            <button style="margin-left:8px;background:transparent;border:1px solid var(--border);color:var(--sub);padding:3px 10px;border-radius:4px;font-size:11px;cursor:pointer;font-family:'Noto Sans JP',sans-serif">ãƒã‚¹ã‚¿ã‹ã‚‰é¸æŠ</button>
          </div>
        </div>

        <!-- ç‰©ä»¶æƒ…å ±ï¼ˆè³ƒè²¸ãƒ»å£²è²·ã®ã¿ï¼‰ -->
        <div id="property-section" style="display:none">
          <div style="font-size:11px;color:var(--muted);letter-spacing:1px;text-transform:uppercase;margin-bottom:10px">ç‰©ä»¶æƒ…å ±</div>
          <div style="display:grid;grid-template-columns:1fr 1fr;gap:12px;margin-bottom:22px">
            <div style="grid-column:1/-1">
              <label style="font-size:11px;color:var(--sub);display:block;margin-bottom:5px">ç‰©ä»¶å ï¼Š</label>
              <input type="text" placeholder="ä¾‹ï¼šæ¸‹è°·ä»£ã€…æœ¨ãƒã‚¦ã‚¹ 201å·å®¤" style="width:100%;background:var(--bg);border:1px solid var(--border);border-radius:6px;padding:9px 10px;color:#e8eaf0;font-size:13px;font-family:'Noto Sans JP',sans-serif">
            </div>
            <div>
              <label style="font-size:11px;color:var(--sub);display:block;margin-bottom:5px">å®¶è³ƒ / å£²è²·ä¾¡æ ¼ ï¼Š</label>
              <input type="text" placeholder="ä¾‹ï¼šÂ¥150,000" style="width:100%;background:var(--bg);border:1px solid var(--border);border-radius:6px;padding:9px 10px;color:#e8eaf0;font-size:13px;font-family:'DM Mono',monospace">
            </div>
            <div>
              <label style="font-size:11px;color:var(--sub);display:block;margin-bottom:5px">å…¥å±…äºˆå®šæ—¥</label>
              <input type="date" style="width:100%;background:var(--bg);border:1px solid var(--border);border-radius:6px;padding:9px 10px;color:#e8eaf0;font-size:13px;font-family:'DM Mono',monospace">
            </div>
          </div>
        </div>

        <div style="display:flex;gap:10px;justify-content:flex-end;padding-top:16px;border-top:1px solid var(--border)">
          <button onclick="hideCaseForm()" class="btn btn-outline">ã‚­ãƒ£ãƒ³ã‚»ãƒ«</button>
          <button onclick="submitCaseForm()" class="btn btn-gold" style="padding:10px 24px;font-size:13px">ç™»éŒ²ã™ã‚‹</button>
        </div>
      </div>
    </div>
  `;
}

function showCaseForm() {
  document.getElementById('case-form-modal').style.display = 'block';
}
function hideCaseForm() {
  document.getElementById('case-form-modal').style.display = 'none';
}
function toggleCaseType() {
  const type = document.getElementById('cf-type').value;
  document.getElementById('mgmt-section').style.display = (type === 'rental' || type === 'sales') ? 'block' : 'none';
  document.getElementById('property-section').style.display = (type === 'rental' || type === 'sales') ? 'block' : 'none';
}
function validateMgmt() {
  const ok = document.getElementById('cf-mgmt-name')?.value && document.getElementById('cf-mgmt-addr')?.value && document.getElementById('cf-mgmt-zip')?.value;
  const msg = document.getElementById('mgmt-validation');
  if (msg) msg.style.display = ok ? 'none' : 'block';
}
function fmtZip(input) {
  let v = input.value.replace(/[^0-9]/g,'');
  if (v.length > 3) v = v.slice(0,3) + '-' + v.slice(3,7);
  input.value = v;
}
function submitCaseForm() {
  const type = document.getElementById('cf-type')?.value;
  const area = document.getElementById('cf-area')?.value?.trim();
  if (!type || !area) { alert('äº‹æ¥­ç¨®åˆ¥ã¨ã‚¨ãƒªã‚¢ã¯å¿…é ˆã§ã™'); return; }
  if (type !== 'hr') {
    const name = document.getElementById('cf-mgmt-name')?.value?.trim();
    const addr = document.getElementById('cf-mgmt-addr')?.value?.trim();
    const zip  = document.getElementById('cf-mgmt-zip')?.value?.trim();
    if (!name || !addr || !zip) {
      document.getElementById('mgmt-validation').style.display = 'block';
      document.getElementById('cf-mgmt-name').focus();
      return;
    }
  }
  hideCaseForm();
  const t = document.createElement('div');
  t.style.cssText = 'position:fixed;bottom:28px;left:50%;transform:translateX(-50%);background:rgba(34,197,94,0.15);border:1px solid #22c55e;color:#22c55e;padding:12px 24px;border-radius:8px;font-size:13px;font-weight:600;z-index:200;white-space:nowrap';
  t.textContent = 'âœ… æ¡ˆä»¶ã‚’ç™»éŒ²ã—ã¾ã—ãŸ';
  document.body.appendChild(t);
  setTimeout(() => t.remove(), 3000);
}

function renderReview(el, perms) {
  const canApprove = perms.includes('approve');
  el.innerHTML = `
    <div class="card">
      <div class="card-title">å…¥ä¼šå¯©æŸ»å¾…ã¡ï¼ˆ3ä»¶ï¼‰</div>
      <table>
        <thead><tr><th>ç”³è«‹ID</th><th>æ°å</th><th>ã‚¿ã‚¤ãƒ—</th><th>çµŒé¨“</th><th>ç”³è«‹æ—¥æ™‚</th><th>æ“ä½œ</th></tr></thead>
        <tbody>
          ${[
            ['R-089','ä¼Šè—¤ éš†','ä¸å‹•ç”£AG','3å¹´ä»¥ä¸Š','2/19 09:12'],
            ['R-090','æ¸¡è¾º ç´”å­','äººæAG','2å¹´','2/19 10:45'],
            ['R-091','å·æ‘å•†äº‹ãˆ±','ãƒ‘ãƒ¼ãƒˆãƒŠãƒ¼ï¼ˆæ³•äººï¼‰','æ³•äºº','2/19 11:30'],
          ].map(([id,name,type,exp,date]) => `
          <tr>
            <td style="font-family:'DM Mono',monospace;font-size:11px;color:var(--muted)">${id}</td>
            <td style="font-weight:500">${name}</td>
            <td><span class="tag tag-blue" style="font-size:10px">${type}</span></td>
            <td>${exp}</td>
            <td style="color:var(--muted)">${date}</td>
            <td style="display:flex;gap:6px">
              <button class="btn btn-outline" style="padding:4px 10px;font-size:11px">è©³ç´°</button>
              ${canApprove
                ? '<button class="btn btn-gold" style="padding:4px 10px;font-size:11px">âœ“ åˆæ ¼</button><button class="btn btn-red" style="padding:4px 10px;font-size:11px">âœ— ä¸åˆæ ¼</button>'
                : '<button class="btn btn-disabled" style="padding:4px 10px;font-size:11px">åˆæ ¼ğŸ”’</button>'}
            </td>
          </tr>`).join('')}
        </tbody>
      </table>
    </div>`;
}

function renderMembers(el, perms) {
  const canEdit = perms.includes('edit');
  const canDelete = perms.includes('delete');
  const showPersonal = ['manager','exec'].includes(currentRole);
  el.innerHTML = `
    <div style="font-size:12px;color:var(--orange);background:rgba(245,158,11,0.08);border:1px solid rgba(245,158,11,0.2);border-radius:6px;padding:10px 14px;margin-bottom:16px">
      ğŸ”’ å£åº§ç•ªå·ãƒ»ä½æ‰€ãªã©ã®å€‹äººæƒ…å ±ã¯ <strong>ç®¡ç†è·ä»¥ä¸Š</strong> ã®ã¿é–²è¦§ã§ãã¾ã™
    </div>
    <div class="card">
      <table>
        <thead><tr><th>ID</th><th>æ°å</th><th>ã‚¿ã‚¤ãƒ—</th><th>ãƒ©ãƒ³ã‚¯</th><th>å£åº§ç•ªå·</th><th>ä½æ‰€</th><th>æ“ä½œ</th></tr></thead>
        <tbody>
          ${[
            ['M-001','å±±ç”° èª ','ä¸å‹•ç”£AG','GOLD','1234-567890','æ±äº¬éƒ½è±Šå³¶åŒº'],
            ['M-002','ä¸­æ‘ ãƒªã‚«','äººæAG','SILVER','9876-543210','æ±äº¬éƒ½æ–°å®¿åŒº'],
            ['M-003','ä½è—¤ ç¾å’²','ãƒ‘ãƒ¼ãƒˆãƒŠãƒ¼','â€”','5555-111222','æ±äº¬éƒ½æ¸‹è°·åŒº'],
          ].map(([id,name,type,rank,bank,addr]) => `
          <tr>
            <td style="font-family:'DM Mono',monospace;font-size:11px;color:var(--muted)">${id}</td>
            <td style="font-weight:500">${name}</td>
            <td><span class="tag tag-blue" style="font-size:10px">${type}</span></td>
            <td style="color:var(--gold)">${rank}</td>
            <td style="font-family:'DM Mono',monospace;font-size:11px">${showPersonal ? bank : '<span style="filter:blur(5px);user-select:none;color:#555">â—â—â—â—-â—â—â—â—â—â—</span>'}</td>
            <td style="font-size:11px">${showPersonal ? addr : '<span style="filter:blur(5px);user-select:none;color:#555">â—â—â—â—â—â—</span>'}</td>
            <td style="display:flex;gap:6px">
              ${canEdit ? '<button class="btn btn-outline" style="padding:4px 10px;font-size:11px">ç·¨é›†</button>' : '<button class="btn btn-disabled" style="padding:4px 10px;font-size:11px">ç·¨é›†ğŸ”’</button>'}
              ${canDelete ? `<button class="btn btn-red" style="padding:4px 10px;font-size:11px" onclick="openDeleteModal('${id}','${name}')">ã‚¢ã‚«ã‚¦ãƒ³ãƒˆå‰Šé™¤</button>` : ''}
            </td>
          </tr>`).join('')}
        </tbody>
      </table>
    </div>`;
}

function renderReward(el, perms) {
  const canApprove = perms.includes('approve');
  const canEdit = perms.includes('edit');
  const showAmounts = currentRole === 'exec';

  if (!showAmounts) {
    // ç®¡ç†è·ï¼šä»¶æ•°ãƒ»ã‚¹ãƒ†ãƒ¼ã‚¿ã‚¹ã®ã¿è¡¨ç¤ºã€é‡‘é¡ã¯ãƒã‚¹ã‚¯
    el.innerHTML = `
      <div style="background:rgba(201,168,76,0.08);border:1px solid rgba(201,168,76,0.2);border-radius:6px;padding:10px 14px;margin-bottom:16px;font-size:12px;color:var(--gold);line-height:1.7">
        ğŸ”’ å ±é…¬ã®é‡‘é¡ãƒ»æ˜ç´°ã¯ <strong>çµŒå–¶é™£ã®ã¿</strong> é–²è¦§ã§ãã¾ã™ã€‚ä»¶æ•°ã¨ã‚¹ãƒ†ãƒ¼ã‚¿ã‚¹ã®ã¿è¡¨ç¤ºã—ã¦ã„ã¾ã™ã€‚
      </div>
      <div class="card">
        <div class="card-title">å ±é…¬æ‰¿èªå¾…ã¡ â€• 2æœˆåˆ†ï¼ˆé‡‘é¡éè¡¨ç¤ºï¼‰</div>
        <table>
          <thead><tr><th>ã‚¨ãƒ¼ã‚¸ã‚§ãƒ³ãƒˆ</th><th>æˆç´„ä»¶æ•°</th><th>å ±é…¬é¡</th><th>æŒ¯è¾¼é¡</th><th>ãƒã‚§ãƒƒã‚¯</th><th>æ“ä½œ</th></tr></thead>
          <tbody>
            ${[['å±±ç”° èª ','4ä»¶','âœ… 8é …ç›®OK'],['é«˜æ©‹ æ˜','3ä»¶','âœ… 8é …ç›®OK'],['ä¸­æ‘ ãƒªã‚«','2ä»¶','âš ï¸ è¦ç¢ºèª']].map(([name,cnt,check]) => `
            <tr>
              <td style="font-weight:500">${name}</td>
              <td style="font-family:'DM Mono',monospace">${cnt}</td>
              <td style="filter:blur(5px);user-select:none;color:#555">Â¥â—â—â—,â—â—â—</td>
              <td style="filter:blur(5px);user-select:none;color:#555">Â¥â—â—â—,â—â—â—</td>
              <td style="font-size:11px">${check}</td>
              <td><button class="btn btn-outline" style="padding:4px 10px;font-size:11px">è©³ç´°</button></td>
            </tr>`).join('')}
          </tbody>
        </table>
      </div>`;
    return;
  }

  el.innerHTML = `
    <div class="card">
      <div class="card-title">å ±é…¬æ‰¿èªå¾…ã¡ â€• 2æœˆåˆ†</div>
      <table>
        <thead><tr><th>ã‚¨ãƒ¼ã‚¸ã‚§ãƒ³ãƒˆ</th><th>æˆç´„ä»¶æ•°</th><th>å ±é…¬é¡ï¼ˆç¨æŠœï¼‰</th><th>æºæ³‰å¾´å</th><th>æŒ¯è¾¼é¡</th><th>ãƒã‚§ãƒƒã‚¯</th><th>æ“ä½œ</th></tr></thead>
        <tbody>
          ${[
            ['å±±ç”° èª ','4ä»¶','Â¥409,500','Â¥41,810','Â¥367,690','âœ… 8é …ç›®OK'],
            ['é«˜æ©‹ æ˜','3ä»¶','Â¥310,000','Â¥31,642','Â¥278,358','âœ… 8é …ç›®OK'],
            ['ä¸­æ‘ ãƒªã‚«','2ä»¶','Â¥673,000','Â¥68,717','Â¥604,283','âš ï¸ è¦ç¢ºèª'],
          ].map(([name,cnt,gross,tax,net,check]) => `
          <tr>
            <td style="font-weight:500">${name}</td>
            <td style="font-family:'DM Mono',monospace">${cnt}</td>
            <td style="font-family:'DM Mono',monospace;color:var(--blue)">${gross}</td>
            <td style="font-family:'DM Mono',monospace;color:var(--red)">${tax}</td>
            <td style="font-family:'DM Mono',monospace;color:var(--green);font-weight:600">${net}</td>
            <td style="font-size:11px">${check}</td>
            <td style="display:flex;gap:6px">
              <button class="btn btn-outline" style="padding:4px 10px;font-size:11px">è©³ç´°</button>
              <button class="btn btn-gold" style="padding:4px 10px;font-size:11px">æ‰¿èª</button>
            </td>
          </tr>`).join('')}
        </tbody>
      </table>
    </div>`;
}

function renderTransfer(el, perms) {
  const canExecute = perms.includes('execute');
  el.innerHTML = `
    <div style="max-width:600px">
      <div style="background:rgba(239,68,68,0.08);border:1px solid rgba(239,68,68,0.3);border-radius:8px;padding:14px;margin-bottom:20px;font-size:12px;color:var(--red);line-height:1.7">
        âš ï¸ æŒ¯è¾¼å®Ÿè¡Œã¯ <strong>çµŒå–¶é™£ã®ã¿</strong> æ“ä½œã§ãã¾ã™ã€‚å®Ÿè¡Œå¾Œã®å–æ¶ˆã¯ã§ãã¾ã›ã‚“ã€‚
      </div>
      <div class="card">
        <div class="card-title">2æœˆåˆ† æŒ¯è¾¼ãƒ‡ãƒ¼ã‚¿ â€• 2026å¹´3æœˆ25æ—¥å®Ÿè¡Œäºˆå®š</div>
        ${[['å¯¾è±¡äººæ•°','18å'],['æŒ¯è¾¼ç·é¡','Â¥4,238,542'],['ã†ã¡æºæ³‰å¾´å','Â¥432,110'],['GMOéŠ€è¡Œæ®‹é«˜','Â¥8,120,000'],['å®Ÿè¡Œã‚¹ãƒ†ãƒ¼ã‚¿ã‚¹','æ‰¿èªå¾…ã¡']].map(([k,v]) => `
        <div style="display:flex;justify-content:space-between;padding:9px 0;border-bottom:1px solid rgba(37,42,56,0.4);font-size:13px">
          <span style="color:var(--sub)">${k}</span>
          <span style="font-family:'DM Mono',monospace;font-weight:600">${v}</span>
        </div>`).join('')}
        <div style="margin-top:20px;display:flex;gap:10px">
          <button class="btn btn-outline">æŒ¯è¾¼æ˜ç´°ã‚’ç¢ºèª</button>
          ${canExecute
            ? '<button class="btn btn-gold" style="padding:10px 24px;font-size:13px">ğŸ¦ æŒ¯è¾¼ã‚’å®Ÿè¡Œã™ã‚‹</button>'
            : '<button class="btn btn-disabled" style="padding:10px 24px;font-size:13px">ğŸ”’ æŒ¯è¾¼å®Ÿè¡Œï¼ˆçµŒå–¶é™£ã®ã¿ï¼‰</button>'}
        </div>
      </div>
    </div>`;
}

function renderSales(el, perms) {
  const showDetailFinance = currentRole === 'exec';
  el.innerHTML = `
    <div class="grid4" style="margin-bottom:20px">
      <div class="stat-card"><div class="stat-label">ä»Šæœˆå£²ä¸Š</div><div class="stat-val" style="color:var(--gold)">Â¥4,200,000</div></div>
      <div class="stat-card"><div class="stat-label">ä»Šæœˆæˆç´„æ•°</div><div class="stat-val" style="color:var(--green)">31ä»¶</div></div>
      <div class="stat-card"><div class="stat-label">å…ˆæœˆæ¯”</div><div class="stat-val" style="color:var(--blue)">+18%</div></div>
      <div class="stat-card">
        <div class="stat-label">æœ¬éƒ¨åˆ©ç›Š</div>
        <div class="stat-val" style="color:${showDetailFinance?'var(--green)':'var(--muted)'}">
          ${showDetailFinance ? 'Â¥1,890,000' : '<span style="filter:blur(5px);user-select:none">Â¥X.XXM</span>'}
        </div>
        ${!showDetailFinance ? '<div style="font-size:10px;color:var(--muted);margin-top:4px">ğŸ”’ çµŒå–¶é™£ã®ã¿</div>' : ''}
      </div>
    </div>

    <div class="card">
      <div style="display:flex;align-items:center;justify-content:space-between;margin-bottom:16px">
        <div class="card-title" style="margin:0">ğŸ† ä»Šæœˆ ã‚¨ãƒ¼ã‚¸ã‚§ãƒ³ãƒˆåˆ¥ãƒ©ãƒ³ã‚­ãƒ³ã‚°</div>
        <div style="font-size:11px;color:var(--muted)">2026å¹´2æœˆ / å…¨ã‚¨ãƒ¼ã‚¸ã‚§ãƒ³ãƒˆå¯¾è±¡</div>
      </div>

      ${[
        { rank:1, name:'å±±ç”° èª ',  type:'ä¸å‹•ç”£AG', cases:7, sales:'Â¥820,000', trend:'+2',  medal:'ğŸ¥‡', bar:100 },
        { rank:2, name:'é«˜æ©‹ æ˜',  type:'ä¸å‹•ç”£AG', cases:6, sales:'Â¥710,000', trend:'+1',  medal:'ğŸ¥ˆ', bar:87  },
        { rank:3, name:'ä¸­æ‘ ãƒªã‚«',type:'äººæAG',   cases:4, sales:'Â¥650,000', trend:'Â±0',  medal:'ğŸ¥‰', bar:79  },
        { rank:4, name:'ä¼Šè—¤ éš†',  type:'ä¸å‹•ç”£AG', cases:4, sales:'Â¥480,000', trend:'+3',  medal:'',   bar:59  },
        { rank:5, name:'æ¸¡è¾º ç´”å­',type:'äººæAG',   cases:3, sales:'Â¥390,000', trend:'-1',  medal:'',   bar:48  },
        { rank:6, name:'æœ¨æ‘ ç¿”',  type:'ä¸å‹•ç”£AG', cases:3, sales:'Â¥310,000', trend:'new', medal:'',   bar:38  },
      ].map(r => `
      <div style="display:flex;align-items:center;gap:14px;padding:12px 0;border-bottom:1px solid rgba(37,42,56,0.4)">
        <div style="font-family:'DM Mono',monospace;font-size:18px;font-weight:700;min-width:32px;text-align:center;color:${r.rank<=3?'var(--gold)':'var(--muted)'}">
          ${r.medal || r.rank}
        </div>
        <div style="min-width:100px">
          <div style="font-size:13px;font-weight:600">${r.name}</div>
          <div style="font-size:10px;color:var(--muted);margin-top:1px">${r.type}</div>
        </div>
        <div style="flex:1">
          <div style="display:flex;align-items:center;gap:8px;margin-bottom:4px">
            <div style="flex:1;height:6px;background:var(--hover);border-radius:3px;overflow:hidden">
              <div style="height:100%;width:${r.bar}%;background:${r.rank===1?'var(--gold)':r.rank===2?'#c0c0c0':r.rank===3?'#cd7f32':'var(--blue)'};border-radius:3px;transition:width .5s ease"></div>
            </div>
          </div>
          <div style="display:flex;gap:16px;font-size:11px;color:var(--muted)">
            <span>æˆç´„ <strong style="color:#e8eaf0">${r.cases}ä»¶</strong></span>
            <span>å£²ä¸Š <strong style="color:var(--gold)">${r.sales}</strong></span>
          </div>
        </div>
        <div style="font-size:11px;min-width:44px;text-align:right;color:${r.trend.startsWith('+')?'var(--green)':r.trend==='-1'?'var(--red)':r.trend==='new'?'var(--purple)':'var(--muted)'}">
          ${r.trend==='new'?'ğŸ†• NEW':r.trend.startsWith('+')?'â–²'+r.trend.slice(1):r.trend==='Â±0'?'â€•':'â–¼'+r.trend.slice(1)}
        </div>
      </div>`).join('')}
    </div>

    <div class="card">
      <div class="card-title">ğŸ“… æœˆåˆ¥æ¨ç§»</div>
      <div style="display:flex;gap:6px;align-items:flex-end;height:80px;padding:4px 0">
        ${[38,52,45,68,60,76,90,84,105,115,98,130].map((h,i)=>`
        <div style="flex:1;display:flex;flex-direction:column;align-items:center;gap:3px">
          <div style="width:100%;background:${i===11?'rgba(201,168,76,0.5)':'rgba(59,130,246,0.2)'};border-radius:3px 3px 0 0;height:${h}%;min-height:4px"></div>
        </div>`).join('')}
      </div>
      <div style="display:flex;justify-content:space-between;font-size:9px;color:var(--muted);margin-top:4px;padding:0 1px">
        ${['3æœˆ','4æœˆ','5æœˆ','6æœˆ','7æœˆ','8æœˆ','9æœˆ','10æœˆ','11æœˆ','12æœˆ','1æœˆ','2æœˆ'].map(m=>`<span>${m}</span>`).join('')}
      </div>
      <div style="margin-top:10px;font-size:11px;color:var(--sub);text-align:right">
        ä»Šæœˆï¼ˆ2æœˆï¼‰ã¯éå»12ãƒ¶æœˆã§ <strong style="color:var(--gold)">æœ€é«˜å£²ä¸Š</strong> ğŸ‰
      </div>
    </div>`;
}

function renderScan(el, perms) {
  el.innerHTML = `<div style="color:var(--sub);font-size:13px">ã‚¹ã‚­ãƒ£ãƒ³ãƒ‡ã‚¹ã‚¯ï¼ˆåˆ¥ãƒ•ã‚¡ã‚¤ãƒ«ã®å®Ÿè£…ã‚’å‚ç…§ï¼‰</div>`;
}

function renderLetterpack(el, perms) {
  el.innerHTML = `<div style="color:var(--sub);font-size:13px">ãƒ¬ã‚¿ãƒ¼ãƒ‘ãƒƒã‚¯è¿½è·¡ä¸€è¦§ï¼ˆåˆ¥ãƒ•ã‚¡ã‚¤ãƒ«ã®å®Ÿè£…ã‚’å‚ç…§ï¼‰</div>`;
}

function renderSystem(el, perms) {
  const canEdit = perms.includes('edit');
  el.innerHTML = `
    <div style="max-width:600px">
      <div class="card">
        <div class="card-title">âš™ï¸ ã‚·ã‚¹ãƒ†ãƒ è¨­å®š</div>
        ${[['æœˆä¼šè²»ï¼ˆãƒ–ãƒ­ãƒ³ã‚ºï¼‰','Â¥980'],['æœˆä¼šè²»ï¼ˆã‚·ãƒ«ãƒãƒ¼ï¼‰','Â¥490'],['ãƒ©ãƒ³ã‚¯è‡ªå‹•åˆ¤å®š','æœ‰åŠ¹'],['äººæç´¹ä»‹ è¿”é‡‘ä¿è¨¼æœŸé–“','3/6ãƒ¶æœˆ'],['æºæ³‰å¾´åç‡ï¼ˆ100ä¸‡ä»¥ä¸‹ï¼‰','10.21%']].map(([k,v]) => `
        <div style="display:flex;justify-content:space-between;align-items:center;padding:10px 0;border-bottom:1px solid rgba(37,42,56,0.4)">
          <span style="font-size:13px;color:var(--sub)">${k}</span>
          <div style="display:flex;gap:8px;align-items:center">
            <span style="font-family:'DM Mono',monospace;font-size:13px">${v}</span>
            ${canEdit ? '<button class="btn btn-outline" style="padding:3px 10px;font-size:11px">å¤‰æ›´</button>' : ''}
          </div>
        </div>`).join('')}
      </div>
    </div>`;
}

function renderConnect(el, perms) {
  el.innerHTML = `
    <div style="max-width:600px">
      <div class="card">
        <div class="card-title" style="color:#e879f9">Slack é€£æº</div>
        <div style="display:flex;align-items:center;gap:8px;margin-bottom:12px">
          <div style="width:8px;height:8px;border-radius:50%;background:var(--green)"></div>
          <span style="font-size:13px">æ¥ç¶šæ¸ˆã¿ï¼šCORETO Workspace</span>
        </div>
        <button class="btn btn-outline" style="font-size:12px">è¨­å®šã‚’å¤‰æ›´</button>
      </div>
      <div class="card">
        <div class="card-title" style="color:#06d674">LINE å…¬å¼ã‚¢ã‚«ã‚¦ãƒ³ãƒˆ é€£æº</div>
        <div style="display:flex;align-items:center;gap:8px;margin-bottom:12px">
          <div style="width:8px;height:8px;border-radius:50%;background:var(--green)"></div>
          <span style="font-size:13px">æ¥ç¶šæ¸ˆã¿ï¼š@CORETO</span>
        </div>
        <button class="btn btn-outline" style="font-size:12px">è¨­å®šã‚’å¤‰æ›´</button>
      </div>
    </div>`;
}

function renderAuditlog(el, perms) {
  const logs = [
    { time:'2/19 15:42', user:'ç®¡ç†ãƒ¦ãƒ¼ã‚¶ãƒ¼ï¼ˆçµŒå–¶é™£ï¼‰', action:'æŒ¯è¾¼å®Ÿè¡Œ â€• 2æœˆåˆ† Â¥4,238,542', result:'ok' },
    { time:'2/19 14:30', user:'ç®¡ç†ãƒ¦ãƒ¼ã‚¶ãƒ¼ï¼ˆç®¡ç†è·ï¼‰', action:'å ±é…¬æ‰¿èª â€• å±±ç”°èª  Â¥367,690', result:'ok' },
    { time:'2/19 11:20', user:'ç®¡ç†ãƒ¦ãƒ¼ã‚¶ãƒ¼ï¼ˆç¤¾å“¡ï¼‰', action:'å…¥ä¼šå¯©æŸ» â€• R-089 åˆæ ¼', result:'ok' },
    { time:'2/19 10:55', user:'ç®¡ç†ãƒ¦ãƒ¼ã‚¶ãƒ¼ï¼ˆäº‹å‹™å“¡ï¼‰', action:'æŒ¯è¾¼å®Ÿè¡Œ ãƒšãƒ¼ã‚¸ã¸ã®ã‚¢ã‚¯ã‚»ã‚¹è©¦è¡Œ', result:'deny' },
    { time:'2/19 10:12', user:'ç®¡ç†ãƒ¦ãƒ¼ã‚¶ãƒ¼ï¼ˆäº‹å‹™å“¡ï¼‰', action:'ã‚¹ã‚­ãƒ£ãƒ³ â€• C003-CONTRACT ç™ºé€', result:'ok' },
    { time:'2/18 17:30', user:'ç®¡ç†ãƒ¦ãƒ¼ã‚¶ãƒ¼ï¼ˆç¤¾å“¡ï¼‰', action:'ãƒ¡ãƒ³ãƒãƒ¼å€‹äººæƒ…å ±ï¼ˆå£åº§ï¼‰é–²è¦§è©¦è¡Œ', result:'deny' },
    { time:'2/18 16:00', user:'ç®¡ç†ãƒ¦ãƒ¼ã‚¶ãƒ¼ï¼ˆç®¡ç†è·ï¼‰', action:'ã‚·ã‚¹ãƒ†ãƒ è¨­å®š ãƒšãƒ¼ã‚¸ã¸ã®ã‚¢ã‚¯ã‚»ã‚¹è©¦è¡Œ', result:'deny' },
  ];
  el.innerHTML = `
    <div class="card">
      <div class="card-title">ğŸ” æ“ä½œãƒ­ã‚° â€• ç›´è¿‘50ä»¶</div>
      <div style="font-size:12px;color:var(--muted);margin-bottom:16px">æ¨©é™å¤–ã‚¢ã‚¯ã‚»ã‚¹è©¦è¡Œã‚‚è¨˜éŒ²ã•ã‚Œã¾ã™</div>
      ${logs.map(l => `
      <div class="log-row">
        <span class="log-time">${l.time}</span>
        <span class="log-user">${l.user}</span>
        <span class="log-action">${l.action}</span>
        <span class="${l.result==='ok'?'log-result-ok':'log-result-deny'}">${l.result==='ok'?'âœ… æˆåŠŸ':'ğŸš« æ‹’å¦'}</span>
      </div>`).join('')}
    </div>`;
}

function renderMatrix(el, perms) {
  const features = [
    { section:'æ¡ˆä»¶ãƒ»æ¥­å‹™', name:'æ¡ˆä»¶é–²è¦§', desc:'', perms:{ clerk:'ok', staff:'ok', manager:'ok', exec:'ok' } },
    { section:null, name:'æ¡ˆä»¶ç·¨é›†', desc:'', perms:{ clerk:'no', staff:'ok', manager:'ok', exec:'ok' } },
    { section:null, name:'æ¡ˆä»¶å‰Šé™¤', desc:'', perms:{ clerk:'no', staff:'no', manager:'ok', exec:'ok' } },
    { section:null, name:'å…¥ä¼šå¯©æŸ»ãƒ»åˆå¦åˆ¤å®š', desc:'', perms:{ clerk:'no', staff:'ok', manager:'ok', exec:'ok' } },
    { section:'ãƒ¡ãƒ³ãƒãƒ¼ç®¡ç†', name:'ãƒ¡ãƒ³ãƒãƒ¼ä¸€è¦§é–²è¦§', desc:'', perms:{ clerk:'no', staff:'ok', manager:'ok', exec:'ok' } },
    { section:null, name:'å€‹äººæƒ…å ±ï¼ˆå£åº§ãƒ»ä½æ‰€ï¼‰', desc:'ç®¡ç†è·ä»¥ä¸Š', perms:{ clerk:'no', staff:'no', manager:'ok', exec:'ok' } },
    { section:null, name:'ãƒ©ãƒ³ã‚¯å¤‰æ›´ãƒ»ç·¨é›†', desc:'', perms:{ clerk:'no', staff:'no', manager:'ok', exec:'ok' } },
    { section:null, name:'ãƒ¡ãƒ³ãƒãƒ¼å‰Šé™¤', desc:'', perms:{ clerk:'no', staff:'no', manager:'no', exec:'ok' } },
    { section:'è²¡å‹™ãƒ»å ±é…¬', name:'å ±é…¬ä¸€è¦§ï¼ˆä»¶æ•°ãƒ»ã‚¹ãƒ†ãƒ¼ã‚¿ã‚¹ã®ã¿ï¼‰', desc:'é‡‘é¡éè¡¨ç¤º', perms:{ clerk:'no', staff:'no', manager:'ok', exec:'ok' } },
    { section:null, name:'å ±é…¬ã®é‡‘é¡ãƒ»æ˜ç´°é–²è¦§', desc:'çµŒå–¶é™£ã®ã¿', perms:{ clerk:'no', staff:'no', manager:'no', exec:'ok' } },
    { section:null, name:'å ±é…¬æ‰¿èª', desc:'çµŒå–¶é™£ã®ã¿', perms:{ clerk:'no', staff:'no', manager:'no', exec:'ok' } },
    { section:null, name:'å£²ä¸Šãƒ»åç›Šãƒ‡ãƒ¼ã‚¿é–²è¦§', desc:'å…¨å½¹è·OK', perms:{ clerk:'ok', staff:'ok', manager:'ok', exec:'ok' } },
    { section:null, name:'æŒ¯è¾¼å®Ÿè¡Œ', desc:'çµŒå–¶é™£ã®ã¿', perms:{ clerk:'no', staff:'no', manager:'no', exec:'ok' } },
    { section:'é‹ç”¨', name:'ã‚¹ã‚­ãƒ£ãƒ³ãƒ‡ã‚¹ã‚¯æ“ä½œ', desc:'', perms:{ clerk:'ok', staff:'ok', manager:'ok', exec:'ok' } },
    { section:null, name:'ãƒ¬ã‚¿ãƒ¼ãƒ‘ãƒƒã‚¯è¿½è·¡é–²è¦§', desc:'', perms:{ clerk:'ok', staff:'ok', manager:'ok', exec:'ok' } },
    { section:'ã‚·ã‚¹ãƒ†ãƒ ', name:'ã‚·ã‚¹ãƒ†ãƒ è¨­å®šå¤‰æ›´', desc:'çµŒå–¶é™£ã®ã¿', perms:{ clerk:'no', staff:'no', manager:'no', exec:'ok' } },
    { section:null, name:'Slack/LINEé€£æºè¨­å®š', desc:'çµŒå–¶é™£ã®ã¿', perms:{ clerk:'no', staff:'no', manager:'no', exec:'ok' } },
    { section:null, name:'æ“ä½œãƒ­ã‚°é–²è¦§', desc:'', perms:{ clerk:'no', staff:'no', manager:'ok', exec:'ok' } },
    { section:null, name:'æ¨©é™ãƒãƒˆãƒªã‚¯ã‚¹é–²è¦§', desc:'', perms:{ clerk:'no', staff:'no', manager:'ok', exec:'ok' } },
    { section:null, name:'æ¨©é™ãƒãƒˆãƒªã‚¯ã‚¹ç·¨é›†', desc:'çµŒå–¶é™£ã®ã¿', perms:{ clerk:'no', staff:'no', manager:'no', exec:'ok' } },
  ];

  const icon = { ok:'<span class="perm-ok">âœ“</span>', no:'<span class="perm-no">â€”</span>', partial:'<span class="perm-partial">â–³</span>' };

  let lastSection = null;
  const rows = features.map(f => {
    let sectionRow = '';
    if (f.section && f.section !== lastSection) {
      sectionRow = `<tr class="section-row"><td colspan="5">${f.section}</td></tr>`;
      lastSection = f.section;
    }
    return sectionRow + `
    <tr>
      <td class="feature-name">
        <strong>${f.name}</strong>
        ${f.desc ? `<span style="font-size:10px;color:var(--gold)">${f.desc}</span>` : ''}
      </td>
      <td>${icon[f.perms.clerk]}</td>
      <td>${icon[f.perms.staff]}</td>
      <td>${icon[f.perms.manager]}</td>
      <td>${icon[f.perms.exec]}</td>
    </tr>`;
  }).join('');

  el.innerHTML = `
    <div class="card" style="overflow-x:auto">
      <div style="display:flex;justify-content:space-between;align-items:center;margin-bottom:16px">
        <div class="card-title" style="margin:0">ğŸ›¡ æ¨©é™ãƒãƒˆãƒªã‚¯ã‚¹</div>
        ${perms.includes('edit') ? '<button class="btn btn-gold">ç·¨é›†</button>' : ''}
      </div>
      <table class="matrix-table">
        <thead>
          <tr>
            <th class="feature-col">æ©Ÿèƒ½</th>
            <th><div class="role-th role-th-clerk">ğŸ—‚<br>äº‹å‹™å“¡</div></th>
            <th><div class="role-th role-th-staff">ğŸ‘¤<br>ç¤¾å“¡</div></th>
            <th><div class="role-th role-th-manager">â­<br>ç®¡ç†è·</div></th>
            <th><div class="role-th role-th-exec">ğŸ‘‘<br>çµŒå–¶é™£</div></th>
          </tr>
        </thead>
        <tbody>${rows}</tbody>
      </table>
      <div style="margin-top:14px;display:flex;gap:16px;font-size:12px;color:var(--muted)">
        <span><span class="perm-ok">âœ“</span> å¯èƒ½</span>
        <span><span class="perm-no">â€”</span> ä¸å¯</span>
        <span><span class="perm-partial">â–³</span> æ¡ä»¶ä»˜ã</span>
      </div>
    </div>`;
}

// åˆæœŸãƒ•ã‚©ãƒ¼ã‚«ã‚¹
window.addEventListener('load', () => {
  document.getElementById('login-email').focus();
});

// ================================================================
// TOOL LAUNCHER
// ================================================================
const TOOL_META = {
  'screening':    { title:'æ›¸é¡å¯©æŸ»ãƒã‚§ãƒƒã‚¯ã‚·ãƒ¼ãƒˆ',     icon:'ğŸ“‹', desc:'å…¥ä¼šç”³è«‹è€…ã®æ›¸é¡ãƒ»çµŒæ­´ã‚’å¯©æŸ»ã—ã€åˆå¦åˆ¤å®šã‚’è¡Œã„ã¾ã™ã€‚',                 color:'#4f9cf9', url:'coreto-screening.html' },
  'payment-batch':{ title:'æ”¯æ‰•æ˜ç´°æ›¸ãƒ»æŒ¯è¾¼ãƒãƒƒãƒç®¡ç†', icon:'ğŸ’´', desc:'æœˆæ¬¡å ±é…¬æ˜ç´°ã®ç”Ÿæˆãƒ»ç¢ºèªã¨æŒ¯è¾¼ãƒãƒƒãƒã®ç®¡ç†ã‚’è¡Œã„ã¾ã™ã€‚',               color:'#c9a84c', url:'coreto-payment.html' },
  'codes':        { title:'ç‰¹åˆ¥ç´¹ä»‹ã‚³ãƒ¼ãƒ‰ç®¡ç†',         icon:'ğŸ”–', desc:'ç‰¹åˆ¥ã‚³ãƒ¼ãƒ‰ã®ç™ºè¡Œãƒ»æœˆä¼šè²»å…é™¤ãƒ»ã‚«ã‚¹ã‚¿ãƒ å ±é…¬ç‡ã®è¨­å®šã‚’ç®¡ç†ã—ã¾ã™ã€‚',       color:'#a78bfa', url:'coreto-codes.html' },
  'early-quit':   { title:'æ—©æœŸé€€è·ã‚¢ãƒ©ãƒ¼ãƒˆ',           icon:'âš ï¸', desc:'HRæ¡ˆä»¶ã®æ—©æœŸé€€è·ã‚’æ¤œçŸ¥ã—ã€è¿”é‡‘æ¡ä»¶ã«åŸºã¥ã„ã¦å¯¾å¿œã‚’ç®¡ç†ã—ã¾ã™ã€‚',         color:'#f87171', url:'coreto-early-quit.html' },
  'partner-mgmt': { title:'ãƒ‘ãƒ¼ãƒˆãƒŠãƒ¼ç®¡ç†ãƒãƒ¼ã‚¿ãƒ«',     icon:'ğŸ¤', desc:'ãƒ‘ãƒ¼ãƒˆãƒŠãƒ¼ã®ç´¹ä»‹æ¡ˆä»¶ãƒ»å ±é…¬ãƒ»ç´¹ä»‹ã‚³ãƒ¼ãƒ‰ã‚’ç®¡ç†ã—ã¾ã™ã€‚',                   color:'#34d399', url:'coreto-partner.html' },
  'rank-mgmt':    { title:'ãƒ©ãƒ³ã‚¯ç®¡ç†ãƒ€ãƒƒã‚·ãƒ¥ãƒœãƒ¼ãƒ‰',   icon:'â­', desc:'ã‚¨ãƒ¼ã‚¸ã‚§ãƒ³ãƒˆã®ãƒ©ãƒ³ã‚¯ãƒã‚¤ãƒ³ãƒˆãƒ»å®Ÿç¸¾ãƒ»æ˜‡æ ¼çŠ¶æ³ã‚’ç¢ºèªã—ã¾ã™ã€‚',             color:'#c9a84c', url:'coreto-rank.html' },
};

function renderToolLauncher(el, page) {
  const meta = TOOL_META[page.id];
  if (!meta) { el.innerHTML = '<div style="color:var(--muted);padding:20px">ï¼ˆå®Ÿè£…äºˆå®šï¼‰</div>'; return; }
  const permRows = Object.entries(page.perms).map(([role, p]) => {
    const r = ROLES[role];
    const label = p.length ? p.join(' / ') : 'ã‚¢ã‚¯ã‚»ã‚¹ä¸å¯';
    const opacity = p.length ? '1' : '0.4';
    return '<span style="margin-right:16px;opacity:' + opacity + '">' + r.name + 'ï¼š' + label + '</span>';
  }).join('');
  el.innerHTML =
    '<div style="max-width:600px">' +
    '<div style="background:var(--card);border:1px solid var(--border);border-radius:16px;padding:32px;text-align:center;margin-bottom:20px">' +
    '<div style="font-size:56px;margin-bottom:16px">' + meta.icon + '</div>' +
    '<div style="font-size:22px;font-weight:700;margin-bottom:10px">' + meta.title + '</div>' +
    '<div style="font-size:13px;color:var(--muted);line-height:1.8;margin-bottom:24px">' + meta.desc + '</div>' +
    '<button onclick="window.open('' + meta.url + '','_blank')"' +
    ' style="padding:12px 28px;border-radius:10px;font-size:14px;font-weight:700;cursor:pointer;border:none;' +
    'font-family:'Noto Sans JP',sans-serif;background:' + meta.color + ';color:#0a0c10">' +
    'ğŸ”— ãƒ„ãƒ¼ãƒ«ã‚’é–‹ãï¼ˆæ–°ã—ã„ã‚¿ãƒ–ï¼‰' +
    '</button>' +
    '</div>' +
    '<div style="background:rgba(255,255,255,.03);border:1px solid var(--border);border-radius:10px;padding:16px">' +
    '<div style="font-size:10px;color:var(--muted);letter-spacing:1px;text-transform:uppercase;margin-bottom:10px">ã‚¢ã‚¯ã‚»ã‚¹æ¨©é™</div>' +
    '<div style="font-size:12px;color:var(--sub);line-height:2">' + permRows + '</div>' +
    '</div>' +
    '</div>';
}

</script>

<!-- â•â•â•â• ã‚¢ã‚«ã‚¦ãƒ³ãƒˆå‰Šé™¤ãƒ¢ãƒ¼ãƒ€ãƒ« â•â•â•â• -->
<div id="del-overlay" style="display:none;position:fixed;inset:0;background:rgba(0,0,0,.8);
     backdrop-filter:blur(5px);z-index:500;align-items:center;justify-content:center">
  <div style="background:#0f1119;border:1px solid #f87171;border-radius:16px;width:460px;max-width:95vw">
    <div style="padding:16px 22px;border-bottom:1px solid #1e2235;display:flex;align-items:center;gap:10px">
      <span style="font-size:20px">âš ï¸</span>
      <div style="font-family:'Syne',sans-serif;font-size:14px;font-weight:800;color:#f87171">ã‚¢ã‚«ã‚¦ãƒ³ãƒˆå‰Šé™¤</div>
    </div>
    <div style="padding:20px 22px">
      <div style="background:rgba(248,113,113,.08);border:1px solid rgba(248,113,113,.3);border-radius:10px;
                  padding:14px;margin-bottom:16px;font-size:12px;line-height:1.9;color:#e2e6f3">
        âš ï¸ <strong style="color:#f87171">ã“ã®æ“ä½œã¯å–ã‚Šæ¶ˆã›ã¾ã›ã‚“ã€‚</strong><br>
        å¯¾è±¡ã‚¨ãƒ¼ã‚¸ã‚§ãƒ³ãƒˆï¼š<strong id="del-name" style="color:#f87171">â€”</strong>ï¼ˆ<span id="del-id" style="font-family:monospace">â€”</span>ï¼‰<br>
        ä»¥ä¸‹ã®å‡¦ç†ãŒåŒæ™‚ã«å®Ÿè¡Œã•ã‚Œã¾ã™ï¼š<br>
        <span style="color:#fb923c">â€¢ ãƒ­ã‚°ã‚¤ãƒ³ã‚¢ã‚¯ã‚»ã‚¹ã‚’å³æ™‚ç„¡åŠ¹åŒ–</span><br>
        <span style="color:#fb923c">â€¢ æœˆé¡ä¼šè²»ã®è‡ªå‹•å¼•ãè½ã¨ã—ã‚’åœæ­¢</span><br>
        <span style="color:#fb923c">â€¢ é€²è¡Œä¸­æ¡ˆä»¶ã‚’ã€Œã‚¯ãƒ­ãƒ¼ã‚ºã€ã«ç§»è¡Œ</span><br>
        <span style="color:#fb923c">â€¢ å€‹äººæƒ…å ±ã‚’3å¹´é–“ã‚¢ãƒ¼ã‚«ã‚¤ãƒ–å¾Œã«å®Œå…¨æ¶ˆå»</span>
      </div>
      <div style="margin-bottom:14px">
        <div style="font-size:10px;color:#7a849e;margin-bottom:6px;font-weight:600">å‰Šé™¤ç†ç”± <span style="color:#f87171">*</span></div>
        <select id="del-reason" style="width:100%;background:#090b13;border:1px solid #252a3d;border-radius:9px;
                padding:9px 13px;color:#e2e6f3;font-size:12px;font-family:'Noto Sans JP',sans-serif;outline:none">
          <option value="">â€” é¸æŠã—ã¦ãã ã•ã„ â€”</option>
          <option>æœ¬äººã‹ã‚‰ã®ç”³ã—å‡ºï¼ˆç›¸è«‡ãƒ™ãƒ¼ã‚¹ï¼‰</option>
          <option>æ¥­å‹™è¦ç´„é•å</option>
          <option>é•·æœŸä¸æ´»å‹•ï¼ˆ6ãƒ¶æœˆä»¥ä¸Šï¼‰</option>
          <option>ä¸æ­£ãƒ»è©æ¬ºè¡Œç‚º</option>
          <option>ãã®ä»–</option>
        </select>
      </div>
      <div style="margin-bottom:16px">
        <div style="font-size:10px;color:#7a849e;margin-bottom:6px;font-weight:600">
          ç¢ºèªã®ãŸã‚ã€Œ<span style="color:#f87171" id="del-confirm-hint">â€”</span>ã€ã¨å…¥åŠ›ã—ã¦ãã ã•ã„
        </div>
        <input id="del-confirm-input" type="text" placeholder="ã‚¨ãƒ¼ã‚¸ã‚§ãƒ³ãƒˆIDã‚’å…¥åŠ›"
               style="width:100%;background:#090b13;border:1px solid #252a3d;border-radius:9px;
                      padding:9px 13px;color:#f87171;font-size:13px;font-family:'DM Mono',monospace;outline:none;
                      transition:.15s" oninput="checkDelConfirm()">
      </div>
      <div style="display:flex;gap:8px;justify-content:flex-end">
        <button onclick="closeDeleteModal()"
          style="padding:9px 18px;border-radius:9px;font-size:11px;font-weight:700;cursor:pointer;
                 background:transparent;border:1px solid #252a3d;color:#7a849e;
                 font-family:'Noto Sans JP',sans-serif">ã‚­ãƒ£ãƒ³ã‚»ãƒ«</button>
        <button id="del-exec-btn" onclick="execDelete()" disabled
          style="padding:9px 18px;border-radius:9px;font-size:11px;font-weight:700;cursor:pointer;
                 background:rgba(248,113,113,.15);border:1px solid rgba(248,113,113,.4);color:#f87171;
                 font-family:'Noto Sans JP',sans-serif;opacity:.4;transition:.15s">
          ğŸ—‘ ã‚¢ã‚«ã‚¦ãƒ³ãƒˆã‚’å‰Šé™¤ã™ã‚‹
        </button>
      </div>
    </div>
  </div>
</div>

<script>
// â”€â”€ ã‚¢ã‚«ã‚¦ãƒ³ãƒˆå‰Šé™¤ â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
var _delId='', _delName='';

function openDeleteModal(id, name) {
  _delId=id; _delName=name;
  document.getElementById('del-name').textContent=name;
  document.getElementById('del-id').textContent=id;
  document.getElementById('del-confirm-hint').textContent=id;
  document.getElementById('del-confirm-input').value='';
  document.getElementById('del-reason').value='';
  document.getElementById('del-exec-btn').disabled=true;
  document.getElementById('del-exec-btn').style.opacity='.4';
  document.getElementById('del-overlay').style.display='flex';
}
function closeDeleteModal() {
  document.getElementById('del-overlay').style.display='none';
}
function checkDelConfirm() {
  var input=document.getElementById('del-confirm-input').value.trim();
  var reason=document.getElementById('del-reason').value;
  var ok = input===_delId && reason;
  document.getElementById('del-exec-btn').disabled=!ok;
  document.getElementById('del-exec-btn').style.opacity=ok?'1':'.4';
}
function execDelete() {
  var reason=document.getElementById('del-reason').value;
  closeDeleteModal();
  // å®Ÿè¡Œãƒ­ã‚°ã‚’Slackã«é€ä¿¡ï¼ˆãƒ‡ãƒ¢ï¼‰
  console.log('Slack #HQ-admin: ã‚¢ã‚«ã‚¦ãƒ³ãƒˆå‰Šé™¤å®Ÿè¡Œ '+_delId+' '+_delName+' / ç†ç”±: '+reason);
  setTimeout(function(){
    alert(
      'âœ… ã‚¢ã‚«ã‚¦ãƒ³ãƒˆã‚’å‰Šé™¤ã—ã¾ã—ãŸã€‚\n\n' +
      'ã‚¨ãƒ¼ã‚¸ã‚§ãƒ³ãƒˆï¼š'+_delName+'ï¼ˆ'+_delId+'ï¼‰\n' +
      'å‰Šé™¤ç†ç”±ï¼š'+reason+'\n\n' +
      'å®Ÿè¡Œå†…å®¹ï¼š\n' +
      'â€¢ ãƒ­ã‚°ã‚¤ãƒ³ã‚¢ã‚¯ã‚»ã‚¹ã‚’ç„¡åŠ¹åŒ–\n' +
      'â€¢ æœˆé¡ä¼šè²»ã®è‡ªå‹•å¼•ãè½ã¨ã—ã‚’åœæ­¢\n' +
      'â€¢ é€²è¡Œä¸­æ¡ˆä»¶ã‚’ã‚¯ãƒ­ãƒ¼ã‚º\n' +
      'â€¢ Slackã® #HQ-admin ã«å‰Šé™¤ãƒ­ã‚°ã‚’è¨˜éŒ²\n\n' +
      'å€‹äººæƒ…å ±ã¯3å¹´é–“ã‚¢ãƒ¼ã‚«ã‚¤ãƒ–å¾Œã«å®Œå…¨æ¶ˆå»ã•ã‚Œã¾ã™ã€‚'
    );
  }, 400);
}

// â”€â”€ ç´¹ä»‹ãƒªãƒ³ã‚¯ãƒ¢ãƒ¼ãƒ€ãƒ« â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
var _refCurrentCode = '';
function openRefModal() {
  var overlay = document.getElementById('ref-modal-overlay');
  var selector = document.getElementById('ref-code-selector');
  var isExec = (typeof session !== 'undefined' && session && session.hqRole === 'exec')
            || (typeof CURRENT_USER !== 'undefined' && CURRENT_USER && CURRENT_USER.hqRole === 'exec');
  var agentId = (typeof session !== 'undefined' && session && session.userId) ? session.userId
              : (typeof ME !== 'undefined' && ME && ME.id) ? ME.id
              : (typeof AGENT !== 'undefined' && AGENT && AGENT.id) ? AGENT.id : '10012';
  if (isExec) {
    var SPECIAL = ['FOUNDER2026','WELCOME2026','GOLD_START','HR_PRO75'];
    var opts = SPECIAL.map(function(c){ return '<option value="'+c+'">â­ '+c+'</option>'; }).join('');
    selector.innerHTML =
      '<div style="margin-bottom:12px"><div style="font-size:10px;color:var(--sub);font-weight:600;margin-bottom:5px">ã‚³ãƒ¼ãƒ‰ç¨®åˆ¥</div>'
      +'<select id="ref-code-select" onchange="updateRefLink()" style="width:100%;padding:8px 10px;background:var(--card2);border:1px solid var(--border2);border-radius:8px;color:var(--text);font-size:12px;font-family:inherit">'
      +'<option value="'+agentId+'">è‡ªåˆ†ã®IDï¼ˆ'+agentId+'ï¼‰</option>'
      +'<optgroup label="â”€â”€ ç‰¹åˆ¥ã‚³ãƒ¼ãƒ‰ â”€â”€">'+opts+'</optgroup>'
      +'</select></div>';
    _refCurrentCode = agentId;
  } else {
    selector.innerHTML =
      '<div style="display:flex;align-items:center;gap:8px;margin-bottom:12px;padding:8px 12px;background:rgba(201,168,76,.06);border:1px solid rgba(201,168,76,.2);border-radius:8px">'
      +'<span style="font-size:11px;color:var(--muted)">ç´¹ä»‹ã‚³ãƒ¼ãƒ‰ï¼š</span>'
      +'<span style="font-family:\'DM Mono\',monospace;font-size:13px;font-weight:700;color:var(--gold)">'+agentId+'</span>'
      +'</div>';
    _refCurrentCode = agentId;
  }
  updateRefLink();
  overlay.classList.add('open');
}
function updateRefLink() {
  var sel = document.getElementById('ref-code-select');
  if (sel) _refCurrentCode = sel.value;
  var base = location.origin + location.pathname.replace(/[^/]*$/, '') + 'coreto-agent-signup.html';
  var url = base + '?ref=' + encodeURIComponent(_refCurrentCode);
  document.getElementById('ref-url-display').textContent = url;
}
function closeRefModal() {
  document.getElementById('ref-modal-overlay').classList.remove('open');
}
function copyRefLink() {
  var url = document.getElementById('ref-url-display').textContent;
  navigator.clipboard.writeText(url).then(function() {
    var btn = document.querySelector('.ref-copy-btn');
    btn.textContent = 'âœ… ã‚³ãƒ”ãƒ¼ã—ã¾ã—ãŸ';
    setTimeout(function(){ btn.textContent = 'ğŸ“‹ ã‚³ãƒ”ãƒ¼'; }, 2000);
  }).catch(function() {
    var ta = document.createElement('textarea');
    ta.value = url; document.body.appendChild(ta); ta.select();
    document.execCommand('copy'); document.body.removeChild(ta);
  });
}
</script>

<div id="ref-modal-overlay" onclick="if(event.target===this)closeRefModal()">
  <div id="ref-modal">
    <div class="ref-mhdr">
      <div class="ref-mhdr-t">ğŸ”— ç´¹ä»‹ãƒªãƒ³ã‚¯ç™ºè¡Œ</div>
      <button onclick="closeRefModal()" style="background:none;border:none;color:var(--muted);font-size:20px;cursor:pointer;line-height:1">Ã—</button>
    </div>
    <div class="ref-mbody">
      <div style="font-size:11px;color:var(--sub);margin-bottom:14px;line-height:1.8">ã“ã®ãƒªãƒ³ã‚¯ã‹ã‚‰å…¥ä¼šã™ã‚‹ã¨ç´¹ä»‹ã‚³ãƒ¼ãƒ‰ãŒè‡ªå‹•å…¥åŠ›ã•ã‚Œã¾ã™ã€‚</div>
      <div id="ref-code-selector"></div>
      <div style="font-size:10px;color:var(--muted);margin-bottom:4px;font-weight:600;letter-spacing:.5px">ç™ºè¡Œãƒªãƒ³ã‚¯</div>
      <div class="ref-url" id="ref-url-display">â€”</div>
      <button class="ref-copy-btn" onclick="copyRefLink()">ğŸ“‹ ã‚³ãƒ”ãƒ¼</button>
    </div>
  </div>
</div>

<button id="ref-float-btn" onclick="openRefModal()">ğŸ”— ç´¹ä»‹ãƒªãƒ³ã‚¯ç™ºè¡Œ</button>
</body>
</html>
