<!DOCTYPE html>
<html lang="ja">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>CORETO ãƒãƒ¼ã‚³ãƒ¼ãƒ‰ã‚¹ã‚­ãƒ£ãƒ³è¿½è·¡ã‚·ã‚¹ãƒ†ãƒ </title>
<script src="https://cdnjs.cloudflare.com/ajax/libs/jsbarcode/3.11.5/JsBarcode.all.min.js"></script>
<style>
@import url('https://fonts.googleapis.com/css2?family=Noto+Sans+JP:wght@300;400;500;700&family=DM+Mono:wght@400;500&display=swap');

*{box-sizing:border-box;margin:0;padding:0;}
:root{
  --bg:#0d0f14;--card:#161921;--hover:#1e2230;--border:#252a38;
  --gold:#c9a84c;--gold-l:#e8c96a;--muted:#6b7280;--sub:#9ca3af;
  --green:#22c55e;--blue:#3b82f6;--orange:#f59e0b;--red:#ef4444;--purple:#a855f7;
}
body{font-family:'Noto Sans JP',sans-serif;background:var(--bg);color:#e8eaf0;min-height:100vh;}

.header{background:#0a0c10;border-bottom:1px solid var(--border);padding:16px 28px;display:flex;align-items:center;justify-content:space-between;}
.logo{font-family:'DM Mono',monospace;font-size:20px;color:var(--gold);letter-spacing:3px;}
.header-sub{font-size:11px;color:var(--muted);margin-top:2px;}

.tabs{background:#0a0c10;border-bottom:1px solid var(--border);padding:0 28px;display:flex;}
.tab{padding:11px 18px;font-size:12px;color:var(--muted);cursor:pointer;border-bottom:2px solid transparent;transition:all .15s;white-space:nowrap;background:none;border-top:none;border-left:none;border-right:none;font-family:'Noto Sans JP',sans-serif;}
.tab:hover{color:#e8eaf0;}
.tab.active{color:var(--gold);border-bottom-color:var(--gold);}

.page{display:none;padding:28px;max-width:1300px;margin:0 auto;}
.page.active{display:block;}

.grid2{display:grid;grid-template-columns:1fr 1fr;gap:20px;}
.grid3{display:grid;grid-template-columns:1fr 1fr 1fr;gap:16px;}

.card{background:var(--card);border:1px solid var(--border);border-radius:10px;padding:20px;margin-bottom:16px;}
.card-title{font-size:14px;font-weight:700;margin-bottom:14px;display:flex;align-items:center;gap:8px;}
.s-label{font-size:11px;color:var(--muted);letter-spacing:1.2px;text-transform:uppercase;margin-bottom:12px;margin-top:24px;}

/* ===== SCAN DESK ===== */
.scan-desk{
  background:linear-gradient(135deg,#0f1520 0%,#161921 100%);
  border:2px solid var(--border);
  border-radius:14px;
  padding:28px;
  position:relative;
  overflow:hidden;
}
.scan-desk::before{
  content:'';position:absolute;top:-40px;right:-40px;
  width:200px;height:200px;
  background:radial-gradient(circle,rgba(201,168,76,0.06) 0%,transparent 70%);
  border-radius:50%;
}

.status-selector{display:flex;gap:10px;margin-bottom:24px;flex-wrap:wrap;}
.status-btn{
  padding:10px 18px;border-radius:8px;font-size:13px;font-weight:600;
  cursor:pointer;border:2px solid var(--border);background:var(--hover);
  color:var(--sub);transition:all .15s;font-family:'Noto Sans JP',sans-serif;
  display:flex;align-items:center;gap:7px;
}
.status-btn:hover{border-color:rgba(201,168,76,0.4);color:#e8eaf0;}
.status-btn.active-shipped{border-color:var(--blue);background:rgba(59,130,246,0.12);color:var(--blue);}
.status-btn.active-received{border-color:var(--green);background:rgba(34,197,94,0.12);color:var(--green);}
.status-btn.active-stored{border-color:var(--purple);background:rgba(168,85,247,0.12);color:var(--purple);}
.status-btn.active-rejected{border-color:var(--red);background:rgba(239,68,68,0.12);color:var(--red);}

.scan-input-area{
  background:#0a0c10;
  border:2px dashed var(--border);
  border-radius:10px;
  padding:20px;
  display:flex;
  align-items:center;
  gap:16px;
  transition:border-color .2s;
  margin-bottom:20px;
  cursor:text;
}
.scan-input-area.focused{border-color:var(--gold);border-style:solid;}
.scan-input-area.success{border-color:var(--green);border-style:solid;}
.scan-input-area.error{border-color:var(--red);border-style:solid;}

.scan-icon{font-size:36px;flex-shrink:0;}
.scan-input-inner{flex:1;}
.scan-hint{font-size:12px;color:var(--muted);margin-bottom:6px;}
.scan-input{
  width:100%;background:transparent;border:none;outline:none;
  font-family:'DM Mono',monospace;font-size:16px;color:#e8eaf0;
  caret-color:var(--gold);
}
.scan-input::placeholder{color:#374151;}

/* ã‚¹ã‚­ãƒ£ãƒ³çµæœ */
.scan-result{
  background:var(--hover);border:1px solid var(--border);
  border-radius:10px;padding:16px;
  display:none;
}
.scan-result.visible{display:block;animation:slideIn .2s ease;}
@keyframes slideIn{from{opacity:0;transform:translateY(-8px);}to{opacity:1;transform:none;}}

.result-header{display:flex;align-items:center;justify-content:space-between;margin-bottom:12px;}
.result-case{font-family:'DM Mono',monospace;font-size:12px;color:var(--gold);}
.result-status-badge{padding:4px 12px;border-radius:20px;font-size:11px;font-weight:700;}

.result-grid{display:grid;grid-template-columns:1fr 1fr 1fr;gap:10px;}
.result-field{}
.result-key{font-size:10px;color:var(--muted);margin-bottom:2px;}
.result-val{font-size:13px;font-weight:500;}

.confirm-btn{
  width:100%;margin-top:14px;padding:12px;
  background:var(--gold);color:#0a0c10;
  border:none;border-radius:8px;font-size:13px;font-weight:700;
  cursor:pointer;font-family:'Noto Sans JP',sans-serif;
  transition:background .15s;
}
.confirm-btn:hover{background:var(--gold-l);}

/* ã‚¹ã‚­ãƒ£ãƒ³å±¥æ­´ */
.history-row{
  display:flex;align-items:center;gap:12px;
  padding:10px 0;border-bottom:1px solid rgba(37,42,56,0.5);
  font-size:12px;
}
.history-row:last-child{border-bottom:none;}
.h-time{font-family:'DM Mono',monospace;font-size:11px;color:var(--muted);min-width:50px;}
.h-code{font-family:'DM Mono',monospace;color:var(--gold);min-width:160px;}
.h-case{color:var(--sub);flex:1;}
.h-badge{padding:3px 10px;border-radius:20px;font-size:10px;font-weight:600;white-space:nowrap;}

/* ===== LABEL PREVIEW ===== */
/* æ„Ÿç†±ãƒ©ãƒ™ãƒ«ï¼ˆ102mmÃ—62mm ã‚’ç”»é¢è¡¨ç¤º: 1mm=3pxï¼‰ */
.thermal-label{
  width:306px;min-height:200px;
  background:white;border-radius:4px;
  padding:9px 11px;
  font-family:'Noto Sans JP',sans-serif;
  color:#111;
  margin:0 auto;
  box-shadow:0 4px 20px rgba(0,0,0,0.5);
  display:flex;flex-direction:column;
  position:relative;
}
.tl-type-bar{font-size:7px;font-weight:700;letter-spacing:0.5px;padding:2px 7px;border-radius:2px;display:inline-block;margin-bottom:5px;width:fit-content;}
.tl-bar-blue{background:#dbeafe;color:#1d4ed8;}
.tl-bar-purple{background:#ede9fe;color:#6d28d9;}
.tl-bar-amber{background:#fef3c7;color:#b45309;}
.tl-to-label{font-size:6px;color:#9ca3af;letter-spacing:0.5px;margin-bottom:1px;}
.tl-postal{font-size:10px;color:#374151;letter-spacing:2px;margin-bottom:1px;}
.tl-address{font-size:7px;color:#374151;line-height:1.5;margin-bottom:1px;}
.tl-name{font-size:13px;font-weight:700;color:#111827;line-height:1.2;}
.tl-honorific{font-size:9px;font-weight:400;}
.tl-divider{border:none;border-top:0.5px solid #e5e7eb;margin:4px 0;}
.tl-from-label{font-size:6px;color:#9ca3af;letter-spacing:0.5px;margin-bottom:1px;}
.tl-from-name{font-size:7.5px;font-weight:700;color:#374151;line-height:1.4;}
.tl-from-addr{font-size:6.5px;color:#6b7280;line-height:1.4;}
.tl-from-tel{font-size:6.5px;color:#6b7280;}

/* ãƒãƒ¼ã‚³ãƒ¼ãƒ‰ã‚¨ãƒªã‚¢ */
.tl-barcode-area{
  margin-top:5px;
  border-top:0.5px solid #f0f0f0;
  padding-top:4px;
  display:flex;
  align-items:center;
  justify-content:space-between;
  gap:6px;
}
.tl-barcode-svg{flex:1;}
.tl-barcode-meta{text-align:right;flex-shrink:0;}
.tl-barcode-id{font-family:'DM Mono',monospace;font-size:6.5px;color:#374151;font-weight:600;}
.tl-barcode-type{font-size:6px;color:#9ca3af;}

/* ãƒ©ãƒ™ãƒ«é¸æŠãƒœã‚¿ãƒ³ */
.label-select-row{display:flex;gap:8px;margin-bottom:16px;flex-wrap:wrap;}
.label-select-btn{
  padding:7px 14px;border-radius:6px;font-size:12px;font-weight:500;
  cursor:pointer;border:1px solid var(--border);background:var(--hover);
  color:var(--sub);transition:all .15s;font-family:'Noto Sans JP',sans-serif;
}
.label-select-btn:hover{border-color:rgba(201,168,76,0.4);color:#e8eaf0;}
.label-select-btn.active{border-color:var(--gold);background:rgba(201,168,76,0.1);color:var(--gold);}

/* ===== KINTONE SETUP ===== */
.step{display:flex;gap:14px;align-items:flex-start;padding:14px 0;border-bottom:1px solid rgba(37,42,56,0.5);}
.step:last-child{border-bottom:none;}
.step-num{width:26px;height:26px;background:var(--gold);border-radius:50%;display:flex;align-items:center;justify-content:center;font-size:11px;font-weight:700;color:#0a0c10;flex-shrink:0;margin-top:1px;}
.step-title{font-size:13px;font-weight:600;margin-bottom:4px;}
.step-desc{font-size:12px;color:var(--sub);line-height:1.8;}
code{background:var(--hover);padding:1px 6px;border-radius:3px;font-size:11px;color:var(--gold);font-family:'DM Mono',monospace;}
.hint{background:rgba(201,168,76,0.06);border:1px solid rgba(201,168,76,0.2);border-radius:6px;padding:12px;font-size:12px;color:var(--sub);line-height:1.7;margin-top:12px;}

/* ã‚¹ãƒ†ãƒ¼ã‚¿ã‚¹ãƒãƒƒã‚¸ */
.badge-shipped{background:rgba(59,130,246,0.15);color:var(--blue);}
.badge-received{background:rgba(34,197,94,0.15);color:var(--green);}
.badge-stored{background:rgba(168,85,247,0.15);color:var(--purple);}
.badge-rejected{background:rgba(239,68,68,0.15);color:var(--red);}

/* ã‚¿ã‚¤ãƒ ãƒ©ã‚¤ãƒ³ */
.tl-item{display:flex;gap:12px;padding-bottom:14px;position:relative;}
.tl-item::before{content:'';position:absolute;left:6px;top:14px;width:1px;height:100%;background:var(--border);}
.tl-item:last-child::before{display:none;}
.tl-dot{width:13px;height:13px;border-radius:50%;flex-shrink:0;margin-top:2px;}
.tl-dot-done{background:var(--green);}
.tl-dot-active{background:var(--gold);box-shadow:0 0 8px rgba(201,168,76,0.5);}
.tl-dot-pending{background:var(--border);}
.tl-text{font-size:12px;font-weight:500;}
.tl-sub{font-size:11px;color:var(--muted);margin-top:2px;}

/* æµã‚Œå›³ */
.flow-row{display:flex;align-items:center;gap:0;flex-wrap:wrap;margin-bottom:16px;}
.flow-box{background:var(--hover);border:1px solid var(--border);border-radius:6px;padding:9px 14px;font-size:12px;text-align:center;min-width:100px;}
.flow-box.hl{border-color:var(--gold);background:rgba(201,168,76,0.08);color:var(--gold);}
.flow-box.hl-blue{border-color:var(--blue);background:rgba(59,130,246,0.08);color:var(--blue);}
.flow-box.hl-green{border-color:var(--green);background:rgba(34,197,94,0.08);color:var(--green);}
.flow-arr{color:var(--muted);font-size:16px;padding:0 8px;}

/* ãƒˆãƒ¼ã‚¹ãƒˆ */
.toast{
  position:fixed;bottom:28px;left:50%;transform:translateX(-50%) translateY(20px);
  background:rgba(34,197,94,0.15);border:1px solid var(--green);
  color:var(--green);padding:12px 24px;border-radius:8px;
  font-size:13px;font-weight:600;
  opacity:0;transition:all .3s;pointer-events:none;z-index:100;
  white-space:nowrap;
}
.toast.show{opacity:1;transform:translateX(-50%) translateY(0);}
.toast.error-toast{background:rgba(239,68,68,0.15);border-color:var(--red);color:var(--red);}
</style>
</head>
<body>

<div class="header">
  <div>
    <div class="logo">CORETO
  <button onclick="window.location.href='coreto-admin-rbac.html'"
            style="font-size:10px;padding:5px 12px;border-radius:6px;border:1px solid var(--border2);
            background:transparent;color:var(--muted);cursor:pointer;font-family:'Noto Sans JP',sans-serif">
    â† ç®¡ç†ãƒãƒ¼ã‚¿ãƒ«
  </button>
</div>
    <div class="header-sub">ãƒãƒ¼ã‚³ãƒ¼ãƒ‰ã‚¹ã‚­ãƒ£ãƒ³è¿½è·¡ã‚·ã‚¹ãƒ†ãƒ  ï¼ Honeywell Voyager 1200g å¯¾å¿œ</div>
  </div>
  <div style="font-size:11px;color:var(--muted)">Kintone é€£æº</div>
</div>

<div class="tabs">
  <button class="tab active" onclick="showTab('scan')">ğŸ“¡ ã‚¹ã‚­ãƒ£ãƒ³ãƒ‡ã‚¹ã‚¯</button>
  <button class="tab" onclick="showTab('receive')">ğŸ“¬ æ›¸é¡å—å–</button>
  <button class="tab" onclick="showTab('label')">ğŸ· ãƒ©ãƒ™ãƒ«ãƒ—ãƒ¬ãƒ“ãƒ¥ãƒ¼</button>
  <button class="tab" onclick="showTab('tracking')">ğŸ“¦ è¿½è·¡ä¸€è¦§</button>
  <button class="tab" onclick="showTab('postal')">ğŸšš éƒµä¾¿è¿½è·¡API</button>
  <button class="tab" onclick="showTab('setup')">âš™ï¸ å°å…¥æ‰‹é †</button>
</div>



<!-- ================================================================ -->
<!-- TAB: æ›¸é¡å—å–ãƒ»ç®¡ç†ã‚¦ã‚£ã‚¶ãƒ¼ãƒ‰ -->
<!-- ================================================================ -->
<div id="tab-receive" class="page">
<div style="display:grid;grid-template-columns:1fr 340px;gap:20px;align-items:start">

<!-- â•â•â• å·¦: ã‚¦ã‚£ã‚¶ãƒ¼ãƒ‰ â•â•â• -->
<div id="rcv-wizard">

  <!-- â”€â”€ ã‚¹ãƒ†ãƒƒãƒ—ã‚¤ãƒ³ã‚¸ã‚±ãƒ¼ã‚¿ãƒ¼ â”€â”€ -->
  <div id="rcv-steps" style="display:flex;align-items:center;gap:0;margin-bottom:20px;background:var(--card);border:1px solid var(--border);border-radius:10px;padding:12px 16px;overflow-x:auto">
    <div class="rcv-step active" id="rstep-0" onclick="rcvGoStep(0)">â‘  åˆ°ç€ç™»éŒ²</div>
    <div class="rcv-step-arrow">â€º</div>
    <div class="rcv-step" id="rstep-1">â‘¡ ã‚¹ã‚­ãƒ£ãƒ³</div>
    <div class="rcv-step-arrow">â€º</div>
    <div class="rcv-step" id="rstep-2">â‘¢ AGé€£çµ¡</div>
    <div class="rcv-step-arrow">â€º</div>
    <div class="rcv-step" id="rstep-3">â‘£ å¯¾å¿œ</div>
    <div class="rcv-step-arrow">â€º</div>
    <div class="rcv-step" id="rstep-4">â‘¤ å®Œäº†</div>
  </div>

  <!-- â•â• STEP 0: åˆ°ç€ç™»éŒ² â•â• -->
  <div id="rcv-s0" class="rcv-panel">
    <div class="rcv-panel-title">ğŸ“¬ æ›¸é¡åˆ°ç€ç™»éŒ²</div>

    <!-- æ¡ˆä»¶æ¤œç´¢ -->
    <div class="rcv-field-label">STEP 1 â€” æ¡ˆä»¶ã‚’ç‰¹å®š</div>
    <div style="display:flex;gap:8px;margin-bottom:10px">
      <input id="rcv-search" type="text" placeholder="ç‰©ä»¶å / ã‚¯ãƒ©ã‚¤ã‚¢ãƒ³ãƒˆå / ç®¡ç†ä¼šç¤¾å / æ¡ˆä»¶ID"
        oninput="rcvFilterList()"
        style="flex:1;background:var(--hover);border:1px solid var(--border);border-radius:7px;padding:9px 12px;color:#e8eaf0;font-size:12px;font-family:'Noto Sans JP',sans-serif;outline:none">
    </div>
    <div id="rcv-case-list" style="max-height:220px;overflow-y:auto;display:flex;flex-direction:column;gap:5px;margin-bottom:14px"></div>

    <!-- é¸æŠæ¸ˆã¿æ¡ˆä»¶ -->
    <div id="rcv-case-selected" style="display:none;background:rgba(201,168,76,.07);border:1px solid rgba(201,168,76,.35);border-radius:8px;padding:12px;margin-bottom:14px">
      <div style="font-size:10px;color:var(--gold);font-weight:700;margin-bottom:6px">âœ… é¸æŠã—ãŸæ¡ˆä»¶</div>
      <div id="rcv-case-selected-info" style="font-size:12px;display:grid;grid-template-columns:1fr 1fr;gap:6px"></div>
      <button onclick="rcvClearCase()" style="margin-top:8px;background:transparent;border:1px solid var(--border);color:var(--muted);border-radius:5px;padding:3px 10px;cursor:pointer;font-size:10px;font-family:inherit">âœ• è§£é™¤</button>
    </div>

    <!-- æ›¸é¡ç¨®åˆ¥ -->
    <div class="rcv-field-label">STEP 2 â€” åˆ°ç€ã—ãŸæ›¸é¡ã®ç¨®åˆ¥ï¼ˆè¤‡æ•°é¸æŠå¯ï¼‰</div>
    <div style="display:grid;grid-template-columns:1fr 1fr;gap:8px;margin-bottom:14px" id="doc-type-grid">
      <div class="doc-type-btn" id="dt-contract" onclick="rcvToggleDocType('contract')">
        <div style="font-size:22px">ğŸ“„</div>
        <div style="font-size:12px;font-weight:700">å¥‘ç´„æ›¸</div>
        <div style="font-size:10px;color:var(--muted)">ã‚¹ã‚­ãƒ£ãƒ³å¿…é ˆ</div>
      </div>
      <div class="doc-type-btn" id="dt-key" onclick="rcvToggleDocType('key')">
        <div style="font-size:22px">ğŸ”‘</div>
        <div style="font-size:12px;font-weight:700">éµ</div>
        <div style="font-size:10px;color:var(--muted)">å†™çœŸã§è¨˜éŒ²</div>
      </div>
      <div class="doc-type-btn" id="dt-additional" onclick="rcvToggleDocType('additional')">
        <div style="font-size:22px">ğŸ“</div>
        <div style="font-size:12px;font-weight:700">è¿½åŠ æ›¸é¡</div>
        <div style="font-size:10px;color:var(--muted)">ã‚¹ã‚­ãƒ£ãƒ³æ¨å¥¨</div>
      </div>
      <div class="doc-type-btn" id="dt-other" onclick="rcvToggleDocType('other')">
        <div style="font-size:22px">ğŸ“¦</div>
        <div style="font-size:12px;font-weight:700">ãã®ä»–</div>
        <div style="font-size:10px;color:var(--muted)">ãƒ¡ãƒ¢ã‚’è¨˜å…¥</div>
      </div>
    </div>

    <!-- ãƒ¡ãƒ¢ -->
    <div class="rcv-field-label">å‚™è€ƒãƒ»ç®¡ç†ä¼šç¤¾ã‹ã‚‰ã®é€šçŸ¥äº‹é …</div>
    <textarea id="rcv-memo" rows="2" placeholder="ä¾‹: ç®¡ç†ä¼šç¤¾ã‚ˆã‚Šã€Œ2éƒ¨é€ä»˜ã€ã¨ã®é€£çµ¡ã‚ã‚Š"
      style="width:100%;background:var(--hover);border:1px solid var(--border);border-radius:7px;padding:8px 12px;color:#e8eaf0;font-size:12px;font-family:'Noto Sans JP',sans-serif;resize:vertical;outline:none;margin-bottom:14px"></textarea>

    <button id="rcv-next-0" onclick="rcvStep0Next()" disabled
      style="width:100%;padding:12px;background:var(--gold);color:#0d0f14;border:none;border-radius:8px;font-weight:700;font-size:13px;cursor:pointer;font-family:inherit;opacity:.4;transition:opacity .2s">
      æ¬¡ã¸ï¼šã‚¹ã‚­ãƒ£ãƒ³ â†’
    </button>
  </div>

  <!-- â•â• STEP 1: ã‚¹ã‚­ãƒ£ãƒ³ãƒ»æ’®å½± â•â• -->
  <div id="rcv-s1" class="rcv-panel" style="display:none">
    <div class="rcv-panel-title">ğŸ“· æ›¸é¡ã‚¹ã‚­ãƒ£ãƒ³ãƒ»æ’®å½±</div>

    <div id="scan-doc-list" style="display:flex;flex-direction:column;gap:12px;margin-bottom:16px"></div>

    <!-- ã‚¹ã‚­ãƒ£ãƒŠãƒ¼å…¥åŠ›ã‚¨ãƒªã‚¢ -->
    <div class="card" style="margin-bottom:14px">
      <div class="card-title" style="font-size:12px">ã‚¹ã‚­ãƒ£ãƒŠãƒ¼ / ã‚«ãƒ¡ãƒ©å…¥åŠ›</div>
      <div style="border:2px dashed var(--border);border-radius:8px;padding:20px;text-align:center;cursor:pointer;transition:border-color .2s"
        id="scan-drop-zone" onclick="triggerScanUpload()" ondragover="event.preventDefault()" ondrop="handleScanDrop(event)">
        <div style="font-size:28px;margin-bottom:8px">ğŸ“„</div>
        <div style="font-size:12px;color:var(--sub);margin-bottom:6px">ã‚¯ãƒªãƒƒã‚¯ã—ã¦ãƒ•ã‚¡ã‚¤ãƒ«ã‚’é¸æŠã€ã¾ãŸã¯ãƒ‰ãƒ­ãƒƒãƒ—</div>
        <div style="font-size:10px;color:var(--muted)">PDF / JPEG / PNG å¯¾å¿œ â€” ã‚¹ã‚­ãƒ£ãƒŠãƒ¼ã‹ã‚‰ç›´æ¥ä¿å­˜å¯</div>
        <input type="file" id="scan-file-input" multiple accept=".pdf,.jpg,.jpeg,.png" style="display:none" onchange="handleScanFiles(event)">
      </div>
      <div id="scan-file-list" style="margin-top:10px;font-size:11px;color:var(--sub)"></div>
    </div>

    <div style="display:flex;gap:8px">
      <button onclick="rcvGoStep(0)" style="flex:1;padding:10px;background:transparent;border:1px solid var(--border);color:var(--muted);border-radius:8px;cursor:pointer;font-size:12px;font-family:inherit">â† æˆ»ã‚‹</button>
      <button id="rcv-next-1" onclick="rcvStep1Next()"
        style="flex:2;padding:10px;background:var(--gold);color:#0d0f14;border:none;border-radius:8px;font-weight:700;font-size:12px;cursor:pointer;font-family:inherit">
        æ¬¡ã¸ï¼šAGé€£çµ¡ â†’
      </button>
    </div>
    <div style="text-align:center;margin-top:8px">
      <button onclick="rcvStep1Skip()" style="background:transparent;border:none;color:var(--muted);font-size:11px;cursor:pointer;font-family:inherit;text-decoration:underline">ã‚¹ã‚­ãƒ£ãƒ³ã‚’ã‚¹ã‚­ãƒƒãƒ—ã—ã¦é€²ã‚€</button>
    </div>
  </div>

  <!-- â•â• STEP 2: AGé€£çµ¡ï¼ˆSlackï¼‰ â•â• -->
  <div id="rcv-s2" class="rcv-panel" style="display:none">
    <div class="rcv-panel-title">ğŸ’¬ ã‚¨ãƒ¼ã‚¸ã‚§ãƒ³ãƒˆã¸Slacké€šçŸ¥</div>

    <!-- é€šçŸ¥ãƒ—ãƒ¬ãƒ“ãƒ¥ãƒ¼ -->
    <div id="slack-preview" style="background:#1e1f26;border:1px solid #3f3f46;border-radius:10px;padding:14px;margin-bottom:14px;font-size:12px">
      <div style="display:flex;align-items:center;gap:8px;margin-bottom:10px">
        <div style="width:32px;height:32px;border-radius:6px;background:var(--gold);display:flex;align-items:center;justify-content:center;font-size:16px">C</div>
        <div>
          <div style="font-weight:700;font-size:12px">CORETO Bot</div>
          <div style="font-size:10px;color:var(--muted)">ä»Šæ—¥</div>
        </div>
      </div>
      <div id="slack-msg-preview" style="line-height:1.7;color:#dcddde"></div>
    </div>

    <!-- é€ä¿¡å…ˆ -->
    <div class="rcv-field-label">é€šçŸ¥å…ˆã‚¨ãƒ¼ã‚¸ã‚§ãƒ³ãƒˆ</div>
    <div id="rcv-agent-target" style="background:var(--hover);border:1px solid var(--border);border-radius:7px;padding:10px 12px;font-size:12px;margin-bottom:14px;color:var(--sub)">â€”</div>

    <!-- å›ç­”æœŸé™ -->
    <div class="rcv-field-label">å›ç­”æœŸé™ï¼ˆã“ã®æ™‚é–“ã‚’è¶…ãˆã‚‹ã¨è‡ªå‹•éƒµé€ï¼‰</div>
    <div style="display:flex;gap:8px;margin-bottom:14px">
      <select id="rcv-deadline" style="flex:1;background:var(--hover);border:1px solid var(--border);border-radius:7px;padding:8px 12px;color:#e8eaf0;font-size:12px;font-family:inherit">
        <option value="2">2æ™‚é–“å¾Œ</option>
        <option value="4" selected>4æ™‚é–“å¾Œ</option>
        <option value="24">ç¿Œæ—¥ã¾ã§</option>
        <option value="48">2æ—¥å¾Œã¾ã§</option>
      </select>
    </div>

    <button onclick="rcvSendSlack()" id="btn-send-slack"
      style="width:100%;padding:12px;background:#4a154b;color:#fff;border:none;border-radius:8px;font-weight:700;font-size:13px;cursor:pointer;font-family:inherit;margin-bottom:8px">
      ğŸ“¤ Slackã§é€šçŸ¥ã‚’é€ä¿¡
    </button>
    <div style="display:flex;gap:8px">
      <button onclick="rcvGoStep(1)" style="flex:1;padding:8px;background:transparent;border:1px solid var(--border);color:var(--muted);border-radius:7px;cursor:pointer;font-size:11px;font-family:inherit">â† æˆ»ã‚‹</button>
      <button onclick="rcvForceMailMode()" style="flex:1;padding:8px;background:transparent;border:1px solid rgba(59,130,246,.4);color:var(--blue);border-radius:7px;cursor:pointer;font-size:11px;font-family:inherit">ç¢ºèªã›ãšéƒµé€ã™ã‚‹</button>
    </div>
  </div>

  <!-- â•â• STEP 3: å¯¾å¿œãƒ•ãƒ­ãƒ¼ï¼ˆåˆ†å²ï¼‰ â•â• -->
  <div id="rcv-s3" class="rcv-panel" style="display:none">
    <div class="rcv-panel-title" id="s3-title">â‘£ å¯¾å¿œ</div>

    <!-- --- 3a: éƒµé€ãƒ•ãƒ­ãƒ¼ --- -->
    <div id="s3-mail" style="display:none">
      <div style="background:rgba(59,130,246,.08);border:1px solid rgba(59,130,246,.3);border-radius:8px;padding:12px;margin-bottom:14px;font-size:12px;color:var(--blue)">
        ğŸ“¤ éƒµé€ãƒ¢ãƒ¼ãƒ‰<span id="s3-mail-reason" style="color:var(--muted);margin-left:8px"></span>
      </div>

      <div class="rcv-field-label">å¾€è·¯ãƒ¬ã‚¿ãƒ¼ãƒ‘ãƒƒã‚¯è¿½è·¡ç•ªå·</div>
      <div style="display:flex;gap:8px;margin-bottom:6px">
        <div style="flex:1;background:var(--hover);border:1px solid var(--border);border-radius:7px;padding:8px 12px;cursor:text" onclick="this.querySelector('input').focus()">
          <input id="mail-outbound-no" type="text" maxlength="12" placeholder="ã‚¹ã‚­ãƒ£ãƒ³ã¾ãŸã¯12æ¡æ‰‹å…¥åŠ›"
            oninput="rcvCheckMailReady()"
            style="width:100%;background:transparent;border:none;color:#e8eaf0;font-family:'DM Mono',monospace;font-size:13px;outline:none">
        </div>
        <button onclick="rcvPrintLabels('mail')" style="background:var(--gold);color:#0d0f14;border:none;border-radius:7px;padding:0 12px;cursor:pointer;font-size:11px;font-weight:700;font-family:inherit;white-space:nowrap">ğŸ–¨ ãƒ©ãƒ™ãƒ«å°åˆ·</button>
      </div>

      <!-- è¿”é€ç”¨å°ç­’ -->
      <div class="rcv-field-label" style="margin-top:12px">è¿”é€ç”¨å°ç­’ã®åŒå°ãŒå¿…è¦ã§ã™ã‹ï¼Ÿ</div>
      <div style="display:flex;gap:8px;margin-bottom:14px">
        <button id="btn-return-yes" onclick="rcvSetReturnEnvelope(true)"
          style="flex:1;padding:9px;background:var(--hover);border:1px solid var(--border);color:var(--sub);border-radius:7px;cursor:pointer;font-size:12px;font-family:inherit;transition:all .15s">
          âœ… å¿…è¦ï¼ˆåŒå°ï¼‰
        </button>
        <button id="btn-return-no" onclick="rcvSetReturnEnvelope(false)"
          style="flex:1;padding:9px;background:var(--hover);border:1px solid var(--border);color:var(--sub);border-radius:7px;cursor:pointer;font-size:12px;font-family:inherit;transition:all .15s">
          ä¸è¦
        </button>
      </div>

      <div id="mail-return-tracking" style="display:none;margin-bottom:14px">
        <div class="rcv-field-label">è¿”é€ç”¨ãƒ¬ã‚¿ãƒ¼ãƒ‘ãƒƒã‚¯è¿½è·¡ç•ªå·</div>
        <div style="background:var(--hover);border:1px solid var(--border);border-radius:7px;padding:8px 12px;cursor:text" onclick="this.querySelector('input').focus()">
          <input id="mail-return-no" type="text" maxlength="12" placeholder="ã‚¹ã‚­ãƒ£ãƒ³ã¾ãŸã¯12æ¡æ‰‹å…¥åŠ›"
            oninput="rcvCheckMailReady()"
            style="width:100%;background:transparent;border:none;color:#e8eaf0;font-family:'DM Mono',monospace;font-size:13px;outline:none">
        </div>
      </div>

      <button id="btn-mail-complete" onclick="rcvMailComplete()" disabled
        style="width:100%;padding:12px;background:var(--blue);color:#fff;border:none;border-radius:8px;font-weight:700;font-size:13px;cursor:pointer;font-family:inherit;opacity:.4;transition:opacity .2s">
        ğŸ“¡ ç™ºé€ç™»éŒ² â†’ è¿½è·¡é–‹å§‹
      </button>
    </div>

    <!-- --- 3b: å—å–ãƒ•ãƒ­ãƒ¼ --- -->
    <div id="s3-pickup" style="display:none">
      <div style="background:rgba(34,197,94,.08);border:1px solid rgba(34,197,94,.3);border-radius:8px;padding:12px;margin-bottom:14px;font-size:12px;color:var(--green)">
        ğŸ¢ å—å–ãƒ¢ãƒ¼ãƒ‰ â€” ã‚¨ãƒ¼ã‚¸ã‚§ãƒ³ãƒˆãŒäº‹å‹™æ‰€ã«æ¥ãŸéš›ã«å‡¦ç†ã—ã¾ã™
      </div>

      <div class="rcv-field-label">ã‚¨ãƒ¼ã‚¸ã‚§ãƒ³ãƒˆæ¥åº—æ™‚ã®ã‚¹ã‚­ãƒ£ãƒ³ / æ¤œç´¢</div>
      <div style="display:flex;gap:8px;margin-bottom:8px">
        <div style="flex:1;background:var(--hover);border:1px solid var(--border);border-radius:7px;padding:8px 12px;cursor:text" onclick="this.querySelector('input').focus()">
          <input id="pickup-agent-search" type="text" placeholder="AGå / æ¡ˆä»¶ID / ãƒãƒ¼ã‚³ãƒ¼ãƒ‰ã‚¹ã‚­ãƒ£ãƒ³"
            oninput="rcvPickupSearch()"
            style="width:100%;background:transparent;border:none;color:#e8eaf0;font-size:12px;font-family:'Noto Sans JP',sans-serif;outline:none">
        </div>
        <button onclick="rcvPickupSearch()" style="background:var(--gold);color:#0d0f14;border:none;border-radius:7px;padding:0 12px;cursor:pointer;font-size:12px;font-weight:700;font-family:inherit">æ¤œç´¢</button>
      </div>
      <div id="pickup-search-results" style="margin-bottom:12px;font-size:11px;color:var(--muted)"></div>

      <!-- è¿”é€ç”¨å°ç­’ç¢ºèª -->
      <div class="rcv-field-label" style="margin-top:4px">è¿”é€ç”¨å°ç­’ã‚’æ‰‹æ¸¡ã—ã¾ã™ã‹ï¼Ÿ</div>
      <div style="display:flex;gap:8px;margin-bottom:14px">
        <button id="btn-pickup-return-yes" onclick="rcvPickupSetReturn(true)"
          style="flex:1;padding:9px;background:var(--hover);border:1px solid var(--border);color:var(--sub);border-radius:7px;cursor:pointer;font-size:12px;font-family:inherit">
          âœ… æ‰‹æ¸¡ã—ï¼ˆãƒ©ãƒ™ãƒ«å°åˆ·ï¼‰
        </button>
        <button id="btn-pickup-return-no" onclick="rcvPickupSetReturn(false)"
          style="flex:1;padding:9px;background:var(--hover);border:1px solid var(--border);color:var(--sub);border-radius:7px;cursor:pointer;font-size:12px;font-family:inherit">
          ä¸è¦
        </button>
      </div>

      <!-- å—å–ç¢ºèªã‚µã‚¤ãƒ³æ¬„ -->
      <div class="rcv-field-label">å—å–ç¢ºèªï¼ˆAGãŒã‚¿ãƒ–ãƒ¬ãƒƒãƒˆã«ã‚µã‚¤ãƒ³ï¼‰</div>
      <div style="background:var(--hover);border:1px solid var(--border);border-radius:8px;overflow:hidden;margin-bottom:14px">
        <canvas id="pickup-signature" width="480" height="100" style="width:100%;display:block;cursor:crosshair;touch-action:none"></canvas>
        <div style="display:flex;justify-content:space-between;padding:6px 10px;border-top:1px solid var(--border)">
          <span style="font-size:10px;color:var(--muted)">ã‚µã‚¤ãƒ³æ¬„ï¼ˆæŒ‡ã¾ãŸã¯ãƒã‚¦ã‚¹ã§ç½²åï¼‰</span>
          <button onclick="clearSignature()" style="background:transparent;border:none;color:var(--muted);font-size:10px;cursor:pointer;font-family:inherit">âœ• ã‚¯ãƒªã‚¢</button>
        </div>
      </div>

      <button id="btn-pickup-complete" onclick="rcvPickupComplete()"
        style="width:100%;padding:12px;background:var(--green);color:#0d0f14;border:none;border-radius:8px;font-weight:700;font-size:13px;cursor:pointer;font-family:inherit">
        âœ… æ‰‹æ¸¡ã—å®Œäº†ãƒ»è¨˜éŒ²
      </button>
    </div>
  </div>

  <!-- â•â• STEP 4: å®Œäº† â•â• -->
  <div id="rcv-s4" class="rcv-panel" style="display:none">
    <div style="text-align:center;padding:20px 0">
      <div style="font-size:40px;margin-bottom:12px">âœ…</div>
      <div style="font-size:18px;font-weight:700;color:var(--green);margin-bottom:8px">å‡¦ç†å®Œäº†</div>
      <div id="rcv-complete-summary" style="font-size:12px;color:var(--muted);line-height:1.8;margin-bottom:20px"></div>
      <div style="display:flex;gap:8px;justify-content:center">
        <button onclick="rcvReset()" style="padding:10px 24px;background:var(--gold);color:#0d0f14;border:none;border-radius:8px;font-weight:700;font-size:13px;cursor:pointer;font-family:inherit">æ¬¡ã®æ›¸é¡ã‚’å‡¦ç†</button>
        <button onclick="showTab('tracking',{target:{closest:()=>null}})" style="padding:10px 24px;background:var(--hover);border:1px solid var(--border);color:var(--sub);border-radius:8px;font-size:12px;cursor:pointer;font-family:inherit">è¿½è·¡ä¸€è¦§ã‚’ç¢ºèª</button>
      </div>
    </div>
  </div>

</div><!-- /rcv-wizard -->

<!-- â•â•â• å³: å¾…æ©Ÿä¸­æ›¸é¡ä¸€è¦§ â•â•â• -->
<div>
  <div style="font-size:10px;color:var(--muted);letter-spacing:1px;margin-bottom:10px">ğŸ“‹ å¾…æ©Ÿä¸­ãƒ»å‡¦ç†ä¸­ã®æ›¸é¡</div>

  <!-- ãƒ•ã‚£ãƒ«ã‚¿ãƒ¼ -->
  <div style="display:flex;gap:6px;margin-bottom:10px">
    <select id="queue-filter" onchange="rcvRenderQueue()" style="flex:1;background:var(--hover);border:1px solid var(--border);border-radius:6px;padding:5px 8px;color:#e8eaf0;font-size:10px;font-family:inherit">
      <option value="">å…¨ã‚¹ãƒ†ãƒ¼ã‚¿ã‚¹</option>
      <option value="arrived">åˆ°ç€æ¸ˆãƒ»æœªé€£çµ¡</option>
      <option value="waiting_reply">AGå›ç­”å¾…ã¡</option>
      <option value="pickup_scheduled">å—å–äºˆå®š</option>
      <option value="in_transit">éƒµé€ä¸­</option>
      <option value="delivered">é…é”å®Œäº†</option>
      <option value="returned">è¿”é€å—å–æ¸ˆ</option>
    </select>
  </div>

  <div id="rcv-queue-list" style="display:flex;flex-direction:column;gap:8px;max-height:560px;overflow-y:auto"></div>
</div>

</div><!-- /grid -->
</div><!-- /tab-receive -->


<!-- ================================================================ -->
<!-- TAB: SCAN DESK -->
<!-- ================================================================ -->
<div id="tab-scan" class="page active">

  <div class="grid2">

    <!-- å·¦ï¼šã‚¹ã‚­ãƒ£ãƒ³ãƒ‡ã‚¹ã‚¯ -->
    <div>
      <div class="s-label">ã‚¹ãƒ†ãƒƒãƒ—1 â€• ã‚¹ãƒ†ãƒ¼ã‚¿ã‚¹ã‚’é¸æŠ</div>
      <div class="status-selector">
        <button class="status-btn active-shipped" id="btn-shipped" onclick="selectStatus('shipped')">ğŸ“¤ ç™ºé€</button>
        <button class="status-btn" id="btn-received" onclick="selectStatus('received')">ğŸ“¥ å—å–</button>
        <button class="status-btn" id="btn-stored" onclick="selectStatus('stored')">ğŸ“¦ ä¿ç®¡ä¸­</button>
        <button class="status-btn" id="btn-rejected" onclick="selectStatus('rejected')">ğŸš« å—å–æ‹’å¦ãƒ»ä¸åœ¨</button>
      </div>

      <div class="s-label">ã‚¹ãƒ†ãƒƒãƒ—2 â€• ãƒãƒ¼ã‚³ãƒ¼ãƒ‰ã‚’ã‚¹ã‚­ãƒ£ãƒ³</div>
      <div class="scan-desk">
        <div class="scan-input-area" id="scan-area" onclick="document.getElementById('scan-input').focus()">
          <div class="scan-icon">ğŸ“·</div>
          <div class="scan-input-inner">
            <div class="scan-hint" id="scan-hint">ã‚¹ã‚­ãƒ£ãƒŠãƒ¼ã‚’ã“ã“ã«å‘ã‘ã¦ãƒãƒ¼ã‚³ãƒ¼ãƒ‰ã‚’èª­ã¿å–ã‚‹ã‹ã€ã‚¯ãƒªãƒƒã‚¯ã—ã¦æ‰‹å…¥åŠ›</div>
            <input
              type="text"
              id="scan-input"
              class="scan-input"
              placeholder="ã‚¹ã‚­ãƒ£ãƒ³å¾…æ©Ÿä¸­..."
              autocomplete="off"
              onkeydown="handleScanInput(event)"
              onfocus="onScanFocus()"
              onblur="onScanBlur()"
            >
          </div>
          <div id="scan-spinner" style="display:none;color:var(--gold);font-size:20px">âŸ³</div>
        </div>

        <!-- ã‚¹ã‚­ãƒ£ãƒ³çµæœ -->
        <div class="scan-result" id="scan-result">
          <div class="result-header">
            <div>
              <div class="result-case" id="result-case-id">â€”</div>
              <div style="font-size:13px;font-weight:600;margin-top:2px" id="result-case-name">â€”</div>
            </div>
            <div class="result-status-badge" id="result-badge">â€”</div>
          </div>
          <div class="result-grid">
            <div class="result-field">
              <div class="result-key">ãƒ©ãƒ™ãƒ«ç¨®åˆ¥</div>
              <div class="result-val" id="result-label-type">â€”</div>
            </div>
            <div class="result-field">
              <div class="result-key">å®›å…ˆ</div>
              <div class="result-val" id="result-dest">â€”</div>
            </div>
            <div class="result-field">
              <div class="result-key">ã‚¹ã‚­ãƒ£ãƒ³æ™‚åˆ»</div>
              <div class="result-val" style="font-family:'DM Mono',monospace" id="result-time">â€”</div>
            </div>
          </div>
          <button class="confirm-btn" id="confirm-btn" onclick="confirmScan()">âœ… Kintoneã«è¨˜éŒ²ã™ã‚‹</button>
        </div>

        <!-- ã‚¹ã‚­ãƒ£ãƒ³å±¥æ­´ -->
        <div style="margin-top:20px">
          <div style="font-size:11px;color:var(--muted);letter-spacing:1px;margin-bottom:10px">æœ¬æ—¥ã®ã‚¹ã‚­ãƒ£ãƒ³å±¥æ­´</div>
          <div id="history-list">
            <div class="history-row">
              <span class="h-time">09:12</span>
              <span class="h-code">C001-CONTRACT</span>
              <span class="h-case">æ± è¢‹ãƒãƒ³ã‚·ãƒ§ãƒ³ 101 / ç”°ä¸­æ§˜</span>
              <span class="h-badge badge-shipped">ğŸ“¤ ç™ºé€</span>
            </div>
            <div class="history-row">
              <span class="h-time">10:34</span>
              <span class="h-code">C001-KEY</span>
              <span class="h-case">æ± è¢‹ãƒãƒ³ã‚·ãƒ§ãƒ³ 101 / ç”°ä¸­æ§˜</span>
              <span class="h-badge badge-shipped">ğŸ“¤ ç™ºé€</span>
            </div>
            <div class="history-row">
              <span class="h-time">11:20</span>
              <span class="h-code">C002-RETURN</span>
              <span class="h-case">æ–°å®¿ã‚¢ãƒ‘ãƒ¼ãƒˆ 201 / å±±ç”°æ§˜</span>
              <span class="h-badge badge-received">ğŸ“¥ å—å–</span>
            </div>
            <div class="history-row">
              <span class="h-time">14:05</span>
              <span class="h-code">C002-RETURN</span>
              <span class="h-case">æ–°å®¿ã‚¢ãƒ‘ãƒ¼ãƒˆ 201 / å±±ç”°æ§˜</span>
              <span class="h-badge badge-stored">ğŸ“¦ ä¿ç®¡ä¸­</span>
            </div>
          </div>
        </div>
      </div>
    </div>

    <!-- å³ï¼šæ¡ˆä»¶è¿½è·¡ã‚¿ã‚¤ãƒ ãƒ©ã‚¤ãƒ³ -->
    <div>
      <div class="s-label">æ¡ˆä»¶ C-003 â€• è¿½è·¡ã‚¿ã‚¤ãƒ ãƒ©ã‚¤ãƒ³</div>
      <div class="card">
        <div style="margin-bottom:14px">
          <div style="font-family:'DM Mono',monospace;font-size:12px;color:var(--gold)">C-003</div>
          <div style="font-size:14px;font-weight:600;margin-top:2px">æ¸‹è°·åŒºä»£ã€…æœ¨ / éˆ´æœ¨ ä¸€éƒ æ§˜</div>
        </div>

        <!-- å¥‘ç´„æ›¸ -->
        <div style="margin-bottom:16px">
          <div style="font-size:11px;color:var(--muted);margin-bottom:8px;letter-spacing:0.5px">ğŸ“„ å¥‘ç´„æ›¸ â€• C003-CONTRACT</div>
          <div>
            <div class="tl-item">
              <div class="tl-dot tl-dot-done"></div>
              <div><div class="tl-text">ğŸ“¤ ç™ºé€</div><div class="tl-sub">2/19 14:22 â€• å±±ç”°ã‚¹ã‚­ãƒ£ãƒ³</div></div>
            </div>
            <div class="tl-item">
              <div class="tl-dot tl-dot-pending"></div>
              <div><div class="tl-text" style="color:var(--muted)">ğŸ“¥ å—å–ï¼ˆé¡§å®¢ç½²åå¾Œè¿”é€ï¼‰</div><div class="tl-sub">å¾…æ©Ÿä¸­</div></div>
            </div>
            <div class="tl-item">
              <div class="tl-dot tl-dot-pending"></div>
              <div><div class="tl-text" style="color:var(--muted)">ğŸ“¦ ä¿ç®¡ä¸­</div><div class="tl-sub">å¾…æ©Ÿä¸­</div></div>
            </div>
          </div>
        </div>

        <!-- éµ -->
        <div style="margin-bottom:16px">
          <div style="font-size:11px;color:var(--muted);margin-bottom:8px;letter-spacing:0.5px">ğŸ”‘ éµ â€• C003-KEY</div>
          <div>
            <div class="tl-item">
              <div class="tl-dot tl-dot-active"></div>
              <div><div class="tl-text" style="color:var(--gold)">ğŸ“¤ ç™ºé€ï¼ˆæœ¬æ—¥äºˆå®šï¼‰</div><div class="tl-sub">æœªã‚¹ã‚­ãƒ£ãƒ³</div></div>
            </div>
            <div class="tl-item">
              <div class="tl-dot tl-dot-pending"></div>
              <div><div class="tl-text" style="color:var(--muted)">ğŸ“¥ é¡§å®¢å—å–ç¢ºèª</div><div class="tl-sub">å¾…æ©Ÿä¸­</div></div>
            </div>
          </div>
        </div>

        <!-- è¿”ä¿¡ç”¨ -->
        <div>
          <div style="font-size:11px;color:var(--muted);margin-bottom:8px;letter-spacing:0.5px">â†©ï¸ è¿”ä¿¡ç”¨ï¼ˆè¿”é€ç¢ºèªï¼‰ â€• C003-RETURN</div>
          <div>
            <div class="tl-item">
              <div class="tl-dot tl-dot-pending"></div>
              <div><div class="tl-text" style="color:var(--muted)">ğŸ“¥ å—å–ï¼ˆäº‹å‹™æ‰€ã«å±Šã„ãŸï¼‰</div><div class="tl-sub">å¾…æ©Ÿä¸­</div></div>
            </div>
            <div class="tl-item">
              <div class="tl-dot tl-dot-pending"></div>
              <div><div class="tl-text" style="color:var(--muted)">ğŸ“¦ ä¿ç®¡ä¸­ï¼ˆæ£šã«æ ¼ç´ï¼‰</div><div class="tl-sub">å¾…æ©Ÿä¸­</div></div>
            </div>
          </div>
        </div>

        <div style="margin-top:14px;padding:10px;background:rgba(59,130,246,0.08);border-radius:6px;font-size:11px;color:var(--blue);line-height:1.7">
          ğŸ’¡ ã‚¹ã‚­ãƒ£ãƒ³ã™ã‚‹ã¨ã“ã®ã‚¿ã‚¤ãƒ ãƒ©ã‚¤ãƒ³ãŒKintoneã§è‡ªå‹•æ›´æ–°ã•ã‚Œã¾ã™ã€‚<br>
          æ—¥æœ¬éƒµä¾¿APIï¼ˆè‡ªå‹•è¿½è·¡ï¼‰ã®ã‚¹ãƒ†ãƒ¼ã‚¿ã‚¹ã¨ã‚‚åˆç®—ã—ã¦è¡¨ç¤ºã•ã‚Œã¾ã™ã€‚
        </div>
      </div>

      <div class="card">
        <div class="card-title">ğŸ“Š ä»Šæœˆã®ç™ºé€çŠ¶æ³</div>
        <div style="display:grid;grid-template-columns:repeat(4,1fr);gap:10px">
          <div style="text-align:center;background:var(--hover);border-radius:8px;padding:12px">
            <div style="font-family:'DM Mono',monospace;font-size:22px;font-weight:700;color:var(--blue)">23</div>
            <div style="font-size:10px;color:var(--muted);margin-top:3px">ç™ºé€æ¸ˆã¿</div>
          </div>
          <div style="text-align:center;background:var(--hover);border-radius:8px;padding:12px">
            <div style="font-family:'DM Mono',monospace;font-size:22px;font-weight:700;color:var(--green)">18</div>
            <div style="font-size:10px;color:var(--muted);margin-top:3px">å—å–å®Œäº†</div>
          </div>
          <div style="text-align:center;background:var(--hover);border-radius:8px;padding:12px">
            <div style="font-family:'DM Mono',monospace;font-size:22px;font-weight:700;color:var(--purple)">12</div>
            <div style="font-size:10px;color:var(--muted);margin-top:3px">ä¿ç®¡ä¸­</div>
          </div>
          <div style="text-align:center;background:var(--hover);border-radius:8px;padding:12px">
            <div style="font-family:'DM Mono',monospace;font-size:22px;font-weight:700;color:var(--red)">2</div>
            <div style="font-size:10px;color:var(--muted);margin-top:3px">ä¸åœ¨æŒæˆ»ã‚Š</div>
          </div>
        </div>
      </div>
    </div>

  </div>
</div>

<!-- ================================================================ -->
<!-- TAB: LABEL PREVIEW -->
<!-- ================================================================ -->
<div id="tab-label" class="page">

  <div class="s-label" style="margin-top:0">ãƒ—ãƒ¬ãƒ“ãƒ¥ãƒ¼ã™ã‚‹ãƒ©ãƒ™ãƒ«ã‚’é¸æŠ</div>
  <div class="label-select-row">
    <button class="label-select-btn active" onclick="showLabelPreview('contract',this)">ğŸ“„ å¥‘ç´„æ›¸é€ä»˜</button>
    <button class="label-select-btn" onclick="showLabelPreview('key',this)">ğŸ”‘ éµé€ä»˜</button>
    <button class="label-select-btn" onclick="showLabelPreview('return',this)">â†©ï¸ è¿”ä¿¡ç”¨</button>
    <button class="label-select-btn" onclick="showLabelPreview('mgmt',this)">ğŸ¢ ç®¡ç†ä¼šç¤¾å®›</button>
  </div>

  <div class="grid2">
    <div>
      <div class="card">
        <div class="card-title">æ„Ÿç†±ãƒ©ãƒ™ãƒ«å°åˆ·ã‚¤ãƒ¡ãƒ¼ã‚¸ï¼ˆ102mm Ã— 62mmï¼‰</div>

        <!-- CONTRACT -->
        <div id="lp-contract">
          <div class="thermal-label">
            <span class="tl-type-bar tl-bar-blue">ğŸ“„ å¥‘ç´„æ›¸é€ä»˜</span>
            <div class="tl-to-label">ãŠå±Šã‘å…ˆ</div>
            <div class="tl-postal">ã€’150-0001</div>
            <div class="tl-address">æ±äº¬éƒ½æ¸‹è°·åŒºç¥å®®å‰1-1-1ã€€â—‹â—‹ãƒãƒ³ã‚·ãƒ§ãƒ³ 201å·å®¤</div>
            <div class="tl-name">éˆ´æœ¨ ä¸€éƒ <span class="tl-honorific">æ§˜</span></div>
            <hr class="tl-divider">
            <div class="tl-from-label">å·®å‡ºäºº</div>
            <div class="tl-from-name">CORETO ï¼ æ‹…å½“ï¼šå±±ç”° èª </div>
            <div class="tl-from-addr">ã€’171-0021 æ±äº¬éƒ½è±Šå³¶åŒºè¥¿æ± è¢‹1-1-1</div>
            <div class="tl-from-tel">TEL: 090-1234-5678</div>
            <div class="tl-barcode-area">
              <svg id="bc-contract" class="tl-barcode-svg"></svg>
              <div class="tl-barcode-meta">
                <div class="tl-barcode-id">C003-CONTRACT</div>
                <div class="tl-barcode-type">è¿½è·¡ãƒãƒ¼ã‚³ãƒ¼ãƒ‰</div>
              </div>
            </div>
          </div>
        </div>

        <!-- KEY -->
        <div id="lp-key" style="display:none">
          <div class="thermal-label">
            <span class="tl-type-bar tl-bar-blue">ğŸ”‘ éµé€ä»˜</span>
            <div class="tl-to-label">ãŠå±Šã‘å…ˆ</div>
            <div class="tl-postal">ã€’150-0001</div>
            <div class="tl-address">æ±äº¬éƒ½æ¸‹è°·åŒºç¥å®®å‰1-1-1ã€€â—‹â—‹ãƒãƒ³ã‚·ãƒ§ãƒ³ 201å·å®¤</div>
            <div class="tl-name">éˆ´æœ¨ ä¸€éƒ <span class="tl-honorific">æ§˜</span></div>
            <hr class="tl-divider">
            <div class="tl-from-label">å·®å‡ºäºº</div>
            <div class="tl-from-name">CORETO ï¼ æ‹…å½“ï¼šå±±ç”° èª </div>
            <div class="tl-from-addr">ã€’171-0021 æ±äº¬éƒ½è±Šå³¶åŒºè¥¿æ± è¢‹1-1-1</div>
            <div class="tl-from-tel">TEL: 090-1234-5678</div>
            <div class="tl-barcode-area">
              <svg id="bc-key" class="tl-barcode-svg"></svg>
              <div class="tl-barcode-meta">
                <div class="tl-barcode-id">C003-KEY</div>
                <div class="tl-barcode-type">è¿½è·¡ãƒãƒ¼ã‚³ãƒ¼ãƒ‰</div>
              </div>
            </div>
          </div>
        </div>

        <!-- RETURN -->
        <div id="lp-return" style="display:none">
          <div class="thermal-label">
            <span class="tl-type-bar tl-bar-purple">â†©ï¸ è¿”ä¿¡ç”¨ï¼ˆå¥‘ç´„æ›¸è¿”é€ï¼‰</span>
            <div class="tl-to-label">ãŠå±Šã‘å…ˆ</div>
            <div class="tl-postal">ã€’171-0021</div>
            <div class="tl-address">æ±äº¬éƒ½è±Šå³¶åŒºè¥¿æ± è¢‹1-1-1</div>
            <div class="tl-name" style="font-size:11px;line-height:1.4">åˆåŒä¼šç¤¾å¸å›½é–‹ç™º<br><span style="font-size:9px;font-weight:600">CORETO å¥‘ç´„æ›¸å—ä»˜ ä¿‚</span></div>
            <hr class="tl-divider">
            <div class="tl-from-label">å·®å‡ºäººï¼ˆãŠå®¢æ§˜ã®ãŠåå‰ã‚’ã”è¨˜å…¥ãã ã•ã„ï¼‰</div>
            <div class="tl-from-name">éˆ´æœ¨ ä¸€éƒ æ§˜</div>
            <div class="tl-from-addr">ã€’150-0001 æ±äº¬éƒ½æ¸‹è°·åŒºç¥å®®å‰1-1-1</div>
            <div class="tl-barcode-area">
              <svg id="bc-return" class="tl-barcode-svg"></svg>
              <div class="tl-barcode-meta">
                <div class="tl-barcode-id">C003-RETURN</div>
                <div class="tl-barcode-type">è¿½è·¡ãƒãƒ¼ã‚³ãƒ¼ãƒ‰</div>
              </div>
            </div>
          </div>
        </div>

        <!-- MGMT -->
        <div id="lp-mgmt" style="display:none">
          <div class="thermal-label">
            <span class="tl-type-bar tl-bar-amber">ğŸ¢ ç®¡ç†ä¼šç¤¾é€ä»˜</span>
            <div class="tl-to-label">ãŠå±Šã‘å…ˆ</div>
            <div class="tl-postal">ã€’160-0022</div>
            <div class="tl-address">æ±äº¬éƒ½æ–°å®¿åŒºæ–°å®¿2-3-4ã€€â—‹â—‹ãƒ“ãƒ« 5éš</div>
            <div class="tl-name" style="font-size:12px">æ ªå¼ä¼šç¤¾æ¸‹è°·ç®¡ç† <span class="tl-honorific">å¾¡ä¸­</span></div>
            <div style="font-size:7px;color:#374151;margin-top:1px">ç®¡ç†éƒ¨ ã”æ‹…å½“è€…æ§˜</div>
            <hr class="tl-divider">
            <div class="tl-from-label">å·®å‡ºäºº</div>
            <div class="tl-from-name">CORETO ï¼ æ‹…å½“ï¼šå±±ç”° èª </div>
            <div class="tl-from-addr">ã€’171-0021 æ±äº¬éƒ½è±Šå³¶åŒºè¥¿æ± è¢‹1-1-1</div>
            <div class="tl-from-tel">TEL: 090-1234-5678</div>
            <div class="tl-barcode-area">
              <svg id="bc-mgmt" class="tl-barcode-svg"></svg>
              <div class="tl-barcode-meta">
                <div class="tl-barcode-id">C003-MGMT</div>
                <div class="tl-barcode-type">è¿½è·¡ãƒãƒ¼ã‚³ãƒ¼ãƒ‰</div>
              </div>
            </div>
          </div>
        </div>

        <div style="text-align:center;margin-top:12px;font-size:11px;color:var(--muted)">
          â†‘ ãƒãƒ¼ã‚³ãƒ¼ãƒ‰ã¯ãƒ©ãƒ™ãƒ«ä¸‹éƒ¨ã«è‡ªå‹•ç”Ÿæˆãƒ»å°åˆ·ã•ã‚Œã¾ã™
        </div>
      </div>
    </div>

    <div>
      <div class="card">
        <div class="card-title">ãƒãƒ¼ã‚³ãƒ¼ãƒ‰è¨­è¨ˆ</div>
        <div style="font-size:12px;color:var(--sub);line-height:1.9">
          <strong style="color:#e8eaf0">ãƒ•ã‚©ãƒ¼ãƒãƒƒãƒˆï¼š</strong> <code>{æ¡ˆä»¶ID}-{ç¨®åˆ¥}</code><br>
          <strong style="color:#e8eaf0">ç¨®åˆ¥ã‚³ãƒ¼ãƒ‰ï¼š</strong><br>
          &emsp;<code>CONTRACT</code> â€• å¥‘ç´„æ›¸é€ä»˜<br>
          &emsp;<code>KEY</code> â€• éµé€ä»˜<br>
          &emsp;<code>RETURN</code> â€• è¿”ä¿¡ç”¨ï¼ˆå¥‘ç´„æ›¸è¿”é€ï¼‰<br>
          &emsp;<code>MGMT</code> â€• ç®¡ç†ä¼šç¤¾å®›<br><br>
          <strong style="color:#e8eaf0">ãƒãƒ¼ã‚³ãƒ¼ãƒ‰å½¢å¼ï¼š</strong> Code 128<br>
          &emsp;è‹±æ•°å­—ãƒ»è¨˜å·ã™ã¹ã¦å¯¾å¿œã€‚Honeywell 1200g ã§ç¢ºå®Ÿã«èª­å–å¯èƒ½ã€‚<br><br>
          <strong style="color:#e8eaf0">ä¾‹ï¼š</strong> æ¡ˆä»¶C-003ã®å¥‘ç´„æ›¸ãƒ©ãƒ™ãƒ«<br>
          &emsp;â†’ <code>C003-CONTRACT</code>
        </div>
        <div class="hint" style="margin-top:16px">
          ğŸ’¡ <strong style="color:#e8eaf0">åŒä¸€æ¡ˆä»¶ã®ãƒ©ãƒ™ãƒ«ã‚’è¤‡æ•°æšç™ºè¡Œã—ãŸå ´åˆ</strong>ã€ãƒãƒ¼ã‚³ãƒ¼ãƒ‰æœ«å°¾ã«é€£ç•ªã‚’ä»˜ã‘ã¾ã™ï¼š<code>C003-CONTRACT-2</code>ã€‚å†ç™ºè¡Œãƒ»å·®ã—æ›¿ãˆã‚‚è¿½è·¡ã§ãã¾ã™ã€‚
        </div>
      </div>

      <div class="card">
        <div class="card-title">ã‚¹ãƒ†ãƒ¼ã‚¿ã‚¹é·ç§»ãƒ«ãƒ¼ãƒ«</div>
        <div style="display:flex;flex-direction:column;gap:10px;font-size:12px">
          <div style="background:var(--hover);border-radius:6px;padding:10px">
            <div style="color:var(--blue);font-weight:600;margin-bottom:4px">ğŸ“„ å¥‘ç´„æ›¸ / ğŸ”‘ éµ / ğŸ¢ ç®¡ç†ä¼šç¤¾å®›</div>
            <div style="color:var(--sub)">ç™ºé€ â†’ å—å–æ‹’å¦ãƒ»ä¸åœ¨ï¼ˆä»»æ„ï¼‰ â†’ â€•</div>
          </div>
          <div style="background:var(--hover);border-radius:6px;padding:10px">
            <div style="color:var(--purple);font-weight:600;margin-bottom:4px">â†©ï¸ è¿”ä¿¡ç”¨ï¼ˆé¡§å®¢â†’äº‹å‹™æ‰€ï¼‰</div>
            <div style="color:var(--sub)">å—å–ï¼ˆäº‹å‹™æ‰€ã«å±Šã„ãŸï¼‰â†’ ä¿ç®¡ä¸­ï¼ˆæ£šã«æ ¼ç´ï¼‰</div>
          </div>
          <div style="background:rgba(239,68,68,0.06);border:1px solid rgba(239,68,68,0.2);border-radius:6px;padding:10px">
            <div style="color:var(--red);font-weight:600;margin-bottom:4px">ğŸš« å—å–æ‹’å¦ãƒ»ä¸åœ¨æŒã¡æˆ»ã‚Š</div>
            <div style="color:var(--sub)">ã„ãšã‚Œã®ãƒ©ãƒ™ãƒ«ç¨®åˆ¥ã«ã‚‚è¨˜éŒ²å¯èƒ½ã€‚<br>ã‚¹ã‚­ãƒ£ãƒ³å¾Œã«Kintoneã§æ‹…å½“ã‚¨ãƒ¼ã‚¸ã‚§ãƒ³ãƒˆã«è‡ªå‹•é€šçŸ¥ã€‚</div>
          </div>
        </div>
      </div>
    </div>
  </div>
</div>

<!-- ================================================================ -->
<!-- TAB: TRACKING -->
<!-- ================================================================ -->
<div id="tab-tracking" class="page">
  <div class="card">
    <div style="display:flex;align-items:center;justify-content:space-between;margin-bottom:16px">
      <div class="card-title" style="margin:0">ğŸ“¦ å…¨ãƒ¬ã‚¿ãƒ¼ãƒ‘ãƒƒã‚¯è¿½è·¡ä¸€è¦§</div>
      <div style="display:flex;gap:8px">
        <select style="background:var(--hover);border:1px solid var(--border);color:#e8eaf0;padding:6px 10px;border-radius:5px;font-size:12px;font-family:'Noto Sans JP',sans-serif">
          <option>å…¨ã‚¹ãƒ†ãƒ¼ã‚¿ã‚¹</option>
          <option>ğŸ“¤ ç™ºé€æ¸ˆã¿</option>
          <option>ğŸ“¥ å—å–å¾…ã¡</option>
          <option>ğŸ“¦ ä¿ç®¡ä¸­</option>
          <option>ğŸš« ä¸åœ¨ãƒ»æ‹’å¦</option>
        </select>
        <select style="background:var(--hover);border:1px solid var(--border);color:#e8eaf0;padding:6px 10px;border-radius:5px;font-size:12px;font-family:'Noto Sans JP',sans-serif">
          <option>å…¨ç¨®åˆ¥</option>
          <option>å¥‘ç´„æ›¸</option>
          <option>éµ</option>
          <option>è¿”ä¿¡ç”¨</option>
          <option>ç®¡ç†ä¼šç¤¾</option>
        </select>
      </div>
    </div>
    <table style="width:100%;border-collapse:collapse">
      <thead>
        <tr>
          <th style="text-align:left;font-size:11px;color:var(--muted);padding:8px 10px;border-bottom:1px solid var(--border)">ãƒãƒ¼ã‚³ãƒ¼ãƒ‰</th>
          <th style="text-align:left;font-size:11px;color:var(--muted);padding:8px 10px;border-bottom:1px solid var(--border)">æ¡ˆä»¶ / é¡§å®¢</th>
          <th style="text-align:left;font-size:11px;color:var(--muted);padding:8px 10px;border-bottom:1px solid var(--border)">ç¨®åˆ¥</th>
          <th style="text-align:left;font-size:11px;color:var(--muted);padding:8px 10px;border-bottom:1px solid var(--border)">ç¾åœ¨ã®ã‚¹ãƒ†ãƒ¼ã‚¿ã‚¹</th>
          <th style="text-align:left;font-size:11px;color:var(--muted);padding:8px 10px;border-bottom:1px solid var(--border)">æœ€çµ‚ã‚¹ã‚­ãƒ£ãƒ³</th>
          <th style="text-align:left;font-size:11px;color:var(--muted);padding:8px 10px;border-bottom:1px solid var(--border)">æ‹…å½“AG</th>
          <th style="text-align:left;font-size:11px;color:var(--muted);padding:8px 10px;border-bottom:1px solid var(--border)">æ—¥æœ¬éƒµä¾¿</th>
        </tr>
      </thead>
      <tbody id="tracking-table-body">
      </tbody>
    </table>
  </div>
</div>


<!-- ================================================================ -->
<!-- TAB: éƒµä¾¿è¿½è·¡API -->
<!-- ================================================================ -->
<div id="tab-postal" class="page">

  <div class="grid2">

    <!-- å·¦ï¼šAPIè¨­å®š & æ‰‹å‹•è¿½è·¡ -->
    <div>
      <div class="s-label" style="margin-bottom:12px">ğŸšš éƒµä¾¿å±€ e-ãŠçŸ¥ã‚‰ã›API é€£æº</div>

      <!-- APIæ¥ç¶šçŠ¶æ…‹ -->
      <div class="card" style="margin-bottom:16px">
        <div style="display:flex;align-items:center;justify-content:space-between;margin-bottom:12px">
          <div class="card-title" style="margin:0">APIæ¥ç¶šçŠ¶æ…‹</div>
          <div id="api-connection-badge" style="font-size:11px;padding:3px 10px;border-radius:20px;background:rgba(239,68,68,.15);color:var(--red);border:1px solid rgba(239,68,68,.3)">â— æœªæ¥ç¶š</div>
        </div>
        <div style="font-size:11px;color:var(--muted);margin-bottom:14px">
          æ—¥æœ¬éƒµä¾¿ã€Œe-ãŠçŸ¥ã‚‰ã›ã‚·ã‚¹ãƒ†ãƒ ã€ã®ãŠå•ã„åˆã‚ã›ç•ªå·ç…§ä¼šAPIã«æ¥ç¶šã—ã¾ã™ã€‚<br>
          APIã‚­ãƒ¼ã¯Kintoneç’°å¢ƒå¤‰æ•°ã‹ã‚‰è‡ªå‹•èª­ã¿è¾¼ã¿ã•ã‚Œã¾ã™ã€‚
        </div>
        <div style="margin-bottom:10px">
          <div style="font-size:10px;color:var(--muted);margin-bottom:5px">APIã‚¨ãƒ³ãƒ‰ãƒã‚¤ãƒ³ãƒˆ</div>
          <div style="background:var(--hover);border:1px solid var(--border);border-radius:6px;padding:8px 12px;font-family:'DM Mono',monospace;font-size:11px;color:var(--sub)">
            https://trackings.post.japanpost.jp/services/srv/search/
          </div>
        </div>
        <div style="display:grid;grid-template-columns:1fr 1fr;gap:8px">
          <button onclick="testApiConnection()" style="padding:8px;background:var(--hover);border:1px solid var(--border);color:var(--sub);border-radius:6px;cursor:pointer;font-size:11px;font-family:inherit">ğŸ”Œ æ¥ç¶šãƒ†ã‚¹ãƒˆ</button>
          <button onclick="refreshAllTracking()" style="padding:8px;background:var(--gold);color:#0d0f14;border:none;border-radius:6px;cursor:pointer;font-size:11px;font-weight:700;font-family:inherit">ğŸ”„ å…¨ä»¶æ›´æ–°</button>
        </div>
      </div>

      <!-- å˜ä½“è¿½è·¡ -->
      <div class="card" style="margin-bottom:16px">
        <div class="card-title">æ‰‹å‹• è¿½è·¡ç•ªå·ç…§ä¼š</div>
        <div style="display:flex;gap:8px;margin-bottom:10px">
          <input id="manual-track-no" type="text" maxlength="12" placeholder="12æ¡ã®è¿½è·¡ç•ªå·ã‚’å…¥åŠ›ã¾ãŸã¯ã‚¹ã‚­ãƒ£ãƒ³"
            onkeydown="if(event.key==='Enter')lookupTracking()"
            style="flex:1;background:var(--hover);border:1px solid var(--border);border-radius:6px;padding:8px 12px;color:#e8eaf0;font-family:'DM Mono',monospace;font-size:13px;outline:none">
          <button onclick="lookupTracking()" style="background:var(--gold);color:#0d0f14;border:none;border-radius:6px;padding:8px 14px;cursor:pointer;font-size:12px;font-weight:700;font-family:inherit">ç…§ä¼š</button>
        </div>
        <div id="manual-track-result" style="font-size:12px;color:var(--muted);min-height:40px"></div>
      </div>

      <!-- è‡ªå‹•æ›´æ–°è¨­å®š -->
      <div class="card">
        <div class="card-title">è‡ªå‹•æ›´æ–°è¨­å®š</div>
        <div style="display:flex;align-items:center;justify-content:space-between;margin-bottom:12px">
          <div style="font-size:12px">è¿½è·¡è‡ªå‹•æ›´æ–°</div>
          <label style="display:flex;align-items:center;gap:8px;cursor:pointer">
            <input type="checkbox" id="auto-refresh-toggle" onchange="toggleAutoRefresh()" style="width:14px;height:14px;accent-color:var(--gold)">
            <span style="font-size:11px;color:var(--muted)">ON</span>
          </label>
        </div>
        <div style="display:flex;align-items:center;gap:10px">
          <div style="font-size:12px;color:var(--muted)">æ›´æ–°é–“éš”</div>
          <select id="refresh-interval" style="background:var(--hover);border:1px solid var(--border);border-radius:6px;padding:4px 10px;color:#e8eaf0;font-size:12px;font-family:inherit">
            <option value="300">5åˆ†</option>
            <option value="600" selected>10åˆ†</option>
            <option value="1800">30åˆ†</option>
            <option value="3600">1æ™‚é–“</option>
          </select>
        </div>
        <div style="margin-top:10px;font-size:10px;color:var(--muted)" id="auto-refresh-status">è‡ªå‹•æ›´æ–°: åœæ­¢ä¸­</div>
      </div>
    </div>

    <!-- å³ï¼šè¿½è·¡å¯¾è±¡ä¸€è¦§ -->
    <div>
      <div class="s-label" style="margin-bottom:12px">ğŸ“‹ è¿½è·¡å¯¾è±¡ä¸€è¦§</div>

      <!-- ãƒ•ã‚£ãƒ«ã‚¿ãƒ¼ -->
      <div style="display:flex;gap:8px;margin-bottom:12px">
        <select id="postal-filter-status" onchange="renderPostalList()" style="background:var(--hover);border:1px solid var(--border);border-radius:6px;padding:6px 10px;color:#e8eaf0;font-size:11px;font-family:inherit">
          <option value="">å…¨ã‚¹ãƒ†ãƒ¼ã‚¿ã‚¹</option>
          <option value="transit">é…é€ä¸­</option>
          <option value="delivered">é…é”å®Œäº†</option>
          <option value="waiting">è¿”é€å¾…ã¡</option>
          <option value="returned">è¿”é€å—å–æ¸ˆ</option>
          <option value="absent">ä¸åœ¨æŒæˆ»ã‚Š</option>
        </select>
        <select id="postal-filter-dir" onchange="renderPostalList()" style="background:var(--hover);border:1px solid var(--border);border-radius:6px;padding:6px 10px;color:#e8eaf0;font-size:11px;font-family:inherit">
          <option value="">å¾€è·¯ãƒ»è¿”è·¯</option>
          <option value="outbound">å¾€è·¯ï¼ˆâ†’ã‚¯ãƒ©ã‚¤ã‚¢ãƒ³ãƒˆï¼‰</option>
          <option value="return">è¿”è·¯ï¼ˆâ†’æœ¬éƒ¨ï¼‰</option>
        </select>
      </div>

      <!-- è¿½è·¡ä¸€è¦§ -->
      <div id="postal-list" style="display:flex;flex-direction:column;gap:8px;max-height:500px;overflow-y:auto">
        <!-- JSå‹•çš„ç”Ÿæˆ -->
      </div>
    </div>

  </div>
</div>

<!-- ================================================================ -->
<!-- TAB: SETUP -->
<!-- ================================================================ -->
<div id="tab-setup" class="page">

  <div class="card">
    <div class="card-title">âš¡ ã‚·ã‚¹ãƒ†ãƒ å…¨ä½“ãƒ•ãƒ­ãƒ¼</div>
    <div class="flow-row">
      <div class="flow-box hl">ãƒ©ãƒ™ãƒ«å°åˆ·æ™‚<br>ãƒãƒ¼ã‚³ãƒ¼ãƒ‰è‡ªå‹•ç”Ÿæˆ</div>
      <div class="flow-arr">â†’</div>
      <div class="flow-box">ç™ºé€å‰ã«<br>ã‚¹ã‚­ãƒ£ãƒ³</div>
      <div class="flow-arr">â†’</div>
      <div class="flow-box hl-blue">Kintone ã«<br>ã‚¹ãƒ†ãƒ¼ã‚¿ã‚¹è¨˜éŒ²</div>
      <div class="flow-arr">â†’</div>
      <div class="flow-box">ã‚¨ãƒ¼ã‚¸ã‚§ãƒ³ãƒˆã«<br>Slacké€šçŸ¥</div>
      <div class="flow-arr">â†’</div>
      <div class="flow-box">è¿”é€å—å–æ™‚<br>å†ã‚¹ã‚­ãƒ£ãƒ³</div>
      <div class="flow-arr">â†’</div>
      <div class="flow-box hl-blue">Kintone è‡ªå‹•æ›´æ–°<br>ã‚¿ã‚¤ãƒ ãƒ©ã‚¤ãƒ³å®Œæˆ</div>
    </div>
    <div style="font-size:12px;color:var(--sub)">Honeywell 1200g ã¯USBã‚­ãƒ¼ãƒœãƒ¼ãƒ‰ã¨ã—ã¦èªè­˜ã•ã‚Œã‚‹ãŸã‚ã€ã‚¹ã‚­ãƒ£ãƒ³ç”»é¢ã«ãƒ•ã‚©ãƒ¼ã‚«ã‚¹ã‚’å½“ã¦ã‚‹ã ã‘ã§è‡ªå‹•å…¥åŠ›ã•ã‚Œã¾ã™ã€‚ã‚¨ãƒ³ã‚¿ãƒ¼ã‚­ãƒ¼æŠ¼ä¸‹ã‚‚ä¸è¦ã§ã™ï¼ˆè‡ªå‹•é€ä¿¡ï¼‰ã€‚</div>
  </div>

  <div class="card">
    <div class="card-title">ğŸ”§ å°å…¥æ‰‹é †</div>

    <div class="step">
      <div class="step-num">1</div>
      <div>
        <div class="step-title">Kintoneã€Œãƒ¬ã‚¿ãƒ¼ãƒ‘ãƒƒã‚¯è¿½è·¡ã€ã‚¢ãƒ—ãƒªã«ãƒ•ã‚£ãƒ¼ãƒ«ãƒ‰ã‚’è¿½åŠ </div>
        <div class="step-desc">
          æ—¢å­˜ã®è¿½è·¡ç•ªå·ãƒ•ã‚£ãƒ¼ãƒ«ãƒ‰ã«åŠ ãˆã¦ä»¥ä¸‹ã‚’è¿½åŠ ï¼š<br>
          <code>ãƒãƒ¼ã‚³ãƒ¼ãƒ‰ID</code>ï¼ˆãƒ†ã‚­ã‚¹ãƒˆï¼‰ã€€<code>ãƒ©ãƒ™ãƒ«ç¨®åˆ¥</code>ï¼ˆãƒ‰ãƒ­ãƒƒãƒ—ãƒ€ã‚¦ãƒ³ï¼‰<br>
          <code>ã‚¹ã‚­ãƒ£ãƒ³ã‚¹ãƒ†ãƒ¼ã‚¿ã‚¹</code>ï¼ˆãƒ‰ãƒ­ãƒƒãƒ—ãƒ€ã‚¦ãƒ³ï¼‰ã€€<code>ã‚¹ã‚­ãƒ£ãƒ³æ—¥æ™‚</code>ï¼ˆæ—¥æ™‚ï¼‰<br>
          <code>ã‚¹ã‚­ãƒ£ãƒ³æ‹…å½“è€…</code>ï¼ˆãƒ¦ãƒ¼ã‚¶ãƒ¼é¸æŠï¼‰
        </div>
      </div>
    </div>

    <div class="step">
      <div class="step-num">2</div>
      <div>
        <div class="step-title">ãƒãƒ¼ã‚³ãƒ¼ãƒ‰IDã®è‡ªå‹•æ¡ç•ªã‚’Kintoneã«è¨­å®š</div>
        <div class="step-desc">
          å¥‘ç´„ãƒ¬ã‚³ãƒ¼ãƒ‰ä½œæˆæ™‚ã«Zapierã§è‡ªå‹•ç”Ÿæˆï¼š<br>
          <code>{{æ¡ˆä»¶ID}}-CONTRACT</code>ã€€<code>{{æ¡ˆä»¶ID}}-KEY</code>ã€€<code>{{æ¡ˆä»¶ID}}-RETURN</code>ã€€<code>{{æ¡ˆä»¶ID}}-MGMT</code><br>
          ã“ã‚Œã‚’ãƒ©ãƒ™ãƒ«å°åˆ·ãƒ†ãƒ³ãƒ—ãƒ¬ãƒ¼ãƒˆï¼ˆP-touch Editorï¼‰ã«å·®ã—è¾¼ã‚€ã“ã¨ã§ãƒãƒ¼ã‚³ãƒ¼ãƒ‰ãŒè‡ªå‹•ç”Ÿæˆã•ã‚Œã¾ã™ã€‚
        </div>
      </div>
    </div>

    <div class="step">
      <div class="step-num">3</div>
      <div>
        <div class="step-title">P-touch Editor ã§ãƒãƒ¼ã‚³ãƒ¼ãƒ‰ãƒ•ã‚£ãƒ¼ãƒ«ãƒ‰ã‚’è¿½åŠ </div>
        <div class="step-desc">
          æ—¢å­˜ãƒ©ãƒ™ãƒ«ãƒ†ãƒ³ãƒ—ãƒ¬ãƒ¼ãƒˆï¼ˆ.lbxï¼‰ã‚’é–‹ãã€ä¸‹éƒ¨ã«ã€Œãƒãƒ¼ã‚³ãƒ¼ãƒ‰ã‚ªãƒ–ã‚¸ã‚§ã‚¯ãƒˆã€ã‚’è¿½åŠ ã€‚<br>
          ãƒãƒ¼ã‚³ãƒ¼ãƒ‰ç¨®åˆ¥ï¼š<code>Code 128</code>ï¼ˆè‹±æ•°å­—ãƒ»è¨˜å·å¯¾å¿œãƒ»Honeywellç¢ºå®Ÿèª­å–ï¼‰<br>
          ãƒ‡ãƒ¼ã‚¿ã‚½ãƒ¼ã‚¹ï¼šKintoneã®<code>ãƒãƒ¼ã‚³ãƒ¼ãƒ‰ID</code>ãƒ•ã‚£ãƒ¼ãƒ«ãƒ‰ã‚’å·®ã—è¾¼ã¿<br>
          ã‚µã‚¤ã‚ºï¼šé«˜ã• 8mm ç¨‹åº¦ï¼ˆãƒ©ãƒ™ãƒ«ä¸‹éƒ¨ã«åã¾ã‚‹ã‚µã‚¤ã‚ºï¼‰
        </div>
      </div>
    </div>

    <div class="step">
      <div class="step-num">4</div>
      <div>
        <div class="step-title">ã‚¹ã‚­ãƒ£ãƒ³å°‚ç”¨ç”»é¢ã‚’Kintoneã«ä½œæˆ</div>
        <div class="step-desc">
          Kintone ã‚«ã‚¹ã‚¿ãƒ ãƒ“ãƒ¥ãƒ¼ã§ã€Œã‚¹ã‚­ãƒ£ãƒ³ãƒ‡ã‚¹ã‚¯ã€ç”»é¢ã‚’ä½œæˆï¼ˆã“ã®ãƒ‡ãƒ¢ã®ã‚ˆã†ãªç”»é¢ï¼‰ã€‚<br>
          ã‚¹ãƒ†ãƒ¼ã‚¿ã‚¹ã‚’é¸æŠ â†’ ã‚¹ã‚­ãƒ£ãƒ³ã™ã‚‹ã¨ãƒãƒ¼ã‚³ãƒ¼ãƒ‰IDã‚’æ¤œç´¢ â†’ å¯¾å¿œãƒ¬ã‚³ãƒ¼ãƒ‰ã«è‡ªå‹•æ›¸ãè¾¼ã¿ã€‚<br>
          JavaScriptã‚³ãƒ¼ãƒ‰ã¯Claudeã«ä¾é ¼ã™ã‚Œã°ç”Ÿæˆã§ãã¾ã™ã€‚æ‰€è¦æ™‚é–“ 30åˆ†ç¨‹åº¦ã€‚
        </div>
      </div>
    </div>

    <div class="step">
      <div class="step-num">5</div>
      <div>
        <div class="step-title">å—å–æ‹’å¦ãƒ»ä¸åœ¨æ™‚ã®Slackè‡ªå‹•é€šçŸ¥ã‚’è¨­å®š</div>
        <div class="step-desc">
          Zapierï¼šKintoneã®<code>ã‚¹ã‚­ãƒ£ãƒ³ã‚¹ãƒ†ãƒ¼ã‚¿ã‚¹</code>ãŒã€Œå—å–æ‹’å¦ãƒ»ä¸åœ¨ã€ã«ãªã£ãŸã‚‰ â†’ Slackã§æ‹…å½“ã‚¨ãƒ¼ã‚¸ã‚§ãƒ³ãƒˆã«é€šçŸ¥ã€‚<br>
          é€šçŸ¥å†…å®¹ï¼šæ¡ˆä»¶IDãƒ»é¡§å®¢åãƒ»ãƒ¬ã‚¿ãƒ¼ãƒ‘ãƒƒã‚¯ç¨®åˆ¥ãƒ»æ—¥æ™‚ã‚’è‡ªå‹•å«ã‚ã‚‹ã€‚<br>
          ã‚¨ãƒ¼ã‚¸ã‚§ãƒ³ãƒˆãŒå³åº§ã«é¡§å®¢ã«é€£çµ¡ã§ãã‚‹ä½“åˆ¶ã«ãªã‚Šã¾ã™ã€‚
        </div>
      </div>
    </div>

    <div class="step">
      <div class="step-num">6</div>
      <div>
        <div class="step-title">æ—¥æœ¬éƒµä¾¿APIã®è‡ªå‹•è¿½è·¡ã¨çµ±åˆï¼ˆæ—¢å­˜æ©Ÿèƒ½ï¼‰</div>
        <div class="step-desc">
          ãƒã‚¹ã‚¿ãƒ¼ãƒ—ãƒ©ãƒ³ã«ã‚ã‚‹æ—¥æœ¬éƒµä¾¿APIè¿½è·¡ã¨ã€ä»Šå›ã®ãƒãƒ¼ã‚³ãƒ¼ãƒ‰ã‚¹ã‚­ãƒ£ãƒ³ã‚’åŒä¸€ã‚¿ã‚¤ãƒ ãƒ©ã‚¤ãƒ³ã«è¡¨ç¤ºã€‚<br>
          â†’ ã€Œäº‹å‹™æ‰€ã‹ã‚‰ç™ºé€ï¼ˆã‚¹ã‚­ãƒ£ãƒ³è¨˜éŒ²ï¼‰ã€ï¼‹ã€Œéƒµä¾¿å±€ã®é…é”çŠ¶æ³ï¼ˆAPIå–å¾—ï¼‰ã€ï¼‹ã€Œäº‹å‹™æ‰€ã§å—å–ï¼ˆã‚¹ã‚­ãƒ£ãƒ³è¨˜éŒ²ï¼‰ã€ãŒ1ç”»é¢ã§ç¢ºèªã§ãã¾ã™ã€‚
        </div>
      </div>
    </div>

    <div class="hint">
      ğŸ’¡ <strong style="color:#e8eaf0">è¿½åŠ è²»ç”¨ï¼šã‚¼ãƒ­</strong>ã€‚Honeywell 1200gã¯ã™ã§ã«ãƒã‚¹ã‚¿ãƒ¼ãƒ—ãƒ©ãƒ³ã«å«ã¾ã‚Œã¦ãŠã‚Šã€P-touch Editorã®Code 128ç”Ÿæˆã‚‚ç„¡æ–™ã§ã™ã€‚Kintoneã®ã‚«ã‚¹ã‚¿ãƒã‚¤ã‚ºã¨ã—ã¦ãƒ•ã‚£ãƒ¼ãƒ«ãƒ‰è¿½åŠ ãƒ»JavaScriptå®Ÿè£…ã®ã¿å¿…è¦ã§ã™ã€‚<br><br>
      ğŸ’¡ <strong style="color:#e8eaf0">Kintoneé€£æºã‚³ãƒ¼ãƒ‰</strong>ã¯ã€Œã‚¹ã‚­ãƒ£ãƒ³ç”»é¢ã®JavaScriptã‚’Kintoneå‘ã‘ã«æ›¸ã„ã¦ã€ã¨ä¾é ¼ã™ã‚Œã°ã™ãç”Ÿæˆã§ãã¾ã™ã€‚
    </div>
  </div>
</div>

<!-- ãƒˆãƒ¼ã‚¹ãƒˆ -->
<div class="toast" id="toast"></div>

<script>
// ===== ãƒ‡ãƒ¼ã‚¿ =====
const caseDB = {
  'C001-CONTRACT': { caseId:'C-001', caseName:'æ± è¢‹ãƒãƒ³ã‚·ãƒ§ãƒ³ 101å·å®¤', dest:'ç”°ä¸­ èŠ±å­ æ§˜', type:'ğŸ“„ å¥‘ç´„æ›¸é€ä»˜' },
  'C001-KEY':      { caseId:'C-001', caseName:'æ± è¢‹ãƒãƒ³ã‚·ãƒ§ãƒ³ 101å·å®¤', dest:'ç”°ä¸­ èŠ±å­ æ§˜', type:'ğŸ”‘ éµé€ä»˜' },
  'C001-RETURN':   { caseId:'C-001', caseName:'æ± è¢‹ãƒãƒ³ã‚·ãƒ§ãƒ³ 101å·å®¤', dest:'CORETOäº‹å‹™æ‰€', type:'â†©ï¸ è¿”ä¿¡ç”¨' },
  'C001-MGMT':     { caseId:'C-001', caseName:'æ± è¢‹ãƒãƒ³ã‚·ãƒ§ãƒ³ 101å·å®¤', dest:'æ ªå¼ä¼šç¤¾æ± è¢‹ç®¡ç†', type:'ğŸ¢ ç®¡ç†ä¼šç¤¾å®›' },
  'C002-CONTRACT': { caseId:'C-002', caseName:'æ–°å®¿ã‚¢ãƒ‘ãƒ¼ãƒˆ 201å·å®¤', dest:'å±±ç”° å¤ªéƒ æ§˜', type:'ğŸ“„ å¥‘ç´„æ›¸é€ä»˜' },
  'C002-KEY':      { caseId:'C-002', caseName:'æ–°å®¿ã‚¢ãƒ‘ãƒ¼ãƒˆ 201å·å®¤', dest:'å±±ç”° å¤ªéƒ æ§˜', type:'ğŸ”‘ éµé€ä»˜' },
  'C002-RETURN':   { caseId:'C-002', caseName:'æ–°å®¿ã‚¢ãƒ‘ãƒ¼ãƒˆ 201å·å®¤', dest:'CORETOäº‹å‹™æ‰€', type:'â†©ï¸ è¿”ä¿¡ç”¨' },
  'C002-MGMT':     { caseId:'C-002', caseName:'æ–°å®¿ã‚¢ãƒ‘ãƒ¼ãƒˆ 201å·å®¤', dest:'æ ªå¼ä¼šç¤¾æ–°å®¿ç®¡ç†', type:'ğŸ¢ ç®¡ç†ä¼šç¤¾å®›' },
  'C003-CONTRACT': { caseId:'C-003', caseName:'æ¸‹è°·åŒºä»£ã€…æœ¨ 2LDK', dest:'éˆ´æœ¨ ä¸€éƒ æ§˜', type:'ğŸ“„ å¥‘ç´„æ›¸é€ä»˜' },
  'C003-KEY':      { caseId:'C-003', caseName:'æ¸‹è°·åŒºä»£ã€…æœ¨ 2LDK', dest:'éˆ´æœ¨ ä¸€éƒ æ§˜', type:'ğŸ”‘ éµé€ä»˜' },
  'C003-RETURN':   { caseId:'C-003', caseName:'æ¸‹è°·åŒºä»£ã€…æœ¨ 2LDK', dest:'CORETOäº‹å‹™æ‰€', type:'â†©ï¸ è¿”ä¿¡ç”¨' },
  'C003-MGMT':     { caseId:'C-003', caseName:'æ¸‹è°·åŒºä»£ã€…æœ¨ 2LDK', dest:'æ ªå¼ä¼šç¤¾æ¸‹è°·ç®¡ç†', type:'ğŸ¢ ç®¡ç†ä¼šç¤¾å®›' },
};

const statusMap = {
  shipped:  { label:'ğŸ“¤ ç™ºé€', cls:'badge-shipped', btnCls:'active-shipped' },
  received: { label:'ğŸ“¥ å—å–', cls:'badge-received', btnCls:'active-received' },
  stored:   { label:'ğŸ“¦ ä¿ç®¡ä¸­', cls:'badge-stored', btnCls:'active-stored' },
  rejected: { label:'ğŸš« å—å–æ‹’å¦ãƒ»ä¸åœ¨', cls:'badge-rejected', btnCls:'active-rejected' },
};

let currentStatus = 'shipped';
let pendingScan = null;

// ===== ã‚¹ãƒ†ãƒ¼ã‚¿ã‚¹é¸æŠ =====
function selectStatus(s) {
  currentStatus = s;
  document.querySelectorAll('.status-btn').forEach(b => {
    b.className = 'status-btn';
  });
  const btn = document.getElementById('btn-'+s);
  btn.className = 'status-btn ' + statusMap[s].btnCls;
  document.getElementById('scan-input').focus();
}

// ===== ã‚¹ã‚­ãƒ£ãƒ³å…¥åŠ› =====
function onScanFocus() {
  const area = document.getElementById('scan-area');
  area.classList.add('focused');
  document.getElementById('scan-hint').textContent = 'âœ… ã‚¹ã‚­ãƒ£ãƒ³æº–å‚™å®Œäº† â€• ãƒãƒ¼ã‚³ãƒ¼ãƒ‰ã‚’èª­ã¿å–ã£ã¦ãã ã•ã„';
}
function onScanBlur() {
  const area = document.getElementById('scan-area');
  if (!area.classList.contains('success')) {
    area.classList.remove('focused');
    document.getElementById('scan-hint').textContent = 'ã‚¹ã‚­ãƒ£ãƒŠãƒ¼ã‚’ã“ã“ã«å‘ã‘ã¦ãƒãƒ¼ã‚³ãƒ¼ãƒ‰ã‚’èª­ã¿å–ã‚‹ã‹ã€ã‚¯ãƒªãƒƒã‚¯ã—ã¦æ‰‹å…¥åŠ›';
  }
}

function handleScanInput(e) {
  // Honeywell ã¯ Enter ã‚’è‡ªå‹•é€ä¿¡ã™ã‚‹ã®ã§Enterã§ç¢ºå®š
  if (e.key === 'Enter') {
    const val = e.target.value.trim().toUpperCase();
    if (val) processScan(val);
    e.preventDefault();
  }
}

function processScan(code) {
  const area = document.getElementById('scan-area');
  const result = document.getElementById('scan-result');
  const input = document.getElementById('scan-input');

  const found = caseDB[code];
  if (!found) {
    area.classList.add('error');
    area.classList.remove('focused');
    showToast('âŒ ãƒãƒ¼ã‚³ãƒ¼ãƒ‰ãŒè¦‹ã¤ã‹ã‚Šã¾ã›ã‚“: ' + code, true);
    input.value = '';
    setTimeout(() => { area.classList.remove('error'); area.classList.add('focused'); input.focus(); }, 1500);
    return;
  }

  pendingScan = { code, data: found, status: currentStatus };

  const st = statusMap[currentStatus];
  const now = new Date();
  const timeStr = now.getHours().toString().padStart(2,'0') + ':' + now.getMinutes().toString().padStart(2,'0');

  document.getElementById('result-case-id').textContent = found.caseId + ' â€• ' + code;
  document.getElementById('result-case-name').textContent = found.caseName;
  document.getElementById('result-label-type').textContent = found.type;
  document.getElementById('result-dest').textContent = found.dest;
  document.getElementById('result-time').textContent = timeStr;

  const badge = document.getElementById('result-badge');
  badge.textContent = st.label;
  badge.className = 'result-status-badge ' + st.cls;

  area.classList.remove('focused','error');
  area.classList.add('success');
  result.classList.add('visible');
  input.value = '';
}

function confirmScan() {
  if (!pendingScan) return;
  const { code, data, status } = pendingScan;
  const st = statusMap[status];
  const now = new Date();
  const timeStr = now.getHours().toString().padStart(2,'0') + ':' + now.getMinutes().toString().padStart(2,'0');

  // å±¥æ­´ã«è¿½åŠ 
  const list = document.getElementById('history-list');
  const row = document.createElement('div');
  row.className = 'history-row';
  row.innerHTML = `
    <span class="h-time">${timeStr}</span>
    <span class="h-code">${code}</span>
    <span class="h-case">${data.caseName} / ${data.dest}</span>
    <span class="h-badge ${st.cls}">${st.label}</span>
  `;
  list.insertBefore(row, list.firstChild);

  showToast('âœ… Kintoneã«è¨˜éŒ²ã—ã¾ã—ãŸ: ' + code + ' â†’ ' + st.label);

  // ãƒªã‚»ãƒƒãƒˆ
  document.getElementById('scan-result').classList.remove('visible');
  const area = document.getElementById('scan-area');
  area.classList.remove('success');
  area.classList.add('focused');
  document.getElementById('scan-hint').textContent = 'âœ… ã‚¹ã‚­ãƒ£ãƒ³æº–å‚™å®Œäº† â€• ãƒãƒ¼ã‚³ãƒ¼ãƒ‰ã‚’èª­ã¿å–ã£ã¦ãã ã•ã„';
  pendingScan = null;
  document.getElementById('scan-input').focus();
}

// ===== ãƒ©ãƒ™ãƒ«ãƒ—ãƒ¬ãƒ“ãƒ¥ãƒ¼ =====
function showLabelPreview(type, btn) {
  ['contract','key','return','mgmt'].forEach(t => {
    document.getElementById('lp-'+t).style.display = t===type ? 'block' : 'none';
  });
  document.querySelectorAll('.label-select-btn').forEach(b => b.classList.remove('active'));
  btn.classList.add('active');
}

// ===== ã‚¿ãƒ– =====
function showTab(t) {
  document.querySelectorAll('.page').forEach(p => p.classList.remove('active'));
  document.querySelectorAll('.tab').forEach(b => b.classList.remove('active'));
  document.getElementById('tab-'+t).classList.add('active');
  event.target.classList.add('active');
}

// ===== ãƒˆãƒ¼ã‚¹ãƒˆ =====
function showToast(msg, isError=false) {
  const toast = document.getElementById('toast');
  toast.textContent = msg;
  toast.className = 'toast' + (isError ? ' error-toast' : '');
  setTimeout(() => toast.classList.add('show'), 10);
  setTimeout(() => toast.classList.remove('show'), 3000);
}

// ===== ãƒãƒ¼ã‚³ãƒ¼ãƒ‰ç”Ÿæˆ =====
function generateBarcodes() {
  const barcodes = {
    'bc-contract': 'C003-CONTRACT',
    'bc-key':      'C003-KEY',
    'bc-return':   'C003-RETURN',
    'bc-mgmt':     'C003-MGMT',
  };
  Object.entries(barcodes).forEach(([id, val]) => {
    const el = document.getElementById(id);
    if (el) {
      JsBarcode(el, val, {
        format: 'CODE128',
        width: 1.2,
        height: 22,
        displayValue: false,
        margin: 0,
        background: 'transparent',
        lineColor: '#111',
      });
    }
  });
}

// ===== è¿½è·¡ãƒ†ãƒ¼ãƒ–ãƒ«ç”Ÿæˆ =====
function buildTrackingTable() {
  const rows = [
    { code:'C003-CONTRACT', caseName:'æ¸‹è°·ä»£ã€…æœ¨ 2LDK', dest:'éˆ´æœ¨ ä¸€éƒ æ§˜', type:'ğŸ“„ å¥‘ç´„æ›¸', status:'shipped', time:'2/19 14:22', agent:'å±±ç”° èª ', postal:'é…é€ä¸­' },
    { code:'C003-KEY',      caseName:'æ¸‹è°·ä»£ã€…æœ¨ 2LDK', dest:'éˆ´æœ¨ ä¸€éƒ æ§˜', type:'ğŸ”‘ éµ',    status:'',        time:'æœªç™ºé€',       agent:'å±±ç”° èª ', postal:'â€•' },
    { code:'C003-RETURN',   caseName:'æ¸‹è°·ä»£ã€…æœ¨ 2LDK', dest:'CORETOäº‹å‹™æ‰€', type:'â†©ï¸ è¿”ä¿¡ç”¨', status:'',        time:'æœªå—å–',       agent:'å±±ç”° èª ', postal:'â€•' },
    { code:'C001-CONTRACT', caseName:'æ± è¢‹ãƒãƒ³ã‚·ãƒ§ãƒ³ 101', dest:'ç”°ä¸­ èŠ±å­ æ§˜', type:'ğŸ“„ å¥‘ç´„æ›¸', status:'received', time:'2/19 09:12', agent:'é«˜æ©‹ æ˜', postal:'é…é”å®Œäº†' },
    { code:'C001-RETURN',   caseName:'æ± è¢‹ãƒãƒ³ã‚·ãƒ§ãƒ³ 101', dest:'CORETOäº‹å‹™æ‰€', type:'â†©ï¸ è¿”ä¿¡ç”¨', status:'stored', time:'2/18 16:30', agent:'é«˜æ©‹ æ˜', postal:'é…é”å®Œäº†' },
    { code:'C002-KEY',      caseName:'æ–°å®¿ã‚¢ãƒ‘ãƒ¼ãƒˆ 201', dest:'å±±ç”° å¤ªéƒ æ§˜', type:'ğŸ”‘ éµ',    status:'rejected', time:'2/18 11:05', agent:'ä¸­æ‘ ãƒªã‚«', postal:'ä¸åœ¨æŒæˆ»ã‚Š' },
  ];

  const tbody = document.getElementById('tracking-table-body');
  rows.forEach(r => {
    const st = r.status ? statusMap[r.status] : null;
    const tr = document.createElement('tr');
    tr.innerHTML = `
      <td style="font-family:'DM Mono',monospace;font-size:12px;color:var(--gold);padding:10px">${r.code}</td>
      <td style="font-size:12px;padding:10px">${r.caseName}<br><span style="font-size:11px;color:var(--muted)">${r.dest}</span></td>
      <td style="font-size:12px;padding:10px">${r.type}</td>
      <td style="padding:10px">${st ? `<span class="h-badge ${st.cls}" style="padding:4px 10px;border-radius:20px;font-size:11px;font-weight:600">${st.label}</span>` : '<span style="font-size:12px;color:var(--muted)">â€•</span>'}</td>
      <td style="font-family:'DM Mono',monospace;font-size:11px;color:var(--muted);padding:10px">${r.time}</td>
      <td style="font-size:12px;padding:10px">${r.agent}</td>
      <td style="font-size:11px;padding:10px;color:var(--sub)">${r.postal}</td>
    `;
    tbody.appendChild(tr);
  });
}

// åˆæœŸåŒ–
window.addEventListener('load', () => {
  generateBarcodes();
  buildTrackingTable();
  rcvFilterList();
  rcvRenderQueue();
  renderPostalList();
  document.getElementById('scan-input').focus();
});



// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
// æ›¸é¡å—å–ãƒ»ç®¡ç†ã‚¦ã‚£ã‚¶ãƒ¼ãƒ‰
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

const WAITING_CASES = [
  { caseId:'R042857', clientName:'ç”°ä¸­ é›„ä»‹', prop:'æ¸‹è°·åŒºæ¡œä¸˜ 2LDK', mgmt:'æ±æ€¥ãƒªãƒãƒ–ãƒ«ç®¡ç†', agent:'å±±ç”° èª ', agentId:'10012', agentSlack:'@yamada-makoto', zip:'150-0001', addr:'æ±äº¬éƒ½æ¸‹è°·åŒºæ¡œä¸˜ç”º5-3-2 ã‚µã‚¯ãƒ©ãƒã‚¤ãƒ„302', step:'contract_wait' },
  { caseId:'R039102', clientName:'æœ¨æ‘ å½©é¦™', prop:'å“å·åŒºå¤§å´ 1K',    mgmt:'å¤§å´ç®¡ç†',        agent:'éˆ´æœ¨ å¥å¤ª', agentId:'10023', agentSlack:'@suzuki-kenta', zip:'141-0031', addr:'æ±äº¬éƒ½å“å·åŒºè¥¿äº”åç”°1-2-3 ã‚°ãƒªãƒ¼ãƒ³ã‚³ãƒ¼ãƒˆ201', step:'contract_wait' },
  { caseId:'R041003', clientName:'æ–è—¤ äº®',   prop:'æ–°å®¿åŒºè¥¿æ–°å®¿ 1LDK', mgmt:'ä¸‰äº•ä½å‹ç®¡ç†',   agent:'æ¸¡è¾º éš†', agentId:'10041', agentSlack:'@watanabe-takashi', zip:'160-0023', addr:'æ±äº¬éƒ½æ–°å®¿åŒºè¥¿æ–°å®¿3-7-1 ãƒ‘ãƒ¼ã‚¯ãƒ“ãƒ¥ãƒ¼805', step:'contract_wait' },
  { caseId:'R038215', clientName:'ä½ã€…æœ¨ æµ', prop:'è±Šå³¶åŒºå—æ± è¢‹ 2LDK', mgmt:'æ± è¢‹ä¸å‹•ç”£ç®¡ç†',  agent:'ä½è—¤ èŠ±å­', agentId:'10008', agentSlack:'@sato-hanako', zip:'171-0022', addr:'æ±äº¬éƒ½è±Šå³¶åŒºå—æ± è¢‹2-25-5 ãƒ¡ã‚¾ãƒ³æ± è¢‹410', step:'contract_wait' },
  { caseId:'R044782', clientName:'ä¸­é‡ åš',   prop:'ç›®é»’åŒºä¸­ç›®é»’ 1LDK', mgmt:'æ±æ€¥ã‚³ãƒŸãƒ¥ãƒ‹ãƒ†ã‚£', agent:'æ¸¡è¾º éš†', agentId:'10041', agentSlack:'@watanabe-takashi', zip:'153-0051', addr:'æ±äº¬éƒ½ç›®é»’åŒºä¸Šç›®é»’3-6-7 ä¸­ç›®é»’ãƒ†ãƒ©ã‚¹302', step:'contract_wait' },
];

// å¾…æ©Ÿä¸­æ›¸é¡ã‚¹ãƒˆã‚¢ï¼ˆå—å–ç™»éŒ²å¾Œã«è¿½åŠ ï¼‰
let DOC_QUEUE = [
  { id:'DQ-001', caseId:'R042857', clientName:'ç”°ä¸­ é›„ä»‹', prop:'æ¸‹è°·åŒºæ¡œä¸˜ 2LDK', agent:'å±±ç”° èª ', agentId:'10012',
    docTypes:['contract','key'], memo:'', arrivedAt:'2026/2/24 10:30',
    status:'waiting_reply', mode:null, deadline:'2026/2/24 14:30',
    outboundNo:null, returnNo:null, scanFiles:[] },
  { id:'DQ-002', caseId:'R039102', clientName:'æœ¨æ‘ å½©é¦™', prop:'å“å·åŒºå¤§å´ 1K', agent:'éˆ´æœ¨ å¥å¤ª', agentId:'10023',
    docTypes:['contract'], memo:'', arrivedAt:'2026/2/23 15:10',
    status:'pickup_scheduled', mode:'pickup', deadline:null,
    outboundNo:null, returnNo:null, scanFiles:[] },
  { id:'DQ-003', caseId:'R041003', clientName:'æ–è—¤ äº®', prop:'æ–°å®¿åŒºè¥¿æ–°å®¿ 1LDK', agent:'æ¸¡è¾º éš†', agentId:'10041',
    docTypes:['contract','additional'], memo:'', arrivedAt:'2026/2/23 11:00',
    status:'in_transit', mode:'mail', deadline:null,
    outboundNo:'123456789012', returnNo:'234567890123', scanFiles:[] },
];

const DOC_TYPE_LABELS = { contract:'ğŸ“„ å¥‘ç´„æ›¸', key:'ğŸ”‘ éµ', additional:'ğŸ“ è¿½åŠ æ›¸é¡', other:'ğŸ“¦ ãã®ä»–' };
const QUEUE_STATUS_MAP = {
  arrived:          { label:'ğŸ“¬ åˆ°ç€æ¸ˆãƒ»æœªé€£çµ¡',  color:'var(--orange)', bg:'rgba(245,158,11,.12)' },
  waiting_reply:    { label:'â³ AGå›ç­”å¾…ã¡',      color:'var(--gold)',   bg:'rgba(201,168,76,.12)' },
  pickup_scheduled: { label:'ğŸ¢ å—å–äºˆå®š',        color:'var(--blue)',   bg:'rgba(59,130,246,.12)' },
  in_transit:       { label:'ğŸšš éƒµé€ä¸­',          color:'var(--sub)',    bg:'rgba(156,163,175,.1)' },
  delivered:        { label:'ğŸ“¬ é…é”å®Œäº†',        color:'var(--green)',  bg:'rgba(34,197,94,.12)'  },
  returned:         { label:'âœ… è¿”é€å—å–æ¸ˆ',       color:'#a855f7',      bg:'rgba(168,85,247,.12)' },
  complete:         { label:'âœ… å®Œäº†',            color:'var(--green)',  bg:'rgba(34,197,94,.12)'  },
};

// ã‚¦ã‚£ã‚¶ãƒ¼ãƒ‰çŠ¶æ…‹
let RCV = {
  step: 0,
  caseData: null,
  docTypes: new Set(),
  memo: '',
  scanFiles: [],
  mode: null,        // 'mail' | 'pickup'
  returnEnvelope: null,
  outboundNo: '',
  returnNo: '',
  dqId: null,
};

// â”€â”€â”€ ã‚¹ãƒ†ãƒƒãƒ—åˆ¶å¾¡ â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
function rcvGoStep(n) {
  for (let i = 0; i <= 4; i++) {
    const panel = document.getElementById('rcv-s' + i);
    if (panel) panel.style.display = i === n ? '' : 'none';
    const step = document.getElementById('rstep-' + i);
    if (step) {
      step.classList.remove('active', 'done');
      if (i < n) step.classList.add('done');
      else if (i === n) step.classList.add('active');
    }
  }
  RCV.step = n;
}

// â”€â”€â”€ STEP 0: åˆ°ç€ç™»éŒ² â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
function rcvFilterList() {
  const q = (document.getElementById('rcv-search').value || '').toLowerCase();
  const filtered = q
    ? WAITING_CASES.filter(d =>
        d.clientName.includes(q) || d.prop.toLowerCase().includes(q) ||
        d.mgmt.includes(q) || d.caseId.toLowerCase().includes(q) || d.agent.includes(q))
    : WAITING_CASES;
  rcvRenderCaseList(filtered);
}

function rcvRenderCaseList(list) {
  const el = document.getElementById('rcv-case-list');
  if (!list.length) { el.innerHTML = '<div style="text-align:center;padding:16px;color:var(--muted);font-size:11px">è©²å½“æ¡ˆä»¶ãªã—</div>'; return; }
  el.innerHTML = list.map(d => `
    <div class="rcv-case-row ${RCV.caseData && RCV.caseData.caseId===d.caseId ? 'selected':''}"
      onclick="rcvSelectCase('${d.caseId}')">
      <div style="display:flex;align-items:center;justify-content:space-between;margin-bottom:4px">
        <span style="font-family:'DM Mono',monospace;font-size:11px;color:var(--gold)">${d.caseId}</span>
        <span style="font-size:10px;color:var(--muted)">ğŸ‘¤ ${d.agent}</span>
      </div>
      <div style="font-weight:700;margin-bottom:2px">${d.clientName} æ§˜</div>
      <div style="display:flex;gap:10px;font-size:10px;color:var(--muted)">
        <span>ğŸ  ${d.prop}</span><span>ğŸ¢ ${d.mgmt}</span>
      </div>
    </div>`).join('');
}

function rcvSelectCase(caseId) {
  RCV.caseData = WAITING_CASES.find(d => d.caseId === caseId);
  rcvFilterList();
  const card = document.getElementById('rcv-case-selected');
  const info = document.getElementById('rcv-case-selected-info');
  card.style.display = 'block';
  const d = RCV.caseData;
  info.innerHTML = [
    ['æ¡ˆä»¶ID', `<span style="font-family:'DM Mono',monospace;color:var(--gold)">${d.caseId}</span>`],
    ['ã‚¯ãƒ©ã‚¤ã‚¢ãƒ³ãƒˆ', `<strong>${d.clientName} æ§˜</strong>`],
    ['ç‰©ä»¶', d.prop],
    ['æ‹…å½“AG', d.agent],
    ['ç®¡ç†ä¼šç¤¾', d.mgmt],
  ].map(([k,v]) => `<div><div style="font-size:9px;color:var(--muted);margin-bottom:1px">${k}</div><div style="font-size:12px">${v}</div></div>`).join('');
  rcvCheckStep0Ready();
}

function rcvClearCase() {
  RCV.caseData = null;
  document.getElementById('rcv-case-selected').style.display = 'none';
  rcvFilterList();
  rcvCheckStep0Ready();
}

function rcvToggleDocType(type) {
  const btn = document.getElementById('dt-' + type);
  if (RCV.docTypes.has(type)) { RCV.docTypes.delete(type); btn.classList.remove('selected'); }
  else { RCV.docTypes.add(type); btn.classList.add('selected'); }
  rcvCheckStep0Ready();
}

function rcvCheckStep0Ready() {
  const ready = RCV.caseData && RCV.docTypes.size > 0;
  const btn = document.getElementById('rcv-next-0');
  btn.disabled = !ready;
  btn.style.opacity = ready ? '1' : '.4';
}

function rcvStep0Next() {
  RCV.memo = document.getElementById('rcv-memo').value;
  // ã‚¹ã‚­ãƒ£ãƒ³ã‚¹ãƒ†ãƒƒãƒ—ãŒå¿…è¦ã‹ï¼ˆå¥‘ç´„æ›¸ã¾ãŸã¯è¿½åŠ æ›¸é¡ï¼‰
  const needScan = RCV.docTypes.has('contract') || RCV.docTypes.has('additional');
  rcvBuildScanPanel();
  rcvGoStep(1);
}

// â”€â”€â”€ STEP 1: ã‚¹ã‚­ãƒ£ãƒ³ â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
function rcvBuildScanPanel() {
  const list = document.getElementById('scan-doc-list');
  const types = [...RCV.docTypes];
  list.innerHTML = types.map(t => `
    <div style="background:var(--hover);border:1px solid var(--border);border-radius:8px;padding:10px 12px;display:flex;align-items:center;gap:10px">
      <span style="font-size:18px">${t==='contract'?'ğŸ“„':t==='key'?'ğŸ”‘':t==='additional'?'ğŸ“':'ğŸ“¦'}</span>
      <div style="flex:1">
        <div style="font-size:12px;font-weight:700">${DOC_TYPE_LABELS[t]}</div>
        <div style="font-size:10px;color:var(--muted)">${t==='contract'?'ã‚¹ã‚­ãƒ£ãƒ³å¿…é ˆ':t==='key'?'å†™çœŸã§è¨˜éŒ²':t==='additional'?'ã‚¹ã‚­ãƒ£ãƒ³æ¨å¥¨':'ä»»æ„'}</div>
      </div>
      <div id="scan-status-${t}" style="font-size:10px;color:var(--muted)">æœªã‚¹ã‚­ãƒ£ãƒ³</div>
    </div>`).join('');
}

function triggerScanUpload() { document.getElementById('scan-file-input').click(); }
function handleScanDrop(e) { e.preventDefault(); handleScanFiles({ target: { files: e.dataTransfer.files } }); }
function handleScanFiles(e) {
  const files = [...e.target.files];
  RCV.scanFiles = [...RCV.scanFiles, ...files];
  const listEl = document.getElementById('scan-file-list');
  listEl.innerHTML = RCV.scanFiles.map((f, i) =>
    `<div style="display:flex;align-items:center;gap:6px;margin-bottom:4px">
      <span style="color:var(--green)">âœ“</span>
      <span>${f.name}</span>
      <span style="color:var(--muted);font-size:10px">(${(f.size/1024).toFixed(0)}KB)</span>
      <button onclick="rcvRemoveScanFile(${i})" style="background:transparent;border:none;color:var(--red);cursor:pointer;font-size:10px">âœ•</button>
    </div>`).join('');
  // Update per-type status
  RCV.docTypes.forEach(t => {
    const el = document.getElementById('scan-status-' + t);
    if (el) { el.textContent = 'âœ… ã‚¹ã‚­ãƒ£ãƒ³æ¸ˆ'; el.style.color = 'var(--green)'; }
  });
}
function rcvRemoveScanFile(i) {
  RCV.scanFiles.splice(i, 1);
  handleScanFiles({ target: { files: [] } });
}

function rcvStep1Next() { rcvBuildSlackPreview(); rcvGoStep(2); }
function rcvStep1Skip() { rcvBuildSlackPreview(); rcvGoStep(2); }

// â”€â”€â”€ STEP 2: Slacké€šçŸ¥ â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
function rcvBuildSlackPreview() {
  const d = RCV.caseData;
  const docStr = [...RCV.docTypes].map(t => DOC_TYPE_LABELS[t]).join('ã€');
  const deadline = document.getElementById('rcv-deadline') ? document.getElementById('rcv-deadline').value : '4';
  const now = new Date();
  const deadlineTime = new Date(now.getTime() + parseInt(deadline) * 3600000);
  const timeStr = deadlineTime.getHours() + ':' + String(deadlineTime.getMinutes()).padStart(2,'0');

  document.getElementById('rcv-agent-target').textContent = `${d.agent}ï¼ˆ${d.agentSlack}ï¼‰`;
  document.getElementById('slack-msg-preview').innerHTML = `
    <div style="margin-bottom:8px">ğŸ“¬ <strong>${d.agent}</strong> ã•ã‚“ã€ä»¥ä¸‹ã®æ›¸é¡ãŒæœ¬éƒ¨ã«å±Šãã¾ã—ãŸã€‚</div>
    <div style="background:#2a2a35;border-left:3px solid var(--gold);padding:8px 12px;border-radius:0 6px 6px 0;margin-bottom:8px;font-size:11px">
      <div>æ¡ˆä»¶: <strong>${d.caseId}</strong> ${d.clientName} æ§˜ | ${d.prop}</div>
      <div>æ›¸é¡: ${docStr}</div>
      ${RCV.memo ? `<div>å‚™è€ƒ: ${RCV.memo}</div>` : ''}
    </div>
    <div style="margin-bottom:8px">å—å–æ–¹æ³•ã‚’é¸æŠã—ã¦ãã ã•ã„ï¼ˆæœŸé™: <strong>æœ¬æ—¥${timeStr}</strong>ã¾ã§ï¼‰</div>
    <div style="display:flex;gap:8px">
      <div style="background:#1d6fa4;border-radius:4px;padding:6px 14px;font-size:11px;cursor:pointer">ğŸ“® éƒµé€å¸Œæœ›</div>
      <div style="background:#2d6a4f;border-radius:4px;padding:6px 14px;font-size:11px;cursor:pointer">ğŸ¢ å—ã‘å–ã‚Šã«è¡Œã</div>
    </div>
    <div style="margin-top:8px;font-size:10px;color:#72767d">æœŸé™ã‚’éãã‚‹ã¨è‡ªå‹•çš„ã«éƒµé€å¯¾å¿œã¨ãªã‚Šã¾ã™</div>`;
}

function rcvSendSlack() {
  const d = RCV.caseData;
  document.getElementById('btn-send-slack').textContent = 'âŸ³ é€ä¿¡ä¸­...';
  setTimeout(() => {
    // Slack APIé€ä¿¡ï¼ˆæœ¬ç•ªå®Ÿè£…ï¼‰
    document.getElementById('btn-send-slack').textContent = 'âœ… é€ä¿¡æ¸ˆã¿';
    document.getElementById('btn-send-slack').style.background = '#27ae60';

    // DQã«è¿½åŠ 
    const dqEntry = {
      id: 'DQ-' + String(DOC_QUEUE.length + 1).padStart(3,'0'),
      caseId: d.caseId, clientName: d.clientName, prop: d.prop,
      agent: d.agent, agentId: d.agentId,
      docTypes: [...RCV.docTypes], memo: RCV.memo,
      arrivedAt: new Date().toLocaleString('ja-JP'),
      status: 'waiting_reply', mode: null, deadline: null,
      outboundNo: null, returnNo: null, scanFiles: RCV.scanFiles.map(f=>f.name),
    };
    DOC_QUEUE.unshift(dqEntry);
    RCV.dqId = dqEntry.id;
    rcvRenderQueue();

    // Simulate agent reply after 3s (demo)
    setTimeout(() => showToast('ğŸ’¬ å±±ç”° èª ã•ã‚“ã‹ã‚‰è¿”ç­”: å—ã‘å–ã‚Šã«è¡Œãã¾ã™'), 3000);

    // Move to step 3 with waiting mode UI
    rcvGoStep(3);
    document.getElementById('s3-title').textContent = 'â‘£ ã‚¨ãƒ¼ã‚¸ã‚§ãƒ³ãƒˆã®å›ç­”ã‚’å¾…ã£ã¦ã„ã¾ã™';
    document.getElementById('s3-mail').style.display = 'none';
    document.getElementById('s3-pickup').style.display = 'none';

    // Show mode selector
    const s3panel = document.getElementById('rcv-s3');
    let modeSelector = document.getElementById('s3-mode-selector');
    if (!modeSelector) {
      modeSelector = document.createElement('div');
      modeSelector.id = 's3-mode-selector';
      s3panel.querySelector('.rcv-panel').insertBefore(modeSelector, s3panel.querySelector('.rcv-panel').firstChild.nextSibling);
    }
    modeSelector.innerHTML = `
      <div style="background:rgba(245,158,11,.08);border:1px solid rgba(245,158,11,.3);border-radius:8px;padding:12px;margin-bottom:16px;font-size:12px;color:var(--orange)">
        â³ Slackã‚’é€ä¿¡ã—ã¾ã—ãŸã€‚ã‚¨ãƒ¼ã‚¸ã‚§ãƒ³ãƒˆã®è¿”ç­”ã‚’å¾…ã£ã¦ã„ã¾ã™...<br>
        <span style="font-size:10px;color:var(--muted)">ä¸‹è¨˜ã‹ã‚‰æ‰‹å‹•ã§ãƒ¢ãƒ¼ãƒ‰ã‚’é¸æŠã™ã‚‹ã“ã¨ã‚‚ã§ãã¾ã™</span>
      </div>
      <div style="display:grid;grid-template-columns:1fr 1fr;gap:10px">
        <button onclick="rcvSetMode('pickup')" style="padding:14px;background:rgba(34,197,94,.1);border:2px solid rgba(34,197,94,.4);color:var(--green);border-radius:10px;cursor:pointer;font-size:13px;font-weight:700;font-family:inherit">
          ğŸ¢ å—å–ãƒ¢ãƒ¼ãƒ‰ã«åˆ‡æ›¿
        </button>
        <button onclick="rcvSetMode('mail')" style="padding:14px;background:rgba(59,130,246,.1);border:2px solid rgba(59,130,246,.4);color:var(--blue);border-radius:10px;cursor:pointer;font-size:13px;font-weight:700;font-family:inherit">
          ğŸ“® éƒµé€ãƒ¢ãƒ¼ãƒ‰ã«åˆ‡æ›¿
        </button>
      </div>`;
  }, 800);
}

function rcvForceMailMode() { rcvSetMode('mail'); }

function rcvSetMode(mode) {
  RCV.mode = mode;
  const modeSelector = document.getElementById('s3-mode-selector');
  if (modeSelector) modeSelector.style.display = 'none';
  document.getElementById('s3-mail').style.display = mode === 'mail' ? '' : 'none';
  document.getElementById('s3-pickup').style.display = mode === 'pickup' ? '' : 'none';
  document.getElementById('s3-title').textContent = mode === 'mail' ? 'â‘£ éƒµé€å¯¾å¿œ' : 'â‘£ å—å–å¯¾å¿œ';
  // Update queue status
  const dq = DOC_QUEUE.find(d => d.id === RCV.dqId);
  if (dq) { dq.mode = mode; dq.status = mode === 'mail' ? 'in_transit' : 'pickup_scheduled'; rcvRenderQueue(); }

  if (mode === 'pickup') { rcvInitSignature(); }
}

// â”€â”€â”€ éƒµé€ãƒ•ãƒ­ãƒ¼ â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
let RCV_returnEnvelope = null;

function rcvSetReturnEnvelope(needed) {
  RCV_returnEnvelope = needed;
  document.getElementById('btn-return-yes').style.borderColor = needed ? 'var(--green)' : 'var(--border)';
  document.getElementById('btn-return-yes').style.color = needed ? 'var(--green)' : 'var(--sub)';
  document.getElementById('btn-return-no').style.borderColor = !needed ? 'var(--muted)' : 'var(--border)';
  document.getElementById('btn-return-no').style.color = !needed ? 'var(--sub)' : 'var(--sub)';
  document.getElementById('mail-return-tracking').style.display = needed ? '' : 'none';
  rcvCheckMailReady();
}

function rcvCheckMailReady() {
  const outVal = (document.getElementById('mail-outbound-no') || {}).value || '';
  const ready = outVal.length >= 10 && RCV_returnEnvelope !== null;
  const btn = document.getElementById('btn-mail-complete');
  if (btn) { btn.disabled = !ready; btn.style.opacity = ready ? '1' : '.4'; }
}

function rcvPrintLabels(mode) {
  if (!RCV.caseData) return;
  const d = RCV.caseData;
  const outboundCode = d.caseId + '-CONTRACT';
  const returnCode   = d.caseId + '-RETURN';
  const HQ_ZIP = '101-0021';
  const HQ_NAME = 'æ ªå¼ä¼šç¤¾CORETO æœ¬éƒ¨';
  const HQ_ADDR = 'æ±äº¬éƒ½åƒä»£ç”°åŒºå¤–ç¥ç”°1-1-1 CORETOæœ¬éƒ¨';

  const barcodeBar = code => `<div style="display:flex;align-items:flex-end;gap:1px;height:36px;justify-content:center;margin:5px 0">
    ${[...code].map((c,i) => `<div style="width:${(c.charCodeAt(0)%3)+1}px;height:${28+(i%5)*2}px;background:#000"></div>`).join('')}
  </div><div style="font-size:8px;font-family:'DM Mono',monospace;text-align:center;letter-spacing:1px">${code}</div>`;

  const lbl = (title,toN,toZ,toA,fromInfo,code,bg) =>
    `<div style="width:90mm;border:2px solid #000;padding:5mm;background:${bg};font-family:'Noto Sans JP',sans-serif;margin-bottom:6mm;page-break-inside:avoid">
      <div style="font-size:8px;font-weight:700;border-bottom:1px solid #000;padding-bottom:2px;margin-bottom:5px">${title}</div>
      ${barcodeBar(code)}
      <div style="margin-bottom:8px"><div style="font-size:8px;color:#555">ã€’${toZ}</div><div style="font-size:8px;color:#555;margin-bottom:3px">${toA}</div><div style="font-size:15px;font-weight:700">${toN}</div></div>
      <div style="border-top:1px dashed #ccc;padding-top:4px;font-size:7px;color:#777">${fromInfo}</div>
    </div>`;

  const docStr = [...RCV.docTypes].map(t=>DOC_TYPE_LABELS[t]).join(' + ');
  const win = window.open('','_blank','width=700,height=600');
  win.document.write(`<!DOCTYPE html><html><head><meta charset="UTF-8">
    <link href="https://fonts.googleapis.com/css2?family=Noto+Sans+JP:wght@400;700&family=DM+Mono&display=swap" rel="stylesheet">
    <style>body{background:#e0e0e0;display:flex;flex-direction:column;align-items:center;justify-content:center;min-height:100vh;padding:20px;font-family:'Noto Sans JP',sans-serif}
    .lw{background:#fff;border-radius:4px;box-shadow:0 2px 8px rgba(0,0,0,.2);padding:10mm;margin-bottom:10px}
    @media print{body{background:#fff;padding:0}.lw{box-shadow:none;padding:0;margin:0}.np{display:none}}</style>
  </head><body>
    <div class="np" style="margin-bottom:16px;display:flex;gap:12px;align-items:center">
      <strong>ãƒ©ãƒ™ãƒ«å°åˆ· â€” ${d.caseId} ${d.clientName}æ§˜ï¼ˆ${docStr}ï¼‰</strong>
      <button onclick="window.print()" style="background:#1a1a2e;color:#c9a84c;border:1px solid #c9a84c;border-radius:6px;padding:6px 16px;cursor:pointer;font-size:12px">ğŸ–¨ï¸ å°åˆ·</button>
      <button onclick="window.close()" style="background:transparent;border:1px solid #ccc;border-radius:6px;padding:6px 16px;cursor:pointer;font-size:12px">âœ• é–‰ã˜ã‚‹</button>
    </div>
    <div class="lw">${lbl('ğŸ“¤ å¾€è·¯ï¼ˆã‚¯ãƒ©ã‚¤ã‚¢ãƒ³ãƒˆå®›ï¼‰'+d.caseId+' æ‹…å½“:'+d.agent, d.clientName+' æ§˜', d.zip, d.addr, 'å·®å‡ºäºº: '+HQ_NAME+' ã€’'+HQ_ZIP+' '+HQ_ADDR, outboundCode, '#fff')}</div>
    ${RCV_returnEnvelope !== false ? `<div class="lw">${lbl('â†©ï¸ è¿”é€ç”¨ï¼ˆæœ¬éƒ¨å®›ï¼‰åŒå° '+d.caseId, HQ_NAME, HQ_ZIP, HQ_ADDR, 'è¿”ä¿¡ç”¨: '+d.clientName+' æ§˜ã‚ˆã‚Šã”è¿”é€ãã ã•ã„', returnCode, '#f5f5f5')}</div>` : ''}
  </body></html>`);
  win.document.close();
  showToast('ğŸ–¨ï¸ ãƒ©ãƒ™ãƒ«ã‚’å°åˆ·ä¸­...');
}

function rcvMailComplete() {
  const outVal = document.getElementById('mail-outbound-no').value;
  const retVal = RCV_returnEnvelope ? (document.getElementById('mail-return-no') || {}).value || '' : '';
  RCV.outboundNo = outVal;
  RCV.returnNo = retVal;

  // è¿½è·¡ãƒ‡ãƒ¼ã‚¿æ›´æ–°
  const dq = DOC_QUEUE.find(d => d.id === RCV.dqId);
  if (dq) { dq.outboundNo = outVal; dq.returnNo = retVal || null; dq.status = 'in_transit'; }

  // éƒµä¾¿è¿½è·¡ã‚¹ãƒˆã‚¢ã«ã‚‚è¿½åŠ 
  POSTAL_TRACKING.push({
    caseId: RCV.caseData.caseId, clientName: RCV.caseData.clientName,
    prop: RCV.caseData.prop, agent: RCV.caseData.agent,
    outboundNo: outVal, returnNo: retVal || null,
    outboundStatus: 'transit', returnStatus: retVal ? 'waiting' : null,
    registeredAt: new Date().toLocaleString('ja-JP'),
    lastChecked: new Date().toLocaleString('ja-JP'),
  });

  rcvShowComplete('mail', outVal, retVal);
}

// â”€â”€â”€ å—å–ãƒ•ãƒ­ãƒ¼ â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
function rcvPickupSearch() {
  const q = (document.getElementById('pickup-agent-search').value || '').toLowerCase();
  const el = document.getElementById('pickup-search-results');
  if (!q) { el.innerHTML = ''; return; }
  const matches = DOC_QUEUE.filter(d =>
    d.status === 'pickup_scheduled' && (
      d.agent.toLowerCase().includes(q) || d.caseId.toLowerCase().includes(q) ||
      d.clientName.includes(q) || d.agentId === q
    ));
  if (!matches.length) { el.innerHTML = '<div style="color:var(--muted);padding:8px">è©²å½“ãªã—</div>'; return; }
  el.innerHTML = matches.map(m => `
    <div style="background:rgba(34,197,94,.08);border:1px solid rgba(34,197,94,.3);border-radius:7px;padding:10px;margin-bottom:6px;cursor:pointer" onclick="rcvPickupSelect('${m.id}')">
      <div style="font-family:'DM Mono',monospace;font-size:11px;color:var(--gold)">${m.caseId}</div>
      <div style="font-size:12px;font-weight:700">${m.clientName} æ§˜ â€” ${m.agent}</div>
      <div style="font-size:10px;color:var(--muted)">${m.prop} | ${m.docTypes.map(t=>DOC_TYPE_LABELS[t]).join(' ')}</div>
    </div>`).join('');
}

function rcvPickupSelect(dqId) {
  const dq = DOC_QUEUE.find(d => d.id === dqId);
  if (!dq) return;
  RCV.dqId = dqId;
  document.getElementById('pickup-agent-search').value = dq.agent + ' / ' + dq.caseId;
  document.getElementById('pickup-search-results').innerHTML =
    `<div style="color:var(--green);font-size:11px;padding:6px">âœ… ${dq.caseId} ${dq.clientName}æ§˜ ã‚’é¸æŠã—ã¾ã—ãŸ</div>`;
}

let RCV_pickupReturn = null;
function rcvPickupSetReturn(needed) {
  RCV_pickupReturn = needed;
  document.getElementById('btn-pickup-return-yes').style.borderColor = needed ? 'var(--green)' : 'var(--border)';
  document.getElementById('btn-pickup-return-no').style.borderColor = !needed ? 'var(--muted)' : 'var(--border)';
  if (needed && RCV.caseData) rcvPrintLabels('pickup');
}

// â”€â”€â”€ ã‚µã‚¤ãƒ³æ¬„ â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
let sigCanvas, sigCtx, sigDrawing = false;
function rcvInitSignature() {
  setTimeout(() => {
    sigCanvas = document.getElementById('pickup-signature');
    if (!sigCanvas) return;
    sigCtx = sigCanvas.getContext('2d');
    sigCtx.strokeStyle = '#c9a84c';
    sigCtx.lineWidth = 2;
    sigCtx.lineCap = 'round';
    sigCanvas.onmousedown = e => { sigDrawing = true; sigCtx.beginPath(); sigCtx.moveTo(e.offsetX, e.offsetY); };
    sigCanvas.onmousemove = e => { if(!sigDrawing) return; sigCtx.lineTo(e.offsetX, e.offsetY); sigCtx.stroke(); };
    sigCanvas.onmouseup = sigCanvas.onmouseleave = () => sigDrawing = false;
    sigCanvas.ontouchstart = e => { e.preventDefault(); const t=e.touches[0],r=sigCanvas.getBoundingClientRect(); sigDrawing=true; sigCtx.beginPath(); sigCtx.moveTo(t.clientX-r.left,t.clientY-r.top); };
    sigCanvas.ontouchmove = e => { e.preventDefault(); if(!sigDrawing) return; const t=e.touches[0],r=sigCanvas.getBoundingClientRect(); sigCtx.lineTo(t.clientX-r.left,t.clientY-r.top); sigCtx.stroke(); };
    sigCanvas.ontouchend = () => sigDrawing = false;
  }, 100);
}
function clearSignature() { if(sigCtx&&sigCanvas) sigCtx.clearRect(0,0,sigCanvas.width,sigCanvas.height); }

function rcvPickupComplete() {
  const dq = DOC_QUEUE.find(d => d.id === RCV.dqId);
  if (dq) { dq.status = 'complete'; rcvRenderQueue(); }
  rcvShowComplete('pickup', '', '');
}

// â”€â”€â”€ å®Œäº† â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
function rcvShowComplete(mode, outNo, retNo) {
  const d = RCV.caseData || {};
  const docStr = [...(RCV.docTypes||[])].map(t=>DOC_TYPE_LABELS[t]).join(' + ');
  const modeStr = mode === 'mail' ? 'éƒµé€ç™ºé€' : 'äº‹å‹™æ‰€å—å–';
  document.getElementById('rcv-complete-summary').innerHTML = [
    `æ¡ˆä»¶: ${d.caseId} ${d.clientName} æ§˜`,
    `æ›¸é¡: ${docStr}`,
    `å¯¾å¿œ: ${modeStr}`,
    outNo ? `å¾€è·¯è¿½è·¡ç•ªå·: ${outNo}` : '',
    retNo ? `è¿”é€ç”¨è¿½è·¡ç•ªå·: ${retNo}` : '',
    `æ‹…å½“AG: ${d.agent} ã«è¨˜éŒ²ã‚’é€šçŸ¥ã—ã¾ã—ãŸ`,
  ].filter(Boolean).join('\n');
  rcvGoStep(4);
  rcvRenderQueue();
  showToast(`âœ… ${d.caseId} ã®å‡¦ç†ãŒå®Œäº†ã—ã¾ã—ãŸ`);
}

function rcvReset() {
  RCV = { step:0, caseData:null, docTypes:new Set(), memo:'', scanFiles:[], mode:null, returnEnvelope:null, outboundNo:'', returnNo:'', dqId:null };
  RCV_returnEnvelope = null;
  RCV_pickupReturn = null;
  document.getElementById('rcv-search').value = '';
  document.getElementById('rcv-memo').value = '';
  document.getElementById('rcv-case-selected').style.display = 'none';
  document.getElementById('scan-file-list').innerHTML = '';
  ['contract','key','additional','other'].forEach(t => document.getElementById('dt-'+t).classList.remove('selected'));
  const modeSelector = document.getElementById('s3-mode-selector');
  if (modeSelector) modeSelector.innerHTML = '';
  document.getElementById('btn-send-slack').textContent = 'ğŸ“¤ Slackã§é€šçŸ¥ã‚’é€ä¿¡';
  document.getElementById('btn-send-slack').style.background = '#4a154b';
  rcvFilterList();
  rcvGoStep(0);
}

// â”€â”€â”€ å¾…æ©Ÿä¸­ã‚­ãƒ¥ãƒ¼ä¸€è¦§ â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
function rcvRenderQueue() {
  const filterStatus = (document.getElementById('queue-filter') || {}).value || '';
  const list = filterStatus ? DOC_QUEUE.filter(d => d.status === filterStatus) : DOC_QUEUE;
  const el = document.getElementById('rcv-queue-list');
  if (!el) return;
  if (!list.length) { el.innerHTML = '<div style="text-align:center;padding:20px;color:var(--muted);font-size:11px">å¾…æ©Ÿä¸­ã®æ›¸é¡ãªã—</div>'; return; }
  el.innerHTML = list.map(d => {
    const st = QUEUE_STATUS_MAP[d.status] || {};
    const docStr = (d.docTypes||[]).map(t=>DOC_TYPE_LABELS[t]).join(' ');
    return `<div class="queue-card">
      <div style="display:flex;align-items:center;justify-content:space-between;margin-bottom:6px">
        <span style="font-family:'DM Mono',monospace;font-size:10px;color:var(--gold)">${d.caseId}</span>
        <span class="queue-badge" style="background:${st.bg};color:${st.color}">${st.label||d.status}</span>
      </div>
      <div style="font-weight:700;font-size:12px;margin-bottom:3px">${d.clientName} æ§˜</div>
      <div style="font-size:10px;color:var(--muted);margin-bottom:4px">ğŸ‘¤ ${d.agent} | ${d.prop}</div>
      <div style="font-size:10px;color:var(--sub);margin-bottom:6px">${docStr}</div>
      ${d.outboundNo ? `<div style="font-size:10px;font-family:'DM Mono',monospace;color:var(--muted)">ğŸ“¤ ${d.outboundNo}${d.returnNo?' | â†©ï¸ '+d.returnNo:''}</div>` : ''}
      <div style="display:flex;justify-content:space-between;margin-top:6px;font-size:9px;color:var(--muted)">
        <span>åˆ°ç€: ${d.arrivedAt}</span>
        ${d.status==='pickup_scheduled' ? `<button onclick="rcvGoToPickup('${d.id}')" style="background:rgba(34,197,94,.15);border:1px solid rgba(34,197,94,.3);color:var(--green);border-radius:4px;padding:2px 8px;cursor:pointer;font-size:9px;font-family:inherit">æ¥åº—å‡¦ç† â†’</button>` : ''}
      </div>
    </div>`;
  }).join('');
}

function rcvGoToPickup(dqId) {
  const dq = DOC_QUEUE.find(d => d.id === dqId);
  if (!dq) return;
  // æ¡ˆä»¶ã‚’è‡ªå‹•ã‚»ãƒƒãƒˆ
  const caseData = WAITING_CASES.find(c => c.caseId === dq.caseId);
  if (caseData) RCV.caseData = caseData;
  RCV.dqId = dqId;
  RCV.docTypes = new Set(dq.docTypes);
  rcvGoStep(3);
  rcvSetMode('pickup');
  document.getElementById('pickup-agent-search').value = dq.agent + ' / ' + dq.caseId;
  document.getElementById('pickup-search-results').innerHTML =
    `<div style="color:var(--green);font-size:11px;padding:6px">âœ… ${dq.caseId} ${dq.clientName}æ§˜ ãŒæ¥åº—ã—ã¾ã—ãŸ</div>`;
}



// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
// éƒµä¾¿è¿½è·¡API
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

// è¿½è·¡ãƒ‡ãƒ¼ã‚¿ã‚¹ãƒˆã‚¢ï¼ˆæœ¬ç•ªã¯DB/Kintoneã‹ã‚‰å–å¾—ï¼‰
let POSTAL_TRACKING = [
  { caseId:'R042857', clientName:'ç”°ä¸­ é›„ä»‹', prop:'æ¸‹è°·åŒºæ¡œä¸˜ 2LDK', agent:'å±±ç”° èª ',
    outboundNo:'123456789012', returnNo:'234567890123',
    outboundStatus:'delivered', returnStatus:'transit',
    registeredAt:'2026/2/22 10:30', lastChecked:'2026/2/24 09:00' },
  { caseId:'R041003', clientName:'æ–è—¤ äº®', prop:'æ–°å®¿åŒºè¥¿æ–°å®¿ 1LDK', agent:'éˆ´æœ¨ å¥å¤ª',
    outboundNo:'345678901234', returnNo:null,
    outboundStatus:'transit', returnStatus:null,
    registeredAt:'2026/2/23 14:15', lastChecked:'2026/2/24 08:45' },
  { caseId:'R038215', clientName:'ä½ã€…æœ¨ æµ', prop:'è±Šå³¶åŒºå—æ± è¢‹ 2LDK', agent:'ä½è—¤ èŠ±å­',
    outboundNo:'456789012345', returnNo:'567890123456',
    outboundStatus:'delivered', returnStatus:'returned',
    registeredAt:'2026/2/20 11:00', lastChecked:'2026/2/24 09:00' },
];

const POSTAL_STATUS_MAP = {
  transit:   { label:'ğŸšš é…é€ä¸­',    color:'var(--blue)',   bg:'rgba(59,130,246,.12)'  },
  delivered: { label:'ğŸ“¬ é…é”å®Œäº†',  color:'var(--green)',  bg:'rgba(34,197,94,.12)'   },
  waiting:   { label:'â³ è¿”é€å¾…ã¡',  color:'var(--orange)', bg:'rgba(245,158,11,.12)'  },
  returned:  { label:'âœ… è¿”é€å—å–æ¸ˆ', color:'#a855f7',       bg:'rgba(168,85,247,.12)'  },
  absent:    { label:'ğŸ”” ä¸åœ¨æŒæˆ»ã‚Š', color:'var(--red)',    bg:'rgba(239,68,68,.12)'   },
};

let autoRefreshTimer = null;

function renderPostalList() {
  const filterStatus = document.getElementById('postal-filter-status').value;
  const filterDir    = document.getElementById('postal-filter-dir').value;

  let list = POSTAL_TRACKING.filter(t => {
    if (filterStatus) {
      const match = t.outboundStatus === filterStatus || t.returnStatus === filterStatus;
      if (!match) return false;
    }
    if (filterDir === 'outbound') return true;
    if (filterDir === 'return')   return t.returnNo;
    return true;
  });

  const el = document.getElementById('postal-list');
  if (!list.length) {
    el.innerHTML = '<div style="text-align:center;padding:24px;color:var(--muted);font-size:12px">è¿½è·¡å¯¾è±¡ãªã—</div>';
    return;
  }

  el.innerHTML = list.map(t => {
    const ob = POSTAL_STATUS_MAP[t.outboundStatus] || {};
    const rt = t.returnStatus ? (POSTAL_STATUS_MAP[t.returnStatus] || {}) : null;
    return `
      <div style="background:var(--card);border:1px solid var(--border);border-radius:10px;padding:14px">
        <div style="display:flex;align-items:center;justify-content:space-between;margin-bottom:8px">
          <div>
            <span style="font-family:'DM Mono',monospace;font-size:11px;color:var(--gold)">${t.caseId}</span>
            <span style="font-size:12px;font-weight:700;margin-left:10px">${t.clientName} æ§˜</span>
          </div>
          <button onclick="refreshSingleTracking('${t.caseId}')"
            style="background:var(--hover);border:1px solid var(--border);color:var(--sub);border-radius:5px;padding:3px 10px;cursor:pointer;font-size:10px;font-family:inherit">
            ğŸ”„ æ›´æ–°
          </button>
        </div>
        <div style="font-size:11px;color:var(--muted);margin-bottom:10px">ğŸ  ${t.prop} | ğŸ‘¤ ${t.agent}</div>

        <div style="display:grid;grid-template-columns:1fr 1fr;gap:8px;margin-bottom:8px">
          <!-- å¾€è·¯ -->
          <div style="background:var(--hover);border-radius:7px;padding:10px">
            <div style="font-size:9px;color:var(--muted);margin-bottom:5px;letter-spacing:.5px">ğŸ“¤ å¾€è·¯ï¼ˆâ†’ã‚¯ãƒ©ã‚¤ã‚¢ãƒ³ãƒˆï¼‰</div>
            <div style="font-family:'DM Mono',monospace;font-size:11px;color:var(--sub);margin-bottom:6px">${t.outboundNo}</div>
            <div style="display:inline-block;font-size:11px;padding:2px 10px;border-radius:12px;background:${ob.bg||'var(--hover)'};color:${ob.color||'var(--muted)'}">${ob.label||'â€”'}</div>
          </div>
          <!-- è¿”è·¯ -->
          <div style="background:var(--hover);border-radius:7px;padding:10px">
            <div style="font-size:9px;color:var(--muted);margin-bottom:5px;letter-spacing:.5px">â†©ï¸ è¿”è·¯ï¼ˆâ†’æœ¬éƒ¨ï¼‰</div>
            <div style="font-family:'DM Mono',monospace;font-size:11px;color:var(--sub);margin-bottom:6px">${t.returnNo || 'â€•'}</div>
            ${rt ? `<div style="display:inline-block;font-size:11px;padding:2px 10px;border-radius:12px;background:${rt.bg||'var(--hover)'};color:${rt.color||'var(--muted)'}">${rt.label}</div>` : '<div style="font-size:11px;color:var(--muted)">æœªç™»éŒ²</div>'}
          </div>
        </div>

        <div style="display:flex;justify-content:space-between;font-size:10px;color:var(--muted)">
          <span>ç™»éŒ²: ${t.registeredAt}</span>
          <span>æœ€çµ‚ç¢ºèª: ${t.lastChecked}</span>
        </div>
      </div>
    `;
  }).join('');
}

function lookupTracking() {
  const no = document.getElementById('manual-track-no').value.trim();
  const el = document.getElementById('manual-track-result');
  if (!no || no.length < 10) {
    el.innerHTML = '<span style="color:var(--red)">âŒ 10æ¡ä»¥ä¸Šã®è¿½è·¡ç•ªå·ã‚’å…¥åŠ›ã—ã¦ãã ã•ã„</span>';
    return;
  }

  // æ—¥æœ¬éƒµä¾¿APIç…§ä¼šï¼ˆCORSåˆ¶é™ã®ãŸã‚KintoneçµŒç”±ã€ã“ã“ã§ã¯ã‚·ãƒŸãƒ¥ãƒ¬ãƒ¼ã‚·ãƒ§ãƒ³ï¼‰
  el.innerHTML = '<span style="color:var(--muted)">âŸ³ ç…§ä¼šä¸­...</span>';
  setTimeout(() => {
    const mockResults = {
      '123456789012': 'é…é”å®Œäº† â€” 2026/02/23 12:35 æ¸‹è°·åŒº é…é”æ¸ˆ',
      '234567890123': 'é…é€ä¸­ â€” 2026/02/24 08:00 å“å·æ”¯åº— é€šé',
      '345678901234': 'é…é€ä¸­ â€” 2026/02/24 09:15 æ–°å®¿æ”¯åº— é€šé',
    };
    const res = mockResults[no] || `ç…§ä¼šçµæœ: ç•ªå· ${no} ã¯ç¾åœ¨ç§»é€ä¸­ã§ã™ï¼ˆ2026/02/24 æ›´æ–°ï¼‰`;
    el.innerHTML = `<div style="background:var(--hover);border:1px solid var(--border);border-radius:6px;padding:10px;font-size:12px">
      <div style="color:var(--gold);margin-bottom:4px;font-family:'DM Mono',monospace">${no}</div>
      <div style="color:#e8eaf0">${res}</div>
      <div style="font-size:10px;color:var(--muted);margin-top:6px">å‡ºå…¸: æ—¥æœ¬éƒµä¾¿ e-ãŠçŸ¥ã‚‰ã›ã‚·ã‚¹ãƒ†ãƒ ï¼ˆã‚·ãƒŸãƒ¥ãƒ¬ãƒ¼ã‚·ãƒ§ãƒ³ï¼‰</div>
    </div>`;
  }, 800);
}

function testApiConnection() {
  const badge = document.getElementById('api-connection-badge');
  badge.textContent = 'â— æ¥ç¶šãƒ†ã‚¹ãƒˆä¸­...';
  badge.style.background = 'rgba(245,158,11,.15)';
  badge.style.color = 'var(--orange)';
  badge.style.borderColor = 'rgba(245,158,11,.3)';
  setTimeout(() => {
    // æœ¬ç•ª: æ—¥æœ¬éƒµä¾¿APIã‚¨ãƒ³ãƒ‰ãƒã‚¤ãƒ³ãƒˆã¸ã®Ping
    badge.textContent = 'â— æ¥ç¶šOKï¼ˆã‚·ãƒŸãƒ¥ãƒ¬ãƒ¼ã‚·ãƒ§ãƒ³ï¼‰';
    badge.style.background = 'rgba(34,197,94,.15)';
    badge.style.color = 'var(--green)';
    badge.style.borderColor = 'rgba(34,197,94,.3)';
    showToast('âœ… éƒµä¾¿å±€APIã«æ¥ç¶šã—ã¾ã—ãŸï¼ˆKintone ProxyçµŒç”±ï¼‰');
  }, 1200);
}

function refreshSingleTracking(caseId) {
  const t = POSTAL_TRACKING.find(p => p.caseId === caseId);
  if (!t) return;
  showToast(`âŸ³ ${caseId} ã‚’æ›´æ–°ä¸­...`);
  setTimeout(() => {
    t.lastChecked = new Date().toLocaleString('ja-JP');
    renderPostalList();
    showToast(`âœ… ${caseId} æ›´æ–°å®Œäº†`);
  }, 800);
}

function refreshAllTracking() {
  showToast('âŸ³ å…¨ä»¶æ›´æ–°ä¸­...');
  setTimeout(() => {
    POSTAL_TRACKING.forEach(t => { t.lastChecked = new Date().toLocaleString('ja-JP'); });
    renderPostalList();
    showToast(`âœ… ${POSTAL_TRACKING.length}ä»¶ã‚’æ›´æ–°ã—ã¾ã—ãŸ`);
  }, 1200);
}

function toggleAutoRefresh() {
  const on = document.getElementById('auto-refresh-toggle').checked;
  const interval = parseInt(document.getElementById('refresh-interval').value);
  const statusEl = document.getElementById('auto-refresh-status');
  if (on) {
    autoRefreshTimer = setInterval(refreshAllTracking, interval * 1000);
    statusEl.textContent = `è‡ªå‹•æ›´æ–°: å®Ÿè¡Œä¸­ï¼ˆ${interval/60}åˆ†ã”ã¨ï¼‰`;
    statusEl.style.color = 'var(--green)';
  } else {
    clearInterval(autoRefreshTimer);
    statusEl.textContent = 'è‡ªå‹•æ›´æ–°: åœæ­¢ä¸­';
    statusEl.style.color = 'var(--muted)';
  }
}

</script>
</body>
</html>