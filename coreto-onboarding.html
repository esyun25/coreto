<!DOCTYPE html>
<html lang="ja">
<head>
  <!-- â”€â”€ Content Security Policy (XSSè»½æ¸›) â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
       å¤‰æ›´æ™‚: ä½¿ç”¨ã™ã‚‹å¤–éƒ¨ã‚µãƒ¼ãƒ“ã‚¹ã®ã‚ªãƒªã‚¸ãƒ³ã‚’è¿½åŠ ã—ã¦ãã ã•ã„
       Kintoneè¿½åŠ æ™‚: connect-src ã« *.cybozu.com ã‚’è¿½åŠ 
  â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ -->
  <meta http-equiv="Content-Security-Policy" content="
    default-src 'self';
    script-src 'self' 'unsafe-inline'
      https://cdnjs.cloudflare.com
      https://js.stripe.com
      https://cdn-cgi/scripts;
    style-src 'self' 'unsafe-inline'
      https://fonts.googleapis.com;
    font-src 'self'
      https://fonts.gstatic.com;
    img-src 'self' data: blob:;
    connect-src 'self'
      https://hooks.slack.com
      https://hooks.zapier.com
      https://api.stripe.com
      https://js.stripe.com
      https://www.houjin-bangou.nta.go.jp
      https://www.retio.or.jp;
    frame-src 'none';
    object-src 'none';
    base-uri 'self';
  ">

<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>CORETO â€” ç ”ä¿®ãƒ»ã‚ªãƒ³ãƒœãƒ¼ãƒ‡ã‚£ãƒ³ã‚°</title>
<style>
@import url('https://fonts.googleapis.com/css2?family=Noto+Sans+JP:wght@300;400;500;700&family=DM+Mono:wght@400;500&family=Syne:wght@700;800&display=swap');
*{box-sizing:border-box;margin:0;padding:0}
:root{
  --bg:#07090f;--card:#0f1119;--card2:#141720;--border:#1e2235;--border2:#252a3d;
  --gold:#c9a84c;--gold-dim:#7a5f22;
  --blue:#4f9cf9;--green:#34d399;--red:#f87171;--orange:#fb923c;--purple:#a78bfa;
  --muted:#4a5270;--sub:#7a849e;--text:#e2e6f3;
}
html,body{height:100%;font-family:'Noto Sans JP',sans-serif;background:var(--bg);color:var(--text)}
.hdr{height:54px;display:flex;align-items:center;justify-content:space-between;
  padding:0 26px;border-bottom:1px solid var(--border);background:rgba(7,9,15,.95);position:sticky;top:0;z-index:100}
.logo{font-family:'Syne',sans-serif;font-size:17px;font-weight:800;color:var(--gold);letter-spacing:3px}
.layout{display:flex;height:calc(100vh - 54px)}
.sidebar{width:220px;flex-shrink:0;border-right:1px solid var(--border);background:var(--card);overflow-y:auto;padding:12px 0}
.sb-sec{font-size:8px;color:var(--muted);letter-spacing:2px;text-transform:uppercase;padding:12px 16px 5px}
.sb-item{display:flex;align-items:center;gap:9px;padding:9px 16px;font-size:12px;cursor:pointer;
  color:var(--sub);transition:.15s;border-left:2px solid transparent}
.sb-item:hover{color:var(--text);background:rgba(255,255,255,.025)}
.sb-item.on{color:var(--blue);background:rgba(79,156,249,.07);border-left-color:var(--blue)}
.main{flex:1;overflow-y:auto;padding:26px 30px 80px}
.card{background:var(--card);border:1px solid var(--border);border-radius:14px;margin-bottom:14px}
.ch{padding:12px 20px;border-bottom:1px solid var(--border);display:flex;align-items:center;justify-content:space-between}
.ch-t{font-size:9px;color:var(--muted);letter-spacing:2px;text-transform:uppercase;display:flex;align-items:center;gap:8px}
.ch-t::before{content:'';width:3px;height:11px;border-radius:2px;background:var(--gold)}
.cb{padding:18px 20px}
.pill{display:inline-flex;align-items:center;gap:4px;padding:3px 10px;border-radius:6px;font-size:9px;font-weight:700}
.pg{background:rgba(52,211,153,.13);color:var(--green);border:1px solid rgba(52,211,153,.3)}
.pb{background:rgba(79,156,249,.12);color:var(--blue);border:1px solid rgba(79,156,249,.25)}
.po{background:rgba(251,146,60,.12);color:var(--orange);border:1px solid rgba(251,146,60,.3)}
.pm{background:rgba(74,82,112,.15);color:var(--sub);border:1px solid var(--border2)}
.btn{padding:8px 16px;border-radius:9px;font-size:11px;font-weight:700;cursor:pointer;
  font-family:'Noto Sans JP',sans-serif;transition:.15s;border:none;display:inline-flex;align-items:center;gap:6px}
.btn-blue{background:linear-gradient(135deg,var(--blue),#3070c0);color:#fff}
.btn-ghost{background:transparent;border:1px solid var(--border2);color:var(--sub)}
.btn-ghost:hover{color:var(--text)}
.btn-ok{background:rgba(52,211,153,.12);border:1px solid rgba(52,211,153,.3);color:var(--green)}
.btn-sm{padding:4px 10px;font-size:10px;border-radius:6px}
/* Progress ring */
.ring-wrap{position:relative;width:90px;height:90px;flex-shrink:0}
.ring-wrap svg{transform:rotate(-90deg)}
.ring-label{position:absolute;inset:0;display:flex;flex-direction:column;align-items:center;justify-content:center}
/* Task item */
.task{display:flex;align-items:flex-start;gap:12px;padding:12px 0;border-bottom:1px solid var(--border)}
.task:last-child{border:none;padding-bottom:0}
.task-check{width:22px;height:22px;border-radius:6px;border:2px solid var(--border2);flex-shrink:0;
  display:flex;align-items:center;justify-content:center;cursor:pointer;transition:.15s;margin-top:1px}
.task-check.done{background:var(--green);border-color:var(--green);color:#0a0c10;font-size:12px}
.task-check.done::after{content:'âœ“'}
.task-check:not(.done):hover{border-color:var(--blue)}
.task-body{flex:1}
.task-title{font-size:13px;font-weight:600;margin-bottom:3px}
.task-title.done{text-decoration:line-through;color:var(--muted)}
.task-sub{font-size:11px;color:var(--sub);line-height:1.6}
.task-tags{display:flex;gap:6px;margin-top:6px;flex-wrap:wrap}
.task-tag{font-size:9px;padding:2px 8px;border-radius:5px;font-weight:700;
  background:rgba(74,82,112,.15);color:var(--muted);border:1px solid var(--border2)}
/* Phase headers */
.phase-hdr{display:flex;align-items:center;gap:10px;padding:10px 0;margin-bottom:4px}
.phase-line{flex:1;height:1px;background:var(--border)}
.phase-label{font-size:9px;color:var(--muted);letter-spacing:2px;text-transform:uppercase;white-space:nowrap}
/* HQ Table */
.tbl{width:100%;border-collapse:collapse}
.tbl th{padding:8px 14px;font-size:9px;color:var(--muted);font-weight:700;letter-spacing:.5px;text-transform:uppercase;border-bottom:1px solid var(--border);background:var(--card2);text-align:left}
.tbl td{padding:10px 14px;border-bottom:1px solid rgba(30,34,53,.5);font-size:12px;vertical-align:middle}
.tbl tr:last-child td{border:none}
/* Progress bar */
.pbar{height:6px;background:var(--border);border-radius:3px;overflow:hidden;width:100%}
.pfill{height:100%;border-radius:3px;background:linear-gradient(90deg,var(--blue),var(--green));transition:.5s}
::-webkit-scrollbar{width:4px}::-webkit-scrollbar-thumb{background:var(--border2);border-radius:2px}

/* â”€â”€ ç´¹ä»‹ãƒªãƒ³ã‚¯ãƒ¢ãƒ¼ãƒ€ãƒ« â”€â”€ */
#ref-modal-overlay{display:none;position:fixed;inset:0;background:rgba(0,0,0,.65);z-index:9000;align-items:center;justify-content:center}
#ref-modal-overlay.open{display:flex}
#ref-modal{background:var(--card);border:1px solid var(--border2);border-radius:16px;padding:0;width:min(460px,92vw);overflow:hidden}
.ref-mhdr{padding:16px 20px;border-bottom:1px solid var(--border);display:flex;align-items:center;justify-content:space-between}
.ref-mhdr-t{font-family:'Syne',sans-serif;font-size:14px;font-weight:800;color:var(--gold)}
.ref-mbody{padding:20px}
.ref-url{background:var(--card2);border:1px solid var(--border2);border-radius:8px;padding:10px 12px;font-family:'DM Mono',monospace;font-size:11px;color:var(--sub);word-break:break-all;margin:10px 0;min-height:36px}
.ref-copy-btn{width:100%;padding:10px;border-radius:8px;border:none;cursor:pointer;font-family:inherit;font-size:13px;font-weight:700;background:var(--gold);color:#0a0c10;margin-top:4px}

/* â•â•â• RESPONSIVE â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• */
@media(max-width:768px){
  .hdr{padding:0 12px;height:48px}
  .layout{flex-direction:column;height:auto;min-height:calc(100vh - 48px)}
  .sidebar{
    width:100%;height:auto;border-right:none;
    border-bottom:1px solid var(--border);
    display:flex;flex-direction:row;overflow-x:auto;
    padding:0;flex-shrink:0;-webkit-overflow-scrolling:touch;
  }
  .sb-sec{display:none}
  .sb-item{
    white-space:nowrap;flex-shrink:0;padding:10px 14px;
    border-left:none;border-bottom:2px solid transparent;
  }
  .sb-item.on{border-bottom-color:var(--gold);border-left:none;background:transparent;color:var(--gold)}
  .main{padding:14px 12px 60px;overflow-y:visible}
  .tbl{min-width:480px}
  .card-body{overflow-x:auto}
  /* repeat(3,1fr) â†’ 1fr 1fr */
  .g3,.step-grid,.kpi-row{grid-template-columns:1fr 1fr !important}
}
@media(max-width:480px){
  .g3,.step-grid,.kpi-row{grid-template-columns:1fr !important}
}
</style>.ref-copy-btn:hover{opacity:.9}
</style>
</head>
<body>
<div class="hdr">
  <div style="display:flex;align-items:center;gap:12px">
    <div class="logo">CORETO</div>
    <div style="width:1px;height:18px;background:var(--border2)"></div>
    <span style="font-size:10px;color:var(--muted);letter-spacing:1px">ç ”ä¿®ãƒ»ã‚ªãƒ³ãƒœãƒ¼ãƒ‡ã‚£ãƒ³ã‚°</span>
  </div>
  <div style="display:flex;gap:8px">
    <button class="btn btn-ghost btn-sm" onclick="window.location.href='coreto-hub.html'">ğŸ  ãƒ›ãƒ¼ãƒ </button>
  </div>
</div>
<div class="layout">
  <div class="sidebar">
    <div class="sb-sec">ãƒ¡ãƒ‹ãƒ¥ãƒ¼</div>
    <div class="sb-item on" id="sb-my"   onclick="showPage('my')"><span>ğŸ“‹</span>è‡ªåˆ†ã®é€²æ—</div>
    <div class="sb-item" id="sb-hq" onclick="showPage('hq')" style="display:none"><span>ğŸ¢</span>HQç®¡ç†</div>

    <div class="sb-sec" style="margin-top:8px">ç´¹ä»‹</div>
    <div class="sb-item" onclick="openRefModal()" style="color:var(--gold)"><span>ğŸ”—</span>ç´¹ä»‹ãƒªãƒ³ã‚¯ç™ºè¡Œ</div>  </div>
  <div class="main" id="main"></div>
</div>
<script src="db.js"></script>
<script>
// â•â• AUTH GUARD (è¦ãƒ­ã‚°ã‚¤ãƒ³) â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
(function() {
  var s = null;
  try { s = JSON.parse(sessionStorage.getItem('coreto_session') || 'null'); } catch(e) {}
  if (!s || !s.userId || !s.type) {
    sessionStorage.setItem('coreto_redirect', window.location.href);
    location.replace('coreto-login.html');
    return;
  }
  if (!s.sessionToken || s.sessionToken.length !== 64) {
    sessionStorage.removeItem('coreto_session');
    location.replace('coreto-login.html');
    return;
  }
  var _la = new Date(s.loginAt).getTime();
  if (isNaN(_la) || (Date.now() - _la) > 28800000) {
    sessionStorage.removeItem('coreto_session');
    alert('ã‚»ãƒƒã‚·ãƒ§ãƒ³ã®æœ‰åŠ¹æœŸé™ãŒåˆ‡ã‚Œã¾ã—ãŸã€‚å†åº¦ãƒ­ã‚°ã‚¤ãƒ³ã—ã¦ãã ã•ã„ã€‚');
    location.replace('coreto-login.html');
    return;
  }
  window._SESSION = s;
})();

const SESSION_KEY = 'coreto_session';
const s = (() => { try { return JSON.parse(sessionStorage.getItem(SESSION_KEY)||'{}'); } catch(e){return {};} })();
const ME = { id: s.id||'10012', name: s.name||'å±±ç”° èª ', type: s.type||'re' };

// ã‚¿ã‚¹ã‚¯ãƒ‡ãƒ¼ã‚¿ï¼ˆREç‰ˆï¼‰
const // â”€â”€ ã‚¿ã‚¹ã‚¯å®šç¾©ï¼ˆdoneçŠ¶æ…‹ã¯DB.getOnboardingProgress()ã§ä¸Šæ›¸ãï¼‰ â”€â”€
TASKS_RE = [
  // Phase 1
  {id:1,phase:'ãƒ•ã‚§ãƒ¼ã‚º1ï¼šå…¥ä¼šæ‰‹ç¶šãï¼ˆ1é€±ç›®ï¼‰',title:'æ¥­å‹™å§”è¨—å¥‘ç´„æ›¸ã«é›»å­ç½²å',sub:'æœ€æ–°ãƒãƒ¼ã‚¸ãƒ§ãƒ³ã®å¥‘ç´„æ›¸ã‚’èª­ã¿ã€é›»å­ç½²åã§ç· çµã—ã¦ãã ã•ã„',tags:['å¿…é ˆ'],link:'coreto-contract.html',done:true},
  {id:2,phase:'ãƒ•ã‚§ãƒ¼ã‚º1ï¼šå…¥ä¼šæ‰‹ç¶šãï¼ˆ1é€±ç›®ï¼‰',title:'eKYCãƒ»æœ¬äººç¢ºèªã‚’å®Œäº†',sub:'èº«åˆ†è¨¼æ˜æ›¸ã¨è‡ªæ’®ã‚Šå†™çœŸã‚’ã‚¢ãƒƒãƒ—ãƒ­ãƒ¼ãƒ‰ã—ã€HQå¯©æŸ»ã‚’å®Œäº†ã—ã¦ãã ã•ã„',tags:['å¿…é ˆ'],link:'coreto-kyc.html',done:true},
  {id:3,phase:'ãƒ•ã‚§ãƒ¼ã‚º1ï¼šå…¥ä¼šæ‰‹ç¶šãï¼ˆ1é€±ç›®ï¼‰',title:'å£åº§æƒ…å ±ã‚’ç™»éŒ²',sub:'å ±é…¬æŒ¯è¾¼ç”¨ã®éŠ€è¡Œå£åº§ã‚’ç™»éŒ²ã—ã¦ãã ã•ã„',tags:['å¿…é ˆ'],link:'coreto-kyc.html',done:true},
  {id:4,phase:'ãƒ•ã‚§ãƒ¼ã‚º1ï¼šå…¥ä¼šæ‰‹ç¶šãï¼ˆ1é€±ç›®ï¼‰',title:'LINEã¸ã®èªè¨¼ã‚³ãƒ¼ãƒ‰å—ä¿¡ã‚’ç¢ºèª',sub:'CORETOå…¬å¼LINEã‚’å‹é”è¿½åŠ ã—ã€èªè¨¼ã‚³ãƒ¼ãƒ‰ãŒå±Šãã“ã¨ã‚’ç¢ºèªã—ã¦ãã ã•ã„',tags:['å¿…é ˆ'],done:true},
  // Phase 2
  {id:5,phase:'ãƒ•ã‚§ãƒ¼ã‚º2ï¼šã‚·ã‚¹ãƒ†ãƒ ç¿’å¾—ï¼ˆ2é€±ç›®ï¼‰',title:'ãƒã‚¤ãƒšãƒ¼ã‚¸ã‚’ç¢ºèª',sub:'ãƒ€ãƒƒã‚·ãƒ¥ãƒœãƒ¼ãƒ‰ãƒ»ãƒ„ãƒ¼ãƒ«ä¸€è¦§ãƒ»æ”¯æ‰•æ˜ç´°ã®ç¢ºèªæ–¹æ³•ã‚’æŠŠæ¡ã—ã¦ãã ã•ã„',tags:['æ¨å¥¨'],link:'coreto-agent-mypage.html',done:true},
  {id:6,phase:'ãƒ•ã‚§ãƒ¼ã‚º2ï¼šã‚·ã‚¹ãƒ†ãƒ ç¿’å¾—ï¼ˆ2é€±ç›®ï¼‰',title:'æ¡ˆä»¶ãƒœãƒ¼ãƒ‰ã®æ“ä½œã‚’ç¿’å¾—',sub:'æ¡ˆä»¶ãƒ‘ã‚¤ãƒ—ãƒ©ã‚¤ãƒ³ã§æ¡ˆä»¶ã®ç™»éŒ²ãƒ»ã‚¹ãƒ†ãƒ¼ã‚¿ã‚¹å¤‰æ›´ãƒ»ãƒ¡ãƒ¢è¿½åŠ ã‚’è©¦ã—ã¦ãã ã•ã„',tags:['æ¨å¥¨'],link:'coreto-pipeline.html',done:false},
  {id:7,phase:'ãƒ•ã‚§ãƒ¼ã‚º2ï¼šã‚·ã‚¹ãƒ†ãƒ ç¿’å¾—ï¼ˆ2é€±ç›®ï¼‰',title:'é¡§å®¢DBã®ç™»éŒ²ã‚’è©¦ã™',sub:'é¡§å®¢æƒ…å ±ã®ç™»éŒ²ãƒ»æ¤œç´¢ãƒ»å±¥æ­´ç®¡ç†ã®æ–¹æ³•ã‚’ç¢ºèªã—ã¦ãã ã•ã„',tags:['æ¨å¥¨'],link:'coreto-client-id.html',done:false},
  {id:8,phase:'ãƒ•ã‚§ãƒ¼ã‚º2ï¼šã‚·ã‚¹ãƒ†ãƒ ç¿’å¾—ï¼ˆ2é€±ç›®ï¼‰',title:'å ±é…¬è¦ç¨‹ã‚’èª­ã‚€',sub:'æˆç´„å ±é…¬ãƒ»ãƒ©ãƒ³ã‚¯åˆ¶åº¦ãƒ»ãƒã‚¤ãƒ³ãƒˆè¨ˆç®—ã‚’ç†è§£ã—ã¦ãã ã•ã„ã€‚FAQã‚‚å‚ç…§',tags:['å¿…é ˆ'],link:'coreto-faq.html',done:false},
  // Phase 3
  {id:9,phase:'ãƒ•ã‚§ãƒ¼ã‚º3ï¼šæ¥­å‹™ç¿’å¾—ï¼ˆ3ã€œ4é€±ç›®ï¼‰',title:'å†…è¦‹ä¾é ¼æ›¸ã‚’ä½œæˆã—ã¦ã¿ã‚‹',sub:'ç‰©ä»¶ã‚’é¸ã³å†…è¦‹ä¾é ¼æ›¸ã‚’ä½œæˆã™ã‚‹æµã‚Œã‚’ç·´ç¿’ã—ã¦ãã ã•ã„',tags:['å®Ÿå‹™'],link:'coreto-naiken.html',done:false},
  {id:10,phase:'ãƒ•ã‚§ãƒ¼ã‚º3ï¼šæ¥­å‹™ç¿’å¾—ï¼ˆ3ã€œ4é€±ç›®ï¼‰',title:'ITé‡èª¬ãƒã‚§ãƒƒã‚¯ãƒªã‚¹ãƒˆã‚’ç¢ºèª',sub:'ITé‡èª¬ã®å®Ÿæ–½æ‰‹é †ã¨å¿…è¦æ›¸é¡ã‚’ç†è§£ã—ã¦ãã ã•ã„',tags:['å®Ÿå‹™'],link:'coreto-it-setsu.html',done:false},
  {id:11,phase:'ãƒ•ã‚§ãƒ¼ã‚º3ï¼šæ¥­å‹™ç¿’å¾—ï¼ˆ3ã€œ4é€±ç›®ï¼‰',title:'æˆç´„å ±å‘Šã®æµã‚Œã‚’ç¢ºèª',sub:'æˆç´„æ™‚ã®å ±å‘Šæ‰‹é †ãƒ»å¿…è¦æ›¸é¡ã‚’ç¢ºèªã—ã¦ãã ã•ã„',tags:['å®Ÿå‹™'],link:'coreto-batch-close.html',done:false},
  {id:12,phase:'ãƒ•ã‚§ãƒ¼ã‚º3ï¼šæ¥­å‹™ç¿’å¾—ï¼ˆ3ã€œ4é€±ç›®ï¼‰',title:'ãƒ©ãƒ³ã‚¯ãƒ€ãƒƒã‚·ãƒ¥ãƒœãƒ¼ãƒ‰ã§ç›®æ¨™è¨­å®š',sub:'ç¾åœ¨ã®ãƒ©ãƒ³ã‚¯ã¨æ¬¡ã®ãƒ©ãƒ³ã‚¯ã¾ã§ã®ç›®æ¨™ãƒã‚¤ãƒ³ãƒˆã‚’ç¢ºèªã—ã¦ãã ã•ã„',tags:['æ¨å¥¨'],link:'coreto-rank.html',done:false},
  // Phase 4
  {id:13,phase:'ãƒ•ã‚§ãƒ¼ã‚º4ï¼šåˆæ¡ˆä»¶ï¼ˆ1ãƒ¶æœˆç›®ï¼‰',title:'åˆæ¡ˆä»¶ã‚’æ¡ˆä»¶ãƒœãƒ¼ãƒ‰ã«ç™»éŒ²',sub:'æœ€åˆã®å•ã„åˆã‚ã›ã‚’ãƒ‘ã‚¤ãƒ—ãƒ©ã‚¤ãƒ³ã«ç™»éŒ²ã—ã¦ãã ã•ã„',tags:['ãƒã‚¤ãƒ«ã‚¹ãƒˆãƒ¼ãƒ³'],done:false},
  {id:14,phase:'ãƒ•ã‚§ãƒ¼ã‚º4ï¼šåˆæ¡ˆä»¶ï¼ˆ1ãƒ¶æœˆç›®ï¼‰',title:'ååˆºã‚’ç™ºæ³¨',sub:'ãƒã‚¤ãƒšãƒ¼ã‚¸ã‹ã‚‰ååˆºã‚’ç™ºæ³¨ã—ã¦ãã ã•ã„ï¼ˆÂ¥2,000ï¼‰',tags:['æ¨å¥¨'],link:'coreto-agent-mypage.html',done:false},
];

function showPage(p) {
  ['my','hq'].forEach(id=>document.getElementById('sb-'+id).classList.toggle('on',id===p));
  if (p==='my') pageMyProgress();
  else pageHQ();
}

function pageMyProgress() {
  loadUserProgress(); // ãƒ¦ãƒ¼ã‚¶ãƒ¼ã”ã¨ã®é€²æ—ã‚’DBã‹ã‚‰èª­ã¿è¾¼ã‚€
  const done = TASKS_RE.filter(t=>t.done).length;
  const total = TASKS_RE.length;
  const pct = Math.round(done/total*100);
  const radius = 36, circ = 2*Math.PI*radius;

  document.getElementById('main').innerHTML = `
    <div style="font-family:'Syne',sans-serif;font-size:17px;font-weight:800;margin-bottom:4px">ç ”ä¿®ãƒ»ã‚ªãƒ³ãƒœãƒ¼ãƒ‡ã‚£ãƒ³ã‚°</div>
    <div style="font-size:11px;color:var(--sub);margin-bottom:20px">å…¥ä¼šã€œåˆæ¡ˆä»¶ã¾ã§ã®ã‚¹ãƒ†ãƒƒãƒ—</div>

    <!-- Progress overview -->
    <div class="card" style="margin-bottom:16px">
      <div class="ch"><div class="ch-t">å…¨ä½“é€²æ—</div></div>
      <div class="cb" style="display:flex;align-items:center;gap:24px">
        <div class="ring-wrap">
          <svg width="90" height="90" viewBox="0 0 90 90">
            <circle cx="45" cy="45" r="${radius}" fill="none" stroke="var(--border2)" stroke-width="8"/>
            <circle cx="45" cy="45" r="${radius}" fill="none" stroke="url(#rg)" stroke-width="8"
              stroke-dasharray="${circ}" stroke-dashoffset="${circ*(1-pct/100)}" stroke-linecap="round"/>
            <defs><linearGradient id="rg" x1="0%" y1="0%" x2="100%" y2="0%">
              <stop offset="0%" stop-color="var(--blue)"/><stop offset="100%" stop-color="var(--green)"/>
            </linearGradient></defs>
          </svg>
          <div class="ring-label">
            <div style="font-family:'DM Mono';font-size:20px;font-weight:700;color:var(--green)">${pct}%</div>
            <div style="font-size:9px;color:var(--muted)">å®Œäº†</div>
          </div>
        </div>
        <div style="flex:1">
          <div style="font-size:13px;font-weight:700;margin-bottom:6px">${done}/${total} ã‚¿ã‚¹ã‚¯å®Œäº†</div>
          <div style="display:flex;flex-direction:column;gap:6px">
            ${['ãƒ•ã‚§ãƒ¼ã‚º1','ãƒ•ã‚§ãƒ¼ã‚º2','ãƒ•ã‚§ãƒ¼ã‚º3','ãƒ•ã‚§ãƒ¼ã‚º4'].map((ph,i)=>{
              const phTasks = TASKS_RE.filter(t=>t.phase.startsWith(ph));
              const phDone  = phTasks.filter(t=>t.done).length;
              const phPct   = phTasks.length ? Math.round(phDone/phTasks.length*100) : 0;
              return `<div>
                <div style="display:flex;justify-content:space-between;font-size:10px;color:var(--sub);margin-bottom:3px">
                  <span>${ph}</span><span>${phDone}/${phTasks.length}</span>
                </div>
                <div class="pbar"><div class="pfill" style="width:${phPct}%"></div></div>
              </div>`;
            }).join('')}
          </div>
        </div>
        <div style="text-align:right">
          <div style="font-size:11px;color:var(--muted)">å…¥ä¼šæ—¥</div>
          <div style="font-family:'DM Mono';font-size:12px;margin-bottom:8px">2026/01/15</div>
          <div style="font-size:11px;color:var(--muted)">çµŒéæ—¥æ•°</div>
          <div style="font-family:'DM Mono';font-size:18px;color:var(--gold);font-weight:700">37æ—¥</div>
        </div>
      </div>
    </div>

    <!-- Task list -->
    <div class="card">
      <div class="ch">
        <div class="ch-t">ã‚¿ã‚¹ã‚¯ä¸€è¦§</div>
        <span class="pill pg">${done} / ${total} å®Œäº†</span>
      </div>
      <div class="cb" id="task-list">${renderTasks()}</div>
    </div>
  `;
}

function renderTasks() {
  let phases = [...new Set(TASKS_RE.map(t=>t.phase))];
  return phases.map(ph=>{
    const tasks = TASKS_RE.filter(t=>t.phase===ph);
    const allDone = tasks.every(t=>t.done);
    return `
      <div class="phase-hdr">
        <div class="phase-label">${ph}</div>
        <div class="phase-line"></div>
        ${allDone ? '<span class="pill pg" style="flex-shrink:0">âœ“ å®Œäº†</span>' : ''}
      </div>
      ${tasks.map(t=>`
        <div class="task" id="task-${t.id}">
          <div class="task-check ${t.done?'done':''}" onclick="toggleTask(${t.id})"></div>
          <div class="task-body">
            <div class="task-title ${t.done?'done':''}">${t.title}</div>
            <div class="task-sub">${t.sub}</div>
            <div class="task-tags">
              ${t.tags.map(tag=>`<span class="task-tag">${tag}</span>`).join('')}
              ${t.link ? `<a href="${t.link}" style="font-size:9px;color:var(--blue);margin-left:4px">â†’ é–‹ã</a>` : ''}
            </div>
          </div>
        </div>`).join('')}
    `;
  }).join('');
}

function toggleTask(id) {
  const t = TASKS_RE.find(t=>t.id===id);
  if (!t) return;
  t.done = !t.done;

  // â”€â”€ ãƒ¦ãƒ¼ã‚¶ãƒ¼ã”ã¨ã®é€²æ—ã‚’ä¿å­˜ â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
  const session = JSON.parse(sessionStorage.getItem('coreto_session') || 'null');
  if (session && session.userId) {
    const progress = {};
    TASKS_RE.forEach(task => { progress[task.id] = task.done; });
    if (typeof DB !== 'undefined') {
      DB.saveOnboardingProgress(session.userId, progress);
    } else {
      // db.jsãŒæœªãƒ­ãƒ¼ãƒ‰ã®å ´åˆã®ãƒ•ã‚©ãƒ¼ãƒ«ãƒãƒƒã‚¯
      const all = JSON.parse(localStorage.getItem('coreto_onboarding') || '{}');
      all[session.userId] = progress;
      localStorage.setItem('coreto_onboarding', JSON.stringify(all));
    }
  }
  // â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€

  pageMyProgress(); // re-render
}

// â”€â”€ ã‚»ãƒƒã‚·ãƒ§ãƒ³ãƒ¦ãƒ¼ã‚¶ãƒ¼ã®é€²æ—ã‚’èª­ã¿è¾¼ã‚€ â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
function loadUserProgress() {
  const session = JSON.parse(sessionStorage.getItem('coreto_session') || 'null');
  if (!session || !session.userId) return;
  let progress = {};
  if (typeof DB !== 'undefined') {
    progress = DB.getOnboardingProgress(session.userId);
  } else {
    const all = JSON.parse(localStorage.getItem('coreto_onboarding') || '{}');
    progress = all[session.userId] || {};
  }
  if (Object.keys(progress).length > 0) {
    // ä¿å­˜æ¸ˆã¿é€²æ—ã§TASKS_REã®doneçŠ¶æ…‹ã‚’ä¸Šæ›¸ã
    TASKS_RE.forEach(task => {
      if (task.id in progress) {
        task.done = progress[task.id];
      }
    });
  }
}

// â”€â”€â”€ HQç®¡ç†ãƒšãƒ¼ã‚¸ â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
function pageHQ() {
  const agents = [
    {id:'10012',name:'å±±ç”° èª ',type:'re',joined:'2026/01/15',done:6,total:14,days:37},
    {id:'10023',name:'éˆ´æœ¨ å¥å¤ª',type:'re',joined:'2026/01/20',done:3,total:14,days:32},
    {id:'10041',name:'æ¸¡è¾º éš†',type:'re',joined:'2026/02/01',done:2,total:14,days:20},
    {id:'20005',name:'ç”°ä¸­ ç¾ç©‚',type:'hr',joined:'2026/01/10',done:10,total:12,days:42},
  ];
  document.getElementById('main').innerHTML = `
    <div style="font-family:'Syne',sans-serif;font-size:17px;font-weight:800;margin-bottom:4px">ã‚ªãƒ³ãƒœãƒ¼ãƒ‡ã‚£ãƒ³ã‚°ç®¡ç†ï¼ˆHQï¼‰</div>
    <div style="font-size:11px;color:var(--sub);margin-bottom:20px">æ–°è¦ã‚¨ãƒ¼ã‚¸ã‚§ãƒ³ãƒˆã®ç ”ä¿®é€²æ—ã‚’ç®¡ç†ã—ã¾ã™</div>

    <div style="display:grid;grid-template-columns:repeat(3,1fr);gap:12px;margin-bottom:18px">
      <div class="card" style="margin:0;padding:16px">
        <div style="font-size:18px;margin-bottom:6px">ğŸ‘¥</div>
        <div style="font-family:'DM Mono';font-size:26px;color:var(--blue)">${agents.length}</div>
        <div style="font-size:10px;color:var(--muted)">ç ”ä¿®ä¸­ã‚¨ãƒ¼ã‚¸ã‚§ãƒ³ãƒˆ</div>
      </div>
      <div class="card" style="margin:0;padding:16px">
        <div style="font-size:18px;margin-bottom:6px">âš ï¸</div>
        <div style="font-family:'DM Mono';font-size:26px;color:var(--orange)">${agents.filter(a=>a.days>30&&a.done/a.total<0.5).length}</div>
        <div style="font-size:10px;color:var(--muted)">é€²æ—é…å»¶ï¼ˆ30æ—¥è¶…ãƒ»50%æœªæº€ï¼‰</div>
      </div>
      <div class="card" style="margin:0;padding:16px">
        <div style="font-size:18px;margin-bottom:6px">âœ…</div>
        <div style="font-family:'DM Mono';font-size:26px;color:var(--green)">${agents.filter(a=>a.done===a.total).length}</div>
        <div style="font-size:10px;color:var(--muted)">ç ”ä¿®å®Œäº†</div>
      </div>
    </div>

    <div class="card">
      <div class="ch"><div class="ch-t">ã‚¨ãƒ¼ã‚¸ã‚§ãƒ³ãƒˆåˆ¥é€²æ—</div></div>
      <table class="tbl">
        <thead><tr><th>ID</th><th>æ°å</th><th>ç¨®åˆ¥</th><th>å…¥ä¼šæ—¥</th><th>çµŒé</th><th>é€²æ—</th><th>å®Œäº†ã‚¿ã‚¹ã‚¯</th><th>ã‚¢ã‚¯ã‚·ãƒ§ãƒ³</th></tr></thead>
        <tbody>
          ${agents.map(a=>{
            const pct=Math.round(a.done/a.total*100);
            const warn=a.days>30&&pct<50;
            return `<tr style="${warn?'background:rgba(251,146,60,.03)':''}">
              <td class="mono">${a.id}</td>
              <td style="font-weight:700">${a.name} ${warn?'<span class="pill po">é…å»¶</span>':''}</td>
              <td><span class="pill ${a.type==='re'?'pb':'pg'}">${a.type.toUpperCase()}</span></td>
              <td class="mono" style="font-size:10px">${a.joined}</td>
              <td class="mono" style="font-size:11px">${a.days}æ—¥</td>
              <td style="min-width:100px">
                <div class="pbar"><div class="pfill" style="width:${pct}%"></div></div>
                <div style="font-size:9px;color:var(--muted);margin-top:3px">${pct}%</div>
              </td>
              <td class="mono">${a.done}/${a.total}</td>
              <td><button class="btn btn-ghost btn-sm" onclick="remind('${a.id}')">ğŸ“¨ ãƒªãƒã‚¤ãƒ³ãƒ‰</button></td>
            </tr>`;
          }).join('')}
        </tbody>
      </table>
    </div>
  `;
}

function remind(id) {
  alert(`ID:${id} ã®ã‚¨ãƒ¼ã‚¸ã‚§ãƒ³ãƒˆã«ãƒªãƒã‚¤ãƒ³ãƒ‰ã‚’LINEãƒ»Slackã§é€ä¿¡ã—ã¾ã—ãŸã€‚`);
}

showPage('my');

// â”€â”€ ç´¹ä»‹ãƒªãƒ³ã‚¯ãƒ¢ãƒ¼ãƒ€ãƒ« â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
var _refCurrentCode = '';
function openRefModal() {
  var overlay = document.getElementById('ref-modal-overlay');
  var selector = document.getElementById('ref-code-selector');
  var isExec = (typeof session !== 'undefined' && session && session.hqRole === 'exec')
            || (typeof CURRENT_USER !== 'undefined' && CURRENT_USER && CURRENT_USER.hqRole === 'exec');
  var agentId = (typeof session !== 'undefined' && session && session.userId) ? session.userId
              : (typeof ME !== 'undefined' && ME && ME.id) ? ME.id
              : (typeof AGENT !== 'undefined' && AGENT && AGENT.id) ? AGENT.id : '10012';
  if (isExec) {
    var SPECIAL = ['FOUNDER2026','WELCOME2026','GOLD_START','HR_PRO75'];
    var opts = SPECIAL.map(function(c){ return '<option value="'+c+'">â­ '+c+'</option>'; }).join('');
    selector.innerHTML =
      '<div style="margin-bottom:12px"><div style="font-size:10px;color:var(--sub);font-weight:600;margin-bottom:5px">ã‚³ãƒ¼ãƒ‰ç¨®åˆ¥</div>'
      +'<select id="ref-code-select" onchange="updateRefLink()" style="width:100%;padding:8px 10px;background:var(--card2);border:1px solid var(--border2);border-radius:8px;color:var(--text);font-size:12px;font-family:inherit">'
      +'<option value="'+agentId+'">è‡ªåˆ†ã®IDï¼ˆ'+agentId+'ï¼‰</option>'
      +'<optgroup label="â”€â”€ ç‰¹åˆ¥ã‚³ãƒ¼ãƒ‰ â”€â”€">'+opts+'</optgroup>'
      +'</select></div>';
    _refCurrentCode = agentId;
  } else {
    selector.innerHTML =
      '<div style="display:flex;align-items:center;gap:8px;margin-bottom:12px;padding:8px 12px;background:rgba(201,168,76,.06);border:1px solid rgba(201,168,76,.2);border-radius:8px">'
      +'<span style="font-size:11px;color:var(--muted)">ç´¹ä»‹ã‚³ãƒ¼ãƒ‰ï¼š</span>'
      +'<span style="font-family:\'DM Mono\',monospace;font-size:13px;font-weight:700;color:var(--gold)">'+agentId+'</span>'
      +'</div>';
    _refCurrentCode = agentId;
  }
  updateRefLink();
  overlay.classList.add('open');
}
function updateRefLink() {
  var sel = document.getElementById('ref-code-select');
  if (sel) _refCurrentCode = sel.value;
  var base = location.origin + location.pathname.replace(/[^/]*$/, '') + 'coreto-agent-signup.html';
  var url = base + '?ref=' + encodeURIComponent(_refCurrentCode);
  document.getElementById('ref-url-display').textContent = url;
}
function closeRefModal() {
  document.getElementById('ref-modal-overlay').classList.remove('open');
}
function copyRefLink() {
  var url = document.getElementById('ref-url-display').textContent;
  navigator.clipboard.writeText(url).then(function() {
    var btn = document.querySelector('.ref-copy-btn');
    btn.textContent = 'âœ… ã‚³ãƒ”ãƒ¼ã—ã¾ã—ãŸ';
    setTimeout(function(){ btn.textContent = 'ğŸ“‹ ã‚³ãƒ”ãƒ¼'; }, 2000);
  }).catch(function() {
    var ta = document.createElement('textarea');
    ta.value = url; document.body.appendChild(ta); ta.select();
    document.execCommand('copy'); document.body.removeChild(ta);
  });
}

// Role-based tab visibility
(function() {
  var s = window._SESSION;
  if (s && s.type === 'hq') {
    var el = document.getElementById('sb-hq');
    if (el) el.style.display = '';
  }
})();
</script>

<div id="ref-modal-overlay" onclick="if(event.target===this)closeRefModal()">
  <div id="ref-modal">
    <div class="ref-mhdr">
      <div class="ref-mhdr-t">ğŸ”— ç´¹ä»‹ãƒªãƒ³ã‚¯ç™ºè¡Œ</div>
      <button onclick="closeRefModal()" style="background:none;border:none;color:var(--muted);font-size:20px;cursor:pointer;line-height:1">Ã—</button>
    </div>
    <div class="ref-mbody">
      <div style="font-size:11px;color:var(--sub);margin-bottom:14px;line-height:1.8">ã“ã®ãƒªãƒ³ã‚¯ã‹ã‚‰å…¥ä¼šã™ã‚‹ã¨ç´¹ä»‹ã‚³ãƒ¼ãƒ‰ãŒè‡ªå‹•å…¥åŠ›ã•ã‚Œã¾ã™ã€‚</div>
      <div id="ref-code-selector"></div>
      <div style="font-size:10px;color:var(--muted);margin-bottom:4px;font-weight:600;letter-spacing:.5px">ç™ºè¡Œãƒªãƒ³ã‚¯</div>
      <div class="ref-url" id="ref-url-display">â€”</div>
      <button class="ref-copy-btn" onclick="copyRefLink()">ğŸ“‹ ã‚³ãƒ”ãƒ¼</button>
    </div>
  </div>
</div>
</body>
</html>
